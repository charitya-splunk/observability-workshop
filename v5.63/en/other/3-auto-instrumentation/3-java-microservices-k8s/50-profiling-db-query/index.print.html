<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.125.5"><meta name=generator content="Relearn 6.0.0+tip"><meta name=description content="1. Introduction As we have seen in the previous chapter, you can trace your interactions between the various services using APM without touching your code, which will allow you to identify issues faster. However as seen, besides tracing, Splunk Zero Config for Auto-Instrumentations offers additional features out of the box that can help you finding issues faster. In this section we are going to look at 2 of them:
Always-on Profiling and Java Metrics Database Query Performance If you want to dive deeper into Always-on Profiling or DB-Query performance, we have a separate Ninja Workshop called Debug Problems that you can follow for more detailed info."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Splunk APM Always-on Profiling & Database Query Performance :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="1. Introduction As we have seen in the previous chapter, you can trace your interactions between the various services using APM without touching your code, which will allow you to identify issues faster. However as seen, besides tracing, Splunk Zero Config for Auto-Instrumentations offers additional features out of the box that can help you finding issues faster. In this section we are going to look at 2 of them:
Always-on Profiling and Java Metrics Database Query Performance If you want to dive deeper into Always-on Profiling or DB-Query performance, we have a separate Ninja Workshop called Debug Problems that you can follow for more detailed info."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/50-profiling-db-query/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Splunk APM Always-on Profiling & Database Query Performance :: Splunk Observability Cloud Workshops"><meta property="og:description" content="1. Introduction As we have seen in the previous chapter, you can trace your interactions between the various services using APM without touching your code, which will allow you to identify issues faster. However as seen, besides tracing, Splunk Zero Config for Auto-Instrumentations offers additional features out of the box that can help you finding issues faster. In this section we are going to look at 2 of them:
Always-on Profiling and Java Metrics Database Query Performance If you want to dive deeper into Always-on Profiling or DB-Query performance, we have a separate Ninja Workshop called Debug Problems that you can follow for more detailed info."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="Ninja Workshops"><meta property="article:modified_time" content="2024-05-17T16:28:10+02:00"><meta itemprop=name content="Splunk APM Always-on Profiling & Database Query Performance :: Splunk Observability Cloud Workshops"><meta itemprop=description content="1. Introduction As we have seen in the previous chapter, you can trace your interactions between the various services using APM without touching your code, which will allow you to identify issues faster. However as seen, besides tracing, Splunk Zero Config for Auto-Instrumentations offers additional features out of the box that can help you finding issues faster. In this section we are going to look at 2 of them:
Always-on Profiling and Java Metrics Database Query Performance If you want to dive deeper into Always-on Profiling or DB-Query performance, we have a separate Ninja Workshop called Debug Problems that you can follow for more detailed info."><meta itemprop=dateModified content="2024-05-17T16:28:10+02:00"><meta itemprop=wordCount content="1469"><title>Splunk APM Always-on Profiling & Database Query Performance :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/50-profiling-db-query/index.html rel=canonical type=text/html title="Splunk APM Always-on Profiling & Database Query Performance :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.63/images/favicon.ico?1718817962 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.63/css/fontawesome-all.min.css?1718817977 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.63/css/fontawesome-all.min.css?1718817977 rel=stylesheet></noscript><link href=/observability-workshop/v5.63/css/nucleus.css?1718817977 rel=stylesheet><link href=/observability-workshop/v5.63/css/auto-complete.css?1718817977 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.63/css/auto-complete.css?1718817977 rel=stylesheet></noscript><link href=/observability-workshop/v5.63/css/perfect-scrollbar.min.css?1718817977 rel=stylesheet><link href=/observability-workshop/v5.63/css/fonts.css?1718817977 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.63/css/fonts.css?1718817977 rel=stylesheet></noscript><link href=/observability-workshop/v5.63/css/theme.css?1718817977 rel=stylesheet><link href=/observability-workshop/v5.63/css/theme-splunk-light.css?1718817977 rel=stylesheet id=R-variant-style><link href=/observability-workshop/v5.63/css/chroma-relearn-light.css?1718817977 rel=stylesheet id=R-variant-chroma-style><link href=/observability-workshop/v5.63/css/variant.css?1718817977 rel=stylesheet><link href=/observability-workshop/v5.63/css/print.css?1718817977 rel=stylesheet media=print><link href=/observability-workshop/v5.63/css/format-print.css?1718817977 rel=stylesheet><script src=/observability-workshop/v5.63/js/variant.js?1718817977></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../../../..",window.relearn.relBaseUri="../../../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.63",window.index_js_url="/observability-workshop/v5.63/en/index.search.js",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA"})</script></script><style>:root{--MAIN-WIDTH-MAX:1000rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/50-profiling-db-query/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.63/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.63/en/other/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.63/en/other/3-auto-instrumentation/index.html><span itemprop=name>Auto-Instrumentation Workshops</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/index.html><span itemprop=name>PetClinic Java Microservices Workshop (Kubernetes)</span></a><meta itemprop=position content="4">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>50. Always-on Profiling & Database Query Performance</span><meta itemprop=position content="5"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/40-traces-spans-tags/index.html title="Splunk APM features available with Zero Config Auto-Instrumentation (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/60-log-observer-connect/index.html title="Log Observer (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=splunk-apm-always-on-profiling--database-query-performance>Splunk APM Always-on Profiling & Database Query Performance</h1><h2 id=1-introduction>1. Introduction</h2><p>As we have seen in the previous chapter, you can trace your interactions between the various services using APM without touching your code, which will allow you to identify issues faster. However as seen, besides tracing, Splunk Zero Config for Auto-Instrumentations offers additional features out of the box that can help you finding issues faster. In this section we are going to look at 2 of them:</p><ul><li>Always-on Profiling and Java Metrics</li><li>Database Query Performance</li></ul><p>If you want to dive deeper into Always-on Profiling or DB-Query performance, we have a separate Ninja Workshop called <em><strong>Debug Problems</strong></em> that you can follow for more detailed info.</p><h2 id=2-alwayson-profiling-and-metrics>2. AlwaysOn Profiling and Metrics</h2><p>When we installed the Splunk Distribution of the OpenTelemetry Collector using the Helm chart earlier, we configured it to enable <strong>AlwaysOn Profiling</strong> and <strong>Metrics</strong>. This means that the collector will automatically generate CPU and Memory profiles for the application and send them to Splunk Observability Cloud.</p><p>When you deploy the PetClinic application and set the annotation, the collector automatically detects the application and instruments it for traces and profiling. We can verify this by examining the startup logs of one of the Java containers we are instrumenting by running the following script:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>.  ~/workshop/petclinic/scripts/get_logs.sh</span></span></code></pre></div><p>The logs should show what flags were picked up by the Java Auto instrumentation agent:</p><div class=tab-panel data-tab-group=d4be13c34ca3e6cc6d98d4a559f4cd25><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d4be13c34ca3e6cc6d98d4a559f4cd25","example-output")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2024/02/15 09:42:00 Problem with dial: dial tcp 10.43.104.25:8761: connect: connection refused. Sleeping 1s
</span></span><span class=line><span class=cl>2024/02/15 09:42:01 Problem with dial: dial tcp 10.43.104.25:8761: connect: connection refused. Sleeping 1s
</span></span><span class=line><span class=cl>2024/02/15 09:42:02 Connected to tcp://discovery-server:8761
</span></span><span class=line><span class=cl>Picked up JAVA_TOOL_OPTIONS:  -javaagent:/otel-auto-instrumentation-java/javaagent.jar
</span></span><span class=line><span class=cl>Picked up _JAVA_OPTIONS: -Dspring.profiles.active=docker,mysql -Dsplunk.profiler.call.stack.interval=150
</span></span><span class=line><span class=cl>OpenJDK 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:03:056 +0000] [main] INFO io.opentelemetry.javaagent.tooling.VersionLogger - opentelemetry-javaagent - version: splunk-1.30.1-otel-1.32.1
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:03:768 +0000] [main] INFO com.splunk.javaagent.shaded.io.micrometer.core.instrument.push.PushMeterRegistry - publishing metrics for SignalFxMeterRegistry every 30s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:478 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:478 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - Profiler configuration:
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:480 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                  splunk.profiler.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:505 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                splunk.profiler.directory : /tmp
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:505 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -       splunk.profiler.recording.duration : 20s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:506 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -               splunk.profiler.keep-files : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:510 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -            splunk.profiler.logs-endpoint : http://10.13.2.38:4317
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:513 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -              otel.exporter.otlp.endpoint : http://10.13.2.38:4317
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:513 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -           splunk.profiler.memory.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:515 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -             splunk.profiler.tlab.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:516 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -        splunk.profiler.memory.event.rate : 150/s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:516 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.call.stack.interval : PT0.15S
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:517 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -  splunk.profiler.include.internal.stacks : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:517 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.tracing.stacks.only : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:517 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:518 +0000] [main] INFO com.splunk.opentelemetry.profiler.JfrActivator - Profiler is active.</span></span></code></pre></div></div></div></div></div><p>We are interested in the section written by the <code>com.splunk.opentelemetry.profiler.ConfigurationLogger</code> or the <strong>Profiling Configuration</strong></p><p>We can see the various settings you can control, some that are useful depending on your use case like the <code>splunk.profiler.directory</code> - The location where the agent writes the call stacks before sending them to Splunk. This may be different depending how you configure your containers.
Another parameter you may want to change is <code>splunk.profiler.call.stack.interval</code> This is how often the system takes a CPU Stack trace. You may want to reduce this if you have short spans like we have in our application. (we kept the default as the spans in this demo application are extremely short, so Span may not always have a CPU Call Stack related to it.)</p><p>You can find how to set these parameters <a href=https://docs.splunk.com/observability/en/gdi/get-data-in/application/java/configuration/advanced-java-otel-configuration.html#profiling-configuration-java rel=external target=_blank>here</a>. Below, is how you set a higher collection rate for call stack in your <code>deployment.yaml</code>, exactly how to pass any JAVA option to the the Java application running in your container:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl> env: 
</span></span><span class=line><span class=cl>    - name: JAVA_OPTIONS
</span></span><span class=line><span class=cl>      value: &#34;-Dsplunk.profiler.call.stack.interval=150&#34;</span></span></code></pre></div><p>If you don&rsquo;t see those lines as a result from the script, the startup may have taken to long and generated to many connection errors, try looking at the logs directly with kubectl or the k9s utility that is installed.</p><h2 id=3-looking-at-profiling-data-in-the-trace-waterfall>3. Looking at Profiling Data in the Trace Waterfall</h2><p>Make sure you have your original (or similar) Trace & Span <strong>(1)</strong> selected in the APM Waterfall view and select <strong>Memory Stack Traces (2)</strong> from the right hand pane:</p><p><a href=#R-image-8865778df764a569e6a46aaa68809726 class=lightbox-link><img alt="profiling from span" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/50-profiling-db-query/../images/flamechart-in-waterfall.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8865778df764a569e6a46aaa68809726><img alt="profiling from span" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/50-profiling-db-query/../images/flamechart-in-waterfall.png></a></p><p>The pane should show you the Memory Stack Trace Flame Graph <strong>(3)</strong>, you can scroll down and/or make the pane for a better view wider by dragging the right side of the pane.</p><p>As AlwaysOn Profiling is constantly taking snapshots, or stack traces, of your application’s code and reading through thousands of stack traces is not practical, AlwaysOn Profiling aggregates and summarizes profiling data, providing a convenient way to explore Call Stacks in a view called the <strong>Flame Graph</strong>. It represents a summary of all stack traces captured from your application. You can use the Flame Graph to discover which lines of code might be causing performance issues and to confirm whether the changes you make to the code have the intended effect.</p><p>To dive deeper in the Always-on Profiling, select Span <strong>(3)</strong> in the Profiling Pane under <strong>Memory Stack Traces</strong>
This will bring you to the Always-on Profiling main screen, with the Memory view pre selected:</p><p><a href=#R-image-4cc190d19d73cc6f4cc944318b7b31a6 class=lightbox-link><img alt="Profiling main" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/50-profiling-db-query/../images/profiling-memory.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4cc190d19d73cc6f4cc944318b7b31a6><img alt="Profiling main" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/50-profiling-db-query/../images/profiling-memory.png></a></p><ul><li>Java Memory Metric Charts <strong>(1)</strong>, Allow you to <code>Monitor Heap Memory, Application Activity</code> like <code>Memory Allocation Rate</code> and <code>Garbage Collecting</code> Metrics.</li><li>Ability to focus/see metrics and Stack Traces only related to the Span <strong>(2)</strong>, This will filter out background activities running in the Java application if required.</li><li>Java Function calls identified.<strong>(3)</strong>, allowing you to drill down into the Methods called from that function.</li><li>The Flame Graph <strong>(4)</strong>, with the visualization of hierarchical based on the stack traces of the profiled service.</li></ul><p>Once you have identified the relevant Function or Method you are interested in, <code>com.mysql.cj.protocol.a.NativePacketPayload.readBytes</code> in our example but yor may differ, so pick the top one <strong>(1)</strong> and find it at the e bottom of the Flame Graph <strong>(2)</strong>. Click on it in the Flame Graph, it will show a pane as shown in the image below, where you can see the Thread information <strong>(3)</strong> by clicking on the blue <em>Show Thread Info</em> link. If you click on the <em>Copy Stack Trace</em> <strong>(4)</strong> button, you grab the actual stack trace that you can use in your coding platform to go to the actual lines of code use at this point (depending of course on your preferred Coding platform)</p><p><a href=#R-image-5a59d135878913ccd1f4bdc9b34c157d class=lightbox-link><img alt="stack trace" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/50-profiling-db-query/../images/grab-stack-trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5a59d135878913ccd1f4bdc9b34c157d><img alt="stack trace" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/50-profiling-db-query/../images/grab-stack-trace.png></a></p><p>For more detail on Profiling, check the the <strong>Debug Problems workshop</strong>, or check the documents <a href=https://docs.splunk.com/observability/en/apm/profiling/intro-profiling.html#introduction-to-alwayson-profiling-for-splunk-apm rel=external target=_blank>here</a></p><h2 id=4-database-query-performance>4. Database Query Performance</h2><p>With Database Query Performance, you can monitor the impact of your database queries on service availability directly in Splunk APM. This way, you can quickly identify long-running, unoptimized, or heavy queries and mitigate issues they might be causing, without having to instrument your databases.</p><p>To look at the performance of your database queries, make sure you are in the APM <strong>Explore</strong> page either by going back in the browser or navigate to the APM APM section in the Menu bar, then click on the <strong>Explore</strong> tile.
Select the inferred database service <code>mysql:petclinic</code> Inferred Database server in the Dependency map <strong>(1)</strong>, then scroll the right hand pane to find the <strong>Database Query Performance</strong> Pane <strong>(2)</strong>.</p><p><a href=#R-image-e33973aec82ea39de6c51bdade8a7217 class=lightbox-link><img alt="db-query from map" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/50-profiling-db-query/../images/db-query-map.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e33973aec82ea39de6c51bdade8a7217><img alt="db-query from map" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/50-profiling-db-query/../images/db-query-map.png></a></p><p>If the service you have selected in the map is indeed an (inferred) database server, this pane will populate with the top 90% (P90) database calls based on duration. To dive deeper into the db-query performance function click somewhere on the word <strong>Database Query Performance</strong> at the top of the pane.</p><p>This will bring us to the DB-query Performance overview screen:</p><p><a href=#R-image-4b8138af80d7d0746d8e621b39a9a051 class=lightbox-link><img alt="db-query full" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/50-profiling-db-query/../images/db-query-full.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4b8138af80d7d0746d8e621b39a9a051><img alt="db-query full" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/50-profiling-db-query/../images/db-query-full.png></a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Database Query Normalization</div><div class=box-content><p>By default, Splunk APM instrumentation sanitizes database queries to remove or mask sensible data, such as secrets or personal identifiable information (PII) from the db.statements. You can find how to turn off database query normalization <a href=https://docs.splunk.com/observability/en/apm/db-query-perf/db-perf-troubleshooting.html#turn-off-database-query-normalization rel=external target=_blank>here</a>.</p></div></div><p>This screen will show us all the Database queries <strong>(1)</strong> done towards our database from you application, based on the Traces & Spans send to the Splunk Observability Cloud. Note that you can compare them across a time block or sort them on Total Time, P90 Latency & Requests <strong>(2)</strong>.</p><p>For each Database query in the list, we see the hightest latency, the total number of calls during the time window, and the number of request per second <strong>(3)</strong>. This allows you to identify places where you might optimise your queries.</p><p>You can select traces containing Database Calls via the two charts in the right hand pane <strong>(5)</strong>. Use the Tag Spotlight pane <strong>(6)</strong> to drill down what tag are related to the database calls, based on endpoints or tags.</p><p>If you click on a specific Query <strong>(1)</strong> you get a detailed query Details pane appear <strong>(2)</strong>, you can use for more detailed investigations:
<a href=#R-image-0559cac8c6eb9c537a1d6c6434a81d29 class=lightbox-link><img alt=details class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/50-profiling-db-query/../images/query-details.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0559cac8c6eb9c537a1d6c6434a81d29><img alt=details class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.63/en/other/3-auto-instrumentation/3-java-microservices-k8s/50-profiling-db-query/../images/query-details.png></a></p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>Maciej Lisowski</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>May 17, 2024</span></span></footer></article></div></main></div><script src=/observability-workshop/v5.63/js/clipboard.min.js?1718817977 defer></script><script src=/observability-workshop/v5.63/js/perfect-scrollbar.min.js?1718817977 defer></script><script src=/observability-workshop/v5.63/js/theme.js?1718817977 defer></script></body></html>