<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.125.5"><meta name=generator content="Relearn 6.0.0+tip"><meta name=description content="Deploy a NGINX ReplicaSet into your K3s cluster and confirm the discovery of your NGINX deployment. Run a load test to create metrics and confirm them streaming into Splunk Observability Cloud! 1. Start your NGINX Verify the number of pods running in the Splunk UI by selecting the WORKLOADS tab. This should give you an overview of the workloads on your cluster.
Note the single agent container running per node among the default Kubernetes pods."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Deploying NGINX in K3s :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="Deploy a NGINX ReplicaSet into your K3s cluster and confirm the discovery of your NGINX deployment. Run a load test to create metrics and confirm them streaming into Splunk Observability Cloud! 1. Start your NGINX Verify the number of pods running in the Splunk UI by selecting the WORKLOADS tab. This should give you an overview of the workloads on your cluster.
Note the single agent container running per node among the default Kubernetes pods."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.57/en/other/1-imt/gdi/nginx/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Deploying NGINX in K3s :: Splunk Observability Cloud Workshops"><meta property="og:description" content="Deploy a NGINX ReplicaSet into your K3s cluster and confirm the discovery of your NGINX deployment. Run a load test to create metrics and confirm them streaming into Splunk Observability Cloud! 1. Start your NGINX Verify the number of pods running in the Splunk UI by selecting the WORKLOADS tab. This should give you an overview of the workloads on your cluster.
Note the single agent container running per node among the default Kubernetes pods."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="Ninja Workshops"><meta property="article:modified_time" content="2023-12-21T14:15:53+00:00"><meta itemprop=name content="Deploying NGINX in K3s :: Splunk Observability Cloud Workshops"><meta itemprop=description content="Deploy a NGINX ReplicaSet into your K3s cluster and confirm the discovery of your NGINX deployment. Run a load test to create metrics and confirm them streaming into Splunk Observability Cloud! 1. Start your NGINX Verify the number of pods running in the Splunk UI by selecting the WORKLOADS tab. This should give you an overview of the workloads on your cluster.
Note the single agent container running per node among the default Kubernetes pods."><meta itemprop=dateModified content="2023-12-21T14:15:53+00:00"><meta itemprop=wordCount content="563"><title>Deploying NGINX in K3s :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.57/en/other/1-imt/gdi/nginx/index.html rel=canonical type=text/html title="Deploying NGINX in K3s :: Splunk Observability Cloud Workshops"><link href=../../../../../images/favicon.ico?1715860346 rel=icon type=image/x-icon sizes=any><link href=../../../../../css/fontawesome-all.min.css?1715860359 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../../css/fontawesome-all.min.css?1715860359 rel=stylesheet></noscript><link href=../../../../../css/nucleus.css?1715860359 rel=stylesheet><link href=../../../../../css/auto-complete.css?1715860359 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../../css/auto-complete.css?1715860359 rel=stylesheet></noscript><link href=../../../../../css/perfect-scrollbar.min.css?1715860359 rel=stylesheet><link href=../../../../../css/fonts.css?1715860359 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../../css/fonts.css?1715860359 rel=stylesheet></noscript><link href=../../../../../css/theme.css?1715860359 rel=stylesheet><link href=../../../../../css/theme-splunk-light.css?1715860359 rel=stylesheet id=R-variant-style><link href=../../../../../css/chroma-relearn-light.css?1715860359 rel=stylesheet id=R-variant-chroma-style><link href=../../../../../css/variant.css?1715860359 rel=stylesheet><link href=../../../../../css/print.css?1715860359 rel=stylesheet media=print><link href=../../../../../css/format-print.css?1715860359 rel=stylesheet><script src=../../../../../js/variant.js?1715860359></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../../../..",window.relearn.relBaseUri="../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.57",window.index_js_url="../../../../../en/index.search.js",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA"})</script></script><style>:root{--MAIN-WIDTH-MAX:1000rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../../../../../en/other/1-imt/gdi/nginx/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../../en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../../en/other/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../../en/other/1-imt/index.html><span itemprop=name>Splunk IM</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../../en/other/1-imt/gdi/index.html><span itemprop=name>2. Get Data In</span></a><meta itemprop=position content="4">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>2.1 Deploy NGINX</span><meta itemprop=position content="5"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=../../../../../en/other/1-imt/gdi/index.html title="Deploying the OpenTelemetry Collector in Kubernetes (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=../../../../../en/other/1-imt/dashboards/index.html title="Working with Dashboards (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=deploying-nginx-in-k3s>Deploying NGINX in K3s</h1><ul><li>Deploy a NGINX ReplicaSet into your K3s cluster and confirm the discovery of your NGINX deployment.</li><li>Run a load test to create metrics and confirm them streaming into Splunk Observability Cloud!</li></ul><hr><h2 id=1-start-your-nginx>1. Start your NGINX</h2><p>Verify the number of pods running in the Splunk UI by selecting the <strong>WORKLOADS</strong> tab. This should give you an overview of the workloads on your cluster.</p><p><a href=#R-image-5d447ea74fc4a09fac1c08bdb92e11b1 class=lightbox-link><img alt="Workload Agent" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../../../en/other/1-imt/gdi/nginx/../../images/k8s-workloads.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5d447ea74fc4a09fac1c08bdb92e11b1><img alt="Workload Agent" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../../../en/other/1-imt/gdi/nginx/../../images/k8s-workloads.png></a></p><p>Note the single agent container running per node among the default Kubernetes pods. This single container will monitor all the pods and services being deployed on this node!</p><p>Now switch back to the default cluster node view by selecting the <strong>MAP</strong> tab and selecting your cluster again.</p><p>In your AWS/EC2 or Multipass shell session change into the <code>nginx</code> directory:</p><div class=tab-panel data-tab-group=0a6a1508140d13b0ea756bcccf4b8bcb><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=change-directory class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0a6a1508140d13b0ea756bcccf4b8bcb","change-directory")'>
<span class=tab-nav-text>Change Directory</span></button></div><div class=tab-content-container><div data-tab-item=change-directory class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/workshop/k3s/nginx</span></span></code></pre></div></div></div></div></div><hr><h2 id=2-create-nginx-deployment>2. Create NGINX deployment</h2><p>Create the NGINX ConfigMap<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> using the <code>nginx.conf</code> file:</p><div class=tab-panel data-tab-group=e6422b67bf16cf813054d68ddd1702a0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-configmap-create class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e6422b67bf16cf813054d68ddd1702a0","kubectl-configmap-create")'>
<span class=tab-nav-text>Kubectl Configmap Create</span>
</button>
<button data-tab-item=kubectl-create-configmap-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("e6422b67bf16cf813054d68ddd1702a0","kubectl-create-configmap-output")'>
<span class=tab-nav-text>Kubectl Create Configmap Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-configmap-create class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create configmap nginxconfig --from-file<span class=o>=</span>nginx.conf</span></span></code></pre></div></div></div><div data-tab-item=kubectl-create-configmap-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>configmap/nginxconfig created</p></div></div></div></div><p>Then create the deployment:</p><div class=tab-panel data-tab-group=b714e2e77577b02b241ed549fa26c050><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-create-deployment class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("b714e2e77577b02b241ed549fa26c050","kubectl-create-deployment")'>
<span class=tab-nav-text>Kubectl Create Deployment</span>
</button>
<button data-tab-item=kubectl-create-deployment-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("b714e2e77577b02b241ed549fa26c050","kubectl-create-deployment-output")'>
<span class=tab-nav-text>Kubectl Create Deployment Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-create-deployment class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create -f nginx-deployment.yaml</span></span></code></pre></div></div></div><div data-tab-item=kubectl-create-deployment-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>deployment.apps/nginx created
service/nginx created</p></div></div></div></div><p>Next, we will deploy Locust<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> which is an open-source tool used for creating a load test against NGINX:</p><div class=tab-panel data-tab-group=b872ffa3f7aa0144142a0379e44b9754><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-create-deployment class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("b872ffa3f7aa0144142a0379e44b9754","kubectl-create-deployment")'>
<span class=tab-nav-text>Kubectl Create Deployment</span>
</button>
<button data-tab-item=kubectl-create-deployment-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("b872ffa3f7aa0144142a0379e44b9754","kubectl-create-deployment-output")'>
<span class=tab-nav-text>Kubectl Create Deployment Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-create-deployment class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create -f locust-deployment.yaml</span></span></code></pre></div></div></div><div data-tab-item=kubectl-create-deployment-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>deployment.apps/nginx-loadgenerator created
service/nginx-loadgenerator created</p></div></div></div></div><p>Validate the deployment has been successful and that the Locust and NGINX pods are running.</p><p>If you have the Splunk UI open you should see new Pods being started and containers being deployed.</p><p>It should only take around 20 seconds for the pods to transition into a Running state. In the Splunk UI you will have a cluster that looks like the screenshot below:</p><p><a href=#R-image-d3ffd161ce4d03319e22462b1def5c6b class=lightbox-link><img alt="back to Cluster" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../../../en/other/1-imt/gdi/nginx/../../images/cluster.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d3ffd161ce4d03319e22462b1def5c6b><img alt="back to Cluster" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../../../en/other/1-imt/gdi/nginx/../../images/cluster.png></a></p><p>If you select the <strong>WORKLOADS</strong> tab again you will now see that there is a new ReplicaSet and a deployment added for NGINX:</p><p><a href=#R-image-456b6418da80a729e3e93fc3ecdb6881 class=lightbox-link><img alt="NGINX loaded" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../../../en/other/1-imt/gdi/nginx/../../images/k8s-workloads-nginx.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-456b6418da80a729e3e93fc3ecdb6881><img alt="NGINX loaded" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../../../en/other/1-imt/gdi/nginx/../../images/k8s-workloads-nginx.png></a></p><hr><p>Let&rsquo;s validate this in your shell as well:</p><div class=tab-panel data-tab-group=68ad4dce397e2a234f33d5648e668db0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-get-pods class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("68ad4dce397e2a234f33d5648e668db0","kubectl-get-pods")'>
<span class=tab-nav-text>Kubectl Get Pods</span>
</button>
<button data-tab-item=kubectl-get-pods-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("68ad4dce397e2a234f33d5648e668db0","kubectl-get-pods-output")'>
<span class=tab-nav-text>Kubectl Get Pods Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-get-pods class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div data-tab-item=kubectl-get-pods-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>NAME READY STATUS RESTARTS AGE
splunk-otel-collector-k8s-cluster-receiver-77784c659c-ttmpk 1/1 Running 0 9m19s
splunk-otel-collector-agent-249rd 1/1 Running 0 9m19s
svclb-nginx-vtnzg 1/1 Running 0 5m57s
nginx-7b95fb6b6b-7sb9x 1/1 Running 0 5m57s
nginx-7b95fb6b6b-lnzsq 1/1 Running 0 5m57s
nginx-7b95fb6b6b-hlx27 1/1 Running 0 5m57s
nginx-7b95fb6b6b-zwns9 1/1 Running 0 5m57s
svclb-nginx-loadgenerator-nscx4 1/1 Running 0 2m20s
nginx-loadgenerator-755c8f7ff6-x957q 1/1 Running 0 2m20s</p></div></div></div></div><hr><h2 id=3-run-locust-load-test>3. Run Locust load test</h2><p>Locust, an open-source load generator, is available on port 8083 of the EC2 instance&rsquo;s IP address. Open a new tab in your web browser and go to <code>http://{==EC2-IP==}:8083/</code>, you will then be able to see the Locust running.</p><p><a href=#R-image-21740524571e7a338be8db2e271a4b7e class=lightbox-link><img alt=Locust class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../../../en/other/1-imt/gdi/nginx/../../images/nginx-locust.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-21740524571e7a338be8db2e271a4b7e><img alt=Locust class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../../../en/other/1-imt/gdi/nginx/../../images/nginx-locust.png></a></p><p>Set the <strong>Spawn rate</strong> to 2 and click <strong>Start Swarming</strong>.</p><p><a href=#R-image-96d3830c497ebe787b9fe7c3cf8f9786 class=lightbox-link><img alt="Locust Spawn Rate" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../../../en/other/1-imt/gdi/nginx/../../images/nginx-locust-spawn-rate.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-96d3830c497ebe787b9fe7c3cf8f9786><img alt="Locust Spawn Rate" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../../../en/other/1-imt/gdi/nginx/../../images/nginx-locust-spawn-rate.png></a></p><p>This will start a gentle continuous load on the application.</p><p><a href=#R-image-84698a76a5d80f2de5d7a7c3a85a347d class=lightbox-link><img alt="Locust Statistics" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../../../en/other/1-imt/gdi/nginx/../../images/nginx-locust-statistics.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-84698a76a5d80f2de5d7a7c3a85a347d><img alt="Locust Statistics" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../../../en/other/1-imt/gdi/nginx/../../images/nginx-locust-statistics.png></a></p><p>As you can see from the above screenshot, most of the calls will report a fail, this is expected, as we have not yet deployed the application behind it, however, NGINX is reporting on your attempts and you should be able to see those metrics.</p><p>Validate you are seeing those metrics in the UI by selecting <strong>Dashboards → Built-in Dashboard Groups → NGINX → NGINX Servers</strong>. Using the <strong>Overrides</strong> filter on <code>k8s.cluster.name:</code>, find the name of your cluster as returned by <code>echo $INSTANCE-k3s-cluster</code> in the terminal.</p><p><a href=#R-image-cf469a888e0c86ff332d2033369a777c class=lightbox-link><img alt="NGINX Dashboard" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../../../en/other/1-imt/gdi/nginx/../../images/nginx-dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-cf469a888e0c86ff332d2033369a777c><img alt="NGINX Dashboard" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../../../en/other/1-imt/gdi/nginx/../../images/nginx-dashboard.png></a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>A ConfigMap is an API object used to store non-confidential data in key-value pairs. Pods can consume ConfigMaps as environment variables, command-line arguments, or configuration files in a volume. A ConfigMap allows you to decouple environment-specific configuration from your container images so that your applications are easily portable.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://locust.io/ rel=external target=_blank>What is Locust?</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>Robert Castley</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Dec 21, 2023</span></span></footer></article></div></main></div><script src=../../../../../js/clipboard.min.js?1715860359 defer></script><script src=../../../../../js/perfect-scrollbar.min.js?1715860359 defer></script><script src=../../../../../js/theme.js?1715860359 defer></script></body></html>