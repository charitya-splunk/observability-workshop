<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.125.5"><meta name=generator content="Relearn 6.0.0+tip"><meta name=description content="This scenario helps SREs identify the impact of planned and unplanned changes to their environment so that they can address issues quickly to ensure the performance of key customer transactions."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Understand Impact of Changes :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="This scenario helps SREs identify the impact of planned and unplanned changes to their environment so that they can address issues quickly to ensure the performance of key customer transactions."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.54/en/scenarios/understand_impact_of_changes/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Understand Impact of Changes :: Splunk Observability Cloud Workshops"><meta property="og:description" content="This scenario helps SREs identify the impact of planned and unplanned changes to their environment so that they can address issues quickly to ensure the performance of key customer transactions."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Understand Impact of Changes :: Splunk Observability Cloud Workshops"><meta itemprop=description content="This scenario helps SREs identify the impact of planned and unplanned changes to their environment so that they can address issues quickly to ensure the performance of key customer transactions."><meta itemprop=dateModified content="2024-04-02T22:47:55+01:00"><meta itemprop=wordCount content="202"><title>Understand Impact of Changes :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.54/en/scenarios/understand_impact_of_changes/index.html rel=canonical type=text/html title="Understand Impact of Changes :: Splunk Observability Cloud Workshops"><link href=../../../images/favicon.ico?1715858742 rel=icon type=image/x-icon sizes=any><link href=../../../css/fontawesome-all.min.css?1715858758 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/fontawesome-all.min.css?1715858758 rel=stylesheet></noscript><link href=../../../css/nucleus.css?1715858758 rel=stylesheet><link href=../../../css/auto-complete.css?1715858758 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/auto-complete.css?1715858758 rel=stylesheet></noscript><link href=../../../css/perfect-scrollbar.min.css?1715858758 rel=stylesheet><link href=../../../css/fonts.css?1715858758 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/fonts.css?1715858758 rel=stylesheet></noscript><link href=../../../css/theme.css?1715858758 rel=stylesheet><link href=../../../css/theme-splunk-light.css?1715858758 rel=stylesheet id=R-variant-style><link href=../../../css/chroma-relearn-light.css?1715858758 rel=stylesheet id=R-variant-chroma-style><link href=../../../css/variant.css?1715858758 rel=stylesheet><link href=../../../css/print.css?1715858758 rel=stylesheet media=print><link href=../../../css/format-print.css?1715858758 rel=stylesheet><script src=../../../js/variant.js?1715858758></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.54",window.index_js_url="../../../en/index.search.js",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA"})</script></script><style>:root{--MAIN-WIDTH-MAX:1000rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../../../en/scenarios/understand_impact_of_changes/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../en/scenarios/index.html><span itemprop=name>Scenarios</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Understand Impact of Changes</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=../../../en/scenarios/optimize_monitoring/6-workshop-conclusion/index.html title="Conclusion (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=../../../en/scenarios/understand_impact_of_changes/1-build-application/index.html title="Build the Sample Application (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable chapter narrow" tabindex=-1><div class=flex-block-wrapper><article class=chapter><header class=headline></header><h1 id=understand-impact-of-changes>Understand Impact of Changes</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>2 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Derek Mitchell</span></span><p><strong>Splunk Observability Cloud</strong> includes powerful features that dramatically reduce the time required for SREs to isolate issues across services, so they know which team to engage to troubleshoot the issue further, and can provide context to help engineering get a head start on debugging.</p><p>Unlocking these features requires tags to be included with your application traces. But how do you know which tags are the most valuable and how do you capture them?</p><p>In this workshop, we&rsquo;ll explore:</p><ul><li>What are <strong>tags</strong> and why are they such a critical part of making an application observable.</li><li>How to use <a href=https://opentelemetry.io rel=external target=_blank><strong>OpenTelemetry</strong></a> to capture tags of interest from your application.</li><li>How to index tags in <strong>Splunk Observability Cloud</strong> and the differences between <strong>Troubleshooting MetricSets</strong> and <strong>Monitoring MetricSets</strong>.</li><li>How to utilize tags in <strong>Splunk Observability Cloud</strong> to find ‚Äúunknown unknowns‚Äù using the <strong>Tag Spotlight</strong> and <strong>Dynamic Service Map</strong> features.</li><li>How to utilize tags for alerting and dashboards.</li></ul><p>The workshop uses a simple microservices-based application to illustrate these concepts. Let&rsquo;s get started!</p><div class="box notices cstyle primary"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Tip</div><div class=box-content><p>The easiest way to navigate through this workshop is by using:</p><ul><li>the left/right arrows (<strong>&lt;</strong> | <strong>></strong>) on the top right of this page</li><li>the left (‚óÄÔ∏è) and right (‚ñ∂Ô∏è) cursor keys on your keyboard</li></ul></div></div><footer class=footline><span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Derek Mitchell
</span></span>&nbsp;
<span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>rcastley</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Apr 2, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Understand Impact of Changes</h1><article class=default><header class=headline></header><h1 id=build-the-sample-application>Build the Sample Application</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<h2 id=introduction>Introduction</h2><p>For this workshop, we&rsquo;ll be using a microservices-based application. This application is for an online retailer and normally includes more than a dozen services. However, to keep the workshop simple, we&rsquo;ll be focusing on two services used by the retailer as part of their payment processing workflow: the credit check service and the credit processor service.</p><h2 id=pre-requisites>Pre-requisites</h2><p>You will start with an EC2 instance and perform some <a href=../../../en/scenarios/understand_impact_of_changes/1-build-application/index.html#initial-steps>initial steps</a> in order to get to the following state:</p><ul><li>Deploy the <strong>Splunk distribution of the OpenTelemetry Collector</strong></li><li>Build and deploy <code>creditcheckservice</code> and <code>creditprocessorservice</code></li><li>Deploy a load generator to send traffic to the services</li></ul><h2 id=initial-steps>Initial Steps</h2><p>The initial setup can be completed by executing the following steps on the command line of your EC2 instance:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> workshop/tagging
</span></span><span class=line><span class=cl>./0-deploy-collector-with-services.sh</span></span></code></pre></div><h2 id=view-your-application-in-splunk-observability-cloud>View your application in Splunk Observability Cloud</h2><p>Now that the setup is complete, let&rsquo;s confirm that it&rsquo;s sending data to <strong>Splunk Observability Cloud</strong>. Note that when the application is deployed for the first time, it may take a few minutes for the data to appear.</p><p>Navigate to APM, then use the Environment dropdown to select your environment (i.e. <code>tagging-workshop-instancename</code>).</p><p>If everything was deployed correctly, you should see <code>creditprocessorservice</code> and <code>creditcheckservice</code> displayed in the list of services:</p><p><a href=#R-image-fbca89140c98f16002edf442c7493ca5 class=lightbox-link><img alt="APM Overview" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/apm_overview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fbca89140c98f16002edf442c7493ca5><img alt="APM Overview" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/apm_overview.png></a></p><p>Click on <strong>Explore</strong> on the right-hand side to view the service map. We can see that the <code>creditcheckservice</code> makes calls to the <code>creditprocessorservice</code>, with an average response time of at least 3 seconds:</p><p><a href=#R-image-229aa6c2f70cbc496fdefd04eecc54a3 class=lightbox-link><img alt="Service Map" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/service_map.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-229aa6c2f70cbc496fdefd04eecc54a3><img alt="Service Map" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/service_map.png></a></p><p>Next, click on <strong>Traces</strong> on the right-hand side to see the traces captured for this application. You&rsquo;ll see that some traces run relatively fast (i.e. just a few milliseconds), whereas others take a few seconds.</p><p><a href=#R-image-0e852c5533b5bb8a18c2fed32dabb44c class=lightbox-link><img alt=Traces class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/traces.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0e852c5533b5bb8a18c2fed32dabb44c><img alt=Traces class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/traces.png></a></p><p>If you toggle <strong>Errors only</strong> to <code>on</code>, you&rsquo;ll also notice that some traces have errors:</p><p><a href=#R-image-6578857a1afd0bf07cd4c1eaa91fd397 class=lightbox-link><img alt=Traces class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/traces_with_errors.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6578857a1afd0bf07cd4c1eaa91fd397><img alt=Traces class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/traces_with_errors.png></a></p><p>Toggle <strong>Errors only</strong> back to <code>off</code> and sort the traces by duration, then click on one of the longer running traces. In this example, the trace took five seconds, and we can see that most of the time was spent calling the <code>/runCreditCheck</code> operation, which is part of the <code>creditprocessorservice</code>.</p><p><a href=#R-image-23c94042edd5e3bf1ea701b4e1e5b924 class=lightbox-link><img alt="Long Running Trace" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/long_running_trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-23c94042edd5e3bf1ea701b4e1e5b924><img alt="Long Running Trace" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/long_running_trace.png></a></p><p>Currently, we don&rsquo;t have enough details in our traces to understand why some requests finish in a few milliseconds, and others take several seconds. To provide the best possible customer experience, this will be critical for us to understand.</p><p>We also don&rsquo;t have enough information to understand why some requests result in errors, and others don&rsquo;t. For example, if we look at one of the error traces, we can see that the error occurs when the <code>creditprocessorservice</code> attempts to call another service named <code>otherservice</code>. But why do some requests results in a call to <code>otherservice</code>, and others don&rsquo;t?</p><p><a href=#R-image-bdde577eaf6ebe80526af9b1a86b7190 class=lightbox-link><img alt="Trace with Errors" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/error_trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bdde577eaf6ebe80526af9b1a86b7190><img alt="Trace with Errors" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/error_trace.png></a></p><p>We&rsquo;ll explore these questions and more in the workshop.</p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>dmitchsplunk</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>May 3, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=what-are-tags>What are Tags?</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>3 minutes</span>
</span>&nbsp;<p>To understand why some requests have errors or slow performance, we&rsquo;ll need to add context to our traces. We&rsquo;ll do this by adding tags. But first, let&rsquo;s take a moment to discuss what tags are, and why they&rsquo;re so important for observability.</p><h2 id=what-are-tags>What are tags?</h2><p>Tags are key-value pairs that provide additional metadata about spans in a trace, allowing you to enrich the context of the spans you send to Splunk APM.</p><p>For example, a payment processing application would find it helpful to track:</p><ul><li>The payment type used (i.e. credit card, gift card, etc.)</li><li>The ID of the customer that requested the payment</li></ul><p>This way, if errors or performance issues occur while processing the payment, we have the context we need for troubleshooting.</p><p>While some tags can be added with the OpenTelemetry collector, the ones we‚Äôll be working with in this workshop are more granular, and are added by application developers using the OpenTelemetry API.</p><h2 id=attributes-vs-tags>Attributes vs. Tags</h2><p>A note about terminology before we proceed. While this workshop is about <strong>tags</strong>, and this is the terminology we use in <strong>Splunk Observability Cloud</strong>, OpenTelemetry uses the term <strong>attributes</strong> instead. So when you see tags mentioned throughout this workshop, you can treat them as synonymous with attributes.</p><h2 id=why-are-tags-so-important>Why are tags so important?</h2><p>Tags are essential for an application to be truly observable. As we saw with our credit check service, some users are having a great experience: fast with no errors. But other users get a slow experience or encounter errors.</p><p>Tags add the context to the traces to help us understand why some users get a great experience and others don&rsquo;t. And powerful features in <strong>Splunk Observability Cloud</strong> utilize tags to help you jump quickly to root cause.</p><h2 id=sneak-peak-tag-spotlight>Sneak Peak: Tag Spotlight</h2><p><strong>Tag Spotlight</strong> uses tags to discover trends that contribute to high latency or error rates:</p><p><a href=#R-image-0e8f2de0f7eed73459615c0e3c1b65cb class=lightbox-link><img alt="Tag Spotlight Preview" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/2-what-are-tags/../images/tag_spotlight_preview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0e8f2de0f7eed73459615c0e3c1b65cb><img alt="Tag Spotlight Preview" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/2-what-are-tags/../images/tag_spotlight_preview.png></a></p><p>The screenshot above provides an example of Tag Spotlight from another application.</p><p>Splunk has analyzed all of the tags included as part of traces that involve the payment service.</p><p>It tells us very quickly whether some tag values have more errors than others.</p><p>If we look at the version tag, we can see that version 350.10 of the service has a 100% error rate, whereas version 350.9 of the service has no errors at all:</p><p><a href=#R-image-fb184300b32d7ab4dea9ce558f442cdb class=lightbox-link><img alt="Tag Spotlight Preview" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/2-what-are-tags/../images/tag_spotlight_preview_details.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fb184300b32d7ab4dea9ce558f442cdb><img alt="Tag Spotlight Preview" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/2-what-are-tags/../images/tag_spotlight_preview_details.png></a></p><p>We‚Äôll be using Tag Spotlight with the credit check service later on in the workshop, once we‚Äôve captured some tags of our own.</p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>dmitchsplunk</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>May 3, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=capture-tags-with-opentelemetry>Capture Tags with OpenTelemetry</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>Let&rsquo;s add some tags to our traces, so we can find out why some customers receive a poor experience from our application.</p><h2 id=identify-useful-tags>Identify Useful Tags</h2><p>We&rsquo;ll start by reviewing the code for the <code>credit_check</code> function of <code>creditcheckservice</code> (which can be found in the <code>/home/splunk/workshop/tagging/creditcheckservice/main.py</code> file):</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/check&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>credit_check</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>customerNum</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;customernum&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Get Credit Score</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreReq</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://creditprocessorservice:8899/getScore?customernum=&#34;</span> <span class=o>+</span> <span class=n>customerNum</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreReq</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScore</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>creditScoreReq</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreCategory</span> <span class=o>=</span> <span class=n>getCreditCategoryFromScore</span><span class=p>(</span><span class=n>creditScore</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Run Credit Check</span>
</span></span><span class=line><span class=cl>    <span class=n>creditCheckReq</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://creditprocessorservice:8899/runCreditCheck?customernum=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>customerNum</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;&amp;score=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>creditScore</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>creditCheckReq</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>checkResult</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>creditCheckReq</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>checkResult</span></span></span></code></pre></div><p>We can see that this function accepts a <strong>customer number</strong> as an input. This would be helpful to capture as part of a trace. What else would be helpful?</p><p>Well, the <strong>credit score</strong> returned for this customer by the <code>creditprocessorservice</code> may be interesting (we want to ensure we don&rsquo;t capture any PII data though). It would also be helpful to capture the <strong>credit score category</strong>, and the <strong>credit check result</strong>.</p><p>Great, we&rsquo;ve identified four tags to capture from this service that could help with our investigation. But how do we capture these?</p><h2 id=capture-tags>Capture Tags</h2><p>We start by adding importing the trace module by adding an import statement to the top of the <code>creditcheckservice/main.py</code> file:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>waitress</span> <span class=kn>import</span> <span class=n>serve</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry</span> <span class=kn>import</span> <span class=n>trace</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl><span class=o>...</span></span></span></code></pre></div><p>Next, we need to get a reference to the current span so we can add an attribute (aka tag) to it:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>credit_check</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span> <span class=o>=</span> <span class=n>trace</span><span class=o>.</span><span class=n>get_current_span</span><span class=p>()</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>    <span class=n>customerNum</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;customernum&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;customer.num&#34;</span><span class=p>,</span> <span class=n>customerNum</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl><span class=o>...</span></span></span></code></pre></div><p>That was pretty easy, right? Let&rsquo;s capture some more, with the final result looking like this:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>credit_check</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span> <span class=o>=</span> <span class=n>trace</span><span class=o>.</span><span class=n>get_current_span</span><span class=p>()</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>    <span class=n>customerNum</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;customernum&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;customer.num&#34;</span><span class=p>,</span> <span class=n>customerNum</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Get Credit Score</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreReq</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://creditprocessorservice:8899/getScore?customernum=&#34;</span> <span class=o>+</span> <span class=n>customerNum</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreReq</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScore</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>creditScoreReq</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;credit.score&#34;</span><span class=p>,</span> <span class=n>creditScore</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreCategory</span> <span class=o>=</span> <span class=n>getCreditCategoryFromScore</span><span class=p>(</span><span class=n>creditScore</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;credit.score.category&#34;</span><span class=p>,</span> <span class=n>creditScoreCategory</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Run Credit Check</span>
</span></span><span class=line><span class=cl>    <span class=n>creditCheckReq</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://creditprocessorservice:8899/runCreditCheck?customernum=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>customerNum</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;&amp;score=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>creditScore</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>creditCheckReq</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>checkResult</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>creditCheckReq</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;credit.check.result&#34;</span><span class=p>,</span> <span class=n>checkResult</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>checkResult</span></span></span></code></pre></div><h2 id=redeploy-service>Redeploy Service</h2><p>Once these changes are made, let&rsquo;s run the following script to rebuild the Docker image used for <code>creditcheckservice</code> and redeploy it to our Kubernetes cluster:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./5-redeploy-creditcheckservice.sh</span></span></code></pre></div><h2 id=confirm-tag-is-captured-successfully>Confirm Tag is Captured Successfully</h2><p>After a few minutes, return to <strong>Splunk Observability Cloud</strong> and load one of the latest traces to confirm that the tags were captured successfully (hint: sort by the timestamp to find the latest traces):</p><p><strong><a href=#R-image-ce2b1e44258306e1d61d20812aaeaeb4 class=lightbox-link><img alt="Trace with Attributes" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/3-capture-tags/../images/trace_with_attributes.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ce2b1e44258306e1d61d20812aaeaeb4><img alt="Trace with Attributes" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/3-capture-tags/../images/trace_with_attributes.png></a></strong></p><p>Well done, you&rsquo;ve leveled up your OpenTelemetry game and have added context to traces using tags.</p><p>Next, we&rsquo;re ready to see how you can use these tags with <strong>Splunk Observability Cloud</strong>!</p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>dmitchsplunk</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Mar 27, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=explore-trace-data>Explore Trace Data</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<p>Now that we&rsquo;ve captured several tags from our application, let&rsquo;s explore some of the trace data we&rsquo;ve captured that include this additional context, and see if we can identify what&rsquo;s causing a poor user experience in some cases.</p><h2 id=use-trace-analyzer>Use Trace Analyzer</h2><p>Navigate to <strong>APM</strong>, then select <strong>Traces</strong>. This takes us to the <strong>Trace Analyzer</strong>, where we can add filters to search for traces of interest. For example, we can filter on traces where the credit score starts with <code>7</code>:</p><p><a href=#R-image-c41396ba174cf7cea2378273d712dfc9 class=lightbox-link><img alt="Credit Check Starts with Seven" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/4-explore-trace-data/../images/credit_score_starts_with_seven.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c41396ba174cf7cea2378273d712dfc9><img alt="Credit Check Starts with Seven" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/4-explore-trace-data/../images/credit_score_starts_with_seven.png></a></p><p>If you load one of these traces, you&rsquo;ll see that the credit score indeed starts with seven.</p><p>We can apply similar filters for the customer number, credit score category, and credit score result.</p><h2 id=explore-traces-with-errors>Explore Traces With Errors</h2><p>Let&rsquo;s remove the credit score filter and toggle <strong>Errors only</strong> to on, which results in a list of only those traces where an error occurred:</p><p><a href=#R-image-0332f736b17c2c81b7784c25fbf36269 class=lightbox-link><img alt="Traces with Errors Only" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/4-explore-trace-data/../images/traces_errors_only.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0332f736b17c2c81b7784c25fbf36269><img alt="Traces with Errors Only" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/4-explore-trace-data/../images/traces_errors_only.png></a></p><p>Click on a few of these traces, and look at the tags we captured. Do you notice any patterns?</p><p>Next, toggle <strong>Errors only</strong> to off, and sort traces by duration. Look at a few of the slowest running traces, and compare them to the fastest running traces. Do you notice any patterns?</p><p>If you found a pattern that explains the slow performance and errors - great job! But keep in mind that this is a difficult way to troubleshoot, as it requires you to look through many traces and mentally keep track of what you saw, so you can identify a pattern.</p><p>Thankfully, <strong>Splunk Observability Cloud</strong> provides a more efficient way to do this, which we&rsquo;ll explore next.</p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>dmitchsplunk</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Mar 27, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=index-tags>Index Tags</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<h2 id=index-tags>Index Tags</h2><p>To use advanced features in <strong>Splunk Observability Cloud</strong> such as <strong>Tag Spotlight</strong>, we&rsquo;ll need to first index one or more tags.</p><p>To do this, navigate to <strong>Settings</strong> -> <strong>APM MetricSets</strong>. Then click the <strong>+ New MetricSet</strong> button.</p><p>Let&rsquo;s index the <code>credit.score.category</code> tag by entering the following details (<strong>note</strong>: since everyone in the workshop is using the same organization, the instructor will do this step on your behalf):</p><p><a href=#R-image-9a522f41f7094b3bc299b30d85daebf4 class=lightbox-link><img alt="Create Troubleshooting MetricSet" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/5-index-tags/../images/create_troubleshooting_metric_set.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9a522f41f7094b3bc299b30d85daebf4><img alt="Create Troubleshooting MetricSet" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/5-index-tags/../images/create_troubleshooting_metric_set.png></a></p><p>Click <strong>Start Analysis</strong> to proceed.</p><p>The tag will appear in the list of <strong>Pending MetricSets</strong> while analysis is performed.</p><p><a href=#R-image-31e0f20f8d6baeedd15116b81131a67f class=lightbox-link><img alt="Pending MetricSets" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/5-index-tags/../images/pending_metric_set.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-31e0f20f8d6baeedd15116b81131a67f><img alt="Pending MetricSets" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/5-index-tags/../images/pending_metric_set.png></a></p><p>Once analysis is complete, click on the checkmark in the <strong>Actions</strong> column.</p><p><a href=#R-image-fcad3aac32ac09ae894a7f8f7d2591f6 class=lightbox-link><img alt="MetricSet Configuraiton Applied" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/5-index-tags/../images/metricset_config_applied.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fcad3aac32ac09ae894a7f8f7d2591f6><img alt="MetricSet Configuraiton Applied" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/5-index-tags/../images/metricset_config_applied.png></a></p><h2 id=how-to-choose-tags-for-indexing>How to choose tags for indexing</h2><p>Why did we choose to index the <code>credit.score.category</code> tag and not the others?</p><p>To understand this, let&rsquo;s review the primary use cases for tags:</p><ul><li>Filtering</li><li>Grouping</li></ul><h3 id=filtering>Filtering</h3><p>With the filtering use case, we can use the <strong>Trace Analyzer</strong> capability of <strong>Splunk Observability Cloud</strong> to filter on traces that match a particular tag value.</p><p>We saw an example of this earlier, when we filtered on traces where the credit score started with <code>7</code>.</p><p>Or if a customer calls in to complain about slow service, we could use <strong>Trace Analyzer</strong> to locate all traces with that particular customer number.</p><p>Tags used for filtering use cases are generally high-cardinality, meaning that there could be thousands or even hundreds of thousands of unique values. In fact, <strong>Splunk Observability Cloud</strong> can handle an effectively infinite number of unique tag values! Filtering using these tags allows us to rapidly locate the traces of interest.</p><p>Note that we aren&rsquo;t required to index tags to use them for filtering with <strong>Trace Analyzer</strong>.</p><h3 id=grouping>Grouping</h3><p>With the grouping use case, we can use <strong>Trace Analyzer</strong> to group traces by a particular tag.</p><p>But we can also go beyond this and surface trends for tags that we collect using the powerful <strong>Tag Spotlight</strong> feature in <strong>Splunk Observability Cloud</strong>, which we‚Äôll see in action shortly.</p><p>Tags used for grouping use cases should be low to medium-cardinality, with hundreds of unique values.</p><p>For custom tags to be used with <strong>Tag Spotlight</strong>, they first need to be indexed.</p><p>We decided to index the <code>credit.score.category</code> tag because it has a few distinct values that would be useful for grouping. In contrast, the customer number and credit score tags have hundreds or thousands of unique values, and are more valuable for filtering use cases rather than grouping.</p><h2 id=troubleshooting-vs-monitoring-metricsets>Troubleshooting vs. Monitoring MetricSets</h2><p>You may have noticed that, to index this tag, we created something called a <strong>Troubleshooting MetricSet</strong>. It&rsquo;s named this way because a Troubleshooting MetricSet, or TMS, allows us to troubleshoot issues with this tag using features such as <strong>Tag Spotlight</strong>.</p><p>You may have also noticed that there&rsquo;s another option which we didn&rsquo;t choose called a <strong>Monitoring MetricSet</strong> (or MMS). Monitoring MetricSets go beyond troubleshooting and allow us to use tags for alerting and dashboards. We&rsquo;ll explore this concept later in the workshop.</p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>dmitchsplunk</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>May 3, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=use-tags-for-troubleshooting>Use Tags for Troubleshooting</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<h2 id=using-tag-spotlight>Using Tag Spotlight</h2><p>Now that we&rsquo;ve indexed the <code>credit.score.category</code> tag, we can use it with <strong>Tag Spotlight</strong> to troubleshoot our application.</p><p>Navigate to <strong>APM</strong> then click on <strong>Tag Spotlight</strong> on the right-hand side. Ensure the <code>creditcheckservice</code> service is selected from the <strong>Service</strong> drop-down (if not already selected).</p><p>With <strong>Tag Spotlight</strong>, we can see 100% of credit score requests that result in a score of <code>impossible</code> have an error, yet requests for all other credit score types have no errors at all!</p><p><strong><a href=#R-image-2c14e3d09ebce3ada82b44ae0e900442 class=lightbox-link><img alt="Tag Spotlight with Errors" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/6-use-tags/../images/tag_spotlight_errors.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2c14e3d09ebce3ada82b44ae0e900442><img alt="Tag Spotlight with Errors" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/6-use-tags/../images/tag_spotlight_errors.png></a></strong></p><p>This illustrates the power of <strong>Tag Spotlight</strong>! Finding this pattern would be time-consuming without it, as we&rsquo;d have to manually look through hundreds of traces to identify the pattern (and even then, there&rsquo;s no guarantee we&rsquo;d find it).</p><p>We&rsquo;ve looked at errors, but what about latency? Let&rsquo;s click on <strong>Latency</strong> near the top of the screen to find out.</p><p>Here, we can see that the requests with a <code>poor</code> credit score request are running slowly, with P50, P90, and P99 times of around 3 seconds, which is too long for our users to wait, and much slower than other requests.</p><p>We can also see that some requests with an <code>exceptional</code> credit score request are running slowly, with P99 times of around 5 seconds, though the P50 response time is relatively quick.</p><p><strong><a href=#R-image-2cd27ff663888edc0421636394308a4b class=lightbox-link><img alt="Tag Spotlight with Latency" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/6-use-tags/../images/tag_spotlight_latency.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2cd27ff663888edc0421636394308a4b><img alt="Tag Spotlight with Latency" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/6-use-tags/../images/tag_spotlight_latency.png></a></strong></p><h2 id=using-dynamic-service-maps>Using Dynamic Service Maps</h2><p>Now that we know the credit score category associated with the request can impact performance and error rates, let&rsquo;s explore another feature that utilizes indexed tags: <strong>Dynamic Service Maps</strong>.</p><p>With Dynamic Service Maps, we can breakdown a particular service by a tag. For example, let&rsquo;s click on <strong>APM</strong>, then click <strong>Explore</strong> to view the service map.</p><p>Click on <code>creditcheckservice</code>. Then, on the right-hand menu, click on the drop-down that says <strong>Breakdown</strong>, and select the <code>credit.score.category</code> tag.</p><p>At this point, the service map is updated dynamically, and we can see the performance of requests hitting <code>creditcheckservice</code> broken down by the credit score category:</p><p><strong><a href=#R-image-446abd206fa742e15274102fecd2627b class=lightbox-link><img alt="Service Map Breakdown" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/6-use-tags/../images/service_map_breakdown.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-446abd206fa742e15274102fecd2627b><img alt="Service Map Breakdown" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/6-use-tags/../images/service_map_breakdown.png></a></strong></p><p>This view makes it clear that performance for <code>good</code> and <code>fair</code> credit scores is excellent, while <code>poor</code> and <code>exceptional</code> scores are much slower, and <code>impossible</code> scores result in errors.</p><h2 id=summary>Summary</h2><p><strong>Tag Spotlight</strong> has uncovered several interesting patterns for the engineers that own this service to explore further:</p><ul><li>Why are all the <code>impossible</code> credit score requests resulting in error?</li><li>Why are all the <code>poor</code> credit score requests running slowly?</li><li>Why do some of the <code>exceptional</code> requests run slowly?</li></ul><p>As an SRE, passing this context to the engineering team would be extremely helpful for their investigation, as it would allow them to track down the issue much more quickly than if we simply told them that the service was &ldquo;sometimes slow&rdquo;.</p><p>If you&rsquo;re curious, have a look at the source code for the <code>creditprocessorservice</code>. You&rsquo;ll see that requests with impossible, poor, and exceptional credit scores are handled differently, thus resulting in the differences in error rates and latency that we uncovered.</p><p>The behavior we saw with our application is typical for modern cloud-native applications, where different inputs passed to a service lead to different code paths, some of which result in slower performance or errors. For example, in a real credit check service, requests resulting in low credit scores may be sent to another downstream service to further evaluate risk, and may perform more slowly than requests resulting in higher scores, or encounter higher error rates.</p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>dmitchsplunk</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Mar 27, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=use-tags-with-alerting-and-dashboards>Use Tags with Alerting and Dashboards</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>Earlier, we created a <strong>Troubleshooting Metric Set</strong> on the <code>credit.score.category</code> tag, which allowed us to use <strong>Tag Spotlight</strong> with that tag and identify a pattern to explain why some users received a poor experience.</p><p>In this section of the workshop, we&rsquo;ll explore a related concept: <strong>Monitoring MetricSets</strong>.</p><h2 id=what-are-monitoring-metricsets>What are Monitoring MetricSets?</h2><p><strong>Monitoring MetricSets</strong> go beyond troubleshooting and allow us to use tags for alerting and dashboards.</p><h2 id=create-a-monitoring-metricset>Create a Monitoring MetricSet</h2><p>Let&rsquo;s navigate to <strong>Settings</strong> -> <strong>APM MetricSets</strong>, and click the edit button (i.e. the little pencil) beside the MetricSet for <code>credit.score.category</code>.</p><p>Check the box beside <strong>Also create Monitoring MetricSet</strong> then click <strong>Start Analysis</strong> (<strong>note</strong>: your workshop instructor will do this for you)</p><p><a href=#R-image-f0374ef39e73b71db9614c76d3fe0616 class=lightbox-link><img alt="Monitoring MetricSet" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/monitoring_metricset.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f0374ef39e73b71db9614c76d3fe0616><img alt="Monitoring MetricSet" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/monitoring_metricset.png></a></p><p>The <code>credit.score.category</code> tag appears again as a <strong>Pending MetricSet</strong>. After a few moments, a checkmark should appear. Click this checkmark to enable the <strong>Pending MetricSet</strong>.</p><h2 id=using-monitoring-metricsets>Using Monitoring MetricSets</h2><p>Next, let&rsquo;s explore how we can use this <strong>Monitoring MetricSet</strong>.</p><h3 id=dashboards>Dashboards</h3><p>Navigate to <strong>Metric Finder</strong>, then type in the name of the tag, which is <code>credit_score_category</code> (note that the dots in the tag name were replaced by underscores when the MMS was created). You&rsquo;ll see that multiple metrics include this tag as a dimension:</p><p><a href=#R-image-fd6875e4f4db0e91953b3b3b925cbad7 class=lightbox-link><img alt="Metric Finder" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/metric_finder.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fd6875e4f4db0e91953b3b3b925cbad7><img alt="Metric Finder" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/metric_finder.png></a></p><p>By default, <strong>Splunk Observability Cloud</strong> calculates several metrics using the trace data it receives. See <a href=https://docs.splunk.com/observability/en/apm/span-tags/metricsets.html rel=external target=_blank>Learn about MetricSets in APM</a> for more details.</p><p>By creating an MMS, <code>credit_score_category</code> was added as a dimension to these metrics, which means that this dimension can now be used for alerting and dashboards.</p><p>To see how, let&rsquo;s click on the metric named <code>service.request.duration.ns.p99</code>, which brings up the following chart:</p><p><a href=#R-image-4bf6f36bc7e61ee2bb0d22f6fa477e98 class=lightbox-link><img alt="Service Request Duration" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/service_request_duration_chart.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4bf6f36bc7e61ee2bb0d22f6fa477e98><img alt="Service Request Duration" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/service_request_duration_chart.png></a></p><p>Add filters for <code>sf_environment</code>, <code>sf_service</code>, and <code>sf_dimensionalized</code>. Then set the <strong>Extrapolation policy</strong> to <code>Last value</code> and the <strong>Display units</strong> to <code>Nanosecond</code>:</p><p><a href=#R-image-4ef49e85443d3590e3a0d83f10e225e4 class=lightbox-link><img alt="Chart with Seconds" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/chart_settings.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4ef49e85443d3590e3a0d83f10e225e4><img alt="Chart with Seconds" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/chart_settings.png></a></p><p>With these settings, the chart allows us to visualize the service request duration by credit score category:</p><p><a href=#R-image-83ee08d2cf2ace9132e871fe6aedb1f9 class=lightbox-link><img alt="Duration by Credit Score" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/duration_by_credit_score.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-83ee08d2cf2ace9132e871fe6aedb1f9><img alt="Duration by Credit Score" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/duration_by_credit_score.png></a></p><p>Now we can see the duration by credit score category. In my example, the red line represents the <code>exceptional</code> category, and we can see that the duration for these requests sometimes goes all the way up to 5 seconds.</p><p>The orange represents the <code>very good</code> category, and has very fast response times.</p><p>The green line represents the <code>poor</code> category, and has response times between 2-3 seconds.</p><p>It may be useful to save this chart on a dashboard for future reference. To do this, click on the <strong>Save as&mldr;</strong> button and provide a name for the chart:</p><p><a href=#R-image-7f25056216ac12eb27dcdc64784893ac class=lightbox-link><img alt="Save Chart As" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/save_chart_as.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7f25056216ac12eb27dcdc64784893ac><img alt="Save Chart As" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/save_chart_as.png></a></p><p>When asked which dashboard to save the chart to, let&rsquo;s create a new one named <code>Credit Check Service - Your Name</code> (substituting your actual name):</p><p><a href=#R-image-6e8e4ea3ff84af05c8d8268199a88289 class=lightbox-link><img alt="Save Chart As" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/create_dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6e8e4ea3ff84af05c8d8268199a88289><img alt="Save Chart As" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/create_dashboard.png></a></p><p>Now we can see the chart on our dashboard, and can add more charts as needed to monitor our credit check service:</p><p><a href=#R-image-62db00a35c52cd3aee0595443b41f8ae class=lightbox-link><img alt="Credit Check Service Dashboard" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/credit_check_service_dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-62db00a35c52cd3aee0595443b41f8ae><img alt="Credit Check Service Dashboard" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/credit_check_service_dashboard.png></a></p><h3 id=alerts>Alerts</h3><p>It&rsquo;s great that we have a dashboard to monitor the response times of the credit check service by credit score, but we don&rsquo;t want to stare at a dashboard all day.</p><p>Let&rsquo;s create an alert so we can be notified proactively if customers with <code>exceptional</code> credit scores encounter slow requests.</p><p>To create this alert, click on the little bell on the top right-hand corner of the chart, then select <strong>New detector from chart</strong>:</p><p><a href=#R-image-cddbb6cd7cdabf16f51d2f40bb8e1eb9 class=lightbox-link><img alt="New Detector From Chart" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/new_detector_from_chart.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-cddbb6cd7cdabf16f51d2f40bb8e1eb9><img alt="New Detector From Chart" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/new_detector_from_chart.png></a></p><p>Let&rsquo;s call the detector <code>Latency by Credit Score Category</code>. Set the environment to your environment name (i.e. <code>tagging-workshop-yourname</code>) then select <code>creditcheckservice</code> as the service. Since we only want to look at performance for customers with <code>exceptional</code> credit scores, add a filter using the <code>credit_score_category</code> dimension and select <code>exceptional</code>:</p><p><a href=#R-image-8249389e6b4a17a4b686772ad62eef16 class=lightbox-link><img alt="Create New Detector" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/create_new_detector.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8249389e6b4a17a4b686772ad62eef16><img alt="Create New Detector" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/create_new_detector.png></a></p><p>We can then set the remainder of the alert details as we normally would. The key thing to remember here is that without capturing a tag with the credit score category and indexing it, we wouldn&rsquo;t be able to alert at this granular level, but would instead be forced to bucket all customers together, regardless of their importance to the business.</p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>dmitchsplunk</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>May 3, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=summary>Summary</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>2 minutes</span>
</span>&nbsp;<p>In this workshop, we learned the following:</p><ul><li>What are tags and why are they such a critical part of making an application observable?</li><li>How to use <a href=https://opentelemetry.io rel=external target=_blank><strong>OpenTelemetry</strong></a> to capture tags of interest from your application.</li><li>How to index tags in <strong>Splunk Observability Cloud</strong> and the differences between <strong>Troubleshooting MetricSets</strong> and <strong>Monitoring MetricSets</strong>.</li><li>How to utilize tags in <strong>Splunk Observability Cloud</strong> to find ‚Äúunknown unknowns‚Äù using the <strong>Tag Spotlight</strong> and <strong>Dynamic Service Map</strong> features.</li><li>How to utilize tags for alerting and dashboards.</li></ul><p>Collecting tags aligned with the best practices shared in this workshop will let you get even more value from the data you‚Äôre sending to <strong>Splunk Observability Cloud</strong>. Now that you‚Äôve completed this workshop, you have the knowledge you need to start collecting tags from your own applications!</p><p>To get started with capturing tags today, check out <a href=https://docs.splunk.com/observability/en/apm/span-tags/add-context-trace-span.html#instrument-your-application-code-to-add-tags-to-spans rel=external target=_blank>how to add tags in various supported languages</a>, and then <a href=https://docs.splunk.com/observability/en/apm/span-tags/index-span-tags.html#apm-index-span-tags rel=external target=_blank>how to use them to create Troubleshooting MetricSets</a> so they can be analyzed in Tag Spotlight. For more help, feel free to <a href=https://www.splunk.com/en_us/about-splunk/contact-us.html rel=external target=_blank>ask a Splunk Expert</a>.</p><div class="box notices cstyle primary"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Tip for Workshop Facilitator(s)</div><div class=box-content><p>Once the workshop is complete, remember to delete the APM MetricSet you created earlier for the <code>credit.score.category</code> tag.</p></div></div><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>dmitchsplunk</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Mar 27, 2024</span></span></footer></article></section></div></main></div><script src=../../../js/clipboard.min.js?1715858758 defer></script><script src=../../../js/perfect-scrollbar.min.js?1715858758 defer></script><script src=../../../js/theme.js?1715858758 defer></script></body></html>