<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.125.5"><meta name=generator content="Relearn 6.4.0+tip"><meta name=description content="The following workshops require Ninja skills, wax on, wax off."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Ninja Workshops :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="The following workshops require Ninja skills, wax on, wax off."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.68/en/ninja-workshops/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Ninja Workshops :: Splunk Observability Cloud Workshops"><meta property="og:description" content="The following workshops require Ninja skills, wax on, wax off."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Ninja Workshops :: Splunk Observability Cloud Workshops"><meta itemprop=description content="The following workshops require Ninja skills, wax on, wax off."><meta itemprop=dateModified content="2024-09-19T16:47:03+01:00"><meta itemprop=wordCount content="72"><title>Ninja Workshops :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.68/en/ninja-workshops/index.html rel=canonical type=text/html title="Ninja Workshops :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.68/images/favicon.ico?1727454570 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.68/css/fontawesome-all.min.css?1727454570 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.68/css/fontawesome-all.min.css?1727454570 rel=stylesheet></noscript><link href=/observability-workshop/v5.68/css/nucleus.css?1727454570 rel=stylesheet><link href=/observability-workshop/v5.68/css/auto-complete.css?1727454570 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.68/css/auto-complete.css?1727454570 rel=stylesheet></noscript><link href=/observability-workshop/v5.68/css/perfect-scrollbar.min.css?1727454570 rel=stylesheet><link href=/observability-workshop/v5.68/css/fonts.css?1727454570 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.68/css/fonts.css?1727454570 rel=stylesheet></noscript><link href=/observability-workshop/v5.68/css/theme.css?1727454570 rel=stylesheet><link href=/observability-workshop/v5.68/css/theme-splunk-light.css?1727454570 rel=stylesheet id=R-variant-style><link href=/observability-workshop/v5.68/css/chroma-relearn-light.css?1727454570 rel=stylesheet id=R-variant-chroma-style><link href=/observability-workshop/v5.68/css/variant.css?1727454570 rel=stylesheet><link href=/observability-workshop/v5.68/css/print.css?1727454570 rel=stylesheet media=print><link href=/observability-workshop/v5.68/css/format-print.css?1727454570 rel=stylesheet><script src=/observability-workshop/v5.68/js/variant.js?1727454570></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.68",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.index_js_url="/observability-workshop/v5.68/en/index.search.js?1727454570",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA"})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/observability-workshop/v5.68/en/ninja-workshops/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.68/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Ninja Workshops</span><meta itemprop=position content="2"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.68/en/s4r/10-wrap-up/key-takeaways/index.html title="Key Takeaways (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/index.html title="Automatic Discovery Workshops (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=ninja-workshops>Ninja Workshops</h1><ul class="children children-li children-sort-"><li><a href=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/index.html>Automatic Discovery Workshops</a><p>Automatic Discovery Workshops</p></li><li><a href=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/index.html>Monitoring Horizontal Pod Autoscaling in Kubernetes</a><p>This workshop will equip you with the basic understanding of monitoring Kubernetes using the Splunk OpenTelemetry Collector</p></li><li><a href=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/index.html>Making Your Observability Cloud Native With OpenTelemetry</a><p>Learn the concepts of the OpenTelemetry Collector and how to use it to send data to Splunk Observability Cloud.</p></li><li><a href=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/index.html>Splunk Synthetic Scripting</a><p>Proactively find and fix performance issues across user flows, business transactions and APIs to deliver better digital experiences.</p></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Ninja Workshops</h1><article class=default><header class=headline></header><h1 id=automatic-discovery-workshops>Automatic Discovery Workshops</h1><ul class="children children-li children-sort-"><li><a href=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/index.html>PetClinic Monolith Workshop</a><p>A workshop using automatic discovery and configuration for Java.</p></li><li><a href=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/index.html>Spring PetClinic SpringBoot Based Microservices On Kubernetes</a><p>Learn how to enable automatic discovery and configuration for your Java-based application running in Kubernetes. Experience real-time monitoring to help you maximize application behavior with end-to-end visibility.</p></li><li><a href=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/index.html>NodeJS Zero-Config Workshop</a><p>A workshop using Zero Configuration Auto-Instrumentation for NodeJS.</p></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Automatic Discovery Workshops</h1><article class=chapter><header class=headline></header><h1 id=petclinic-monolith-workshop>PetClinic Monolith Workshop</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>30 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Robert Castley</span></span><p>The goal is to walk through the basic steps to configure the following components of the <strong>Splunk Observability Cloud</strong> platform:</p><ul><li>Splunk Infrastructure Monitoring (IM)</li><li>Splunk Automatic Discovery for Java (APM)<ul><li>Database Query Performance</li><li>AlwaysOn Profiling</li></ul></li><li>Splunk Real User Monitoring (RUM)</li><li>RUM to APM Correlation</li><li>Splunk Log Observer (LO)</li></ul><p>We will also show the steps about how to clone (download) a sample Java application (Spring PetClinic), as well as how to compile, package and run the application.</p><p>Once the application is up and running, we will instantly start seeing metrics, traces and logs via the <strong>automatic discovery and configuration</strong> for Java 2.x that will be used by the <strong>Splunk APM</strong> product.</p><p>After that, we will instrument PetClinic&rsquo;s end user interface (HTML pages rendered by the application) with the <strong>Splunk OpenTelemetry Javascript Libraries (RUM)</strong> that will generate RUM traces around all the individual clicks and page loads executed by an end user.</p><p>Lastly, we will view the logs generated by the automatic injection of trace metadata into the PetClinic application logs.</p><div class="box notices cstyle primary"><div class=box-label><i class="fa-fw fas fa-info"></i> Prerequisites</div><div class=box-content><ul><li>Outbound SSH access to port <code>2222</code>.</li><li>Outbound HTTP access to port <code>8083</code>.</li><li>Familiarity with the <code>bash</code> shell and <code>vi/vim</code> editor.</li></ul></div></div><p><a href=#R-image-bf325163a2eb48360bafbc28c1155b9e class=lightbox-link><img alt="PetClinic Exercise" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/images/petclinic-exercise.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bf325163a2eb48360bafbc28c1155b9e><img alt="PetClinic Exercise" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/images/petclinic-exercise.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of PetClinic Monolith Workshop</h1><article class=default><header class=headline></header><h1 id=installing-the-opentelemetry-collector>Installing the OpenTelemetry Collector</h1><p>The Splunk OpenTelemetry Collector is the core component of instrumenting infrastructure and applications. Its role is to collect and send:</p><ul><li>Infrastructure metrics (disk, CPU, memory, etc)</li><li>Application Performance Monitoring (APM) traces</li><li>Profiling data</li><li>Host and application logs</li></ul><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Remove any existing OpenTelemetry Collectors</div><div class=box-content><p>If you have completed the Splunk IM workshop, please ensure you have deleted the collector running in Kubernetes before continuing. This can be done by running the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></div></div><p>To ensure your instance is configured correctly, we need to confirm that the required environment variables for this workshop are set correctly. In your terminal run the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>. ~/workshop/scripts/check_env.sh</span></span></code></pre></div><p>In the output check that all of the following environment variables are present and have values set. If any are missing, please contact your instructor:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>ACCESS_TOKEN
</span></span><span class=line><span class=cl>REALM
</span></span><span class=line><span class=cl>RUM_TOKEN
</span></span><span class=line><span class=cl>HEC_TOKEN
</span></span><span class=line><span class=cl>HEC_URL
</span></span><span class=line><span class=cl>INSTANCE</span></span></code></pre></div><p>We can then go ahead and install the Collector. Some additional parameters are passed to the install script, they are:</p><ul><li><code>--with-instrumentation</code> - This will install the agent from the Splunk distribution of OpenTelemetry Java, which is then loaded automatically when the PetClinic Java application starts up. No configuration is required!</li><li><code>--deployment-environment</code> - Sets the resource attribute <code>deployment.environment</code> to the value passed. This is used to filter views in the UI.</li><li><code>--enable-profiler</code> - Enables the profiler for the Java application. This will generate CPU profiles for the application.</li><li><code>--enable-profiler-memory</code> - Enables the profiler for the Java application. This will generate memory profiles for the application.</li><li><code>--enable-metrics</code> - Enables the exporting of Micrometer metrics</li><li><code>--hec-token</code> - Sets the HEC token for the collector to use</li><li><code>--hec-url</code> - Sets the HEC URL for the collector to use</li></ul><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo sh /tmp/splunk-otel-collector.sh --realm <span class=nv>$REALM</span> -- <span class=nv>$ACCESS_TOKEN</span> --mode agent --without-fluentd --with-instrumentation --deployment-environment <span class=nv>$INSTANCE</span>-petclinic --enable-profiler --enable-profiler-memory --enable-metrics --hec-token <span class=nv>$HEC_TOKEN</span> --hec-url <span class=nv>$HEC_URL</span></span></span></code></pre></div><p>Next, we will patch the collector to expose the hostname of the instance and not the AWS instance ID. This will make it easier to filter data in the UI:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo sed -i <span class=s1>&#39;s/gcp, ecs, ec2, azure, system/system, gcp, ecs, ec2, azure/g&#39;</span> /etc/otel/collector/agent_config.yaml</span></span></code></pre></div><p>Once the <code>agent_config.yaml</code> has been patched, you will need to restart the collector:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector</span></span></code></pre></div><p>Once the installation is completed, you can navigate to the <strong>Hosts with agent installed</strong> dashboard to see the data from your host, <strong>Dashboards → Hosts with agent installed</strong>.</p><p>Use the dashboard filter and select <code>host.name</code> and type or select the hostname of your workshop instance (you can get this from the command prompt in your terminal session). Once you see data flowing for your host, we are then ready to get started with the APM component.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=building-the-spring-petclinic-application>Building the Spring PetClinic Application</h1><p>The first thing we need to set up APM is&mldr; well, an application. For this exercise, we will use the Spring PetClinic application. This is a very popular sample Java application built with the Spring framework (Springboot).</p><p>First, clone the PetClinic GitHub repository, and then we will compile, build, package and test the application:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/spring-projects/spring-petclinic</span></span></code></pre></div><p>Change into the <code>spring-petclinic</code> directory:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> spring-petclinic</span></span></code></pre></div><p>Using Docker, start a MySQL database for PetClinic to use:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d -e <span class=nv>MYSQL_USER</span><span class=o>=</span>petclinic -e <span class=nv>MYSQL_PASSWORD</span><span class=o>=</span>petclinic -e <span class=nv>MYSQL_ROOT_PASSWORD</span><span class=o>=</span>root -e <span class=nv>MYSQL_DATABASE</span><span class=o>=</span>petclinic -p 3306:3306 docker.io/biarms/mysql:5.7</span></span></code></pre></div><p>Next, we will start another container running Locust that will generate some simple traffic to the PetClinic application. Locust is a simple load-testing tool that can be used to generate traffic to a web application.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --network<span class=o>=</span><span class=s2>&#34;host&#34;</span> -d -p 8090:8090 -v ~/workshop/petclinic:/mnt/locust docker.io/locustio/locust -f /mnt/locust/locustfile.py --headless -u <span class=m>1</span> -r <span class=m>1</span> -H http://127.0.0.1:8083</span></span></code></pre></div><p>Next, compile, build and package PetClinic using <code>maven</code>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><blockquote><p>[!INFO]
This will take a few minutes the first time you run and will download a lot of dependencies before it compiles the application. Future builds will be a lot quicker.</p></blockquote><p>Once the build completes, you need to obtain the public IP address of the instance you are running on. You can do this by running the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://ifconfig.me</span></span></code></pre></div><p>You will see an IP address returned, make a note of this as we will need it to validate that the application is running.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=automatic-discovery-and-configuration-for-java>Automatic discovery and configuration for Java</h1><p>You can now start the application with the following command. Notice that we are passing the <code>mysql</code> profile to the application, this will tell the application to use the MySQL database we started earlier. We are also setting the <code>otel.service.name</code> and <code>otel.resource.attributes</code> to a logical names using the instance name. These will also be used in the UI for filtering:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-env <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>You can validate the application is running by visiting <code>http://&lt;IP_ADDRESS>:8083</code> (replace <code>&lt;IP_ADDRESS></code> with the IP address you obtained earlier).</p><p>When we installed the collector we configured it to enable <strong>AlwaysOn Profiling</strong> and <strong>Metrics</strong>. This means that the collector will automatically generate CPU and Memory profiles for the application and send them to Splunk Observability Cloud.</p><p>When you start the PetClinic application you will see the collector automatically detect the application and instrument it for traces and profiling.</p><div class=tab-panel data-tab-group=7a0f755c85e6dde09ecad41ac0db9253><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("7a0f755c85e6dde09ecad41ac0db9253","example-output")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Picked up JAVA_TOOL_OPTIONS: -javaagent:/usr/lib/splunk-instrumentation/splunk-otel-javaagent.jar
</span></span><span class=line><span class=cl>OpenJDK 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:58:970 +0000] [main] INFO io.opentelemetry.javaagent.tooling.VersionLogger - opentelemetry-javaagent - version: splunk-2.6.0-otel-2.6.0
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:730 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:730 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - Profiler configuration:
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:730 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                  splunk.profiler.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:731 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                splunk.profiler.directory : /tmp
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:731 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -       splunk.profiler.recording.duration : 20s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:731 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -               splunk.profiler.keep-files : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -            splunk.profiler.logs-endpoint : null
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -              otel.exporter.otlp.endpoint : null
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -           splunk.profiler.memory.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -        splunk.profiler.memory.event.rate : 150/s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.call.stack.interval : PT10S
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:733 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -  splunk.profiler.include.internal.stacks : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:733 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.tracing.stacks.only : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:733 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:733 +0000] [main] INFO com.splunk.opentelemetry.profiler.JfrActivator - Profiler is active.</span></span></code></pre></div></div></div></div></div><p>You can now visit the Splunk APM UI and examine the application components, traces, profiling, DB Query performance and metrics. From the left-hand menu <strong>APM</strong> → <strong>Explore</strong>, click the environment dropdown and select your environment e.g. <code>&lt;INSTANCE>-petclinic</code> (where<code>&lt;INSTANCE></code> is replaced with the value you noted down earlier).</p><p><a href=#R-image-2f69d1509691fe74db832a4372840f3f class=lightbox-link><img alt="APM Environment" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/3-auto-discovery/../images/apm-environment.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2f69d1509691fe74db832a4372840f3f><img alt="APM Environment" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/3-auto-discovery/../images/apm-environment.png></a></p><p>Once your validation is complete you can stop the application by pressing <code>Ctrl-c</code>.</p><p>Resource attributes can be added to every reported span. For example <code>version=0.314</code>. A comma-separated list of resource attributes can also be defined e.g. <code>key1=val1,key2=val2</code>.</p><p>Let&rsquo;s launch the PetClinic again using new resource attributes. Note, that adding resource attributes to the run command will override what was defined when we installed the collector. Let&rsquo;s add a new resource attribute <code>version=0.314</code>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-env,version<span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>Back in the Splunk APM UI we can drill down on a recent trace and see the new <code>version</code> attribute in a span.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=3-real-user-monitoring>3. Real User Monitoring</h1><p>For the Real User Monitoring (RUM) instrumentation, we will add the Open Telemetry Javascript <a href=https://github.com/signalfx/splunk-otel-js-web rel=external target=_blank><strong>https://github.com/signalfx/splunk-otel-js-web</strong></a> snippet in the pages, we will use the wizard again <strong>Data Management → Add Integration → RUM Instrumentation → Browser Instrumentation</strong>.</p><p>Your instructor will inform you which token to use from the dropdown, click <strong>Next</strong>. Enter <strong>App name</strong> and <strong>Environment</strong> using the following syntax:</p><ul><li><code>&lt;INSTANCE>-petclinic-service</code> - replacing <code>&lt;INSTANCE></code> with the value you noted down earlier.</li><li><code>&lt;INSTANCE>-petclinic-env</code> - replacing <code>&lt;INSTANCE></code> with the value you noted down earlier.</li></ul><p>The wizard will then show a snippet of HTML code that needs to be placed at the top of the pages in the <code>&lt;head></code> section. The following is an example of the (do not use this snippet, use the one generated by the wizard):</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>/*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>IMPORTANT: Replace the <span class=p>&lt;</span><span class=nt>version</span><span class=p>&gt;</span> placeholder in the src URL with a
</span></span><span class=line><span class=cl>version from https://github.com/signalfx/splunk-otel-js-web/releases
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*/
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>realm</span><span class=o>:</span> <span class=s2>&#34;eu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>rumAccessToken</span><span class=o>:</span> <span class=s2>&#34;&lt;redacted&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>applicationName</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>deploymentEnvironment</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-env&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div><p>The Spring PetClinic application uses a single HTML page as the &ldquo;layout&rdquo; page, that is reused across all pages of the application. This is the perfect location to insert the Splunk RUM Instrumentation Library as it will be loaded in all pages automatically.</p><p>Let&rsquo;s then edit the layout page:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi src/main/resources/templates/fragments/layout.html</span></span></code></pre></div><p>Next, insert the snippet we generated above in the <code>&lt;head></code> section of the page. Make sure you don&rsquo;t include the comment and replace <code>&lt;version></code> in the source URL to <code>latest</code> e.g.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!doctype html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>th:fragment</span><span class=o>=</span><span class=s>&#34;layout (template, menu)&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>realm</span><span class=o>:</span> <span class=s2>&#34;eu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>rumAccessToken</span><span class=o>:</span> <span class=s2>&#34;&lt;redacted&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>applicationName</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>deploymentEnvironment</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-env&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>...</span></span></code></pre></div><p>With the code changes complete, we need to rebuild the application and run it again. Run the <code>maven</code> command to compile/build/package PetClinic:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-env,version<span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>Then let&rsquo;s visit the application using a browser to generate real-user traffic <code>http://&lt;IP_ADDRESS>:8083</code>.</p><p>In RUM, filter down into the environment as defined in the RUM snippet above and click through to the dashboard.</p><p>When you drill down into a RUM trace you will see a link to APM in the spans. Clicking on the trace ID will take you to the corresponding APM trace for the current RUM trace.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=4-log-observer>4. Log Observer</h1><p>For the Splunk Log Observer component, the Splunk OpenTelemetry Collector automatically collects logs from the Spring PetClinic application and sends them to Splunk Observability Cloud using the OTLP exporter, anotating the log events with <code>trace_id</code>, <code>span_id</code> and trace flags.</p><p>Log Observer provides a real-time view of logs from your applications and infrastructure. It allows you to search, filter, and analyze logs to troubleshoot issues and monitor your environment.</p><p>Go back to the PetClinic web application and click on the <strong>Error</strong> link several times. This will generate some log messages in the PetClinic application logs.</p><p><a href=#R-image-49aadc353effbb41ef95120c2f2de5ae class=lightbox-link><img alt="PetClinic Error" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/5-log-observer/../images/petclinic-error.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-49aadc353effbb41ef95120c2f2de5ae><img alt="PetClinic Error" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/5-log-observer/../images/petclinic-error.png></a></p><p>From the left-hand menu click on <strong>Log Observer</strong> and ensure <strong>Index</strong> is set to <strong>splunk4rookies-workshop</strong>.</p><p>Next, click <strong>Add Filter</strong> search for the field <code>service.name</code> select the value <code>&lt;INSTANCE>-petclinic-service</code> and click <code>=</code> (include). You should now see only the log messages from your PetClinic application.</p><p>Select one of the log entries that were generated by clicking on the <strong>Error</strong> link in the PetClinic application. You will see the log message and the trace metadata that was automatically injected into the log message. Also, you will notice that Related Content is available for APM and Infrastructure.</p><p><a href=#R-image-934e5a56d8eba6d8c98fe01d490393df class=lightbox-link><img alt="Log Observer" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/5-log-observer/../images/log-observer.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-934e5a56d8eba6d8c98fe01d490393df><img alt="Log Observer" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/5-log-observer/../images/log-observer.png></a></p><p>This is the end of the workshop and we have certainly covered a lot of ground. At this point, you should have metrics, traces (APM & RUM), logs, database query performance and code profiling being reported into Splunk Observability Cloud and all without having to modify the PetClinic application code (well except for RUM).</p><p><strong>Congratulations!</strong></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section><article class=chapter><header class=headline></header><h1 id=spring-petclinic-springboot-based-microservices-on-kubernetes>Spring PetClinic SpringBoot Based Microservices On Kubernetes</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>90 minutes</span>
</span>&nbsp;<p>The goal of this workshop is to introduce the features of Splunk&rsquo;s <strong>automatic discovery and configuration</strong> for Java.</p><p>The workshop scenario will be created by installing a simple (<strong>un-instrumented</strong>) Java microservices application in Kubernetes.</p><p>By following the simple steps to install the Splunk OpenTelemetry Collector and enabling automatic discovery and configuration for existing Java based deployments you will learn how easy it is to send metrics, traces and logs to <strong>Splunk Observability Cloud</strong>.</p><blockquote><p>[!SPLUNK]Prerequisites</p><ul><li>Outbound SSH access to port <strong>2222</strong>.</li><li>Outbound HTTP access to port <strong>81</strong>.</li><li>Familiarity with the Linux command line.</li></ul></blockquote><p>During this workshop we will cover the following components:</p><ul><li>Splunk Infrastructure Monitoring (<strong>IM</strong>)</li><li>Splunk automatic discovery and configuration for Java (<strong>APM</strong>)<ul><li>Database Query Performance</li><li>AlwaysOn Profiling</li></ul></li><li>Splunk Log Observer (<strong>LO</strong>)</li><li>Splunk Real User Monitoring (<strong>RUM</strong>)</li></ul><p><em>Splunk Synthetics is feeling a little left out here, but we cover that in other workshops</em> <i class="fa-fw fas fa-heart"></i></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 27, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Spring PetClinic SpringBoot Based Microservices On Kubernetes</h1><article class=default><header class=headline></header><h1 id=architecture>Architecture</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<p>The Spring PetClinic Java application is a simple microservices application that consists of a frontend and backend services. The frontend service is a Spring Boot application that serves a web interface to interact with the backend services. The backend services are Spring Boot applications that serve RESTful API&rsquo;s to interact with a MySQL database.</p><p>By the end of this workshop, you will have a better understanding of how to enable <strong>automatic discovery and configuration</strong> for your Java-based applications running in Kubernetes.</p><p>The diagram below details the architecture of the Spring PetClinic Java application running in Kubernetes with the Splunk OpenTelemetry Operator and automatic discovery and configuration enabled.</p><p><a href=#R-image-99f31e1d86571453943feecae22263e2 class=lightbox-link><img alt="Splunk Otel Architecture" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/1-architecture/../images/auto-instrumentation-java-diagram.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-99f31e1d86571453943feecae22263e2><img alt="Splunk Otel Architecture" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/1-architecture/../images/auto-instrumentation-java-diagram.png></a></p><hr><p>Based on the <a href=https://github.com/signalfx/splunk-otel-collector-chart/blob/main/examples/enable-operator-and-auto-instrumentation/spring-petclinic-java.md rel=external target=_blank><strong>example</strong></a> <strong>Josh Voravong</strong> created.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 27, 2024</span></span></footer></article><article class=chapter><header class=headline></header><h1 id=preparation-of-the-workshop-instance>Preparation of the Workshop instance</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>The instructor will provide you with the login information for the instance that we will be using during the workshop.</p><p>When you first log into your instance, you will be greeted by the Splunk Logo as shown below. If you have any issues connecting to your workshop instance then please reach out to your Instructor.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ ssh -p 2222 splunk@&lt;ip-address&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>███████╗██████╗ ██╗     ██╗   ██╗███╗   ██╗██╗  ██╗    ██╗  
</span></span><span class=line><span class=cl>██╔════╝██╔══██╗██║     ██║   ██║████╗  ██║██║ ██╔╝    ╚██╗ 
</span></span><span class=line><span class=cl>███████╗██████╔╝██║     ██║   ██║██╔██╗ ██║█████╔╝      ╚██╗
</span></span><span class=line><span class=cl>╚════██║██╔═══╝ ██║     ██║   ██║██║╚██╗██║██╔═██╗      ██╔╝
</span></span><span class=line><span class=cl>███████║██║     ███████╗╚██████╔╝██║ ╚████║██║  ██╗    ██╔╝ 
</span></span><span class=line><span class=cl>╚══════╝╚═╝     ╚══════╝ ╚═════╝ ╚═╝  ╚═══╝╚═╝  ╚═╝    ╚═╝  
</span></span><span class=line><span class=cl>Last login: Mon Feb  5 11:04:54 2024 from [Redacted]
</span></span><span class=line><span class=cl>Waiting for cloud-init status...
</span></span><span class=line><span class=cl>Your instance is ready!
</span></span><span class=line><span class=cl>splunk@show-no-config-i-0d1b29d967cb2e6ff:~$ </span></span></code></pre></div><p>To ensure your instance is configured correctly, we need to confirm that the required environment variables for this workshop are set correctly. In your terminal run the following script and check that the environment variables are present and set with actual valid values:</p><div class=tab-panel data-tab-group=69c0c6bd1c9c05c58f0f8e89e4be0850><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=script class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("69c0c6bd1c9c05c58f0f8e89e4be0850","script")'>
<span class=tab-nav-text>Script</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("69c0c6bd1c9c05c58f0f8e89e4be0850","example-output")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=script class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>. ~/workshop/petclinic/scripts/check_env.sh</span></span></code></pre></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>ACCESS_TOKEN</span> <span class=o>=</span> &lt;redacted&gt;
</span></span><span class=line><span class=cl><span class=nv>REALM</span> <span class=o>=</span> &lt;e.g. eu0, us1, us2, jp0, au0 etc.&gt;
</span></span><span class=line><span class=cl><span class=nv>RUM_TOKEN</span> <span class=o>=</span> &lt;redacted&gt;
</span></span><span class=line><span class=cl><span class=nv>HEC_TOKEN</span> <span class=o>=</span> &lt;redacted&gt;
</span></span><span class=line><span class=cl><span class=nv>HEC_URL</span> <span class=o>=</span> https://&lt;...&gt;/services/collector/event
</span></span><span class=line><span class=cl><span class=nv>INSTANCE</span> <span class=o>=</span> &lt;instance_name&gt;</span></span></code></pre></div></div></div></div></div><p>Please make a note of the <code>INSTANCE</code> environment variable value as this will used later to filter data in <strong>Splunk Observability Cloud</strong>.</p><p>For this workshop, <strong>all</strong> of the above are required. If any have values missing, please contact your Instructor.</p><blockquote><p>[!SPLUNK] Delete any existing OpenTelemetry Collectors
If you have previously completed a Splunk Observability workshop using this EC2 instance, you
need to ensure that any existing installation of the Splunk OpenTelemetry Collector is
deleted. This can be achieved by running the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></blockquote><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 27, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Preparation of the Workshop instance</h1><article class=default><header class=headline></header><h1 id=deploy-the-splunk-opentelemetry-collector>Deploy the Splunk OpenTelemetry Collector</h1><p>To get Observability signals (<strong>metrics, traces</strong> and <strong>logs</strong>) into <strong>Splunk Observability Cloud</strong> the Splunk OpenTelemetry Collector needs to be deployed into the Kubernetes cluster.</p><p>For this workshop, we will be using the Splunk OpenTelemetry Collector Helm Chart. First we need to add the Helm chart repository to Helm and update to ensure the latest version:</p><div class=tab-panel data-tab-group=600f767e61cdd53f88ce285a65869379><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=install-helm-chart class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("600f767e61cdd53f88ce285a65869379","install-helm-chart")'>
<span class=tab-nav-text>Install Helm Chart</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("600f767e61cdd53f88ce285a65869379","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=install-helm-chart class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart <span class=o>&amp;&amp;</span> helm repo update</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Using ACCESS_TOKEN={REDACTED}
</span></span><span class=line><span class=cl>Using REALM=eu0
</span></span><span class=line><span class=cl>&#34;splunk-otel-collector-chart&#34; has been added to your repositories
</span></span><span class=line><span class=cl>Using ACCESS_TOKEN={REDACTED}
</span></span><span class=line><span class=cl>Using REALM=eu0
</span></span><span class=line><span class=cl>Hang tight while we grab the latest from your chart repositories...
</span></span><span class=line><span class=cl>...Successfully got an update from the &#34;splunk-otel-collector-chart&#34; chart repository
</span></span><span class=line><span class=cl>Update Complete. ⎈Happy Helming!⎈</span></span></code></pre></div></div></div></div></div><p><strong>Splunk Observability Cloud</strong> offers wizards in the UI to walk you through the setup of the OpenTelemetry Collector on Kubernetes, but in the interest of time, we will use the Helm install command below. Additional parameters are set to enable the operator and automatic discovery and configuration.</p><ul><li><code>--set="operator.enabled=true"</code> - this will install the Opentelemetry operator that will be used to handle automatic discovery and configuration.</li><li><code>--set="certmanager.enabled=true"</code> - this will install the required certificate manager for the operator.</li><li><code>--set="splunkObservability.profilingEnabled=true"</code> - this enables Code Profiling via the operator.</li></ul><p>To install the collector run the following command, do <strong>NOT</strong> edit this:</p><div class=tab-panel data-tab-group=08153f2a2d6c86ae9d00d7ba1f3b7ee8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=helm-install class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("08153f2a2d6c86ae9d00d7ba1f3b7ee8","helm-install")'>
<span class=tab-nav-text>Helm Install</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("08153f2a2d6c86ae9d00d7ba1f3b7ee8","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=helm-install class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;operator.enabled=true&#34;</span>, <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;certmanager.enabled=true&#34;</span>, <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.profilingEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;environment=</span><span class=nv>$INSTANCE</span><span class=s2>-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.endpoint=</span><span class=nv>$HEC_URL</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.token=</span><span class=nv>$HEC_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.index=splunk4rookies-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/otel-collector.yaml</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>LAST DEPLOYED: Fri Apr 19 09:39:54 2024
</span></span><span class=line><span class=cl>NAMESPACE: default
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 1
</span></span><span class=line><span class=cl>NOTES:
</span></span><span class=line><span class=cl>Splunk OpenTelemetry Collector is installed and configured to send data to Splunk Platform endpoint &#34;https://http-inputs-o11y-workshop-eu0.splunkcloud.com:443/services/collector/event&#34;.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Splunk OpenTelemetry Collector is installed and configured to send data to Splunk Observability realm eu0.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[INFO] You&#39;ve enabled the operator&#39;s auto-instrumentation feature (operator.enabled=true), currently considered ALPHA.
</span></span><span class=line><span class=cl>  - Instrumentation library maturity varies (e.g., Java is more mature than Go). For library stability, visit: https://opentelemetry.io/docs/instrumentation/#status-and-releases
</span></span><span class=line><span class=cl>  - Some libraries may be enabled by default. For current status, see: https://github.com/open-telemetry/opentelemetry-operator#controlling-instrumentation-capabilities
</span></span><span class=line><span class=cl>  - Splunk provides best-effort support for native OpenTelemetry libraries, and full support for Splunk library distributions. For used libraries, refer to the values.yaml under &#34;operator.instrumentation.spec&#34;.</span></span></code></pre></div></div></div></div></div><p>Ensure the Pods are reported as <strong>Running</strong> before continuing (this typically takes around 30 seconds).</p><div class=tab-panel data-tab-group=77c37531797182305228a189051d5ed9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-get-pods class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("77c37531797182305228a189051d5ed9","kubectl-get-pods")'>
<span class=tab-nav-text>kubectl get pods</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("77c37531797182305228a189051d5ed9","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-get-pods class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods <span class=p>|</span> grep splunk-otel </span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>splunk-otel-collector-certmanager-cainjector-5c5dc4ff8f-95z49   1/1     Running   0          10m
</span></span><span class=line><span class=cl>splunk-otel-collector-certmanager-6d95596898-vjxss              1/1     Running   0          10m
</span></span><span class=line><span class=cl>splunk-otel-collector-certmanager-webhook-69f4ff754c-nghxz      1/1     Running   0          10m
</span></span><span class=line><span class=cl>splunk-otel-collector-k8s-cluster-receiver-6bd5567d95-5f8cj     1/1     Running   0          10m
</span></span><span class=line><span class=cl>splunk-otel-collector-agent-tspd2                               1/1     Running   0          10m
</span></span><span class=line><span class=cl>splunk-otel-collector-operator-69d476cb7-j7zwd                  2/2     Running   0          10m</span></span></code></pre></div></div></div></div></div><p>Ensure there are no errors reported by the Splunk OpenTelemetry Collector (press <code>ctrl + c</code> to exit) or use the installed <strong>awesome</strong> <code>k9s</code> terminal UI for bonus points!</p><div class=tab-panel data-tab-group=5fb86e3dd48af25222f8dae71a82f61f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-logs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5fb86e3dd48af25222f8dae71a82f61f","kubectl-logs")'>
<span class=tab-nav-text>kubectl logs</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("5fb86e3dd48af25222f8dae71a82f61f","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-logs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>app</span><span class=o>=</span>splunk-otel-collector -f --container otel-collector</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2021-03-21T16:11:10.900Z        INFO    service/service.go:364  Starting receivers...
</span></span><span class=line><span class=cl>2021-03-21T16:11:10.900Z        INFO    builder/receivers_builder.go:70 Receiver is starting... {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;prometheus&#34;, &#34;component_name&#34;: &#34;prometheus&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    builder/receivers_builder.go:75 Receiver started.       {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;prometheus&#34;, &#34;component_name&#34;: &#34;prometheus&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    builder/receivers_builder.go:70 Receiver is starting... {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;k8s_cluster&#34;, &#34;component_name&#34;: &#34;k8s_cluster&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    k8sclusterreceiver@v0.21.0/watcher.go:195       Configured Kubernetes MetadataExporter  {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;k8s_cluster&#34;, &#34;component_name&#34;: &#34;k8s_cluster&#34;, &#34;exporter_name&#34;: &#34;signalfx&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    builder/receivers_builder.go:75 Receiver started.       {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;k8s_cluster&#34;, &#34;component_name&#34;: &#34;k8s_cluster&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    healthcheck/handler.go:128      Health Check state change       {&#34;component_kind&#34;: &#34;extension&#34;, &#34;component_type&#34;: &#34;health_check&#34;, &#34;component_name&#34;: &#34;health_check&#34;, &#34;status&#34;: &#34;ready&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    service/service.go:267  Everything is ready. Begin running and processing data.
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    k8sclusterreceiver@v0.21.0/receiver.go:59       Starting shared informers and wait for initial cache sync.      {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;k8s_cluster&#34;, &#34;component_name&#34;: &#34;k8s_cluster&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.281Z        INFO    k8sclusterreceiver@v0.21.0/receiver.go:75       Completed syncing shared informer caches.       {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;k8s_cluster&#34;, &#34;component_name&#34;: &#34;k8s_cluster&#34;}</span></span></code></pre></div></div></div></div></div><blockquote><p>[!INFO] Deleting a failed installation
If you make an error installing the OpenTelemetry Collector you can start over by deleting the
installation with the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></blockquote><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 27, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=deploy-the-petclinic-application>Deploy the PetClinic Application</h1><p>The first deployment of the application will be using prebuilt containers to give the base scenario: a regular Java microservices-based application running in Kubernetes that we want to start observing. So let&rsquo;s deploy the application:</p><div class=tab-panel data-tab-group=bf3447425ded727ade54ac65e439d6b6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-apply class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("bf3447425ded727ade54ac65e439d6b6","kubectl-apply")'>
<span class=tab-nav-text>kubectl apply</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("bf3447425ded727ade54ac65e439d6b6","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-apply class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f ~/workshop/petclinic/petclinic-deploy.yaml</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>deployment.apps/config-server created
</span></span><span class=line><span class=cl>service/config-server created
</span></span><span class=line><span class=cl>deployment.apps/discovery-server created
</span></span><span class=line><span class=cl>service/discovery-server created
</span></span><span class=line><span class=cl>deployment.apps/api-gateway created
</span></span><span class=line><span class=cl>service/api-gateway created
</span></span><span class=line><span class=cl>service/api-gateway-external created
</span></span><span class=line><span class=cl>deployment.apps/customers-service created
</span></span><span class=line><span class=cl>service/customers-service created
</span></span><span class=line><span class=cl>deployment.apps/vets-service created
</span></span><span class=line><span class=cl>service/vets-service created
</span></span><span class=line><span class=cl>deployment.apps/visits-service created
</span></span><span class=line><span class=cl>service/visits-service created
</span></span><span class=line><span class=cl>deployment.apps/admin-server created
</span></span><span class=line><span class=cl>service/admin-server created
</span></span><span class=line><span class=cl>service/petclinic-db created
</span></span><span class=line><span class=cl>deployment.apps/petclinic-db created
</span></span><span class=line><span class=cl>configmap/petclinic-db-initdb-config created
</span></span><span class=line><span class=cl>deployment.apps/petclinic-loadgen-deployment created
</span></span><span class=line><span class=cl>configmap/scriptfile created</span></span></code></pre></div></div></div></div></div><p>At this point, we can verify the deployment by checking that the Pods are running. The containers need to be downloaded and started so this may take a couple of minutes.</p><div class=tab-panel data-tab-group=4384577554aa9efe5e3c670ff25c88fc><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-get-pods class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4384577554aa9efe5e3c670ff25c88fc","kubectl-get-pods")'>
<span class=tab-nav-text>kubectl get pods</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("4384577554aa9efe5e3c670ff25c88fc","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-get-pods class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                                            READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>splunk-otel-collector-certmanager-dc744986b-z2gzw               1/1     Running   0          114s
</span></span><span class=line><span class=cl>splunk-otel-collector-certmanager-cainjector-69546b87d6-d2fz2   1/1     Running   0          114s
</span></span><span class=line><span class=cl>splunk-otel-collector-certmanager-webhook-78b59ffc88-r2j8x      1/1     Running   0          114s
</span></span><span class=line><span class=cl>splunk-otel-collector-k8s-cluster-receiver-655dcd9b6b-dcvkb     1/1     Running   0          114s
</span></span><span class=line><span class=cl>splunk-otel-collector-agent-dg2vj                               1/1     Running   0          114s
</span></span><span class=line><span class=cl>splunk-otel-collector-operator-57cbb8d7b4-dk5wf                 2/2     Running   0          114s
</span></span><span class=line><span class=cl>petclinic-db-64d998bb66-2vzpn                                   1/1     Running   0          58s
</span></span><span class=line><span class=cl>api-gateway-d88bc765-jd5lg                                      1/1     Running   0          58s
</span></span><span class=line><span class=cl>visits-service-7f97b6c579-bh9zj                                 1/1     Running   0          58s
</span></span><span class=line><span class=cl>admin-server-76d8b956c5-mb2zv                                   1/1     Running   0          58s
</span></span><span class=line><span class=cl>customers-service-847db99f79-mzlg2                              1/1     Running   0          58s
</span></span><span class=line><span class=cl>vets-service-7bdcd7dd6d-2tcfd                                   1/1     Running   0          58s
</span></span><span class=line><span class=cl>petclinic-loadgen-deployment-5d69d7f4dd-xxkn4                   1/1     Running   0          58s
</span></span><span class=line><span class=cl>config-server-67f7876d48-qrsr5                                  1/1     Running   0          58s
</span></span><span class=line><span class=cl>discovery-server-554b45cfb-bqhgt                                1/1     Running   0          58s</span></span></code></pre></div></div></div></div></div><p>Make sure the output of <code>kubectl get pods</code> matches the output as shown above. Ensure all the services are shown as <strong>Running</strong> (or use <code>k9s</code> to continuously monitor the status).</p><p>To test the application you need to obtain the public IP address of the instance you are running on. You can do this by running the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://ifconfig.me</span></span></code></pre></div><p>You can validate if the application is running by visiting <strong>http://&lt;IP_ADDRESS>:81</strong> (replace <strong>&lt;IP_ADDRESS></strong> with the IP address you obtained above). You should see the PetClinic application running.</p><p><a href=#R-image-6df712d13559289a4bd1e35cacc1fbff class=lightbox-link><img alt="Pet shop" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/2-preparation/2-petclinic/../../images/petclinic.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6df712d13559289a4bd1e35cacc1fbff><img alt="Pet shop" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/2-preparation/2-petclinic/../../images/petclinic.png></a></p><p>Make sure the application is working correctly by visiting the <strong>All Owners</strong> <strong>(1)</strong> and <strong>Veterinarians</strong> <strong>(2)</strong> tabs, you should get a list of names in each case.</p><p><a href=#R-image-e3f8fa0d60d9e166e85f4adde37317bf class=lightbox-link><img alt=owners class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/2-preparation/2-petclinic/../../images/petclinic-owners.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e3f8fa0d60d9e166e85f4adde37317bf><img alt=owners class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/2-preparation/2-petclinic/../../images/petclinic-owners.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 27, 2024</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=verify-kubernetes-cluster-metrics>Verify Kubernetes Cluster metrics</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>Once the installation has been completed, you can log in to <strong>Splunk Observability Cloud</strong> and verify that the metrics are flowing in from your Kubernetes cluster.</p><p>From the left-hand menu click on <strong>Infrastructure</strong> <a href=#R-image-ec6b8f0da18db9dcb1bdf2dcffa293a2 class=lightbox-link><img alt=infra class="noborder inline lazy lightbox noshadow figure-image" loading=lazy src="/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/3-verify-setup/../images/infra-icon.png?classes=inline&height=25px" style=height:25px;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ec6b8f0da18db9dcb1bdf2dcffa293a2><img alt=infra class="noborder inline lazy lightbox noshadow lightbox-image" loading=lazy src="/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/3-verify-setup/../images/infra-icon.png?classes=inline&height=25px"></a> and select <strong>Kubernetes</strong>, then select the <strong>Kubernetes nodes</strong> pane. Once you are in the <strong>Kubernetes nodes</strong> view, change the <strong>Time</strong> filter from <strong>-4h</strong> to the last 15 minutes <strong>(-15m)</strong> to focus on the latest data.</p><p>Next, click <strong>Add filters</strong> (next to the <strong>Time filter</strong>) and add the filter <code>k8s.cluster.name</code> <strong>(1)</strong>. Type or select the cluster name of your workshop instance (you can get the unique part from your cluster name by using the <code>INSTANCE</code> from the output from the shell script you ran earlier). You can also select your cluster by clicking on its image in the cluster pane. You will now only have your cluster visible <strong>(2)</strong>.</p><p><a href=#R-image-103c6d78836e16ae7e5cf5e7339c7630 class=lightbox-link><img alt=Navigator class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/3-verify-setup/../images/navigator.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-103c6d78836e16ae7e5cf5e7339c7630><img alt=Navigator class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/3-verify-setup/../images/navigator.png></a></p><p>Scroll down the page to see the metrics coming in from your cluster. Locate the <strong>Node log events rate</strong> chart and click on a vertical bar to see the log entries coming in from your cluster.</p><p><a href=#R-image-74d1c7492474fee6431b446ab5e023aa class=lightbox-link><img alt=logs class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/3-verify-setup/../images/k8s-peek-at-logs.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-74d1c7492474fee6431b446ab5e023aa><img alt=logs class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/3-verify-setup/../images/k8s-peek-at-logs.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Verify Kubernetes Cluster metrics</h1></section><article class=default><header class=headline></header><h1 id=setting-up-automatic-discovery-and-configuration-for-apm>Setting up automatic discovery and configuration for APM</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>In this section we will enable <strong>automatic discovery and configuration</strong> for the Java services running in Kubernetes. This means that the OpenTelemetry Collector will look for Pod annotations that indicate that the Java application should be instrumented with the Splunk OpenTelemetry Java agent. This will allow us to get traces, spans, and profiling data from the Java services running on the cluster.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> automatic discovery and configuration</div><div class=box-content><p>It is important to understand that automatic discovery and configuration is designed to get <strong>trace, span & profiling</strong> data out of your application, without requiring code changes or recompilation.</p><p>This is a great way to get started with APM, but it is <strong>not</strong> a replacement for manual instrumentation. Manual instrumentation allows you to add custom spans, tags, and logs to your application, which can provide more context and detail to your traces.</p></div></div><p>For Java applications the OpenTelemetry Collector will look for the annotation <code>instrumentation.opentelemetry.io/inject-java</code>.</p><p>The annotation can have the value set <code>true</code> or to the <code>namespace/daemonset</code> of the OpenTelemetry Collector e.g. <code>default/splunk-otel-collector</code>. This allows working across namespaces and what we will use in this workshop.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Using the deployment.yaml</div><div class=box-content><p>If you want your Pods to send traces automatically, you can add the annotation to the <code>deployment.yaml</code> as shown below. This will add the instrumentation library during the initial deployment. To speed things up we have done that for the following Pods:</p><ul><li><strong>admin-server</strong></li><li><strong>config-server</strong></li><li><strong>discovery-server</strong></li></ul><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>admin-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class=l>spring-petclinic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>admin-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>admin-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>instrumentation.opentelemetry.io/inject-java</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;default/splunk-otel-collector&#34;</span></span></span></code></pre></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Setting up automatic discovery and configuration for APM</h1><article class=default><header class=headline></header><h1 id=patching-the-deployment>Patching the Deployment</h1><p>To configure <strong>automatic discovery and configuration</strong> the deployments need to be patched to add the instrumentation annotation. Once patched, the OpenTelemetry Collector will inject the automatic discovery and configuration library and the Pods will be restarted in order to start sending traces and profiling data. First, confirm that the <code>api-gateway</code> does not have the <code>splunk-otel-java</code> image.</p><div class=tab-panel data-tab-group=669ed4767dbcb45ea0dd6df88eac284a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=describe-api-gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("669ed4767dbcb45ea0dd6df88eac284a","describe-api-gateway")'>
<span class=tab-nav-text>Describe api-gateway</span>
</button>
<button data-tab-item=describe-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("669ed4767dbcb45ea0dd6df88eac284a","describe-output")'>
<span class=tab-nav-text>Describe Output</span></button></div><div class=tab-content-container><div data-tab-item=describe-api-gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe pods api-gateway <span class=p>|</span> grep Image:</span></span></code></pre></div></div></div><div data-tab-item=describe-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Image:         quay.io/phagen/spring-petclinic-api-gateway:0.0.2</span></span></code></pre></div></div></div></div></div><p>Next, enable the Java automatic discovery and configuration for all of the services by adding the annotation to the deployments. The following command will patch the all deployments. This will trigger the OpenTelemetry Operator to inject the <code>splunk-otel-java</code> image into the Pods:</p><div class=tab-panel data-tab-group=e41800403c4d033e390f08210dd77460><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=patch-all-petclinic-services class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e41800403c4d033e390f08210dd77460","patch-all-petclinic-services")'>
<span class=tab-nav-text>Patch all PetClinic services</span>
</button>
<button data-tab-item=patch-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("e41800403c4d033e390f08210dd77460","patch-output")'>
<span class=tab-nav-text>Patch Output</span></button></div><div class=tab-content-container><div data-tab-item=patch-all-petclinic-services class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get deployments -l app.kubernetes.io/part-of<span class=o>=</span>spring-petclinic -o name <span class=p>|</span> xargs -I % kubectl patch % -p <span class=s2>&#34;{\&#34;spec\&#34;: {\&#34;template\&#34;:{\&#34;metadata\&#34;:{\&#34;annotations\&#34;:{\&#34;instrumentation.opentelemetry.io/inject-java\&#34;:\&#34;default/splunk-otel-collector\&#34;}}}}}&#34;</span></span></span></code></pre></div></div></div><div data-tab-item=patch-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>deployment.apps/config-server patched (no change)
</span></span><span class=line><span class=cl>deployment.apps/admin-server patched (no change)
</span></span><span class=line><span class=cl>deployment.apps/customers-service patched
</span></span><span class=line><span class=cl>deployment.apps/visits-service patched
</span></span><span class=line><span class=cl>deployment.apps/discovery-server patched (no change)
</span></span><span class=line><span class=cl>deployment.apps/vets-service patched
</span></span><span class=line><span class=cl>deployment.apps/api-gateway patched</span></span></code></pre></div></div></div></div></div><p>There will be no change for the <strong>config-server</strong>, <strong>discovery-server</strong> and <strong>admin-server</strong> as these have already been patched.</p><p>To check the container image(s) of the <code>api-gateway</code> pod again, run the following command:</p><div class=tab-panel data-tab-group=ea0af388db55e6e4d140ac1d9cff57c7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=describe-api-gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ea0af388db55e6e4d140ac1d9cff57c7","describe-api-gateway")'>
<span class=tab-nav-text>Describe api-gateway</span>
</button>
<button data-tab-item=describe-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("ea0af388db55e6e4d140ac1d9cff57c7","describe-output")'>
<span class=tab-nav-text>Describe Output</span></button></div><div class=tab-content-container><div data-tab-item=describe-api-gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe pods api-gateway <span class=p>|</span> grep Image:</span></span></code></pre></div></div></div><div data-tab-item=describe-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Image:         ghcr.io/signalfx/splunk-otel-java/splunk-otel-java:v1.30.0
</span></span><span class=line><span class=cl>Image:         quay.io/phagen/spring-petclinic-api-gateway:0.0.2</span></span></code></pre></div></div></div></div></div><p>A new image has been added to the <code>api-gateway</code> which will pull <code>splunk-otel-java</code> from <code>ghcr.io</code> (if you see two <code>api-gateway</code> containers, the original one is probably still terminating, so give it a few seconds).</p><p>Navigate back to the Kubernetes Navigator in <strong>Splunk Observability Cloud</strong>. After a couple of minutes you will see that the Pods are being restarted by the operator and the automatic discovery and configuration container will be added. This will look similar to the screenshot below:</p><p><a href=#R-image-74b85d5ae4096e4616815806e796c76f class=lightbox-link><img alt=restart class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/4-apm/1-patching-deployment/../../images/k8s-navigator-restarted-pods.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-74b85d5ae4096e4616815806e796c76f><img alt=restart class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/4-apm/1-patching-deployment/../../images/k8s-navigator-restarted-pods.png></a></p><p>Wait for the Pods to turn green in the Kubernetes Navigator, then go tho the next section.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=viewing-the-data-in-splunk-apm>Viewing the data in Splunk APM</h1><p>Log in to Splunk Observability Cloud, from the left-hand menu click on <strong>APM</strong> <a href=#R-image-9798049b868df35f837e8a2654170977 class=lightbox-link><img alt=APM class="noborder inline lazy lightbox noshadow figure-image" loading=lazy src="/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/4-apm/2-apm-data/../../images/apm-icon.png?classes=inline&height=25px" style=height:25px;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9798049b868df35f837e8a2654170977><img alt=APM class="noborder inline lazy lightbox noshadow lightbox-image" loading=lazy src="/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/4-apm/2-apm-data/../../images/apm-icon.png?classes=inline&height=25px"></a> to see the data generated by the traces from the newly instrumented services. Change the <strong>Environment</strong> filter <strong>(1)</strong> to the name of your workshop instance in the dropdown box (this will be <strong><code>&lt;INSTANCE>-workshop</code></strong> where <strong><code>INSTANCE</code></strong> is the value from the shell script you ran earlier) and make sure it is the only one selected.</p><p><a href=#R-image-bc68470a9d5bee07a7c5f7d526e2ee95 class=lightbox-link><img alt=apm class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/4-apm/2-apm-data/../../images/zero-config-first-services-overview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bc68470a9d5bee07a7c5f7d526e2ee95><img alt=apm class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/4-apm/2-apm-data/../../images/zero-config-first-services-overview.png></a></p><p>You will see the name <strong>(2)</strong> of the <strong>api-gateway</strong> service and metrics in the Latency and Request & Errors charts (you can ignore the Critical Alert, as it is caused by the sudden request increase generated by the load generator). You will also see the rest of the services appear.</p><p>Once you see the Customer service, Vets service and Visits services like show in the screenshot above, let&rsquo;s click on the <strong>Service Map</strong> <strong>(3)</strong> pane to get ready for the next section.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section><article class=chapter><header class=headline></header><h1 id=apm-features>APM Features</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>As we have seen in the previous section, once you enable <strong>automatic discovery and configuration</strong> on your services, traces are sent to <strong>Splunk Observability Cloud</strong>.</p><p>With these traces, Splunk will automatically generate <strong>Service Maps</strong> and <strong>RED Metrics</strong>. These are the first steps in understanding the behavior of your services and how they interact with each other.</p><p>In this next section, we are going to examine the traces themselves and what information they provide to help you understand the behavior of your services all without touching your code.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of APM Features</h1><article class=default><header class=headline></header><h1 id=apm-service-map>APM Service Map</h1><p><a href=#R-image-1c960d780b77717ed51dfc05f1d63e2a class=lightbox-link><img alt="apm map" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/5-traces/1-service-map/../../images/zero-config-first-services-map.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1c960d780b77717ed51dfc05f1d63e2a><img alt="apm map" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/5-traces/1-service-map/../../images/zero-config-first-services-map.png></a></p><p>The above map shows all the interactions between all of the services. The map may still be in an interim state as it will take the Petclinic Microservice application a few minutes to start up and fully synchronize. Reducing the time filter to a custom time of <strong>2 minutes</strong> will help. The initial startup-related errors (red dots) will eventually disappear.</p><p>Next, let&rsquo;s examine the metrics that are available for each service that is instrumented and visit the request, error, and duration (RED) metrics Dashboard</p><p>For this exercise we are going to use a common scenario you would use if the service operation was showing high latency, or errors for example.</p><p>Select (click) on the <strong>Customer Service</strong> in the Dependency map <strong>(1)</strong>, then make sure the <code>customers-service</code> is selected in the <strong>Services</strong> dropdown box <strong>(2)</strong>. Next, select <code>GET /Owners</code> from the Operations dropdown <strong>(3</strong>)**.</p><p>This should give you the workflow with a filter on <code>GET /owners</code> <strong>(1)</strong> as shown below.</p><p><a href=#R-image-53ef527b45401df94a2d4e70b9332e92 class=lightbox-link><img alt="select a trace" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/5-traces/1-service-map/../../images/select-workflow.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-53ef527b45401df94a2d4e70b9332e92><img alt="select a trace" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/5-traces/1-service-map/../../images/select-workflow.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=apm-trace>APM Trace</h1><p>To pick a trace, select a line in the <code>Service Requests & Errors</code> chart <strong>(2)</strong>, when the dot appears click to get a list of sample traces:</p><p>Once you have the list of sample traces, click on the blue <strong>(3)</strong> Trace ID Link (make sure it has the same three services mentioned in the Service Column.)</p><p><a href=#R-image-bc6a7900d9145e6c1cea035c9b5aa96d class=lightbox-link><img alt=workflow-trace-pick class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/5-traces/2-trace/../../images/selecting-a-trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bc6a7900d9145e6c1cea035c9b5aa96d><img alt=workflow-trace-pick class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/5-traces/2-trace/../../images/selecting-a-trace.png></a></p><p>This brings us the the Trace selected in the Waterfall view:</p><p>Here we find several sections:</p><ul><li>The actual Waterfall Pane <strong>(1)</strong>, where you see the trace and all the instrumented functions visible as spans, with their duration representation and order/relationship showing.</li><li>The Trace Info Pane <strong>(2)</strong>, by default, shows the selected Span information (highlighted with a box around the Span in the Waterfall Pane).</li><li>The Span Pane <strong>(3)</strong>, here you can find all the Tags that have been sent in the selected Span, You can scroll down to see all of them.</li><li>The process Pane, with tags related to the process that created the Span (scroll down to see as it is not in the screenshot).</li><li>The Trace Properties at the top of the right-hand pane by default is collapsed as shown.</li></ul><p><a href=#R-image-e5c7fa8a92e084f6a558b8f4a8646395 class=lightbox-link><img alt=waterfall class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/5-traces/2-trace/../../images/waterfall-view.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e5c7fa8a92e084f6a558b8f4a8646395><img alt=waterfall class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/5-traces/2-trace/../../images/waterfall-view.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=apm-span>APM Span</h1><p>While we examine our spans, let&rsquo;s look at several features that you get out of the box without code modifications when using <strong>automatic discovery and configuration</strong> on top of tracing:</p><p>Due to the fact there are several different routes
First, in the Waterfall Pane, make sure the <code>customers-service:SELECT petclinic.owners</code> or similar span is selected as shown in the screenshot below:</p><p><a href=#R-image-0cb08a7f3384a2c9021f4cf50bab57b9 class=lightbox-link><img alt=DB-query class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/5-traces/3-spans/../../images/db-query.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0cb08a7f3384a2c9021f4cf50bab57b9><img alt=DB-query class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/5-traces/3-spans/../../images/db-query.png></a></p><ul><li>The basic latency information is shown as a bar for the instrumented function or call, in our example, it took 6.3 Milliseconds.</li><li>Several similar Spans <strong>(1)</strong>, are only visible if the span is repeated multiple times. In this case, there are 10 repeats in our example. (You can show/hide them all by clicking on the <code>10x</code> and all spans will show in order)</li><li><strong>Inferred Services</strong>: Calls made to external systems that are not instrumented, show up as a grey &lsquo;inferred&rsquo; span. The Inferred Service or span in our case here is a call to the Mysql Database <code>mysql:petclinic SELECT petclinic</code> <strong>(2)</strong> as shown above our selected span.</li><li><strong>Span Tags</strong>: In the Tag Pane, standard tags produced by the automatic discovery and configuration. In this case, the span is calling a Database, so it includes the <code>db.statement</code> tag <strong>(3)</strong>. This tag will hold the DB query statement and is used by the Database call performed during this span. This will be used by the DB-Query Performance feature. We look at DB-Query Performance in the next section.</li><li><strong>Always-on Profiling</strong>: <strong>IF</strong> the system is configured to and has captured Profiling data during a Span life cycle, it will show the number of Call Stacks captured in the Spans timeline (15 Call Stacks for the <code>customers-service:SELECT petclinic.owners</code> Span shown above).</li></ul><p>We will look at Profiling in the next section.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=service-centric-view>Service Centric View</h1><p>Splunk APM provide <strong>Service Centric Views</strong> that provide engineers a deep understanding of service performance in one centralized view. Now, across every service, engineers can quickly identify errors or bottlenecks from a service’s underlying infrastructure, pinpoint performance degradations from new deployments, and visualize the health of every third party dependency.</p><p>To see this dashboard for the <code>api-gateway</code>, make sure you have the <code>api-gateway</code> service selected in the Service Map, then click on the *<strong>View Service</strong> button in the top of the right-hand pane. This will bring you to the Service Centric View dashboard:</p><p>This view, which is available for each of your instrumented services, offers an overview of <strong>Service metrics</strong>, <strong>Runtime metrics</strong> and <strong>Infrastructure metrics</strong>.</p><p>You can select the *<em>Back</em> function of you browser to go back to the previous view.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section><article class=chapter><header class=headline></header><h1 id=always-on-profiling--db-query-performance>Always-On Profiling & DB Query Performance</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>As we have seen in the previous chapter, you can trace your interactions between the various services using APM without touching your code, which will allow you to identify issues faster.</p><p>However, besides tracing <strong>automatic discovery and configuration</strong> offers additional features out of the box that can help you find issues even faster. In this section we are going to look at two of them:</p><ul><li><strong>Always-on Profiling and Java Metrics</strong></li><li><strong>Database Query Performance</strong></li></ul><p>If you want to dive deeper into Always-on Profiling or DB-Query performance, we have a separate Ninja Workshop called <a href=/observability-workshop/v5.68/en/scenarios/debug_problems/index.html><strong>Debug Problems in Microservices</strong></a> that you can follow.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Always-On Profiling & DB Query Performance</h1><article class=default><header class=headline></header><h1 id=always-on-profiling--metrics>Always-On Profiling & Metrics</h1><p>When we installed the Splunk Distribution of the OpenTelemetry Collector using the Helm chart earlier, we configured it to enable <strong>AlwaysOn Profiling</strong> and <strong>Metrics</strong>. This means that the collector will automatically generate CPU and Memory profiles for the application and send them to Splunk Observability Cloud.</p><p>When you deploy the PetClinic application and set the annotation, the collector automatically detects the application and instruments it for traces and profiling. We can verify this by examining the startup logs of one of the Java containers we are instrumenting by running the following script:</p><p>The logs should show what flags were picked up by the Java automatic discovery and configuration:</p><p><div class=tab-panel data-tab-group=74ed2039dadd04425bc75ae4560268f0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=run-the-script class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("74ed2039dadd04425bc75ae4560268f0","run-the-script")'>
<span class=tab-nav-text>Run the script</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("74ed2039dadd04425bc75ae4560268f0","example-output")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div data-tab-item=run-the-script class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0><code class=language-logs data-lang=logs>.  ~/workshop/petclinic/scripts/get_logs.sh</code></pre></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2024/02/15 09:42:00 Problem with dial: dial tcp 10.43.104.25:8761: connect: connection refused. Sleeping 1s
</span></span><span class=line><span class=cl>2024/02/15 09:42:01 Problem with dial: dial tcp 10.43.104.25:8761: connect: connection refused. Sleeping 1s
</span></span><span class=line><span class=cl>2024/02/15 09:42:02 Connected to tcp://discovery-server:8761
</span></span><span class=line><span class=cl>Picked up JAVA_TOOL_OPTIONS:  -javaagent:/otel-auto-instrumentation-java/javaagent.jar
</span></span><span class=line><span class=cl>Picked up _JAVA_OPTIONS: -Dspring.profiles.active=docker,mysql -Dsplunk.profiler.call.stack.interval=150
</span></span><span class=line><span class=cl>OpenJDK 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:03:056 +0000] [main] INFO io.opentelemetry.javaagent.tooling.VersionLogger - opentelemetry-javaagent - version: splunk-1.30.1-otel-1.32.1
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:03:768 +0000] [main] INFO com.splunk.javaagent.shaded.io.micrometer.core.instrument.push.PushMeterRegistry - publishing metrics for SignalFxMeterRegistry every 30s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:478 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:478 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - Profiler configuration:
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:480 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                  splunk.profiler.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:505 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                splunk.profiler.directory : /tmp
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:505 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -       splunk.profiler.recording.duration : 20s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:506 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -               splunk.profiler.keep-files : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:510 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -            splunk.profiler.logs-endpoint : http://10.13.2.38:4317
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:513 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -              otel.exporter.otlp.endpoint : http://10.13.2.38:4317
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:513 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -           splunk.profiler.memory.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:515 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -             splunk.profiler.tlab.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:516 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -        splunk.profiler.memory.event.rate : 150/s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:516 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.call.stack.interval : PT0.15S
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:517 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -  splunk.profiler.include.internal.stacks : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:517 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.tracing.stacks.only : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:517 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:518 +0000] [main] INFO com.splunk.opentelemetry.profiler.JfrActivator - Profiler is active.</span></span></code></pre></div></div></div></div></div>We are interested in the section written by the <code>com.splunk.opentelemetry.profiler.ConfigurationLogger</code> or the <strong>Profiling Configuration</strong>.</p><p>We can see the various settings you can control, some that are useful depending on your use case like the <code>splunk.profiler.directory</code> - The location where the agent writes the call stacks before sending them to Splunk. This may be different depending on how you configure your containers.</p><p>Another parameter you may want to change is <code>splunk.profiler.call.stack.interval</code> This is how often the system takes a CPU Stack trace. You may want to reduce this if you have short spans like we have in our application. (we kept the default as the spans in this demo application are extremely short, so Span may not always have a CPU Call Stack related to it.)</p><p>You can find how to set these parameters <a href=https://docs.splunk.com/observability/en/gdi/get-data-in/application/java/configuration/advanced-java-otel-configuration.html#profiling-configuration-java rel=external target=_blank>here</a>. Below, is how you set a higher collection rate for call stack in your <code>deployment.yaml</code>, exactly how to pass any JAVA option to the Java application running in your container:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>env</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>JAVA_OPTIONS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;-Xdebug -Dsplunk.profiler.call.stack.interval=150&#34;</span></span></span></code></pre></div><p>If you don&rsquo;t see those lines as a result of the script, the startup may have taken too long and generated too many connection errors, try looking at the logs directly with <code>kubectl</code> or the <code>k9s</code> utility that is installed.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=always-on-profiling-in-the-trace-waterfall>Always-On Profiling in the Trace Waterfall</h1><p>Make sure you have your original (or similar) Trace & Span <strong>(1)</strong> selected in the APM Waterfall view and select <strong>Memory Stack Traces (2)</strong> from the right-hand pane:</p><p><a href=#R-image-bddf4a99ea098c0954f014032ebc7cb8 class=lightbox-link><img alt="profiling from span" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/6-profiling-db-query/2-waterfall/../../images/flamechart-in-waterfall.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bddf4a99ea098c0954f014032ebc7cb8><img alt="profiling from span" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/6-profiling-db-query/2-waterfall/../../images/flamechart-in-waterfall.png></a></p><p>The pane should show you the Memory Stack Trace Flame Graph <strong>(3)</strong>, you can scroll down and/or make the pane for a better view by dragging the right side of the pane.</p><p>As AlwaysOn Profiling is constantly taking snapshots, or stack traces, of your application’s code and reading through thousands of stack traces is not practical, AlwaysOn Profiling aggregates and summarizes profiling data, providing a convenient way to explore Call Stacks in a view called the <strong>Flame Graph</strong>. It represents a summary of all stack traces captured from your application. You can use the Flame Graph to discover which lines of code might be causing performance issues and to confirm whether the changes you make to the code have the intended effect.</p><p>To dive deeper into the Always-on Profiling, select Span <strong>(3)</strong> in the Profiling Pane under <strong>Memory Stack Traces</strong>
This will bring you to the Always-on Profiling main screen, with the Memory view pre-selected:</p><p><a href=#R-image-ee15b1e91b3d1179c981b7bedb189375 class=lightbox-link><img alt="Profiling main" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/6-profiling-db-query/2-waterfall/../../images/profiling-memory.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ee15b1e91b3d1179c981b7bedb189375><img alt="Profiling main" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/6-profiling-db-query/2-waterfall/../../images/profiling-memory.png></a></p><ul><li>Java Memory Metric Charts <strong>(1)</strong>, Allow you to <code>Monitor Heap Memory, Application Activity</code> like <code>Memory Allocation Rate</code> and <code>Garbage Collecting</code> Metrics.</li><li>Ability to focus/see metrics and Stack Traces only related to the Span <strong>(2)</strong>, This will filter out background activities running in the Java application if required.</li><li>Java Function calls identified. <strong>(3)</strong>, allowing you to drill down into the Methods called from that function.</li><li>The Flame Graph <strong>(4)</strong>, with the visualization of hierarchy based on the stack traces of the profiled service.</li></ul><p>For further investigation the UI let&rsquo;s you grab the actual stack trace, so you can use in your coding platform to go to the actual lines of code used at this point (depending of course on your preferred Coding platform)</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=database-query-performance>Database Query Performance</h1><p>With Database Query Performance, you can monitor the impact of your database queries on service availability directly in Splunk APM. This way, you can quickly identify long-running, unoptimized, or heavy queries and mitigate issues they might be causing, without having to instrument your databases.</p><p>To look at the performance of your database queries, make sure you are on the APM <strong>Explore</strong> page either by going back in the browser or navigating to the APM section in the Menu bar, then click on the <strong>Explore</strong> tile.
Select the inferred database service <code>mysql:petclinic</code> Inferred Database server in the Dependency map <strong>(1)</strong>, then scroll the right-hand pane to find the <strong>Database Query Performance</strong> Pane <strong>(2)</strong>.</p><p><a href=#R-image-b767cdb8f56d3fd7088a8edfbc821500 class=lightbox-link><img alt="DB-query from map" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/6-profiling-db-query/3-dbquery/../../images/db-query-map.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b767cdb8f56d3fd7088a8edfbc821500><img alt="DB-query from map" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/6-profiling-db-query/3-dbquery/../../images/db-query-map.png></a></p><p>If the service you have selected in the map is indeed an (inferred) database server, this pane will populate with the top 90% (P90) database calls based on duration. To dive deeper into the db-query performance function click somewhere on the word <strong>Database Query Performance</strong> at the top of the pane.</p><p>This will bring us to the DB-query Performance overview screen:</p><p><a href=#R-image-287c2a34b441dc69575d10dd48b948df class=lightbox-link><img alt="DB-query full" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/6-profiling-db-query/3-dbquery/../../images/db-query-full.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-287c2a34b441dc69575d10dd48b948df><img alt="DB-query full" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/6-profiling-db-query/3-dbquery/../../images/db-query-full.png></a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Database Query Normalization</div><div class=box-content><p>By default, Splunk APM instrumentation sanitizes database queries to remove or mask sensible data, such as secrets or personally identifiable information (PII) from the <code>db.statements</code>. You can find how to turn off database query normalization <a href=https://docs.splunk.com/observability/en/apm/db-query-perf/db-perf-troubleshooting.html#turn-off-database-query-normalization rel=external target=_blank>here</a>.</p></div></div><p>This screen will show us all the Database queries <strong>(1)</strong> done towards our database from your application, based on the Traces & Spans sent to the Splunk Observability Cloud. Note that you can compare them across a time block or sort them on Total Time, P90 Latency & Requests <strong>(2)</strong>.</p><p>For each Database query in the list, we see the highest latency, the total number of calls during the time window and the number of requests per second <strong>(3)</strong>. This allows you to identify places where you might optimize your queries.</p><p>You can select traces containing Database Calls via the two charts in the right-hand pane <strong>(5)</strong>. Use the Tag Spotlight pane <strong>(6)</strong> to drill down what tags are related to the database calls, based on endpoints or tags.</p><p>If you click on a specific Query <strong>(1)</strong> you get a detailed query Details pane appears <strong>(2)</strong>, which you can use for more detailed investigations:
<a href=#R-image-4957854d5be1c944e0e341f1ba09419f class=lightbox-link><img alt=details class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/6-profiling-db-query/3-dbquery/../../images/query-details.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4957854d5be1c944e0e341f1ba09419f><img alt=details class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/6-profiling-db-query/3-dbquery/../../images/query-details.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section><article class=chapter><header class=headline></header><h1 id=log-observer>Log Observer</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>Up until this point, there have been no code changes, yet tracing, profiling and Database Query Performance data is being sent to Splunk Observability Cloud.</p><p>Next we will work with the <strong>Splunk Log Observer</strong> to the mix to obtain log data from the Spring PetClinic application.</p><p>The <strong>Splunk OpenTelemetry Collector</strong> automatically collects logs from the Spring PetClinic application and sends them to Splunk Observability Cloud using the OTLP exporter, annotating the log events with <code>trace_id</code>, <code>span_id</code> and trace flags.</p><p>The <strong>Splunk Log Observer</strong> is then used to view the logs and with the changes to the log format the platform can automatically correlate log information with services and traces.</p><p>This feature is called <a href=https://docs.splunk.com/observability/en/metrics-and-metadata/relatedcontent.html rel=external target=_blank><strong>Related Content</strong></a>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Log Observer</h1><article class=default><header class=headline></header><h1 id=viewing-the-logs>Viewing the Logs</h1><p>In order to see logs click on the <strong>Log Observer</strong> <a href=#R-image-7f128d8a0609e92055a495204fe23ca0 class=lightbox-link><img alt=Logo class="noborder inline lazy lightbox noshadow figure-image" loading=lazy src="/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/7-log-observer-connect/1-view-logs/../../images/logo-icon.png?classes=inline&height=25px" style=height:25px;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7f128d8a0609e92055a495204fe23ca0><img alt=Logo class="noborder inline lazy lightbox noshadow lightbox-image" loading=lazy src="/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/7-log-observer-connect/1-view-logs/../../images/logo-icon.png?classes=inline&height=25px"></a> in the left-hand menu. Once in Log Observer please ensure <strong>Index</strong> on the filter bar is set to <strong>splunk4rookies-workshop</strong>.</p><p>Next, click <strong>Add Filter</strong> and search for the field <code>deployment.environment</code>, select your workshop instance and click <code>=</code> (to include). You will now see only the log messages from your PetClinic application.</p><p>Next search for the field <code>service.name</code>, select the value <code>customers-service</code> and click <code>=</code> (to include). Now the log entries will be reduced to show the entries from your <code>customers-service</code> only.</p><p><a href=#R-image-4e20d1b780d9b83618d07a15a656eb3d class=lightbox-link><img alt="Log Observer" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/7-log-observer-connect/1-view-logs/../../images/log-observer-trace-info.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4e20d1b780d9b83618d07a15a656eb3d><img alt="Log Observer" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/7-log-observer-connect/1-view-logs/../../images/log-observer-trace-info.png></a></p><p>Click on an entry with an injected trace_id <strong>(1)</strong>. A side pane will open where you can see the detailed information, including the relevant trace and span IDs <strong>(2)</strong>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=related-content>Related Content</h1><p>In the bottom pane is where any related content will be reported. In the screenshot below you can see that APM has found a trace that is related to this log line <strong>(1)</strong>:</p><p><a href=#R-image-1dd361e7feef33b5b8eba10b61f99ce1 class=lightbox-link><img alt=RC class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/7-log-observer-connect/2-related-content/../../images/log-apm-rc.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1dd361e7feef33b5b8eba10b61f99ce1><img alt=RC class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/7-log-observer-connect/2-related-content/../../images/log-apm-rc.png></a></p><p>By clicking on <strong>Trace for 4be8b620a98aa938e76cf76aa1bde396</strong> <strong>(2)</strong> will take us to the waterfall in APM for this specific trace that this log line was generated from:</p><p><a href=#R-image-076a3cdc5a2646a556dbc8fcc4d77b42 class=lightbox-link><img alt="waterfall logs" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/7-log-observer-connect/2-related-content/../../images/waterfall-with-logs.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-076a3cdc5a2646a556dbc8fcc4d77b42><img alt="waterfall logs" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/7-log-observer-connect/2-related-content/../../images/waterfall-with-logs.png></a></p><p>Note that you now have Related Content pane for Logs appear <strong>(1)</strong>. Clicking on this will take you back to Log Observer and will display all the log lines that are part of this trace.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section><article class=chapter><header class=headline></header><h1 id=real-user-monitoring>Real User Monitoring</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>To enable Real User Monitoring (RUM) instrumentation for an application, you need to add the Open Telemetry Javascript <a href=https://github.com/signalfx/splunk-otel-js-web rel=external target=_blank><strong>https://github.com/signalfx/splunk-otel-js-web</strong></a> snippet to the code base.</p><p>The Spring PetClinic application uses a single <a href=https://github.com/spring-petclinic/spring-petclinic-microservices/blob/main/spring-petclinic-api-gateway/src/main/resources/static/index.html rel=external target=_blank><strong>index</strong></a> HTML page, that is reused across all views of the application. This is the perfect location to insert the Splunk RUM instrumentation library as it will be loaded for all pages automatically.</p><p>The <code>api-gateway</code> service is already running the instrumentation and sending RUM traces to Splunk Observability Cloud and we will review the data in the next section.</p><p>If you want you can verify the snippet, you can view the page source in your browser by right-clicking on the page and selecting <strong>View Page Source</strong>.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;/env.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>  
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>realm</span> <span class=o>=</span> <span class=nx>env</span><span class=p>.</span><span class=nx>RUM_REALM</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Realm:&#39;</span><span class=p>,</span> <span class=nx>realm</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>auth</span> <span class=o>=</span> <span class=nx>env</span><span class=p>.</span><span class=nx>RUM_AUTH</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>appName</span> <span class=o>=</span> <span class=nx>env</span><span class=p>.</span><span class=nx>RUM_APP_NAME</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>environmentName</span> <span class=o>=</span> <span class=nx>env</span><span class=p>.</span><span class=nx>RUM_ENVIRONMENT</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>realm</span> <span class=o>&amp;&amp;</span> <span class=nx>auth</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>realm</span><span class=o>:</span> <span class=nx>realm</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>rumAccessToken</span><span class=o>:</span> <span class=nx>auth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>applicationName</span><span class=o>:</span> <span class=nx>appName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>deploymentEnvironment</span><span class=o>:</span> <span class=nx>environmentName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>version</span><span class=o>:</span> <span class=s1>&#39;1.0.0&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>            <span class=nx>SplunkSessionRecorder</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>app</span><span class=o>:</span> <span class=nx>appName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>realm</span><span class=o>:</span> <span class=nx>realm</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>rumAccessToken</span><span class=o>:</span> <span class=nx>auth</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>Provider</span> <span class=o>=</span> <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>provider</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>tracer</span><span class=o>=</span><span class=nx>Provider</span><span class=p>.</span><span class=nx>getTracer</span><span class=p>(</span><span class=s1>&#39;appModuleLoader&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Realm or auth is empty, provide default values or skip initialization
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Realm or auth is empty. Skipping Splunk Rum initialization.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>     <span class=c>&lt;!-- Section added for  RUM --&gt;</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 27, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Real User Monitoring</h1><article class=default><header class=headline></header><h1 id=select-the-rum-view-for-the-petclinic-app>Select the RUM view for the Petclinic App</h1><p>Lets start a quick high level tour into RUM by clicking <strong>RUM</strong> <a href=#R-image-0f310f3445de7c3c40bbf225aa66b2a8 class=lightbox-link><img alt=RUM class="noborder inline lazy lightbox noshadow figure-image" loading=lazy src="/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/8-rum/1-rum-tour/../../images/rum-icon.png?classes=inline&height=25px" style=height:25px;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0f310f3445de7c3c40bbf225aa66b2a8><img alt=RUM class="noborder inline lazy lightbox noshadow lightbox-image" loading=lazy src="/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/8-rum/1-rum-tour/../../images/rum-icon.png?classes=inline&height=25px"></a> in the left-hand menu. Then change the <strong>Environment</strong> filter <strong>(1)</strong> to the name of your workshop instance from the dropdown box, it will be <strong><code>&lt;INSTANCE>-workshop</code></strong> <strong>(1)</strong> (where <strong><code>INSTANCE</code></strong> is the value from the shell script you ran earlier). Make sure it is the only one selected.</p><p>Then change the <strong>App</strong> <strong>(2)</strong> dropdown box to the name of your app, it will be <strong><code>&lt;INSTANCE>-store</code></strong></p><p><a href=#R-image-035a826230b8e4235598c0e18c84d81a class=lightbox-link><img alt="rum select" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/8-rum/1-rum-tour/../../images/rum-env-select.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-035a826230b8e4235598c0e18c84d81a><img alt="rum select" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/8-rum/1-rum-tour/../../images/rum-env-select.png></a></p><p>Once you have selected your <strong>Environment</strong> and <strong>App</strong>, you will see an overview page showing the RUM status of your App (if your Summary Dashboard is just a single row of numbers, you are looking at the condensed view. You can expand it by clicking on the <strong>></strong> in front of the Application name). If any JavaScript error occurred they will show up as shown below:</p><p><a href=#R-image-cef2791d65b07192c6f5002fa0ff9d93 class=lightbox-link><img alt="rum overview" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/8-rum/1-rum-tour/../../images/rum-overview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-cef2791d65b07192c6f5002fa0ff9d93><img alt="rum overview" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/8-rum/1-rum-tour/../../images/rum-overview.png></a></p><p>To continue, click on the blue link (with your workshop name) to get to the details page, this will bring up a new dashboard view breaking down the interactions by UX Metrics, Front-end Health, Back-end Health and Custom Events and comparing them to historic metrics (1 hour by default).</p><p><a href=#R-image-db031d504a28cbf673a26e8c21b36824 class=lightbox-link><img alt="rum  main" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/8-rum/1-rum-tour/../../images/rum-main.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-db031d504a28cbf673a26e8c21b36824><img alt="rum  main" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/8-rum/1-rum-tour/../../images/rum-main.png></a>
Normally you have only one line inside the first chart, Click on the link that relates to your Petclinic shop,
http://198.19.249.62 in our example:</p><p>This will bring us to the Tag Spotlight page.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 27, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=rum-trace-waterfall-view--linking-to-apm>RUM trace Waterfall view & linking to APM</h1><p>In the TAG Spotlight view, you are presented with all the tags associated with the RUM data. Tags are key-value pairs that are used to identify the data. In this case, the tags are automatically generated by the OpenTelemetry instrumentation. The tags are used to filter the data and to create the charts and tables. The Tag Spotlight view allows you detect trends in behavior and to drill down into a user session.</p><p><a href=#R-image-43ba9148ccffc58706efc3501ea09585 class=lightbox-link><img alt="RUM TAG" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/8-rum/2-rum-tour/../../images/rum-tag-spotlight.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-43ba9148ccffc58706efc3501ea09585><img alt="RUM TAG" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/8-rum/2-rum-tour/../../images/rum-tag-spotlight.png></a></p><p>Click on User Sessions <strong>(1)</strong>, this will show you the list of user session that occurred during the time window.
We want to look at one of the session , so click on <em>Duration</em> <strong>(2)</strong> to sort on duration, and make sure you click on the link of one of the longer ones <strong>(3)</strong>:</p><p><a href=#R-image-551644b161f1c398eb00aca28204ba89 class=lightbox-link><img alt="User sessions" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/8-rum/2-rum-tour/../../images/rum-user-sessions.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-551644b161f1c398eb00aca28204ba89><img alt="User sessions" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/8-rum/2-rum-tour/../../images/rum-user-sessions.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 27, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=rum-trace-waterfall-view--linking-to-apm>RUM trace Waterfall view & linking to APM</h1><p>We are now looking at the RUM Trace waterfall, this will tell you what happened during the session on the user device as they visited the page of our petclinic application.</p><p>If you scroll down the waterfall find click on the <strong>Vets</strong> segment on the right <strong>(1)</strong>, you see a list of action that occurred during the handling of the Vets request. Note, that the HTTP request have a blue <strong>APM</strong> link before the return code. Pick one, and click on the APM link. This will show you the APM info for this Ser vice call to our Microservices in Kubernetes.</p><p><a href=#R-image-f0f146d6dc3ae20da4a1c3b9eee37588 class=lightbox-link><img alt="rum apm link" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/8-rum/3-rum-tour/../../images/rum-trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f0f146d6dc3ae20da4a1c3b9eee37588><img alt="rum apm link" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/8-rum/3-rum-tour/../../images/rum-trace.png></a></p><p>Note , that there give you the information what happened during action in the Microservices, and if you want to drill down to verify what happened with the request, click on the Trace ID url.</p><p>This will show you the trace related to your request from RUM:</p><p><a href=#R-image-bcab9bdaf81fea4f0d75ca64b3b1da11 class=lightbox-link><img alt="RUm-apm linked" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/8-rum/3-rum-tour/../../images/rum-apm-waterfall.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bcab9bdaf81fea4f0d75ca64b3b1da11><img alt="RUm-apm linked" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/8-rum/3-rum-tour/../../images/rum-apm-waterfall.png></a></p><p>You can see that the entry point into your service now has a <strong>RUM (1)</strong> related content link added, allowing you to return back to your RUM session after you validated what happened in your Microservices.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 27, 2024</span></span></footer></article></section><article class=chapter><header class=headline></header><h1 id=workshop-wrap-up->Workshop Wrap-up 🎁</h1><p>Congratulations, you have completed the <strong>Get the Most Out of Your Existing Kubernetes Java Applications Using Automatic Discovery and Configuration With OpenTelemetry</strong> workshop.</p><p>Today, you have learnt how easy it is to add Tracing, Code Profiling and Database Query Performance to your existing Java application in Kubernetes.</p><p>You immediately improved the observability of the application and infrastructure with out touching a line of code or configuration using <strong>Automatic Discovery and Configuration</strong>.</p><p>You also learnt that with simple configuration changes you can add even more observability (<strong>logging</strong> and <strong>RUM</strong>) to the application in order to provide end-to-end observability.</p><p><a href=#R-image-415f60dc9e7ce6694fd15af5198ba5c2 class=lightbox-link><img alt=Champagne class="noborder lazy lightbox noshadow figure-image" loading=lazy src="/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/9-wrap-up/images/champagne.png?width=45vw" style=height:auto;width:45vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-415f60dc9e7ce6694fd15af5198ba5c2><img alt=Champagne class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src="/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/9-wrap-up/images/champagne.png?width=45vw"></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=nodejs-zero-config-workshop>NodeJS Zero-Config Workshop</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>30 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Robert Castley</span></span><p>The goal is to walk through the basic steps to configure the following components of the <strong>Splunk Observability Cloud</strong> platform:</p><ul><li>Splunk Infrastructure Monitoring (IM)</li><li>Splunk Zero Configuration Auto Instrumentation for NodeJS (APM)<ul><li>AlwaysOn Profiling</li></ul></li><li>Splunk Log Observer (LO)</li></ul><p>We will deploy the OpenTelemetry Astronomy Shop application in Kubernetes, which contains two NodeJS services (<strong>Frontend</strong> & <strong>Payment Service</strong>). Once the application and the OpenTelemetry Connector are up and running, we will start seeing metrics, traces and logs via the <strong>Zero Configuration Auto Instrumentation</strong> for NodeJS that will be used by the <strong>Splunk Observability Cloud</strong> platform to provide insights into the application.</p><div class="box notices cstyle primary"><div class=box-label><i class="fa-fw fas fa-info"></i> Prerequisites</div><div class=box-content><ul><li>Outbound SSH access to port <code>2222</code>.</li><li>Outbound HTTP access to port <code>8083</code>.</li><li>Familiarity with the <code>bash</code> shell and <code>vi/vim</code> editor.</li></ul></div></div><p>Next, we will deploy the <strong>OpenTelemetry Demo</strong>.</p><pre class="mermaid align-center">
graph TD
subgraph Service Diagram
accountingservice(Accounting Service):::golang
adservice(Ad Service):::java
cache[(Cache)]
cartservice(Cart Service):::dotnet
checkoutservice(Checkout Service):::golang
currencyservice(Currency Service):::cpp
emailservice(Email Service):::ruby
frauddetectionservice(Fraud Detection Service):::kotlin
frontend(Frontend):::typescript
frontendproxy(Frontend Proxy):::cpp
loadgenerator([Load Generator]):::python
paymentservice(Payment Service):::javascript
productcatalogservice(Product Catalog Service):::golang
quoteservice(Quote Service):::php
recommendationservice(Recommendation Service):::python
shippingservice(Shipping Service):::rust
featureflagservice(Feature Flag Service):::erlang
featureflagstore[(Feature Flag Store)]
queue[(queue)]
Internet --&gt;|HTTP| frontendproxy
frontendproxy --&gt;|HTTP| frontend
frontendproxy --&gt;|HTTP| featureflagservice
loadgenerator --&gt;|HTTP| frontendproxy
accountingservice --&gt;|TCP| queue
cartservice ---&gt;|gRPC| featureflagservice
checkoutservice ---&gt;|gRPC| cartservice --&gt; cache
checkoutservice ---&gt;|gRPC| productcatalogservice
checkoutservice ---&gt;|gRPC| currencyservice
checkoutservice ---&gt;|HTTP| emailservice
checkoutservice ---&gt;|gRPC| paymentservice
checkoutservice --&gt;|gRPC| shippingservice
checkoutservice ---&gt;|TCP| queue
frontend --&gt;|gRPC| adservice
frontend --&gt;|gRPC| cartservice
frontend --&gt;|gRPC| productcatalogservice
frontend --&gt;|gRPC| checkoutservice
frontend --&gt;|gRPC| currencyservice
frontend --&gt;|gRPC| recommendationservice --&gt;|gRPC| productcatalogservice
frontend --&gt;|gRPC| shippingservice --&gt;|HTTP| quoteservice
frauddetectionservice --&gt;|TCP| queue
adservice ---&gt;|gRPC| featureflagservice
productcatalogservice --&gt;|gRPC| featureflagservice
recommendationservice --&gt;|gRPC| featureflagservice
shippingservice --&gt;|gRPC| featureflagservice
featureflagservice --&gt; featureflagstore
end

classDef dotnet fill:#178600,color:white;
classDef cpp fill:#f34b7d,color:white;
classDef erlang fill:#b83998,color:white;
classDef golang fill:#00add8,color:black;
classDef java fill:#b07219,color:white;
classDef javascript fill:#f1e05a,color:black;
classDef kotlin fill:#560ba1,color:white;
classDef php fill:#4f5d95,color:white;
classDef python fill:#3572A5,color:white;
classDef ruby fill:#701516,color:white;
classDef rust fill:#dea584,color:black;
classDef typescript fill:#e98516,color:black;
</pre><pre class="mermaid align-center">
graph TD
subgraph Service Legend
  dotnetsvc(.NET):::dotnet
  cppsvc(C&#43;&#43;):::cpp
  erlangsvc(Erlang/Elixir):::erlang
  golangsvc(Go):::golang
  javasvc(Java):::java
  javascriptsvc(JavaScript):::javascript
  kotlinsvc(Kotlin):::kotlin
  phpsvc(PHP):::php
  pythonsvc(Python):::python
  rubysvc(Ruby):::ruby
  rustsvc(Rust):::rust
  typescriptsvc(TypeScript):::typescript
end

classDef dotnet fill:#178600,color:white;
classDef cpp fill:#f34b7d,color:white;
classDef erlang fill:#b83998,color:white;
classDef golang fill:#00add8,color:black;
classDef java fill:#b07219,color:white;
classDef javascript fill:#f1e05a,color:black;
classDef kotlin fill:#560ba1,color:white;
classDef php fill:#4f5d95,color:white;
classDef python fill:#3572A5,color:white;
classDef ruby fill:#701516,color:white;
classDef rust fill:#dea584,color:black;
classDef typescript fill:#e98516,color:black;
</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of NodeJS Zero-Config Workshop</h1><article class=default><header class=headline></header><h1 id=deploying-the-opentelemetry-demo>Deploying the OpenTelemetry Demo</h1><h2 id=1-create-a-namespace>1. Create a namespace</h2><p>To not conflict with other workshops, we will deploy the OpenTelemetry Demo in a separate namespace called <code>otel-demo</code>. To create the namespace, run the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create namespace otel-demo</span></span></code></pre></div><h2 id=2-deploy-the-opentelemetry-demo>2. Deploy the OpenTelemetry Demo</h2><p>Next, change to the directory containing the OpenTelemetry Demo application:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/workshop/apm</span></span></code></pre></div><p>Deploy the OpenTelemetry Demo application:</p><div class=tab-panel data-tab-group=9b4d54d2666095c9a87e7c882d77c6a2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9b4d54d2666095c9a87e7c882d77c6a2","command")'>
<span class=tab-nav-text>Command</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("9b4d54d2666095c9a87e7c882d77c6a2","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -n otel-demo -f otel-demo.yaml</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>serviceaccount/opentelemetry-demo created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-adservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-cartservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-checkoutservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-currencyservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-emailservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-featureflagservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-ffspostgres created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-frontend created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-kafka created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-loadgenerator created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-paymentservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-productcatalogservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-quoteservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-recommendationservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-redis created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-shippingservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-accountingservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-adservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-cartservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-checkoutservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-currencyservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-emailservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-featureflagservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-ffspostgres created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-frauddetectionservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-frontend created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-kafka created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-loadgenerator created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-paymentservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-productcatalogservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-quoteservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-recommendationservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-redis created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-shippingservice created</span></span></code></pre></div></div></div></div></div><p>Once the application is deployed, we need to wait for the pods to be in a <code>Running</code> state. To check the status of the pods, run the following command:</p><div class=tab-panel data-tab-group=10948ff73054c1337420c280ccf15edb><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("10948ff73054c1337420c280ccf15edb","command")'>
<span class=tab-nav-text>Command</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("10948ff73054c1337420c280ccf15edb","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods -n otel-demo</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                                        READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>opentelemetry-demo-emailservice-847d6fb577-bxll6            1/1     Running   0          40s
</span></span><span class=line><span class=cl>opentelemetry-demo-ffspostgres-55f65465dd-2gsj4             1/1     Running   0          40s
</span></span><span class=line><span class=cl>opentelemetry-demo-adservice-5b7c68859d-5hx5f               1/1     Running   0          40s
</span></span><span class=line><span class=cl>opentelemetry-demo-currencyservice-c4cb78446-qsd68          1/1     Running   0          40s
</span></span><span class=line><span class=cl>opentelemetry-demo-frontend-5d7cdb8786-5dl76                1/1     Running   0          39s
</span></span><span class=line><span class=cl>opentelemetry-demo-kafka-79868d56d8-62wsd                   1/1     Running   0          39s
</span></span><span class=line><span class=cl>opentelemetry-demo-paymentservice-5cb4ccc47c-65hxl          1/1     Running   0          39s
</span></span><span class=line><span class=cl>opentelemetry-demo-productcatalogservice-59d955f9d6-xtnjr   1/1     Running   0          38s
</span></span><span class=line><span class=cl>opentelemetry-demo-loadgenerator-755d6cd5b-r5lqs            1/1     Running   0          39s
</span></span><span class=line><span class=cl>opentelemetry-demo-quoteservice-5fbfb97778-vm62m            1/1     Running   0          38s
</span></span><span class=line><span class=cl>opentelemetry-demo-redis-57c49b7b5b-b2klr                   1/1     Running   0          37s
</span></span><span class=line><span class=cl>opentelemetry-demo-shippingservice-6667f69f78-cwj8q         1/1     Running   0          37s
</span></span><span class=line><span class=cl>opentelemetry-demo-recommendationservice-749f55f9b6-5k4lc   1/1     Running   0          37s
</span></span><span class=line><span class=cl>opentelemetry-demo-featureflagservice-67677647c-85xtm       1/1     Running   0          40s
</span></span><span class=line><span class=cl>opentelemetry-demo-checkoutservice-5474bf74b8-2nmns         1/1     Running   0          40s
</span></span><span class=line><span class=cl>opentelemetry-demo-frauddetectionservice-77fd69d967-lnjcg   1/1     Running   0          39s
</span></span><span class=line><span class=cl>opentelemetry-demo-accountingservice-96d44cfbc-vmtzb        1/1     Running   0          40s
</span></span><span class=line><span class=cl>opentelemetry-demo-cartservice-7c4f59bdd5-rfkf4             1/1     Running   0          40s</span></span></code></pre></div></div></div></div></div><h2 id=3-validate-the-application-is-running>3. Validate the application is running</h2><p>To validate the application is running, we will port-forward the frontend service. To do this, run the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl port-forward svc/opentelemetry-demo-frontend 8083:8080 -n otel-demo --address<span class=o>=</span><span class=s1>&#39;0.0.0.0&#39;</span></span></span></code></pre></div><p>Obtain the <strong>public IP address</strong> of the instance you are running on. You can do this by running the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl ifconfig.me</span></span></code></pre></div><p>Once the port-forward is running, you can access the application by opening a browser and navigating to <code>http://&lt;public IP address>:8083</code>. You should see the following:</p><p><a href=#R-image-ee7d86fbb07ddfc9ad20acb8b43da56e class=lightbox-link><img alt="OpenTelemetry Demo" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/1-otel-demo/../images/otel-demo.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ee7d86fbb07ddfc9ad20acb8b43da56e><img alt="OpenTelemetry Demo" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/1-otel-demo/../images/otel-demo.png></a></p><p>Once you have confirmed the application is running, you can close the port-forward by pressing <code>ctrl + c</code>.</p><p>Next, we will deploy the <strong>OpenTelemetry Collector</strong>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=installing-the-opentelemetry-collector>Installing the OpenTelemetry Collector</h1><h2 id=1-introduction>1. Introduction</h2><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Delete any existing OpenTelemetry Collectors</div><div class=box-content><p>If you have completed any other Observability workshops, please ensure you delete the collector running in Kubernetes before continuing. This can be done by running the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></div></div><h2 id=2-confirm-environment-variables>2. Confirm environment variables</h2><p>To ensure your instance is configured correctly, we need to confirm that the required environment variables for this workshop are set correctly. In your terminal run the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>env</span></span></code></pre></div><p>In the output check the following environment variables are present and have values set:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>ACCESS_TOKEN
</span></span><span class=line><span class=cl>REALM
</span></span><span class=line><span class=cl>RUM_TOKEN
</span></span><span class=line><span class=cl>HEC_TOKEN
</span></span><span class=line><span class=cl>HEC_URL</span></span></code></pre></div><p>For this workshop, <strong>all</strong> of the above are required. If any are missing, please contact your instructor.</p><h2 id=3-install-the-opentelemetry-collector>3. Install the OpenTelemetry Collector</h2><p>We can then go ahead and install the Collector. Some additional parameters are passed to the <code>helm install</code> command, they are:</p><ul><li><code>--set="operator.enabled=true"</code> - Enabled the Splunk OpenTelemetry Collector Operator for Kubernetes.</li><li><code>--set="certmanager.enabled=true"</code> - The cert-manager adds certificates and certificate issuers as resource types in Kubernetes clusters and simplifies the process of obtaining, renewing and using those certificates.</li><li><code>--set="splunkObservability.profilingEnabled=true"</code> - Enables CPU/Memory profiling for supported languages.</li></ul><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart <span class=o>&amp;&amp;</span> helm repo update</span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;operator.enabled=true&#34;</span>, <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;certmanager.enabled=true&#34;</span>, <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.logsEnabled=false&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;logsEngine=otel&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.profilingEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.infrastructureMonitoringEventsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;environment=</span><span class=nv>$INSTANCE</span><span class=s2>-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.endpoint=</span><span class=nv>$HEC_URL</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.token=</span><span class=nv>$HEC_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.index=splunk4rookies-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/otel-collector.yaml</span></span></code></pre></div><p>Once the installation is completed, you can navigate to the <strong>Kubernetes Navigator</strong> to see the data from your host.</p><p>Click on <strong>Add filters</strong> select <code>k8s.cluster.name</code> and select the cluster of your workshop instance.
You can determine your instance name from the command prompt in your terminal session:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=nv>$INSTANCE</span></span></span></code></pre></div><p>Once you see data flowing for your host, we are then ready to get started with the APM component.</p><p><a href=#R-image-aeb97210c6ee8f07e1b5ddb2b74c498d class=lightbox-link><img alt="Kubernetes Navigator" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/2-otel-collector/../images/k8s-navigator.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-aeb97210c6ee8f07e1b5ddb2b74c498d><img alt="Kubernetes Navigator" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/2-otel-collector/../images/k8s-navigator.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=zero-configuration---frontend-service>Zero Configuration - Frontend Service</h1><h2 id=1-patching-the-frontend-service>1. Patching the Frontend service</h2><p>First, confirm that you can see your environment in <strong>APM</strong>. There should be a service called <code>loadgenerator</code> displayed in the Service map.</p><p><a href=#R-image-89a6353c8c6fbadf595fd3805de28ea9 class=lightbox-link><img alt="APM Service Map" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/3-frontend-service/../images/apm-servicemap.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-89a6353c8c6fbadf595fd3805de28ea9><img alt="APM Service Map" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/3-frontend-service/../images/apm-servicemap.png></a></p><p>Next, we will patch the <code>frontend</code> deployment with an annotation to inject the NodeJS auto instrumentation. This will allow us to see the <code>frontend</code> service in <strong>APM</strong>. Note, that at this point we have not edited any code.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl patch deployment opentelemetry-demo-frontend -n otel-demo -p <span class=s1>&#39;{&#34;spec&#34;: {&#34;template&#34;:{&#34;metadata&#34;:{&#34;annotations&#34;:{&#34;instrumentation.opentelemetry.io/inject-nodejs&#34;:&#34;default/splunk-otel-collector&#34;}}}} }&#39;</span></span></span></code></pre></div><ul><li>This will cause the <code>opentelemetry-demo-frontend</code> pod to restart.</li><li>The annotation value <code>default/splunk-otel-collector</code> refers to the instrumentation configuration named <code>splunk-otel-collector</code> in the <code>default</code> namespace.</li><li>If the chart is not installed in the <code>default</code> namespace, modify the annotation value to be <code>{chart_namespace}/splunk-otel-collector</code>.</li></ul><p>After a few minutes, you should see the <code>frontend</code> service in <strong>APM</strong>.</p><p><a href=#R-image-7943508ab4369b416cd0b37e44a2655f class=lightbox-link><img alt=Frontend class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/3-frontend-service/../images/apm-frontend.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7943508ab4369b416cd0b37e44a2655f><img alt=Frontend class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/3-frontend-service/../images/apm-frontend.png></a></p><p>With the <code>frontend</code> service highlighted, click on the <strong>Traces</strong> tab to see the traces for the service. Select one of the traces and confirm that the trace contains metadata confirming that the Splunk Zero-Configuration Auto-Instrumentation for NodeJS is being used.</p><p><a href=#R-image-60fad8bb27650f0210e7f6f6fd498c80 class=lightbox-link><img alt="Zero Configuration" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/3-frontend-service/../images/apm-frontend-trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-60fad8bb27650f0210e7f6f6fd498c80><img alt="Zero Configuration" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/3-frontend-service/../images/apm-frontend-trace.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=zero-configuration---payment-service>Zero Configuration - Payment Service</h1><h2 id=1-patching-the-payment-service>1. Patching the Payment Service</h2><p>Finally, we will patch the <code>paymentservice</code> deployment with an annotation to inject the NodeJS auto instrumentation. This will allow us to see the <code>paymentservice</code> service in <strong>APM</strong>.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl patch deployment opentelemetry-demo-paymentservice -n otel-demo -p <span class=s1>&#39;{&#34;spec&#34;: {&#34;template&#34;:{&#34;metadata&#34;:{&#34;annotations&#34;:{&#34;instrumentation.opentelemetry.io/inject-nodejs&#34;:&#34;default/splunk-otel-collector&#34;}}}} }&#39;</span></span></span></code></pre></div><p>This will cause the <code>opentelemetry-demo-paymentservice</code> pod to restart and after a few minutes, you should see the <code>paymentservice</code> service in <strong>APM</strong>.</p><p><a href=#R-image-d22a3b5c1a76b5dd105f0614268085e7 class=lightbox-link><img alt=Paymentservice class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/4-payment-service/../images/apm-paymentservice.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d22a3b5c1a76b5dd105f0614268085e7><img alt=Paymentservice class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/4-payment-service/../images/apm-paymentservice.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=code-profiling---payment-service>Code Profiling - Payment Service</h1><h2 id=1-alwayson-profiling-for-the-payment-service>1. AlwaysOn Profiling for the Payment Service</h2><p><strong>AlwaysOn Profiling</strong> is a feature of the Splunk Distribution of OpenTelemetry Collector that allows you to collect CPU and Memory profiling data for your services without having to modify your code. This is useful for troubleshooting performance issues in your services. Here are some of the benefits of AlwaysOn Profiling:</p><ul><li>Perform continuous profiling of your applications. The profiler is always on once you activate it.</li><li>Collect code performance context and link it to trace data.</li><li>Explore memory usage and garbage collection of your application.</li><li>Analyze code bottlenecks that impact service performance.</li><li>Identify inefficiencies that increase the need for scaling up cloud resources.</li></ul><p>With the <code>opentelemetry-demo-paymentservice</code> selected, click on <strong>AlwaysOn Profiling</strong> to view the code profiling data for the service.</p><p><a href=#R-image-8dbf535590b15a373cb7822bffc331b7 class=lightbox-link><img alt="AlwaysOn Profiling" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/5-profiling/../images/alwayson-profiling.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8dbf535590b15a373cb7822bffc331b7><img alt="AlwaysOn Profiling" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/5-profiling/../images/alwayson-profiling.png></a></p><p>Here you can see the CPU and Memory profiling data for the <code>paymentservice</code> service. You can also see the CPU and Memory profiling data for the <code>frontend</code> service by selecting the <code>opentelemetry-demofrontend</code> service from the <strong>Service</strong> dropdown.</p><p><a href=#R-image-167dc56f3e95bfa1c312606cc26e6504 class=lightbox-link><img alt="Profiling Service" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/5-profiling/../images/profiling-service.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-167dc56f3e95bfa1c312606cc26e6504><img alt="Profiling Service" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/5-profiling/../images/profiling-service.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=logs---payment-service>Logs - Payment Service</h1><h2 id=1-viewing-the-logs-for-the-payment-service>1. Viewing the logs for the Payment Service</h2><p>Navigate back to APM from the main menu and under <strong>Services</strong> click on <code>opentelemetry-demo-paymentservice</code>. This will open up the Service map for the <code>paymentservice</code> service only.</p><p>At the bottom of the page, click on the <strong>Logs(1)</strong> tab to view the logs for the <code>paymentservice</code> service.</p><p><a href=#R-image-a6a3f67bfa990150a9b76f0b5a106e5e class=lightbox-link><img alt="Related Logs" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/6-logs/../images/related-logs.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a6a3f67bfa990150a9b76f0b5a106e5e><img alt="Related Logs" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/6-logs/../images/related-logs.png></a></p><p>Once in <strong>Log Observer</strong> select one of the log entries to view the metadata for the log entry.</p><p><a href=#R-image-65dae76046cece3f81e813d1433c5b6f class=lightbox-link><img alt="Log Entry" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/6-logs/../images/log-entry.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-65dae76046cece3f81e813d1433c5b6f><img alt="Log Entry" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/1-automatic-discovery/3-nodejs-kubernetes/6-logs/../images/log-entry.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section></section><article class=default><header class=headline></header><h1 id=monitoring-horizontal-pod-autoscaling-in-kubernetes>Monitoring Horizontal Pod Autoscaling in Kubernetes</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>45 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Robert Castley</span></span><p>This workshop will equip you with a basic understanding of monitoring Kubernetes using the Splunk OpenTelemetry Collector. During the workshop, you will deploy PHP/Apache and a load generator.</p><p>You will learn about OpenTelemetry Receivers, Kubernetes Namespaces, ReplicaSets, Kubernetes Horizontal Pod AutoScaling and how to monitor all this using the Splunk Observability Cloud. The main learnings from the workshop will be a better understanding of the Kubernetes Navigator (and Dashboards) in Splunk Observability Cloud as well as seeing Kubernetes metrics, events and Detectors.</p><p>For this workshop, Splunk has prepared an Ubuntu Linux instance in AWS/EC2 all pre-configured for you.</p><p>To get access to the instance that you will be using in the workshop, please visit the URL provided by the workshop leader.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Monitoring Horizontal Pod Autoscaling in Kubernetes</h1><article class=default><header class=headline></header><h1 id=deploying-the-opentelemetry-collector-in-kubernetes-using-a-namespace>Deploying the OpenTelemetry Collector in Kubernetes using a NameSpace</h1><h2 id=1-kubernetes-navigator-20-ui>1. Kubernetes Navigator 2.0 UI</h2><p>We will be starting this workshop using the new Kubernetes Navigator so please check that you are already using the new Navigator.</p><p>When you select <strong>Infrastructure</strong> from the main menu on the left, followed by selecting <strong>Kubernetes</strong>, you should see two service panes (<strong>K8s nodes</strong> and <strong>K8s workloads</strong>) for Kubernetes, similar to the ones below:</p><p><a href=#R-image-a13f02e2022ad856e66ce3e6244a5c47 class=lightbox-link><img alt=k8s-navi-v-2 class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/1-deploy-otel/../images/k8s-nav2-two.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a13f02e2022ad856e66ce3e6244a5c47><img alt=k8s-navi-v-2 class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/1-deploy-otel/../images/k8s-nav2-two.png></a></p><h2 id=2-connect-to-ec2-instance>2. Connect to EC2 instance</h2><p>You will be able to connect to the workshop instance by using SSH from your Mac, Linux or Windows device. Open the link to the sheet provided by your instructor. This sheet contains the IP addresses and the password for the workshop instances.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>Your workshop instance has been pre-configured with the correct <strong>Access Token</strong> and <strong>Realm</strong> for this workshop. There is no need for you to configure these.</p></div></div><h2 id=3-install-splunk-otel-using-helm>3. Install Splunk OTel using Helm</h2><p>Install the OpenTelemetry Collector using the Splunk Helm chart. First, add the Splunk Helm chart repository and update.</p><div class=tab-panel data-tab-group=3c55d108361d2e1f59e79ba2639788a1><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=helm-repo-add class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("3c55d108361d2e1f59e79ba2639788a1","helm-repo-add")'>
<span class=tab-nav-text>helm repo add</span>
</button>
<button data-tab-item=helm-repo-add-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("3c55d108361d2e1f59e79ba2639788a1","helm-repo-add-output")'>
<span class=tab-nav-text>helm repo add output</span></button></div><div class=tab-content-container><div data-tab-item=helm-repo-add class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart <span class=o>&amp;&amp;</span> helm repo update</span></span></code></pre></div></div></div><div data-tab-item=helm-repo-add-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Using ACCESS_TOKEN=&lt;REDACTED&gt;
</span></span><span class=line><span class=cl>Using REALM=eu0
</span></span><span class=line><span class=cl>&#34;splunk-otel-collector-chart&#34; has been added to your repositories
</span></span><span class=line><span class=cl>Using ACCESS_TOKEN=&lt;REDACTED&gt;
</span></span><span class=line><span class=cl>Using REALM=eu0
</span></span><span class=line><span class=cl>Hang tight while we grab the latest from your chart repositories...
</span></span><span class=line><span class=cl>...Successfully got an update from the &#34;splunk-otel-collector-chart&#34; chart repository
</span></span><span class=line><span class=cl>Update Complete. ⎈Happy Helming!⎈</span></span></code></pre></div></div></div></div></div><p>Install the OpenTelemetry Collector Helm with the following commands, do <strong>NOT</strong> edit this:</p><div class=tab-panel data-tab-group=66459cfcc90105c7d8ee98ce18924bda><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=helm-install class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("66459cfcc90105c7d8ee98ce18924bda","helm-install")'>
<span class=tab-nav-text>helm install</span></button></div><div class=tab-content-container><div data-tab-item=helm-install class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.logsEnabled=false&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;logsEngine=otel&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.infrastructureMonitoringEventsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.endpoint=</span><span class=nv>$HEC_URL</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.token=</span><span class=nv>$HEC_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.index=splunk4rookies-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/otel-collector.yaml</span></span></code></pre></div></div></div></div></div><h2 id=4-verify-deployment>4. Verify Deployment</h2><p>You can monitor the progress of the deployment by running <code>kubectl get pods</code> which should typically report that the new pods are up and running after about 30 seconds.</p><p>Ensure the status is reported as <strong>Running</strong> before continuing.</p><div class=tab-panel data-tab-group=ec81bb6c14775e18e6d8923381be8c5e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-get-pods class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ec81bb6c14775e18e6d8923381be8c5e","kubectl-get-pods")'>
<span class=tab-nav-text>kubectl get pods</span>
</button>
<button data-tab-item=kubectl-get-pods-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("ec81bb6c14775e18e6d8923381be8c5e","kubectl-get-pods-output")'>
<span class=tab-nav-text>kubectl get pods Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-get-pods class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div data-tab-item=kubectl-get-pods-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                                          READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>splunk-otel-collector-agent-pvstb                             2/2     Running   0          19s
</span></span><span class=line><span class=cl>splunk-otel-collector-k8s-cluster-receiver-6c454894f8-mqs8n   1/1     Running   0          19s</span></span></code></pre></div></div></div></div></div><p>Use the label set by the <code>helm</code> install to tail logs (You will need to press <code>ctrl + c</code> to exit).</p><div class=tab-panel data-tab-group=f780a3e4c86e01ff6a09e77ba8ddd26a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-logs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f780a3e4c86e01ff6a09e77ba8ddd26a","kubectl-logs")'>
<span class=tab-nav-text>kubectl logs</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-logs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>app</span><span class=o>=</span>splunk-otel-collector -f --container otel-collector</span></span></code></pre></div></div></div></div></div><p>Or use the installed <code>k9s</code> terminal UI.</p><p><a href=#R-image-1296b8bfb5749872a693e9c2a2246658 class=lightbox-link><img alt=k9s class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/1-deploy-otel/../images/k9s.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1296b8bfb5749872a693e9c2a2246658><img alt=k9s class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/1-deploy-otel/../images/k9s.png></a></p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Deleting a failed installation</div><div class=box-content><p>If you make an error installing the Splunk OpenTelemetry Collector you can start over by deleting the installation using:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=tour-of-the-kubernetes-navigator>Tour of the Kubernetes Navigator</h1><h2 id=1-cluster-vs-workload-view>1. Cluster vs Workload View</h2><p>The Kubernetes Navigator offers you two separate use cases to view your Kubernetes data.</p><ul><li>The <strong>K8s workloads</strong> are focusing on providing information in regards to workloads a.k.a. <em>your deployments</em>.</li><li>The <strong>K8s nodes</strong> are focusing on providing insight into the performance of clusters, nodes, pods and containers.</li></ul><p>You will initially select either view depending on your need (you can switch between the view on the fly if required). The most common one we will use in this workshop is the workload view and we will focus on that specifically.</p><h3 id=11-finding-your-k8s-cluster-name>1.1 Finding your K8s Cluster Name</h3><p>Your first task is to identify and find your cluster. The cluster will be named as determined by the preconfigured environment variable <code>INSTANCE</code>. To confirm the cluster name enter the following command in your terminal:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=nv>$INSTANCE</span>-k3s-cluster</span></span></code></pre></div><p>Please make a note of your cluster name as you will need this later in the workshop for filtering.</p><h2 id=2-workloads--workload-details-pane>2. Workloads & Workload Details Pane</h2><p>Go to the <strong>Infrastructure</strong> page in the Observability UI and select <strong>Kubernetes</strong>, this will offer you a set of Kubernetes services, one of them being the <strong>K8s workloads</strong> pane.</p><p>The pane will show a tiny graph giving you a bird&rsquo;s eye view of the load being handled across those Workloads. Also, if there are any alerts for one of the workloads, you will see a small alert indicator as shown in the image below.</p><p><a href=#R-image-91165088f55e87ab8ad746cd84c43176 class=lightbox-link><img alt=k8sWorkloads class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/K8s-Workloads.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-91165088f55e87ab8ad746cd84c43176><img alt=k8sWorkloads class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/K8s-Workloads.png></a></p><p>Click on the <strong>K8s workloads</strong> pane and you will be taken to the workload view.</p><p>Initially, you will see all the workloads for all clusters that are reported into your Observability Cloud Org. If an alert has fired for any of the workloads, it will be highlighted on the top right (as marked with a red stripe) in the image below. You can go directly to the alert by clicking it to expand it.</p><p><a href=#R-image-514f7327160ff35429e12963b226e155 class=lightbox-link><img alt=Workloads class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/k8s-workload-screen.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-514f7327160ff35429e12963b226e155><img alt=Workloads class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/k8s-workload-screen.png></a></p><p>Now, let&rsquo;s find your cluster by filtering on the field <code>k8s.cluster.name</code> in the filter toolbar (as marked with a blue stripe).</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>You can enter a partial name into the search box, such as <code>emea-ws-7*</code>, to quickly find your Cluster.</p><p>Also, it&rsquo;s a very good idea to switch the default time from the default <strong>-4h</strong> back to the last 15 minutes (<strong>-15m</strong>).</p></div></div><p><a href=#R-image-9acafd8aea7880cfbc9eaa54c991bf6a class=lightbox-link><img alt=Workloads class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/k8s-workload-filter.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9acafd8aea7880cfbc9eaa54c991bf6a><img alt=Workloads class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/k8s-workload-filter.png></a></p><p>You should now just see information for your own cluster.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>How many workloads are running & how many namespaces are in your Cluster?</p></div></div><h3 id=21-using-the-navigator-selection-chart>2.1 Using the Navigator Selection Chart</h3><p>The <strong>K8s workloads</strong> table is a common feature used across most of the Navigators and will offer you a list view of the data you are viewing. In our case, it shows a list of <code>Pods Failed</code> grouped by <code>k8s.namespace.name</code>.</p><p><a href=#R-image-e64a68a98ff7a38ff169e2c431752d7f class=lightbox-link><img alt=k8s-workload-list class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/workload-selection.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e64a68a98ff7a38ff169e2c431752d7f><img alt=k8s-workload-list class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/workload-selection.png></a></p><p>Now let&rsquo;s change the list view to a heat map view by selecting either the Heat map icon or the List icon in the upper-right corner of the screen (as marked with the purple line).</p><p>Changing this option will result in the following visualization:</p><p><a href=#R-image-4e29db39cace3aa0e9f263e0ff67ae9c class=lightbox-link><img alt=k8s-Heat-map class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/heatmap.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4e29db39cace3aa0e9f263e0ff67ae9c><img alt=k8s-Heat-map class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/heatmap.png></a></p><p>In this view, you will note that each workload is now a colored square. These squares will change color according to the <strong>Color by</strong> option you selected, <em>as marked by the first green line</em> in the image above. The colors give a visual indication of health and/or usage. You can check the meaning by hovering over the <strong>legend</strong> exclamation icon <i class="fa-fw fas fa-exclamation-circle"></i>
bottom right of the heatmaps.</p><p>Another valuable option in this screen is <strong>Find Outliers</strong> which provides historical analytics of your clusters based on what is selected in the <strong>Color by</strong> dropdown.</p><p>Now, let&rsquo;s select the <strong>File system usage (bytes)</strong> from the <strong>Color by</strong> drop-down box, then click on the <strong>Find outliers</strong> drop-down <em>as marked by a yellow line</em> in the above image and make sure you change the <strong>Scope</strong> in the dialog to <strong>Per k8s.namespace.name</strong> and <strong>Deviation from Median</strong> as below:</p><p><a href=#R-image-3360e99ed4140ca319f3adb313bc5dc5 class=lightbox-link><img alt=k8s-Heat-map class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/set-find-outliers.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-3360e99ed4140ca319f3adb313bc5dc5><img alt=k8s-Heat-map class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/set-find-outliers.png></a></p><p>The <strong>Find Outliers</strong> view is very useful when you need to view a selection of your workloads (or any service depending on the Navigator used) and quickly need to figure out if something has changed.</p><p>It will give you fast insight into items (workloads in our case) that are performing differently (both increased or decreased) which helps to make it easier to spot problems.</p><h3 id=22-the-deployment-overview-pane>2.2 The Deployment Overview pane</h3><p>The Deployment Overview pane gives you a quick insight into the status of your deployments. You can see at once if the pods of your deployments are Pending, Running, Succeeded, Failed or in an Unknown state.</p><p><a href=#R-image-73c0a1eb6ec63435f182f8471b16cd4a class=lightbox-link><img alt=k8s-workload-overview class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/k8s-deployment-overview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-73c0a1eb6ec63435f182f8471b16cd4a><img alt=k8s-workload-overview class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/k8s-deployment-overview.png></a></p><ul><li><em>Running:</em> Pod is deployed and in a running state</li><li><em>Pending:</em> Waiting to be deployed</li><li><em>Succeeded:</em> Pod has been deployed and completed its job and is finished</li><li><em>Failed:</em> Containers in the pod have run and returned some kind of error</li><li><em>Unknown:</em> Kubernetes isn&rsquo;t reporting any of the known states. (This may be during the starting or stopping of pods, for example).</li></ul><p>You can expand the Workload name by hovering your mouse on it, in case the name is longer than the chart allows.</p><p><a href=#R-image-49854cb55031f74efd351aec7c0c9f2c class=lightbox-link><img alt=k8s-workload-hoover class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/k8s-workload-hover.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-49854cb55031f74efd351aec7c0c9f2c><img alt=k8s-workload-hoover class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/k8s-workload-hover.png></a></p><p>To filter to a specific workload, you can click on three dots <strong>&mldr;</strong> next to the workload name in the <strong>k8s.workload.name</strong> column and choose <strong>Filter</strong> from the dropdown box.</p><p><a href=#R-image-604c470faca8954499e1ab345277d7dd class=lightbox-link><img alt=workload-add-filter class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/workload-add-filter.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-604c470faca8954499e1ab345277d7dd><img alt=workload-add-filter class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/workload-add-filter.png></a></p><p>This will add the selected workload to your filters. It would then list a single workload in the <strong>default</strong> namespace.</p><p><a href=#R-image-1cffa6132defa55fd91229652ead2266 class=lightbox-link><img alt=workload-add-filter class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/heatmap-filter-down.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1cffa6132defa55fd91229652ead2266><img alt=workload-add-filter class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/heatmap-filter-down.png></a></p><p>From the Heatmap above find the <strong>splunk-otel-collector-k8s-cluster-receiver</strong> in the <strong>default</strong> namespace and click on the square to see more information about the workload.</p><p><a href=#R-image-04ac8a74d2d1833756d55be7ce548cac class=lightbox-link><img alt=workload-add-filter class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/k8s-workload-detail.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-04ac8a74d2d1833756d55be7ce548cac><img alt=workload-add-filter class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/k8s-workload-detail.png></a></p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What are the CPU request & CPU limit units for the otel-collector?</p></div></div><p>At this point, you can drill into the information of the pods, but that is outside the scope of this workshop.</p><h2 id=3-navigator-sidebar>3. Navigator Sidebar</h2><p>Later in the workshop, you will deploy an Apache server into your cluster which will display an icon in the <strong>Navigator Sidebar</strong>.</p><p>In navigators for Kubernetes, you can track dependent services and containers in the navigator sidebar. To get the most out of the navigator sidebar you configure the services you want to track by configuring an extra dimension called <code>service.name</code>. For this workshop, we have already configured the <code>extraDimensions</code> in the collector configuration for monitoring Apache e.g.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extraDimensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>service.name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span></span></span></code></pre></div><p>The Navigator Sidebar will expand and a link to the discovered service will be added as seen in the image below:</p><p><a href=#R-image-760727ca21a04f83a9be4fa976435128 class=lightbox-link><img alt=Pivotbar class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/pivotbar.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-760727ca21a04f83a9be4fa976435128><img alt=Pivotbar class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/2-check-new-navigator-short/../images/pivotbar.png></a></p><p>This will allow for easy switching between Navigators. The same applies to your Apache server instance, it will have a Navigator Sidebar allowing you to quickly jump back to the Kubernetes Navigator.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=deploying-phpapache>Deploying PHP/Apache</h1><h2 id=1-namespaces-in-kubernetes>1. Namespaces in Kubernetes</h2><p>Most of our customers will make use of some kind of private or public cloud service to run Kubernetes. They often choose to have only a few large Kubernetes clusters as it is easier to manage centrally.</p><p>Namespaces are a way to organize these large Kubernetes clusters into virtual sub-clusters. This can be helpful when different teams or projects share a Kubernetes cluster as this will give them the easy ability to just see and work with their resources.</p><p>Any number of namespaces are supported within a cluster, each logically separated from others but with the ability to communicate with each other. Components are only <strong>visible</strong> when selecting a namespace or when adding the <code>--all-namespaces</code> flag to <code>kubectl</code> instead of allowing you to view just the components relevant to your project by selecting your namespace.</p><p>Most customers will want to install the applications into a separate namespace. This workshop will follow that best practice.</p><h2 id=2--dns-and-services-in-kubernetes>2. DNS and Services in Kubernetes</h2><p>The Domain Name System (DNS) is a mechanism for linking various sorts of information with easy-to-remember names, such as IP addresses. Using a DNS system to translate request names into IP addresses makes it easy for end-users to reach their target domain name effortlessly.</p><p>Most Kubernetes clusters include an internal DNS service configured by default to offer a lightweight approach for service discovery. Even when Pods and Services are created, deleted, or shifted between nodes, built-in service discovery simplifies applications to identify and communicate with services on the Kubernetes clusters.</p><p>In short, the DNS system for Kubernetes will create a DNS entry for each Pod and Service. In general, a Pod has the following DNS resolution:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>pod-name.my-namespace.pod.cluster-domain.example</span></span></code></pre></div><p>For example, if a Pod in the <code>default</code> namespace has the Pod name <code>my_pod</code>, and the domain name for your cluster is <code>cluster.local</code>, then the Pod has a DNS name:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>my_pod.default.pod.cluster.local</span></span></code></pre></div><p>Any Pods exposed by a Service have the following DNS resolution available:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>my_pod.service-name.my-namespace.svc.cluster-domain.example</span></span></code></pre></div><p>More information can be found here: <a href=https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/ rel=external target=_blank><strong>DNS for Service and Pods</strong></a></p><h2 id=3-review-otel-receiver-for-phpapache>3. Review OTel receiver for PHP/Apache</h2><p>Inspect the YAML file <code>~/workshop/k3s/otel-apache.yaml</code> and validate the contents using the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/workshop/k3s/otel-apache.yaml</span></span></code></pre></div><p>This file contains the configuration for the OpenTelemetry agent to monitor the PHP/Apache deployment.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>agent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receiver_creator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>smartagent/apache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=l>type == &#34;port&#34; &amp;&amp; pod.name matches &#34;apache&#34; &amp;&amp; port == 80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>collectd/apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>http://php-apache-svc.apache.svc.cluster.local/server-status?auto</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>extraDimensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>service.name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span></span></span></code></pre></div><h2 id=4--observation-rules-in-the-opentelemetry-config>4. Observation Rules in the OpenTelemetry config</h2><p>The above file contains an observation rule for Apache using the OTel <code>receiver_creator</code>. This receiver can instantiate other receivers at runtime based on whether observed endpoints match a configured rule.</p><p>The configured rules will be evaluated for each endpoint discovered. If the rule evaluates to true, then the receiver for that rule will be started as configured against the matched endpoint.</p><p>In the file above we tell the OpenTelemetry agent to look for Pods that match the name <code>apache</code> and have port <code>80</code> open. Once found, the agent will configure an Apache receiver to read Apache metrics from the configured URL. Note, the K8s DNS-based URL in the above YAML for the service.</p><p>To use the Apache configuration, you can upgrade the existing Splunk OpenTelemetry Collector Helm chart to use the <code>otel-apache.yaml</code> file with the following command:</p><div class=tab-panel data-tab-group=737d2892887b30102b3a75b0fa76a2da><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=helm-upgrade class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("737d2892887b30102b3a75b0fa76a2da","helm-upgrade")'>
<span class=tab-nav-text>Helm Upgrade</span></button></div><div class=tab-content-container><div data-tab-item=helm-upgrade class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm upgrade splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.logsEnabled=false&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;logsEngine=otel&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.infrastructureMonitoringEventsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.endpoint=</span><span class=nv>$HEC_URL</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.token=</span><span class=nv>$HEC_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.index=splunk4rookies-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/otel-collector.yaml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/otel-apache.yaml</span></span></code></pre></div></div></div></div></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> NOTE</div><div class=box-content><p>The <strong>REVISION</strong> number of the deployment has changed, which is a helpful way to keep track of your changes.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Release &#34;splunk-otel-collector&#34; has been upgraded. Happy Helming!
</span></span><span class=line><span class=cl>NAME: splunk-otel-collector
</span></span><span class=line><span class=cl>LAST DEPLOYED: Tue Feb  6 11:17:15 2024
</span></span><span class=line><span class=cl>NAMESPACE: default
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 2
</span></span><span class=line><span class=cl>TEST SUITE: None</span></span></code></pre></div></div></div><h2 id=5-kubernetes-configmaps>5. Kubernetes ConfigMaps</h2><p>A ConfigMap is an object in Kubernetes consisting of key-value pairs that can be injected into your application. With a ConfigMap, you can separate configuration from your Pods.</p><p>Using ConfigMap, you can prevent hardcoding configuration data. ConfigMaps are useful for storing and sharing non-sensitive, unencrypted configuration information.</p><p>The OpenTelemetry collector/agent uses ConfigMaps to store the configuration of the agent and the K8s Cluster receiver. You can/will always verify the current configuration of an agent after a change by running the following commands:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get cm</span></span></code></pre></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>How many ConfigMaps are used by the collector?</p></div></div><p>When you have a list of ConfigMaps from the namespace, select the one for the <code>otel-agent</code> and view it with the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get cm splunk-otel-collector-otel-agent -o yaml</span></span></code></pre></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> NOTE</div><div class=box-content><p>The option <code>-o yaml</code> will output the content of the ConfigMap in a readable YAML format.</p></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Is the configuration from <code>otel-apache.yaml</code> visible in the ConfigMap for the collector agent?</p></div></div><h2 id=6-review-phpapache-deployment-yaml>6. Review PHP/Apache deployment YAML</h2><p>Inspect the YAML file <code>~/workshop/k3s/php-apache.yaml</code> and validate the contents using the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/workshop/k3s/php-apache.yaml</span></span></code></pre></div><p>This file contains the configuration for the PHP/Apache deployment and will create a new StatefulSet with a single replica of the PHP/Apache image.</p><p>A stateless application does not care which network it is using, and it does not need permanent storage. Examples of stateless apps may include web servers such as Apache, Nginx, or Tomcat.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>StatefulSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>updateStrategy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>RollingUpdate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;php-apache-svc&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ghcr.io/splunk/php-apache:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;6&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;4Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache-svc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span></span></span></code></pre></div><h2 id=7-deploy-phpapache>7. Deploy PHP/Apache</h2><p>Create an <code>apache</code> namespace then deploy the PHP/Apache application to the cluster.</p><p>Create the <code>apache</code> namespace:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create namespace apache</span></span></code></pre></div><p>Deploy the PHP/Apache application:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f ~/workshop/k3s/php-apache.yaml -n apache</span></span></code></pre></div><p>Ensure the deployment has been created:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get statefulset -n apache</span></span></code></pre></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What metrics for your Apache instance are being reported in the Apache Navigator?</p><p><strong>Tip:</strong> Use the Navigator Sidebar and click on the service name.</p></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Using Log Observer what is the issue with the PHP/Apache deployment?</p><p><strong>Tip:</strong> Adjust your filters to use: <code>object = php-apache-svc</code> and <code>k8s.cluster.name = &lt;your_cluster></code>.</p></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=fix-phpapache-issue>Fix PHP/Apache Issue</h1><h2 id=1-kubernetes-resources>1. Kubernetes Resources</h2><p>Especially in Production Kubernetes Clusters, CPU and Memory are considered precious resources. Cluster Operators will normally require you to specify the amount of CPU and Memory your Pod or Service will require in the deployment, so they can have the Cluster automatically manage on which Node(s) your solution will be placed.</p><p>You do this by placing a Resource section in the deployment of your application/Pod</p><p><strong>Example:</strong></p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>limits</span><span class=p>:</span><span class=w>         </span><span class=c># Maximum amount of CPU &amp; memory for peek use</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8&#34;</span><span class=w>      </span><span class=c># Maximum of 8 cores of CPU allowed at for peek use</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8Mi&#34;</span><span class=w> </span><span class=c># Maximum allowed 8Mb of memory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>requests</span><span class=p>:</span><span class=w>       </span><span class=c># Request are the expected amount of CPU &amp; memory for normal use</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;6&#34;</span><span class=w>      </span><span class=c># Requesting 4 cores of a CPU</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;4Mi&#34;</span><span class=w> </span><span class=c># Requesting 4Mb of memory</span></span></span></code></pre></div><p>More information can be found here: <a href=https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/ rel=external target=_blank><strong>Resource Management for Pods and Containers</strong></a></p><p>If your application or Pod will go over the limits set in your deployment, Kubernetes will kill and restart your Pod to protect the other applications on the Cluster.</p><p>Another scenario that you will run into is when there is not enough Memory or CPU on a Node. In that case, the Cluster will try to reschedule your Pod(s) on a different Node with more space.</p><p>If that fails, or if there is not enough space when you deploy your application, the Cluster will put your workload/deployment in schedule mode until there is enough room on any of the available Nodes to deploy the Pods according to their limits.</p><h2 id=2-fix-phpapache-deployment>2. Fix PHP/Apache Deployment</h2><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Before we start, let&rsquo;s check the current status of the PHP/Apache deployment. Under <strong>Alerts & Detectors</strong> which detector has fired? Where else can you find this information?</p></div></div><p>To fix the PHP/Apache StatefulSet, edit <code>~/workshop/k3s/php-apache.yaml</code> using the following commands to reduce the CPU resources:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim ~/workshop/k3s/php-apache.yaml</span></span></code></pre></div><p>Find the resources section and reduce the CPU limits to <strong>1</strong> and the CPU requests to <strong>0.5</strong>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.5&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;4Mi&#34;</span></span></span></code></pre></div><p>Save the changes you have made. (Hint: Use <code>Esc</code> followed by <code>:wq!</code> to save your changes).</p><p>Now, we must delete the existing StatefulSet and re-create it. StatefulSets are immutable, so we must delete the existing one and re-create it with the new changes.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl delete statefulset php-apache -n apache</span></span></code></pre></div><p>Now, deploy your changes:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f ~/workshop/k3s/php-apache.yaml -n apache</span></span></code></pre></div><h2 id=3-validate-the-changes>3. Validate the changes</h2><p>You can validate the changes have been applied by running the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe statefulset php-apache -n apache</span></span></code></pre></div><p>Validate the Pod is now running in Splunk Observability Cloud.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Is the <strong>Apache Web Servers</strong> dashboard showing any data now?</p><p><strong>Tip:</strong> Don&rsquo;t forget to use filters and time frames to narrow down your data.</p></div></div><p>Monitor the Apache web servers Navigator dashboard for a few minutes.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What is happening with the # Hosts reporting chart?</p></div></div><h2 id=4-fix-the-memory-issue>4. Fix the memory issue</h2><p>If you navigate back to the Apache dashboard, you will notice that metrics are no longer coming in. We have another resource issue and this time we are Out of Memory. Let&rsquo;s edit the stateful set and increase the memory to what is shown in the image below:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl edit statefulset php-apache -n apache</span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>16Mi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=l>500m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>12Mi</span></span></span></code></pre></div><p>Save the changes you have made.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-exclamation"></i> Hint</div><div class=box-content><p><code>kubectl edit</code> will open the contents in the <code>vi</code> editor, use <code>Esc</code> followed by <code>:wq!</code> to save your changes.</p></div></div><p>Because StatefulSets are immutable, we must delete the existing Pod and let the StatefulSet re-create it with the new changes.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl delete pod php-apache-0 -n apache</span></span></code></pre></div><p>Validate the changes have been applied by running the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe statefulset php-apache -n apache</span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=deploy-load-generator>Deploy Load Generator</h1><p>Now let&rsquo;s apply some load against the <code>php-apache</code> pod. To do this, you will need to start a different Pod to act as a client. The container within the client Pod runs in an infinite loop, sending HTTP GETs to the <code>php-apache</code> service.</p><h2 id=1-review-loadgen-yaml>1. Review loadgen YAML</h2><p>Inspect the YAML file <code>~/workshop/k3s/loadgen.yaml</code> and validate the contents using the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/workshop/k3s/loadgen.yaml</span></span></code></pre></div><p>This file contains the configuration for the load generator and will create a new ReplicaSet with two replicas of the load generator image.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ReplicaSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>loadgen</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>loadgen</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>loadgen</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>loadgen</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>loadgen</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>infinite-calls</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>/bin/sh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- -<span class=l>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=s2>&#34;while true; do wget -q -O- http://php-apache-svc.apache.svc.cluster.local; done&#34;</span></span></span></code></pre></div><h2 id=2-create-a-new-namespace>2. Create a new namespace</h2><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl create namespace loadgen</span></span></code></pre></div><h2 id=3-deploy-the-loadgen-yaml>3. Deploy the loadgen YAML</h2><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl apply -f ~/workshop/k3s/loadgen.yaml --namespace loadgen</span></span></code></pre></div><p>Once you have deployed the load generator, you can see the Pods running in the <code>loadgen</code> namespace. Use previous similar commands to check the status of the Pods from the command line.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Which metrics in the Apache Navigator have now significantly increased?</p></div></div><h2 id=4-scale-the-load-generator>4. Scale the load generator</h2><p>A ReplicaSet is a process that runs multiple instances of a Pod and keeps the specified number of Pods constant. Its purpose is to maintain the specified number of Pod instances running in a cluster at any given time to prevent users from losing access to their application when a Pod fails or is inaccessible.</p><p>ReplicaSet helps bring up a new instance of a Pod when the existing one fails, scale it up when the running instances are not up to the specified number, and scale down or delete Pods if another instance with the same label is created. A ReplicaSet ensures that a specified number of Pod replicas are running continuously and helps with load-balancing in case of an increase in resource usage.</p><p>Let&rsquo;s scale our ReplicaSet to 4 replicas using the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl scale replicaset/loadgen --replicas 4 -n loadgen</span></span></code></pre></div><p>Validate the replicas are running from both the command line and Splunk Observability Cloud:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl get replicaset loadgen -n loadgen</span></span></code></pre></div><p><a href=#R-image-782edce7be8054324cf786dad59c17ad class=lightbox-link><img alt=ReplicaSet class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/5-deploy-loadgen/../images/k8s-workload-replicaset.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-782edce7be8054324cf786dad59c17ad><img alt=ReplicaSet class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/2-hpa/5-deploy-loadgen/../images/k8s-workload-replicaset.png></a></p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What impact can you see in the Apache Navigator?</p></div></div><p>Let the load generator run for around 2-3 minutes and keep observing the metrics in the Kubernetes Navigator and the Apache Navigator.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=setup-horizontal-pod-autoscaling-hpa>Setup Horizontal Pod Autoscaling (HPA)</h1><p>In Kubernetes, a HorizontalPodAutoscaler automatically updates a workload resource (such as a Deployment or StatefulSet), to automatically scale the workload to match demand.</p><p>Horizontal scaling means that the response to increased load is to deploy more Pods. This is different from vertical scaling, which for Kubernetes would mean assigning more resources (for example: memory or CPU) to the Pods that are already running for the workload.</p><p>If the load decreases, and the number of Pods is above the configured minimum, the HorizontalPodAutoscaler instructs the workload resource (the Deployment, StatefulSet, or other similar resource) to scale back down.</p><h2 id=1-setup-hpa>1. Setup HPA</h2><p>Inspect the <code>~/workshop/k3s/hpa.yaml</code> file and validate the contents using the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/workshop/k3s/hpa.yaml</span></span></code></pre></div><p>This file contains the configuration for the Horizontal Pod Autoscaler and will create a new HPA for the <code>php-apache</code> deployment.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>autoscaling/v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>HorizontalPodAutoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>maxReplicas</span><span class=p>:</span><span class=w> </span><span class=m>4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cpu</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>averageUtilization</span><span class=p>:</span><span class=w> </span><span class=m>50</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Utilization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>memory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>averageUtilization</span><span class=p>:</span><span class=w> </span><span class=m>75</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Utilization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>minReplicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scaleTargetRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>StatefulSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span></span></span></code></pre></div><p>Once deployed, <code>php-apache</code> will autoscale when either the average CPU usage goes above 50% or the average memory usage for the deployment goes above 75%, with a minimum of 1 pod and a maximum of 4 pods.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl apply -f ~/workshop/k3s/hpa.yaml</span></span></code></pre></div><h2 id=2-validate-hpa>2. Validate HPA</h2><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl get hpa -n apache</span></span></code></pre></div><p>Go to the <strong>Workloads</strong> or <strong>Node Detail</strong> tab in Kubernetes and check the HPA deployment.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>How many additional <code>php-apache-x</code> pods have been created?</p></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Which metrics in the Apache Navigator have significantly increased again?</p></div></div><h2 id=3-increase-the-hpa-replica-count>3. Increase the HPA replica count</h2><p>Increase the <code>maxReplicas</code> to 8</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl edit hpa php-apache -n apache</span></span></code></pre></div><p>Save the changes you have made. (Hint: Use <code>Esc</code> followed by <code>:wq!</code> to save your changes).</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Questions</div><div class=box-content><ol><li><p>How many pods are now running?</p></li><li><p>How many are pending?</p></li><li><p>Why are they pending?</p></li></ol></div></div><p><strong>Congratulations!</strong> You have completed the workshop.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=making-your-observability-cloud-native-with-opentelemetry>Making Your Observability Cloud Native With OpenTelemetry</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>1 hour</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Robert Castley</span></span><h2 id=abstract>Abstract</h2><p>Organizations getting started with OpenTelemetry may begin by sending data directly to an observability backend. While this works well for initial testing, using the OpenTelemetry collector as part of your observability architecture provides numerous benefits and is recommended for any production deployment.</p><p>In this workshop, we will be focusing on using the OpenTelemetry collector and starting with the fundamentals of configuring the receivers, processors, and exporters ready to use with Splunk Observability Cloud. The journey will take attendees from novices to being able to start adding custom components to help solve for their business observability needs for their distributed platform.</p><h3 id=ninja-sections>Ninja Sections</h3><p>Throughout the workshop there will be expandable <span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja</strong> Sections</span></span>, these will be more hands on and go into further technical detail that you can explore within the workshop or in your own time.</p><p>Please note that the content in these sections may go out of date due to the frequent development being made to the OpenTelemetry project. Links will be provided in the event details are out of sync, please let us know if you spot something that needs updating.</p><hr><div class=expand><input type=checkbox id=R-expand-b94f7d3fc1e11a8da380b1984f70d6c7 aria-controls=R-expandcontent-b94f7d3fc1e11a8da380b1984f70d6c7>
<label class=expand-label for=R-expand-b94f7d3fc1e11a8da380b1984f70d6c7><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> <span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Test Me!</span></span></label><div id=R-expandcontent-b94f7d3fc1e11a8da380b1984f70d6c7 class=expand-content><p><strong>By completing this workshop you will officially be an OpenTelemetry Collector Ninja!</strong></p></div></div><hr><h2 id=target-audience>Target Audience</h2><p>This interactive workshop is for developers and system administrators who are interested in learning more about architecture and deployment of the OpenTelemetry Collector.</p><h2 id=prerequisites>Prerequisites</h2><ul><li>Attendees should have a basic understanding of data collection</li><li>Command line and vim/vi experience.</li><li>A instance/host/VM running Ubuntu 20.04 LTS or 22.04 LTS.<ul><li>Minimum requirements are an AWS/EC2 t2.micro (1 CPU, 1GB RAM, 8GB Storage)</li></ul></li></ul><h2 id=learning-objectives>Learning Objectives</h2><p>By the end of this talk, attendees will be able to:</p><ul><li>Understand the components of OpenTelemetry</li><li>Use receivers, processors, and exporters to collect and analyze data</li><li>Identify the benefits of using OpenTelemetry</li><li>Build a custom component to solve their business needs</li></ul><h2 id=opentelemetry-architecture>OpenTelemetry Architecture</h2><pre class="mermaid align-center">
%%{
  init:{
    &#34;theme&#34;:&#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    subgraph Collector
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Making Your Observability Cloud Native With OpenTelemetry</h1><article class=default><header class=headline></header><h1 id=installing-opentelemetry-collector-contrib>Installing OpenTelemetry Collector Contrib</h1><h2 id=download-the-opentelemetry-collector-contrib-distribution>Download the OpenTelemetry Collector Contrib distribution</h2><p>The first step in installing the Open Telemetry Collector is downloading it. For our lab, we will use the <code>wget</code> command to download the <code>.deb</code> package from the OpenTelemetry Github repository.</p><p>Obtain the <code>.deb</code> package for your platform from the <a href=https://github.com/open-telemetry/opentelemetry-collector-releases/releases rel=external target=_blank><strong>OpenTelemetry Collector Contrib releases page</strong></a></p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget https://github.com/open-telemetry/opentelemetry-collector-releases/releases/download/v0.96.0/otelcol-contrib_0.96.0_linux_amd64.deb</span></span></code></pre></div><h2 id=install-the-opentelemetry-collector-contrib-distribution>Install the OpenTelemetry Collector Contrib distribution</h2><p>Install the <code>.deb</code> package using <code>dpkg</code>. Take a look at the <strong>dpkg Output</strong> tab below to see what the example output of a successful install will look like:</p><div class=tab-panel data-tab-group=756bf7205795c900dcd4682022d752ed><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=install class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("756bf7205795c900dcd4682022d752ed","install")'>
<span class=tab-nav-text>Install</span>
</button>
<button data-tab-item=dpkg-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("756bf7205795c900dcd4682022d752ed","dpkg-output")'>
<span class=tab-nav-text>dpkg Output</span></button></div><div class=tab-content-container><div data-tab-item=install class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo dpkg -i otelcol-contrib_0.96.0_linux_amd64.deb</span></span></code></pre></div></div></div><div data-tab-item=dpkg-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Selecting previously unselected package otelcol-contrib.
</span></span><span class=line><span class=cl>(Reading database ... 64218 files and directories currently installed.)
</span></span><span class=line><span class=cl>Preparing to unpack otelcol-contrib_0.96.0_linux_amd64.deb ...
</span></span><span class=line><span class=cl>Unpacking otelcol-contrib (0.96.0) ...
</span></span><span class=line><span class=cl>Setting up otelcol-contrib (0.96.0) ...
</span></span><span class=line><span class=cl>Created symlink /etc/systemd/system/multi-user.target.wants/otelcol-contrib.service → /lib/systemd/system/otelcol-contrib.service.</span></span></code></pre></div></div></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Installing OpenTelemetry Collector Contrib</h1><article class=default><header class=headline></header><h1 id=installing-opentelemetry-collector-contrib>Installing OpenTelemetry Collector Contrib</h1><h2 id=confirm-the-collector-is-running>Confirm the Collector is running</h2><p>The collector should now be running. We will verify this as root using <code>systemctl</code> command. To exit the status just press <code>q</code>.</p><div class=tab-panel data-tab-group=18c32157d3829bfd8dcc2d2388eb3208><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("18c32157d3829bfd8dcc2d2388eb3208","command")'>
<span class=tab-nav-text>Command</span>
</button>
<button data-tab-item=status-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("18c32157d3829bfd8dcc2d2388eb3208","status-output")'>
<span class=tab-nav-text>Status Output</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl status otelcol-contrib</span></span></code></pre></div></div></div><div data-tab-item=status-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>● otelcol-contrib.service - OpenTelemetry Collector Contrib
</span></span><span class=line><span class=cl>     Loaded: loaded (/lib/systemd/system/otelcol-contrib.service; enabled; vendor preset: enabled)
</span></span><span class=line><span class=cl>     Active: active (running) since Tue 2023-05-16 08:23:23 UTC; 25s ago
</span></span><span class=line><span class=cl>   Main PID: 1415 (otelcol-contrib)
</span></span><span class=line><span class=cl>      Tasks: 5 (limit: 1141)
</span></span><span class=line><span class=cl>     Memory: 22.2M
</span></span><span class=line><span class=cl>        CPU: 125ms
</span></span><span class=line><span class=cl>     CGroup: /system.slice/otelcol-contrib.service
</span></span><span class=line><span class=cl>             └─1415 /usr/bin/otelcol-contrib --config=/etc/otelcol-contrib/config.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]: NumberDataPoints #0
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]: Data point attributes:
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]:      -&gt; exporter: Str(logging)
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]:      -&gt; service_instance_id: Str(df8a57f4-abdc-46b9-a847-acd62db1001f)
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]:      -&gt; service_name: Str(otelcol-contrib)
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]:      -&gt; service_version: Str(0.75.0)
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]: StartTimestamp: 2023-05-16 08:23:39.006 +0000 UTC
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]: Timestamp: 2023-05-16 08:23:39.006 +0000 UTC
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]: Value: 0.000000
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]:         {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;metrics&#34;, &#34;name&#34;: &#34;logging&#34;}</span></span></code></pre></div></div></div></div></div><p>Because we will be making multiple configuration file changes, setting environment variables and restarting the collector, we need to stop the collector service and disable it from starting on boot.</p><div class=tab-panel data-tab-group=87519b18f6bee04c167e0e13de5eaca9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("87519b18f6bee04c167e0e13de5eaca9","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl stop otelcol-contrib <span class=o>&amp;&amp;</span> sudo systemctl disable otelcol-contrib</span></span></code></pre></div></div></div></div></div><hr><div class=expand><input type=checkbox id=R-expand-e16d9e528d25e8f7d78cc3c4390c87da aria-controls=R-expandcontent-e16d9e528d25e8f7d78cc3c4390c87da>
<label class=expand-label for=R-expand-e16d9e528d25e8f7d78cc3c4390c87da><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> <span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Build your own collector using Open Telemetry Collector Builder (ocb)</span></span></label><div id=R-expandcontent-e16d9e528d25e8f7d78cc3c4390c87da class=expand-content><p>For this part we will require the following installed on your system:</p><ul><li><p>Golang (latest version)</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /tmp
</span></span><span class=line><span class=cl>wget https://golang.org/dl/go1.20.linux-amd64.tar.gz
</span></span><span class=line><span class=cl>sudo tar -C /usr/local -xzf go1.20.linux-amd64.tar.gz</span></span></code></pre></div><p>Edit <code>.profile</code> and add the following environment variables:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>GOROOT</span><span class=o>=</span>/usr/local/go
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>GOPATH</span><span class=o>=</span><span class=nv>$HOME</span>/go
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=nv>$GOPATH</span>/bin:<span class=nv>$GOROOT</span>/bin:<span class=nv>$PATH</span></span></span></code></pre></div><p>Renew your shell session:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>source</span> ~/.profile</span></span></code></pre></div><p>Check Go version:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go version</span></span></code></pre></div></li><li><p>ocb installed</p><ul><li><p>Download the ocb binary from the <a href=https://github.com/open-telemetry/opentelemetry-collector/releases/tag/cmd%2Fbuilder%2Fv0.80.0 rel=external target=_blank>project releases</a>
and run the following commands:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mv ocb_0.80.0_darwin_arm64 /usr/bin/ocb
</span></span><span class=line><span class=cl>chmod <span class=m>755</span> /usr/bin/ocb</span></span></code></pre></div><p>An alternative approach would be to use the golang tool chain to build the binary locally by doing:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go install go.opentelemetry.io/collector/cmd/builder@v0.80.0
</span></span><span class=line><span class=cl>mv <span class=k>$(</span>go env GOPATH<span class=k>)</span>/bin/builder /usr/bin/ocb</span></span></code></pre></div></li></ul></li><li><p>(Optional) Docker</p></li></ul><h2 id=why-build-your-own-collector>Why build your own collector?</h2><p>The default distribution of the collector (core and contrib) either contains too much or too little in what they have to offer.</p><p>It is also not advised to run the contrib collector in your production environments due to the amount of components installed which more than likely are not needed by your deployment.</p><h2 id=benefits-of-building-your-own-collector>Benefits of building your own collector?</h2><p>When creating your own collector binaries, (commonly referred to as distribution), means you build what you need.</p><p>The benefits of this are:</p><ol><li>Smaller sized binaries</li><li>Can use existing go scanners for vulnerabilities</li><li>Include internal components that can tie in with your organization</li></ol><h2 id=considerations-for-building-your-collector>Considerations for building your collector?</h2><p>Now, this would not be a 🥷 Ninja zone if it didn&rsquo;t come with some drawbacks:</p><ol><li>Go experience is recommended if not required</li><li><strong>No</strong> Splunk support</li><li>Responsibility for distribution and lifecycle management</li></ol><p>It is important to note that the project is working towards stability but it does not mean changes made will not break your workflow. The team at Splunk provides increased support and a higher level of stability so they can provide a curated experience helping you with your deployment needs.</p><h2 id=the-ninja-zone>The Ninja Zone</h2><p>Once you have all the required tools installed to get started, you will need to create a new file named <code>otelcol-builder.yaml</code> and we will follow this directory structure:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>└── otelcol-builder.yaml</span></span></code></pre></div><p>Once we have the file created, we need to add a list of components for it to install with some additional metadata.</p><p>For this example, we are going to create a builder manifest that will install only the components we need for the introduction config:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dist</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>otelcol-ninja</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>A custom build of the Open Telemetry Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>output_path</span><span class=p>:</span><span class=w> </span><span class=l>./dist</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/extension/ballastextension v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/extension/zpagesextension  v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/extension/httpforwarder v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/extension/healthcheckextension v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/loggingexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/otlpexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/exporter/splunkhecexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/exporter/signalfxexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/exporter/sapmexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/processor/batchprocessor v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/processor/memorylimiterprocessor v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/receiver/otlpreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/hostmetricsreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/jaegerreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/prometheusreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/zipkinreceiver v0.80.0</span></span></span></code></pre></div><p>Once the yaml file has been updated for the <em>ocb</em>, then run the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ocb --config<span class=o>=</span>otelcol-builder.yaml</span></span></code></pre></div><p>Which leave you with the following directory structure:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>├── dist
</span></span><span class=line><span class=cl>│   ├── components.go
</span></span><span class=line><span class=cl>│   ├── components_test.go
</span></span><span class=line><span class=cl>│   ├── go.mod
</span></span><span class=line><span class=cl>│   ├── go.sum
</span></span><span class=line><span class=cl>│   ├── main.go
</span></span><span class=line><span class=cl>│   ├── main_others.go
</span></span><span class=line><span class=cl>│   ├── main_windows.go
</span></span><span class=line><span class=cl>│   └── otelcol-ninja
</span></span><span class=line><span class=cl>└── otelcol-builder.yaml</span></span></code></pre></div><h3 id=references>References</h3><ol><li><a href=https://opentelemetry.io/docs/collector/custom-collector/ rel=external target=_blank>https://opentelemetry.io/docs/collector/custom-collector/</a></li></ol></div></div><hr><h2 id=default-configuration>Default configuration</h2><p>OpenTelemetry is configured through YAML files. These files have default configurations that we can modify to meet our needs. Let&rsquo;s look at the default configuration that is supplied:</p><div class=tab-panel data-tab-group=06dcf0c4c24283621fd636b192b76fca><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("06dcf0c4c24283621fd636b192b76fca","command")'>
<span class=tab-nav-text>Command</span>
</button>
<button data-tab-item=configyaml class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("06dcf0c4c24283621fd636b192b76fca","configyaml")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /etc/otelcol-contrib/config.yaml</span></span></code></pre></div></div></div><div data-tab-item=configyaml class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" linenos=table><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div><p>Congratulations! You have successfully downloaded and installed the OpenTelemetry Collector. You are well on your way to becoming an OTel Ninja. But first let&rsquo;s walk through configuration files and different distributions of the OpenTelemetry Collector.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>Splunk does provide its own, fully supported, distribution of the OpenTelemetry Collector. This distribution is available to install from the <a href=https://github.com/signalfx/splunk-otel-collector rel=external target=_blank><strong>Splunk GitHub Repository</strong></a> or via a wizard in Splunk Observability Cloud that will build out a simple installation script to copy and paste. This distribution includes many additional features and enhancements that are not available in the OpenTelemetry Collector Contrib distribution.</p><ul><li>The Splunk Distribution of the OpenTelemetry Collector is production-tested; it is in use by the majority of customers in their production environments.</li><li>Customers that use our distribution can receive direct help from official Splunk support within SLAs.</li><li>Customers can use or migrate to the Splunk Distribution of the OpenTelemetry Collector without worrying about future breaking changes to its core configuration experience for metrics and traces collection (OpenTelemetry logs collection configuration is in beta). There may be breaking changes to the Collector&rsquo;s metrics.</li></ul></div></div><p>We will now walk through each section of the configuration file and modify it to send host metrics to Splunk Observability Cloud.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-extensions>OpenTelemetry Collector Extensions</h1><p>Now that we have the OpenTelemetry Collector installed, let&rsquo;s take a look at extensions for the OpenTelemetry Collector. Extensions are optional and available primarily for tasks that do not involve processing telemetry data. Examples of extensions include health monitoring, service discovery, and data forwarding.</p><pre class="mermaid align-center">
%%{
  init:{
    &#34;theme&#34;: &#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    style E fill:#e20082,stroke:#333,stroke-width:4px,color:#fff
    subgraph Collector
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of OpenTelemetry Collector Extensions</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-extensions>OpenTelemetry Collector Extensions</h1><h2 id=health-check>Health Check</h2><p>Extensions are configured in the same <code>config.yaml</code> file that we referenced in the installation step. Let&rsquo;s edit the <code>config.yaml</code> file and configure the extensions. Note that the <strong>pprof</strong> and <strong>zpages</strong> extensions are already configured in the default <code>config.yaml</code> file. For the purpose of this workshop, we will only be updating the <strong>health_check</strong> extension to expose the port on all network interfaces on which we can access the health of the collector.</p><div class=tab-panel data-tab-group=9feb47583984e89ac5e403603dfa0ec0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9feb47583984e89ac5e403603dfa0ec0","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/otelcol-contrib/config.yaml</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=5a230e9f7c70aabf7a3bc25e520d8d92><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=extensions-configuration class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5a230e9f7c70aabf7a3bc25e520d8d92","extensions-configuration")'>
<span class=tab-nav-text>Extensions Configuration</span></button></div><div class=tab-content-container><div data-tab-item=extensions-configuration class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" hl_lines=3><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span></span></span></code></pre></div></div></div></div></div><p>Start the collector:</p><div class=tab-panel data-tab-group=43b3af86b0592e4bcaf00c662e85671e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("43b3af86b0592e4bcaf00c662e85671e","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>otelcol-contrib --config<span class=o>=</span>file:/etc/otelcol-contrib/config.yaml</span></span></code></pre></div></div></div></div></div><p>This extension enables an HTTP URL that can be probed to check the status of the OpenTelemetry Collector. This extension can be used as a liveness and/or readiness probe on Kubernetes. To learn more about the <code>curl</code> command, check out the <a href=https://curl.se/docs/manpage.html rel=external target=_blank>curl man page</a>.</p><p>Open a new terminal session and SSH into your instance to run the following command:</p><div class=tab-panel data-tab-group=be85e43de2c484e98080ab741b0f316e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=curl-command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("be85e43de2c484e98080ab741b0f316e","curl-command")'>
<span class=tab-nav-text>curl Command</span>
</button>
<button data-tab-item=curl-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("be85e43de2c484e98080ab741b0f316e","curl-output")'>
<span class=tab-nav-text>curl Output</span></button></div><div class=tab-content-container><div data-tab-item=curl-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:13133</span></span></code></pre></div></div></div><div data-tab-item=curl-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>{&#34;status&#34;:&#34;Server available&#34;,&#34;upSince&#34;:&#34;2023-04-27T10:11:22.153295874+01:00&#34;,&#34;uptime&#34;:&#34;16m24.684476004s&#34;}</span></span></code></pre></div></div></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-extensions>OpenTelemetry Collector Extensions</h1><h2 id=performance-profiler>Performance Profiler</h2><p><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/extension/pprofextension/README.md rel=external target=_blank><strong>Performance Profiler</strong></a> extension enables the golang net/http/pprof endpoint. This is typically used by developers to collect performance profiles and investigate issues with the service. <strong>We will not be covering this in this workshop</strong>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-extensions>OpenTelemetry Collector Extensions</h1><h2 id=zpages>zPages</h2><p><a href=https://github.com/open-telemetry/opentelemetry-collector/blob/main/extension/zpagesextension/README.md rel=external target=_blank><strong>zPages</strong></a> are an in-process alternative to external exporters. When included, they collect and aggregate tracing and metrics information in the background; this data is served on web pages when requested. zPages are an extremely useful diagnostic feature to ensure the collector is running as expected.</p><div class=tab-panel data-tab-group=ac38268af8a0a60d613278a63c040560><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=servicez class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ac38268af8a0a60d613278a63c040560","servicez")'>
<span class=tab-nav-text>ServiceZ</span>
</button>
<button data-tab-item=pipelinez class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("ac38268af8a0a60d613278a63c040560","pipelinez")'>
<span class=tab-nav-text>PipelineZ</span>
</button>
<button data-tab-item=extensionz class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("ac38268af8a0a60d613278a63c040560","extensionz")'>
<span class=tab-nav-text>ExtensionZ</span></button></div><div class=tab-content-container><div data-tab-item=servicez class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p><strong>ServiceZ</strong> gives an overview of the collector services and quick access to the pipelinez, extensionz, and featurez zPages. The page also provides build and runtime information.</p><p>Example URL: <a href=http://localhost:55679/debug/servicez rel=external target=_blank>http://localhost:55679/debug/servicez</a> (change <code>localhost</code> to reflect your own environment).</p><p><a href=#R-image-5ba3b665ee6d12ece9ccdff145df8e56 class=lightbox-link><img alt=ServiceZ class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/2-extensions/3-zpages/../../images/servicez.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5ba3b665ee6d12ece9ccdff145df8e56><img alt=ServiceZ class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/2-extensions/3-zpages/../../images/servicez.png></a></p></div></div><div data-tab-item=pipelinez class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><strong>PipelineZ</strong> provides insights on the running pipelines running in the collector. You can find information on type, if data is mutated, and you can also see information on the receivers, processors and exporters that are used for each pipeline.</p><p>Example URL: <a href=http://localhost:55679/debug/pipelinez rel=external target=_blank>http://localhost:55679/debug/pipelinez</a> (change <code>localhost</code> to reflect your own environment).</p><p><a href=#R-image-f63f837736613b2519c068e2e61df401 class=lightbox-link><img alt=PipelineZ class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/2-extensions/3-zpages/../../images/pipelinez.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f63f837736613b2519c068e2e61df401><img alt=PipelineZ class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/2-extensions/3-zpages/../../images/pipelinez.png></a></p></div></div><div data-tab-item=extensionz class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><strong>ExtensionZ</strong> shows the extensions that are active in the collector.</p><p>Example URL: <a href=http://localhost:55679/debug/extensionz rel=external target=_blank>http://localhost:55679/debug/extensionz</a> (change <code>localhost</code> to reflect your own environment).</p><p><a href=#R-image-10f71980179cb922f1aaf6b3cd0778b0 class=lightbox-link><img alt=ExtensionZ class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/2-extensions/3-zpages/../../images/extensionz.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-10f71980179cb922f1aaf6b3cd0778b0><img alt=ExtensionZ class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/2-extensions/3-zpages/../../images/extensionz.png></a></p></div></div></div></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>You can use your browser to access your environment emitting zPages information at (replace <code>&lt;insert_your_ip></code> with your IP address):</p><ul><li><strong>ServiceZ:</strong> <a href="http://<insert_your_ip>:55679/debug/servicez" rel=external target=_blank>http://&lt;insert_your_ip>:55679/debug/servicez</a></li><li><strong>PipelineZ:</strong> <a href="http://<insert_your_ip>:55679/debug/pipelinez" rel=external target=_blank>http://&lt;insert_your_ip>:55679/debug/pipelinez</a></li><li><strong>ExtensionZ:</strong> <a href="http://<insert_your_ip>:55679/debug/extensionz" rel=external target=_blank>http://&lt;insert_your_ip>:55679/debug/extensionz</a></li></ul></div></div><hr><div class=expand><input type=checkbox id=R-expand-55ebb23e9aaaf7ea377ffa04850d508a aria-controls=R-expandcontent-55ebb23e9aaaf7ea377ffa04850d508a>
<label class=expand-label for=R-expand-55ebb23e9aaaf7ea377ffa04850d508a><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> <span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Improve data durability with storage extension</span></span></label><div id=R-expandcontent-55ebb23e9aaaf7ea377ffa04850d508a class=expand-content><p>For this, we will need to validate that our distribution has the <code>file_storage</code> extension installed. This can be done by running the command <code>otelcol-contrib components</code> which should show results like:</p><div class=tab-panel data-tab-group=08b77456976925a848527fc0772bc8c0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=truncated-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("08b77456976925a848527fc0772bc8c0","truncated-output")'>
<span class=tab-nav-text>Truncated Output</span>
</button>
<button data-tab-item=full-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("08b77456976925a848527fc0772bc8c0","full-output")'>
<span class=tab-nav-text>Full Output</span></button></div><div class=tab-content-container><div data-tab-item=truncated-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># ... truncated for clarity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>file_storage</span></span></span></code></pre></div></div></div><div data-tab-item=full-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>buildinfo</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>otelcol-contrib</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>OpenTelemetry Collector Contrib</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>prometheus_simple</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>influxdb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>purefa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>purefb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>receiver_creator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mongodbatlas</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>vcenter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>snmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>expvar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jmx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>skywalking</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>udplog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>carbon</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>kafkametrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>memcached</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>prometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>windowseventlog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsecscontainermetrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>iis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>nsxt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>aerospike</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>httpcheck</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8sobjects</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mongodb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>hostmetrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>signalfx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>statsd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsxray</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>cloudfoundry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>collectd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>couchdb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>kubeletstats</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jaeger</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>journald</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>riak</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>splunk_hec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>active_directory_ds</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awscloudwatch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sqlquery</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>windowsperfcounters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>flinkmetrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlecloudpubsub</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>podman_stats</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>wavefront</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8s_events</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>postgresql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sapm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sqlserver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>solace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tcplog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awscontainerinsightreceiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsfirehose</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bigip</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>filelog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlecloudspanner</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>cloudflare</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>docker_stats</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8s_cluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>pulsar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>zipkin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>opencensus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>azureeventhub</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>datadog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>fluentforward</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlpjsonfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>syslog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>cumulativetodelta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>groupbyattrs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>groupbytrace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8sattributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>experimental_metricsgeneration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>metricstransform</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>routing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>datadog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>deltatorate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>spanmetrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>span</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>redaction</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>servicegraph</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>transform</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>filter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>probabilistic_sampler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tail_sampling</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>carbon</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>datadog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>f5cloud</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mezmo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>skywalking</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsxray</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>dynatrace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>loki</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>prometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>logging</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>azuredataexplorer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>azuremonitor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>instana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jaeger</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>loadbalancing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sentry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>splunk_hec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tanzuobservability</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>zipkin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>alibabacloud_logservice</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>clickhouse</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlecloud</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>prometheusremotewrite</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awscloudwatchlogs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlecloudpubsub</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jaeger_thrift</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>logzio</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sapm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sumologic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlemanagedprometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>opencensus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awskinesis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>coralogix</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>influxdb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>logicmonitor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>signalfx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tencentcloud_logservice</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsemf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>pulsar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>zpages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bearertokenauth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>oidc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>host_observer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sigv4auth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>file_storage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>memory_ballast</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>health_check</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>oauth2client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsproxy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>http_forwarder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jaegerremotesampling</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8s_observer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>pprof</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>asapclient</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>basicauth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>headers_setter</span></span></span></code></pre></div></div></div></div></div><p>This extension provides exporters the ability to queue data to disk in the event that exporter is unable to send data to the configured endpoint.</p><p>In order to configure the extension, you will need to update your config to include the information below. First, be sure to create a /tmp/otel-data directory and give it read/write permissions:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file_storage</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/otel-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>compaction</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/otel-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>on_start</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>on_rebound</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>rebound_needed_threshold_mib</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>rebound_trigger_threshold_mib</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># ... truncated for clarity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages, file_storage]</span></span></span></code></pre></div><h2 id=why-queue-data-to-disk>Why queue data to disk?</h2><p>This allows the collector to weather network interruptions (and even collector restarts) to ensure data is sent to the upstream provider.</p><h2 id=considerations-for-queuing-data-to-disk>Considerations for queuing data to disk?</h2><p>There is a potential that this could impact data throughput performance due to disk performance.</p><h3 id=references>References</h3><ol><li><a href=https://community.splunk.com/t5/Community-Blog/Data-Persistence-in-the-OpenTelemetry-Collector/ba-p/624583 rel=external target=_blank>https://community.splunk.com/t5/Community-Blog/Data-Persistence-in-the-OpenTelemetry-Collector/ba-p/624583</a></li><li><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/extension/storage/filestorage rel=external target=_blank>https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/extension/storage/filestorage</a></li></ol></div></div><hr><h2 id=configuration-check-in>Configuration Check-in</h2><p>Now that we&rsquo;ve covered extensions, let&rsquo;s check our configuration changes.</p><hr><div class=expand><input type=checkbox id=R-expand-8019c944f10b4b770f9744e4ad59e75d aria-controls=R-expandcontent-8019c944f10b4b770f9744e4ad59e75d>
<label class=expand-label for=R-expand-8019c944f10b4b770f9744e4ad59e75d><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> <span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>Review your configuration</span></span></label><div id=R-expandcontent-8019c944f10b4b770f9744e4ad59e75d class=expand-content><div class=tab-panel data-tab-group=808567adda1a691f26968221d018dd75><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configyaml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("808567adda1a691f26968221d018dd75","configyaml")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div data-tab-item=configyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" hl_lines=3 linenos=table><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=hl><span class=lnt> 3
</span></span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></div><hr><p>Now that we have reviewed extensions, let&rsquo;s dive into the data pipeline portion of the workshop. A pipeline defines a path the data follows in the Collector starting from reception, moving to further processing or modification, and finally exiting the Collector via exporters.</p><p>The data pipeline in the OpenTelemetry Collector is made up of receivers, processors, and exporters. We will first start with receivers.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-receivers>OpenTelemetry Collector Receivers</h1><p>Welcome to the receiver portion of the workshop! This is the starting point of the data pipeline of the OpenTelemetry Collector. Let&rsquo;s dive in.</p><p>A receiver, which can be push or pull based, is how data gets into the Collector. Receivers may support one or more data sources. Generally, a receiver accepts data in a specified format, translates it into the internal format and passes it to processors and exporters defined in the applicable pipelines.</p><pre class="mermaid align-center">
%%{
  init:{
    &#34;theme&#34;:&#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    style M fill:#e20082,stroke:#333,stroke-width:4px,color:#fff
    subgraph Collector
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of OpenTelemetry Collector Receivers</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-receivers>OpenTelemetry Collector Receivers</h1><h2 id=host-metrics-receiver>Host Metrics Receiver</h2><p><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/receiver/hostmetricsreceiver/README.md rel=external target=_blank><strong>The Host Metrics Receiver</strong></a> generates metrics about the host system scraped from various sources. This is intended to be used when the collector is deployed as an agent which is what we will be doing in this workshop.</p><p>Let&rsquo;s update the <code>/etc/otel-contrib/config.yaml</code> file and configure the <strong>hostmetrics</strong> receiver. Insert the following YAML under the <strong>receivers</strong> section, taking care to indent by two spaces.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/otelcol-contrib/config.yaml</span></span></code></pre></div><div class=tab-panel data-tab-group=2cc834b89b65c16f55744aca733e3532><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=host-metrics-receiver-configuration class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("2cc834b89b65c16f55744aca733e3532","host-metrics-receiver-configuration")'>
<span class=tab-nav-text>Host Metrics Receiver Configuration</span></button></div><div class=tab-content-container><div data-tab-item=host-metrics-receiver-configuration class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" hl_lines=2-22><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># process:</span></span></span></code></pre></div></div></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-receivers>OpenTelemetry Collector Receivers</h1><h2 id=prometheus-receiver>Prometheus Receiver</h2><p>You will also notice another receiver called <strong>prometheus</strong>. <a href=https://prometheus.io/docs/introduction/overview/ rel=external target=_blank><strong>Prometheus</strong></a> is an open-source toolkit used by the OpenTelemetry Collector. This receiver is used to scrape metrics from the OpenTelemetry Collector itself. These metrics can then be used to monitor the health of the collector.</p><p>Let&rsquo;s modify the <code>prometheus</code> receiver to clearly show that it is for collecting metrics from the collector itself. By changing the name of the receiver from <code>prometheus</code> to <code>prometheus/internal</code>, it is now much clearer as to what that receiver is doing. Update the configuration file to look like this:</p><div class=tab-panel data-tab-group=0669a99b25ac631fe7dd4c5d012c7f38><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=prometheus-receiver-configuration class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0669a99b25ac631fe7dd4c5d012c7f38","prometheus-receiver-configuration")'>
<span class=tab-nav-text>Prometheus Receiver Configuration</span></button></div><div class=tab-content-container><div data-tab-item=prometheus-receiver-configuration class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" hl_lines=1><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class="line hl"><span class=cl><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span></span></span></code></pre></div></div></div></div></div><h2 id=example-dashboard---prometheus-metrics>Example Dashboard - Prometheus metrics</h2><p>The following screenshot shows an example dashboard of spme of the metrics the Prometheus internal receiver collects from the OpenTelemetry Collector. Here, we can see accepted and sent spans, metrics and log records.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>The following screenshot is an out-of-the-box (OOTB) dashboard from Splunk Observability Cloud that allows you to easily monitor your Splunk OpenTelemetry Collector install base.</p></div></div><p><a href=#R-image-4559c405a5172e76c735868588e35554 class=lightbox-link><img alt=otel-charts class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/3-receivers/2-prometheus/../../images/otel-charts.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4559c405a5172e76c735868588e35554><img alt=otel-charts class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/3-receivers/2-prometheus/../../images/otel-charts.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-receivers>OpenTelemetry Collector Receivers</h1><h2 id=other-receivers>Other Receivers</h2><p>You will notice in the default configuration there are other receivers: <strong>otlp</strong>, <strong>opencensus</strong>, <strong>jaeger</strong> and <strong>zipkin</strong>. These are used to receive telemetry data from other sources. We will not be covering these receivers in this workshop and they can be left as they are.</p><hr><div class=expand><input type=checkbox id=R-expand-94893db5d5cfe35ff0a56976b78c6ad2 aria-controls=R-expandcontent-94893db5d5cfe35ff0a56976b78c6ad2>
<label class=expand-label for=R-expand-94893db5d5cfe35ff0a56976b78c6ad2><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> <span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Create receivers dynamically</span></span></label><div id=R-expandcontent-94893db5d5cfe35ff0a56976b78c6ad2 class=expand-content><p>To help observe short lived tasks like docker containers, kubernetes pods, or ssh sessions, we can use the <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/receivercreator rel=external target=_blank>receiver creator</a> with <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/extension/observer rel=external target=_blank>observer extensions</a> to create a new receiver as these services start up.</p><h2 id=what-do-we-need>What do we need?</h2><p>In order to start using the receiver creator and its associated observer extensions, they will need to be part of your collector build manifest.</p><p>See <a href=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/1-installation/index.html>installation</a> for the details.</p><h2 id=things-to-consider>Things to consider?</h2><p>Some short lived tasks may require additional configuration such as <em>username</em>, and <em>password</em>.
These values can be referenced via <a href=https://opentelemetry.io/docs/collector/configuration/#configuration-environment-variables rel=external target=_blank>environment variables</a>,
or use a scheme expand syntax such as <code>${file:./path/to/database/password}</code>.
Please adhere to your organisation&rsquo;s secret practices when taking this route.</p><h2 id=the-ninja-zone>The Ninja Zone</h2><p>There are only two things needed for this ninja zone:</p><ol><li>Make sure you have added receiver creater and observer extensions to the builder manifest.</li><li>Create the config that can be used to match against discovered endpoints.</li></ol><p>To create the templated configurations, you can do the following:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receiver_creator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>watch_observers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>host_observer]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>redis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=l>type == &#34;port&#34; &amp;&amp; port == 6379</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=l>${env:HOST_REDIS_PASSWORD}</span></span></span></code></pre></div><p>For more examples, refer to these <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/receivercreator#examples rel=external target=_blank>receiver creator&rsquo;s examples</a>.</p></div></div><hr><h2 id=configuration-check-in>Configuration Check-in</h2><p>We&rsquo;ve now covered receivers, so let&rsquo;s now check our configuration changes.</p><hr><div class=expand><input type=checkbox id=R-expand-9853679af1c4684a1c9d823d103951f9 aria-controls=R-expandcontent-9853679af1c4684a1c9d823d103951f9>
<label class=expand-label for=R-expand-9853679af1c4684a1c9d823d103951f9><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> <span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>Review your configuration</span></span></label><div id=R-expandcontent-9853679af1c4684a1c9d823d103951f9 class=expand-content><div class=tab-panel data-tab-group=2fc37fe911febebf0859a9fe56b671c7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configyaml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("2fc37fe911febebf0859a9fe56b671c7","configyaml")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div data-tab-item=configyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" hl_lines="10-30 39" linenos=table><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=hl><span class=lnt>10
</span></span><span class=hl><span class=lnt>11
</span></span><span class=hl><span class=lnt>12
</span></span><span class=hl><span class=lnt>13
</span></span><span class=hl><span class=lnt>14
</span></span><span class=hl><span class=lnt>15
</span></span><span class=hl><span class=lnt>16
</span></span><span class=hl><span class=lnt>17
</span></span><span class=hl><span class=lnt>18
</span></span><span class=hl><span class=lnt>19
</span></span><span class=hl><span class=lnt>20
</span></span><span class=hl><span class=lnt>21
</span></span><span class=hl><span class=lnt>22
</span></span><span class=hl><span class=lnt>23
</span></span><span class=hl><span class=lnt>24
</span></span><span class=hl><span class=lnt>25
</span></span><span class=hl><span class=lnt>26
</span></span><span class=hl><span class=lnt>27
</span></span><span class=hl><span class=lnt>28
</span></span><span class=hl><span class=lnt>29
</span></span><span class=hl><span class=lnt>30
</span></span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=hl><span class=lnt>39
</span></span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># process:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></div><hr><p>Now that we have reviewed how data gets into the OpenTelemetry Collector through receivers, let&rsquo;s now take a look at how the Collector processes the received data.</p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div><div class=box-content><p>As the <code>/etc/otelcol-contrib/config.yaml</code> is not complete, please <strong>do not</strong> attempt to restart the collector at this point.</p></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-processors>OpenTelemetry Collector Processors</h1><p><a href=https://github.com/open-telemetry/opentelemetry-collector/blob/main/processor/README.md rel=external target=_blank><strong>Processors</strong></a> are run on data between being received and being exported. Processors are optional though some are recommended. There are <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor rel=external target=_blank><strong>a large number of processors</strong></a> included in the OpenTelemetry contrib Collector.</p><pre class="mermaid align-center">
%%{
  init:{
    &#34;theme&#34;:&#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    style Processors fill:#e20082,stroke:#333,stroke-width:4px,color:#fff
    subgraph Collector
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of OpenTelemetry Collector Processors</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-processors>OpenTelemetry Collector Processors</h1><h2 id=batch-processor>Batch Processor</h2><p>By default, only the <strong>batch</strong> processor is enabled. This processor is used to batch up data before it is exported. This is useful for reducing the number of network calls made to exporters. For this workshop, we will inherit the following defaults which are hard-coded into the Collector:</p><ul><li><code>send_batch_size</code> (default = 8192): Number of spans, metric data points, or log records after which a batch will be sent regardless of the timeout. send_batch_size acts as a trigger and does not affect the size of the batch. If you need to enforce batch size limits sent to the next component in the pipeline see send_batch_max_size.</li><li><code>timeout</code> (default = 200ms): Time duration after which a batch will be sent regardless of size. If set to zero, send_batch_size is ignored as data will be sent immediately, subject to only send_batch_max_size.</li><li><code>send_batch_max_size</code> (default = 0): The upper limit of the batch size. 0 means no upper limit on the batch size. This property ensures that larger batches are split into smaller units. It must be greater than or equal to send_batch_size.</li></ul><p>For more information on the Batch processor, see the <a href=https://github.com/open-telemetry/opentelemetry-collector/blob/main/processor/batchprocessor/README.md rel=external target=_blank><strong>Batch Processor documentation</strong></a>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-processors>OpenTelemetry Collector Processors</h1><h2 id=resource-detection-processor>Resource Detection Processor</h2><p>The <strong>resourcedetection</strong> processor can be used to detect resource information from the host and append or override the resource value in telemetry data with this information.</p><p>By default, the hostname is set to the FQDN if possible, otherwise, the hostname provided by the OS is used as a fallback. This logic can be changed from using using the <code>hostname_sources</code> configuration option. To avoid getting the FQDN and use the hostname provided by the OS, we will set the <code>hostname_sources</code> to <code>os</code>.</p><div class=tab-panel data-tab-group=9b598566cd20f54ed26e0a4d3ef29e46><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=system-resource-detection-processor-configuration class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9b598566cd20f54ed26e0a4d3ef29e46","system-resource-detection-processor-configuration")'>
<span class=tab-nav-text>System Resource Detection Processor Configuration</span></button></div><div class=tab-content-container><div data-tab-item=system-resource-detection-processor-configuration class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" hl_lines=3-7><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span></span></span></code></pre></div></div></div></div></div><p>If the workshop instance is running on an AWS/EC2 instance we can gather the following tags from the EC2 metadata API (this is not available on other platforms).</p><ul><li><code>cloud.provider ("aws")</code></li><li><code>cloud.platform ("aws_ec2")</code></li><li><code>cloud.account.id</code></li><li><code>cloud.region</code></li><li><code>cloud.availability_zone</code></li><li><code>host.id</code></li><li><code>host.image.id</code></li><li><code>host.name</code></li><li><code>host.type</code></li></ul><p>We will create another processor to append these tags to our metrics.</p><div class=tab-panel data-tab-group=58e6de2225363f2409ffaa655ee758b8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=ec2-resource-detection-processor-configuration class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("58e6de2225363f2409ffaa655ee758b8","ec2-resource-detection-processor-configuration")'>
<span class=tab-nav-text>EC2 Resource Detection Processor Configuration</span></button></div><div class=tab-content-container><div data-tab-item=ec2-resource-detection-processor-configuration class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" hl_lines=7-8><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span></span></span></code></pre></div></div></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-processors>OpenTelemetry Collector Processors</h1><h2 id=attributes-processor>Attributes Processor</h2><p>The attributes processor modifies attributes of a span, log, or metric. This processor also supports the ability to filter and match input data to determine if they should be included or excluded for specified actions.</p><p>It takes a list of actions that are performed in the order specified in the config. The supported actions are:</p><ul><li><code>insert</code>: Inserts a new attribute in input data where the key does not already exist.</li><li><code>update</code>: Updates an attribute in input data where the key does exist.</li><li><code>upsert</code>: Performs insert or update. Inserts a new attribute in input data where the key does not already exist and updates an attribute in input data where the key does exist.</li><li><code>delete</code>: Deletes an attribute from the input data.</li><li><code>hash</code>: Hashes (SHA1) an existing attribute value.</li><li><code>extract</code>: Extracts values using a regular expression rule from the input key to target keys specified in the rule. If a target key already exists, it will be overridden.</li></ul><p>We are going to create an attributes processor to <code>insert</code> a new attribute to all our host metrics called <code>participant.name</code> with a value of your name e.g. <code>marge_simpson</code>.</p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div><div class=box-content><p>Ensure you replace <code>INSERT_YOUR_NAME_HERE</code> with your name and also ensure you <strong>do not</strong> use spaces in your name.</p></div></div><p>Later on in the workshop, we will use this attribute to filter our metrics in Splunk Observability Cloud.</p><div class=tab-panel data-tab-group=597e6c7b10cad60a4b1f5a850e14d295><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=attributes-processor-configuration class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("597e6c7b10cad60a4b1f5a850e14d295","attributes-processor-configuration")'>
<span class=tab-nav-text>Attributes Processor Configuration</span></button></div><div class=tab-content-container><div data-tab-item=attributes-processor-configuration class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" hl_lines=9-13><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>attributes/conf</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>participant.name</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;INSERT_YOUR_NAME_HERE&#34;</span></span></span></code></pre></div></div></div></div></div><hr><div class=expand><input type=checkbox id=R-expand-ca109bb9649f710e418585f80d820081 aria-controls=R-expandcontent-ca109bb9649f710e418585f80d820081>
<label class=expand-label for=R-expand-ca109bb9649f710e418585f80d820081><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> <span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Using connectors to gain internal insights</span></span></label><div id=R-expandcontent-ca109bb9649f710e418585f80d820081 class=expand-content><p>One of the most recent additions to the collector was the notion of a <a href=https://opentelemetry.io/docs/collector/configuration/#connectors rel=external target=_blank><strong>connector</strong></a>, which allows you to join the output of one pipeline to the input of another pipeline.</p><p>An example of how this is beneficial is that some services emit metrics based on the amount of datapoints being exported, the number of logs containing an error status,
or the amount of data being sent from one deployment environment. The count connector helps address this for you out of the box.</p><h2 id=why-a-connector-instead-of-a-processor>Why a connector instead of a processor?</h2><p>A processor is limited in what additional data it can produce considering it has to pass on the data it has processed making it hard to expose additional information. Connectors do not have to emit the data they receive which means they provide an opportunity to create the insights we are after.</p><p>For example, a connector could be made to count the number of logs, metrics, and traces that do not have the deployment environment attribute.</p><p>A very simple example with the output of being able to break down data usage by deployment environment.</p><h2 id=considerations-with-connectors>Considerations with connectors</h2><p>A connector only accepts data exported from one pipeline and receiver by another pipeline, this means you may have to consider how you construct your collector config to take advantage of it.</p><h2 id=references>References</h2><ol><li><a href=https://opentelemetry.io/docs/collector/configuration/#connectors rel=external target=_blank><strong>https://opentelemetry.io/docs/collector/configuration/#connectors</strong></a></li><li><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/countconnector rel=external target=_blank><strong>https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/countconnector</strong></a></li></ol></div></div><hr><h2 id=configuration-check-in>Configuration Check-in</h2><p>That&rsquo;s processors covered, let&rsquo;s check our configuration changes.</p><hr><div class=expand><input type=checkbox id=R-expand-24e347d13b3b40349bb2b9305389e46c aria-controls=R-expandcontent-24e347d13b3b40349bb2b9305389e46c>
<label class=expand-label for=R-expand-24e347d13b3b40349bb2b9305389e46c><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> <span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>Review your configuration</span></span></label><div id=R-expandcontent-24e347d13b3b40349bb2b9305389e46c class=expand-content><div class=tab-panel data-tab-group=c6fbf184cb7b64e6c80e56c0715a75e9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configyaml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c6fbf184cb7b64e6c80e56c0715a75e9","configyaml")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div data-tab-item=configyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" hl_lines=58-68 linenos=table><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=hl><span class=lnt>58
</span></span><span class=hl><span class=lnt>59
</span></span><span class=hl><span class=lnt>60
</span></span><span class=hl><span class=lnt>61
</span></span><span class=hl><span class=lnt>62
</span></span><span class=hl><span class=lnt>63
</span></span><span class=hl><span class=lnt>64
</span></span><span class=hl><span class=lnt>65
</span></span><span class=hl><span class=lnt>66
</span></span><span class=hl><span class=lnt>67
</span></span><span class=hl><span class=lnt>68
</span></span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># process:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>attributes/conf</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>participant.name</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;INSERT_YOUR_NAME_HERE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></div><hr><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-exporters>OpenTelemetry Collector Exporters</h1><p>An exporter, which can be push or pull-based, is how you send data to one or more backends/destinations. Exporters may support one or more data sources.</p><p>For this workshop, we will be using the <a href=https://opentelemetry.io/docs/specs/otel/protocol/exporter/ rel=external target=_blank><strong>otlphttp</strong></a> exporter. The OpenTelemetry Protocol (OTLP) is a vendor-neutral, standardised protocol for transmitting telemetry data. The OTLP exporter sends data to a server that implements the OTLP protocol. The OTLP exporter supports both <a href=https://grpc.io/ rel=external target=_blank><strong>gRPC</strong></a> and <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview rel=external target=_blank><strong>HTTP</strong></a>/<a href=https://www.json.org/json-en.html rel=external target=_blank><strong>JSON</strong></a> protocols.</p><pre class="mermaid align-center">
%%{
  init:{
    &#34;theme&#34;:&#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    style Exporters fill:#e20082,stroke:#333,stroke-width:4px,color:#fff
    subgraph Collector
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of OpenTelemetry Collector Exporters</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-exporters>OpenTelemetry Collector Exporters</h1><h2 id=otlp-http-exporter>OTLP HTTP Exporter</h2><p>To send metrics over HTTP to Splunk Observability Cloud, we will need to configure the <strong>otlphttp</strong> exporter.</p><p>Let&rsquo;s edit our <code>/etc/otelcol-contrib/config.yaml</code> file and configure the <strong>otlphttp</strong> exporter. Insert the following YAML under the <strong>exporters</strong> section, taking care to indent by two spaces e.g.</p><p>We will also change the verbosity of the logging exporter to prevent the disk from filling up. The default of <code>detailed</code> is very noisy.</p><div class="highlight wrap-code" hl_lines=3-4><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=l>otlphttp/splunk:</span></span></span></code></pre></div><p>Next, we need to define the <code>metrics_endpoint</code> and configure the target URL.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>If you are an attendee at a Splunk-hosted workshop, the instance you are using has already been configured with a Realm environment variable. We will reference that environment variable in our configuration file. Otherwise, you will need to create a new environment variable and set the Realm e.g.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>REALM</span><span class=o>=</span><span class=s2>&#34;us1&#34;</span></span></span></code></pre></div></div></div><p>The URL to use is <code>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</code>. (Splunk has Realms in key geographical locations around the world for data residency).</p><p>The <strong>otlphttp</strong> exporter can also be configured to send traces and logs by defining a target URL for <code>traces_endpoint</code> and <code>logs_endpoint</code> respectively. Configuring these is outside the scope of this workshop.</p><div class="highlight wrap-code" hl_lines=5><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp/splunk</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>metrics_endpoint</span><span class=p>:</span><span class=w> </span><span class=l>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</span></span></span></code></pre></div><p>By default, <code>gzip</code> compression is enabled for all endpoints. This can be disabled by setting <code>compression: none</code> in the exporter configuration. We will leave compression enabled for this workshop and accept the default as this is the most efficient way to send data.</p><p>To send metrics to Splunk Observability Cloud, we need to use an Access Token. This can be done by creating a new token in the Splunk Observability Cloud UI. For more information on how to create a token, see <a href=https://docs.splunk.com/Observability/admin/authentication-tokens/org-tokens.html rel=external target=_blank>Create a token</a>. The token needs to be of type <strong>INGEST</strong>.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>If you are an attendee at a Splunk-hosted workshop, the instance you are using has already been configured with an Access Token (which has been set as an environment variable). We will reference that environment variable in our configuration file. Otherwise, you will need to create a new token and set it as an environment variable e.g.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>ACCESS_TOKEN</span><span class=o>=</span>&lt;replace-with-your-token&gt;</span></span></code></pre></div></div></div><p>The token is defined in the configuration file by inserting <code>X-SF-TOKEN: ${env:ACCESS_TOKEN}</code> under a <code>headers:</code> section:</p><div class="highlight wrap-code" hl_lines=6-8><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp/splunk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics_endpoint</span><span class=p>:</span><span class=w> </span><span class=l>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>X-SF-TOKEN</span><span class=p>:</span><span class=w> </span><span class=l>${env:ACCESS_TOKEN}</span></span></span></code></pre></div><h2 id=configuration-check-in>Configuration Check-in</h2><p>Now that we&rsquo;ve covered exporters, let&rsquo;s check our configuration changes:</p><hr><div class=expand><input type=checkbox id=R-expand-1f474bb3f5d368f074c9c576a32b3bcf aria-controls=R-expandcontent-1f474bb3f5d368f074c9c576a32b3bcf>
<label class=expand-label for=R-expand-1f474bb3f5d368f074c9c576a32b3bcf><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> <span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>Review your configuration</span></span></label><div id=R-expandcontent-1f474bb3f5d368f074c9c576a32b3bcf class=expand-content><div class=tab-panel data-tab-group=f54776bb97589125e8cf3c63138e7af1><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configyaml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f54776bb97589125e8cf3c63138e7af1","configyaml")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div data-tab-item=configyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" hl_lines=72-76 linenos=table><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=hl><span class=lnt>72
</span></span><span class=hl><span class=lnt>73
</span></span><span class=hl><span class=lnt>74
</span></span><span class=hl><span class=lnt>75
</span></span><span class=hl><span class=lnt>76
</span></span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># process:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>attributes/conf</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>participant.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;INSERT_YOUR_NAME_HERE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>otlphttp/splunk</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>metrics_endpoint</span><span class=p>:</span><span class=w> </span><span class=l>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>X-SF-TOKEN</span><span class=p>:</span><span class=w> </span><span class=l>${env:ACCESS_TOKEN}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></div><hr><p>Of course, you can easily configure the <code>metrics_endpoint</code> to point to any other solution that supports the <strong>OTLP</strong> protocol.</p><p>Next, we need to enable the receivers, processors and exporters we have just configured in the service section of the <code>config.yaml</code>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><p>The <strong>Service</strong> section is used to configure what components are enabled in the Collector based on the configuration found in the receivers, processors, exporters, and extensions sections.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>If a component is configured, but not defined within the <strong>Service</strong> section then it is <strong>not</strong> enabled.</p></div></div><p>The service section consists of three sub-sections:</p><ul><li>extensions</li><li>pipelines</li><li>telemetry</li></ul><p>In the default configuration, the extension section has been configured to enable <code>health_check</code>, <code>pprof</code> and <code>zpages</code>, which we configured in the Extensions module earlier.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></div><p>So lets configure our Metric Pipeline!</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of OpenTelemetry Collector Service</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><h2 id=hostmetrics-receiver>Hostmetrics Receiver</h2><p>If you recall from the Receivers portion of the workshop, we defined the <a href=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/3-receivers/index.html#host-metrics-receiver><strong>Host Metrics Receiver</strong></a> to generate metrics about the host system, which are scraped from various sources. To enable the receiver, we must include the <code>hostmetrics</code> receiver in the metrics pipeline.</p><p>In the <code>metrics</code> pipeline, add <code>hostmetrics</code> to the metrics <code>receivers</code> section.</p><div class="highlight wrap-code" hl_lines=11><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><h2 id=prometheus-internal-receiver>Prometheus Internal Receiver</h2><p>Earlier in the workshop, we also renamed the <code>prometheus</code> receiver to reflect that is was collecting metrics internal to the collector, renaming it to <code>prometheus/internal</code>.</p><p>We now need to enable the <code>prometheus/internal</code> receiver under the metrics pipeline. Update the <code>receivers</code> section to include <code>prometheus/internal</code> under the <code>metrics</code> pipeline:</p><div class="highlight wrap-code" hl_lines=11><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><h2 id=resource-detection-processor>Resource Detection Processor</h2><p>We also added <code>resourcedetection/system</code> and <code>resourcedetection/ec2</code> processors so that the collector can capture the instance hostname and AWS/EC2 metadata. We now need to enable these two processors under the metrics pipeline.</p><p>Update the <code>processors</code> section to include <code>resourcedetection/system</code> and <code>resourcedetection/ec2</code> under the <code>metrics</code> pipeline:</p><div class="highlight wrap-code" hl_lines=12><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch, resourcedetection/system, resourcedetection/ec2]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><h2 id=attributes-processor>Attributes Processor</h2><p>Also in the Processors section of this workshop, we added the <code>attributes/conf</code> processor so that the collector will insert a new attribute called <code>participant.name</code> to all the metrics. We now need to enable this under the metrics pipeline.</p><p>Update the <code>processors</code> section to include <code>attributes/conf</code> under the <code>metrics</code> pipeline:</p><div class="highlight wrap-code" hl_lines=12><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch, resourcedetection/system, resourcedetection/ec2, attributes/conf]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><h2 id=otlp-http-exporter>OTLP HTTP Exporter</h2><p>In the Exporters section of the workshop, we configured the <code>otlphttp</code> exporter to send metrics to Splunk Observability Cloud. We now need to enable this under the metrics pipeline.</p><p>Update the <code>exporters</code> section to include <code>otlphttp/splunk</code> under the <code>metrics</code> pipeline:</p><div class="highlight wrap-code" hl_lines=13><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch, resourcedetection/system, resourcedetection/ec2, attributes/conf]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging, otlphttp/splunk]</span></span></span></code></pre></div><hr><div class=expand><input type=checkbox id=R-expand-5fc0eeb54f23ac4295fe4850e749c0f6 aria-controls=R-expandcontent-5fc0eeb54f23ac4295fe4850e749c0f6>
<label class=expand-label for=R-expand-5fc0eeb54f23ac4295fe4850e749c0f6><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> <span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Observing the collector internals</span></span></label><div id=R-expandcontent-5fc0eeb54f23ac4295fe4850e749c0f6 class=expand-content><p>The collector captures internal signals about its behavior this also includes additional signals from running components.
The reason for this is that components that make decisions about the flow of data need a way to surface that information
as metrics or traces.</p><h2 id=why-monitor-the-collector>Why monitor the collector?</h2><p>This is somewhat of a chicken and egg problem of, &ldquo;Who is watching the watcher?&rdquo;, but it is important that we can surface this information. Another interesting part of the collector&rsquo;s history is that it existed before the Go metrics&rsquo; SDK was considered stable so the collector exposes a Prometheus endpoint to provide this functionality for the time being.</p><h2 id=considerations>Considerations</h2><p>Monitoring the internal usage of each running collector in your organization can contribute a significant amount of new Metric Time Series (MTS). The Splunk distribution has curated these metrics for you and would be able to help forecast the expected increases.</p><h2 id=the-ninja-zone>The Ninja Zone</h2><p>To expose the internal observability of the collector, some additional settings can be adjusted:</p><div class=tab-panel data-tab-group=6360aaf5446666b8aace1e9ebfce8597><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=telemetry-schema class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6360aaf5446666b8aace1e9ebfce8597","telemetry-schema")'>
<span class=tab-nav-text>telemetry schema</span>
</button>
<button data-tab-item=example-configyml class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("6360aaf5446666b8aace1e9ebfce8597","example-configyml")'>
<span class=tab-nav-text>example-config.yml</span></button></div><div class=tab-content-container><div data-tab-item=telemetry-schema class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>telemetry</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>&lt;info|warn|error&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>development</span><span class=p>:</span><span class=w> </span><span class=l>&lt;true|false&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>encoding</span><span class=p>:</span><span class=w> </span><span class=l>&lt;console|json&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disable_caller</span><span class=p>:</span><span class=w> </span><span class=l>&lt;true|false&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disable_stacktrace</span><span class=p>:</span><span class=w> </span><span class=l>&lt;true|false&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>output_paths</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>&lt;stdout|stderr&gt;, paths...]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>error_output_paths</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>&lt;stdout|stderr&gt;, paths...]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>initial_fields</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>&lt;none|basic|normal|detailed&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Address binds the promethues endpoint to scrape</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class=l>&lt;hostname:port&gt;</span></span></span></code></pre></div></div></div><div data-tab-item=example-configyml class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>telemetry</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>info</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>encoding</span><span class=p>:</span><span class=w> </span><span class=l>json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disable_stacktrace</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>initial_fields</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>instance.name</span><span class=p>:</span><span class=w> </span><span class=l>${env:INSTANCE}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class=l>localhost:8888 </span></span></span></code></pre></div></div></div></div></div><h2 id=references>References</h2><ol><li><a href=https://opentelemetry.io/docs/collector/configuration/#service rel=external target=_blank>https://opentelemetry.io/docs/collector/configuration/#service</a></li></ol></div></div><hr><h2 id=final-configuration>Final configuration</h2><hr><div class=expand><input type=checkbox id=R-expand-f90e9d28982e963d62d78b8ee4cfe7ad aria-controls=R-expandcontent-f90e9d28982e963d62d78b8ee4cfe7ad>
<label class=expand-label for=R-expand-f90e9d28982e963d62d78b8ee4cfe7ad><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> <span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>Review your final configuration</span></span></label><div id=R-expandcontent-f90e9d28982e963d62d78b8ee4cfe7ad class=expand-content><div class=tab-panel data-tab-group=587a04b4f9a696c98fcc564d43a219cb><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configyaml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("587a04b4f9a696c98fcc564d43a219cb","configyaml")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div data-tab-item=configyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" linenos=table><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># process:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>attributes/conf</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>participant.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;INSERT_YOUR_NAME_HERE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp/splunk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics_endpoint</span><span class=p>:</span><span class=w> </span><span class=l>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>X-SF-TOKEN</span><span class=p>:</span><span class=w> </span><span class=l>${env:ACCESS_TOKEN}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch, resourcedetection/system, resourcedetection/ec2, attributes/conf] </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging, otlphttp/splunk]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></div><hr><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Tip</div><div class=box-content><p>It is recommended that you validate your configuration file before restarting the collector. You can do this by using the built-in <code>validate</code> command:</p><div class=tab-panel data-tab-group=c7e96dadebce60c845fa826d9fa154b2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c7e96dadebce60c845fa826d9fa154b2","command")'>
<span class=tab-nav-text>Command</span>
</button>
<button data-tab-item=example-error-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("c7e96dadebce60c845fa826d9fa154b2","example-error-output")'>
<span class=tab-nav-text>Example error output</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>otelcol-contrib validate --config<span class=o>=</span>file:/etc/otelcol-contrib/config.yaml</span></span></code></pre></div></div></div><div data-tab-item=example-error-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Error: failed to get config: cannot unmarshal the configuration: 1 error(s) decoding:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>* error decoding &#39;processors&#39;: error reading configuration for &#34;attributes/conf&#34;: 1 error(s) decoding:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>* &#39;actions[0]&#39; has invalid keys: actions
</span></span><span class=line><span class=cl>2023/06/29 09:41:28 collector server run finished with error: failed to get config: cannot unmarshal the configuration: 1 error(s) decoding:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>* error decoding &#39;processors&#39;: error reading configuration for &#34;attributes/conf&#34;: 1 error(s) decoding:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>* &#39;actions[0]&#39; has invalid keys: actions</span></span></code></pre></div></div></div></div></div></div></div><p>Now that we have a working configuration, let&rsquo;s start the collector and then check to see what <a href=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/2-extensions/index.html#zpages>zPages</a> is reporting.</p><div class=tab-panel data-tab-group=33c4fe62bdb600c51cf67d2d43f8816a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("33c4fe62bdb600c51cf67d2d43f8816a","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>otelcol-contrib --config<span class=o>=</span>file:/etc/otelcol-contrib/config.yaml</span></span></code></pre></div></div></div></div></div><p><a href=#R-image-e9d9b2343a738e651f1d3a5fe52e1940 class=lightbox-link><img alt=pipelinez-full-config class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/6-service/5-otlphttp/../../images/pipelinez-full-config.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e9d9b2343a738e651f1d3a5fe52e1940><img alt=pipelinez-full-config class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/6-service/5-otlphttp/../../images/pipelinez-full-config.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=data-visualisations>Data Visualisations</h1><h2 id=splunk-observability-cloud>Splunk Observability Cloud</h2><p>Now that we have configured the OpenTelemetry Collector to send metrics to Splunk Observability Cloud, let&rsquo;s take a look at the data in Splunk Observability Cloud. If you have not received an invite to Splunk Observability Cloud, your instructor will provide you with login credentials.</p><p>Before that, let&rsquo;s make things a little more interesting and run a stress test on the instance. This in turn will light up the dashboards.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install stress
</span></span><span class=line><span class=cl><span class=k>while</span> true<span class=p>;</span> <span class=k>do</span> stress -c <span class=m>2</span> -t 40<span class=p>;</span> stress -d <span class=m>5</span> -t 40<span class=p>;</span> stress -m <span class=m>20</span> -t 40<span class=p>;</span> <span class=k>done</span></span></span></code></pre></div><p>Once you are logged into Splunk Observability Cloud, using the left-hand navigation, navigate to <strong>Dashboards</strong> from the main menu. This will take you to the Teams view. At the top of this view click on <strong>All Dashboards</strong> :</p><p><a href=#R-image-868349cdc711eceabc97a67377bbb8f0 class=lightbox-link><img alt=menu-dashboards class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/7-visualisation/../images/menu-dashboards.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-868349cdc711eceabc97a67377bbb8f0><img alt=menu-dashboards class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/7-visualisation/../images/menu-dashboards.png></a></p><p>In the search box, search for <strong>OTel Contrib</strong>:</p><p><a href=#R-image-36c2072735777d8b09fa2db5967b026e class=lightbox-link><img alt=search-dashboards class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/7-visualisation/../images/search-dashboards.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-36c2072735777d8b09fa2db5967b026e><img alt=search-dashboards class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/7-visualisation/../images/search-dashboards.png></a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>If the dashboard does not exist, then your instructor will be able to quickly add it. If you are not attending a Splunk hosted version of this workshop then the Dashboard Group to import can be found at the bottom of this page.</p></div></div><p>Click on the <strong>OTel Contrib Dashboard</strong> dashboard to open it:</p><p><a href=#R-image-d8a96b5371d8fcf2f72c63a3d20b24fe class=lightbox-link><img alt=otel-dashboard class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/7-visualisation/../images/otel-dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d8a96b5371d8fcf2f72c63a3d20b24fe><img alt=otel-dashboard class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/7-visualisation/../images/otel-dashboard.png></a></p><p>Click in the <strong>Participant Name</strong> box, at the top of the dashboard, and select the name you configured for <code>participant.name</code> in the <code>config.yaml</code> in the drop-down list or start typing the name to search for it:</p><p><a href=#R-image-114adca9a5487e484635622b9673172a class=lightbox-link><img alt=select-conf-attendee-name class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/7-visualisation/../images/select-participant-name.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-114adca9a5487e484635622b9673172a><img alt=select-conf-attendee-name class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/7-visualisation/../images/select-participant-name.png></a></p><p>You can now see the host metrics for the host upon which you configured the OpenTelemetry Collector.</p><p><a href=#R-image-a3f53403416f7e518f967bf90a83d32b class=lightbox-link><img alt=participant-dashboard class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/7-visualisation/../images/participant-dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a3f53403416f7e518f967bf90a83d32b><img alt=participant-dashboard class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/7-visualisation/../images/participant-dashboard.png></a></p><div class="box attachments cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Download Dashboard Group JSON for importing</div><ul class="attachments-files box-content"><li><a href=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/7-visualisation/index.files/OpenTelemetry-Contrib-Dashboard-Group.json>index.files/OpenTelemetry-Contrib-Dashboard-Group.json</a> (40 KB)</li></ul></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-development>OpenTelemetry Collector Development</h1><h2 id=developing-a-custom-component>Developing a custom component</h2><p>Building a component for the Open Telemetry Collector requires three key parts:</p><ol><li>The Configuration - <em>What values are exposed to the user to configure</em></li><li>The Factory - <em>Make the component using the provided values</em></li><li>The Business Logic - <em>What the component needs to do</em></li></ol><p>For this, we will use the example of building a component that works with Jenkins so that we can track important DevOps metrics of our project(s).</p><p>The metrics we are looking to measure are:</p><ol><li>Lead time for changes - <em>&ldquo;How long it takes for a commit to get into production&rdquo;</em></li><li>Change failure rate - <em>&ldquo;The percentage of deployments causing a failure in production&rdquo;</em></li><li>Deployment frequency - <em>&ldquo;How often a [team] successfully releases to production&rdquo;</em></li><li>Mean time to recover - <em>&ldquo;How long does it take for a [team] to recover from a failure in production&rdquo;</em></li></ol><p>These indicators were identified Google&rsquo;s DevOps Research and Assesment (DORA)[^1] team to help
show performance of a software development team. The reason for choosing <em>Jenkins CI</em> is that we remain in the same Open Source Software ecosystem which we can serve as the example for the vendor managed CI tools to adopt in future.</p><h2 id=instrument-vs-component>Instrument Vs Component</h2><p>There is something to consider when improving level of Observability within your organisation
since there are some trade offs that get made.</p><table><thead><tr><th></th><th>Pros</th><th>Cons</th></tr></thead><tbody><tr><td><strong>(Auto) Instrumented</strong></td><td>Does not require an external API to be monitored in order to observe the system.</td><td>Changing instrumentation requires changes to the project.</td></tr><tr><td></td><td>Gives system owners/developers to make changes in their observability.</td><td>Requires additional runtime dependancies.</td></tr><tr><td></td><td>Understands system context and can corrolate captured data with <em>Exemplars</em>.</td><td>Can impact performance of the system.</td></tr><tr><td><strong>Component</strong></td><td>- Changes to data names or semantics can be rolled out independently of the system&rsquo;s release cycle.</td><td>Breaking API changes require a coordinated release between system and collector.</td></tr><tr><td></td><td>Updating/extending data collected is a seemless user facing change.</td><td>Captured data semantics can unexpectedly break that does not align with a new system release.</td></tr><tr><td></td><td>Does not require the supporting teams to have a deep understanding of observability practice.</td><td>Strictly external / exposed information can be surfaced from the system.</td></tr></tbody></table><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of OpenTelemetry Collector Development</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-development>OpenTelemetry Collector Development</h1><h2 id=project-setup-hahahugoshortcode104s0hbhb>Project Setup <span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja</strong></span></span></h2><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>The time to finish this section of the workshop can vary depending on experience.</p><p>A complete solution can be found <a href=https://github.com/splunk/collector-workshop-example rel=external target=_blank><strong>here</strong></a> in case you&rsquo;re stuck or want to follow
along with the instructor.</p></div></div><p>To get started developing the new <em>Jenkins CI</em> receiver, we first need to set up a Golang project.
The steps to create your new Golang project is:</p><ol><li>Create a new directory named <code>${HOME}/go/src/jenkinscireceiver</code> and change into it<ol><li>The actual directory name or location is not strict, you can choose your own development directory to make it in.</li></ol></li><li>Initialize the golang module by going <code>go mod init splunk.conf/workshop/example/jenkinscireceiver</code><ol><li>This will create a file named <code>go.mod</code> which is used to track our direct and indirect dependencies</li><li>Eventually, there will be a <code>go.sum</code> which is the checksum value of the dependencies being imported.</li></ol></li></ol><div class=expand><input type=checkbox id=R-expand-57e46ce6fd72e34ff2337701b598a991 aria-controls=R-expandcontent-57e46ce6fd72e34ff2337701b598a991>
<label class=expand-label for=R-expand-57e46ce6fd72e34ff2337701b598a991><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> <span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>Review your go.mod</span></span></label><div id=R-expandcontent-57e46ce6fd72e34ff2337701b598a991 class=expand-content><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>module splunk.conf/workshop/example/jenkinscireceiver
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>go 1.20</span></span></code></pre></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-development>OpenTelemetry Collector Development</h1><h2 id=building-the-configuration>Building The Configuration</h2><p>The configuration portion of the component is how the user is able to have their inputs over the component,
so the values that is used for the configuration need to be:</p><ol><li>Intuitive for users to understand what that field controls</li><li>Be explicit in what is required and what is optional</li><li>Reuse common names and fields</li><li>Keep the options simple</li></ol><div class=tab-panel data-tab-group=5cd636afc54420d7c59647bc7926bb9c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=bad-config class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5cd636afc54420d7c59647bc7926bb9c","bad-config")'>
<span class=tab-nav-text>bad config</span>
</button>
<button data-tab-item=good-config class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("5cd636afc54420d7c59647bc7926bb9c","good-config")'>
<span class=tab-nav-text>good config</span></button></div><div class=tab-content-container><div data-tab-item=bad-config class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jenkins_server_addr</span><span class=p>:</span><span class=w> </span><span class=l>hostname</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jenkins_server_api_port</span><span class=p>:</span><span class=w> </span><span class=m>8089</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>10m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>filter_builds_by</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-awesome-build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class=l>amber</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>track</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>example.metric.1</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>example.metric.2</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>example.metric.3</span><span class=p>:</span><span class=w> </span><span class=kc>no</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>example.metric.4</span><span class=p>:</span><span class=w> </span><span class=kc>no</span></span></span></code></pre></div></div></div><div data-tab-item=good-config class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Required Values</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=l>http://my-jenkins-server:8089</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>auth</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>authenticator</span><span class=p>:</span><span class=w> </span><span class=l>basicauth/jenkins</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Optional Values</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example.metric.1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example.metric.2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example.metric.3</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example.metric.4</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span></span></span></code></pre></div></div></div></div></div><p>The bad configuration highlights how doing the opposite of the recommendations of configuration practices impacts the usability
of the component. It doesn&rsquo;t make it clear what field values should be, it includes features that can be pushed to existing processors,
and the field naming is not consistent with other components that exist in the collector.</p><p>The good configuration keeps the required values simple, reuses field names from other components, and ensures the component focuses on
just the interaction between Jenkins and the collector.</p><p>The code tab shows how much is required to be added by us and what is already provided for us by shared libraries within the collector.
These will be explained in more detail once we get to the business logic. The configuration should start off small and will change
once the business logic has started to include additional features that is needed.</p><h2 id=write-the-code>Write the code</h2><p>In order to implement the code needed for the configuration, we are going to create a new file named <code>config.go</code> with the following content:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/config/confighttp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver/scraperhelper&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;splunk.conf/workshop/example/jenkinscireceiver/internal/metadata&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Config</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// HTTPClientSettings contains all the values
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// that are commonly shared across all HTTP interactions
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// performed by the collector.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>confighttp</span><span class=p>.</span><span class=nx>HTTPClientSettings</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ScraperControllerSettings will allow us to schedule 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// how often to check for updates to builds.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>scraperhelper</span><span class=p>.</span><span class=nx>ScraperControllerSettings</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl>    <span class=c1>// MetricsBuilderConfig contains all the metrics
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// that can be configured.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>metadata</span><span class=p>.</span><span class=nx>MetricsBuilderConfig</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-development>OpenTelemetry Collector Development</h1><h2 id=component-review>Component Review</h2><p>To recap the type of component we will need to capture metrics from Jenkins:</p><div class=tab-panel data-tab-group=9997c8343d2c1236dfe2f6aca28af6b8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=extension class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9997c8343d2c1236dfe2f6aca28af6b8","extension")'>
<span class=tab-nav-text>Extension</span>
</button>
<button data-tab-item=receiver class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("9997c8343d2c1236dfe2f6aca28af6b8","receiver")'>
<span class=tab-nav-text>Receiver</span>
</button>
<button data-tab-item=processor class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("9997c8343d2c1236dfe2f6aca28af6b8","processor")'>
<span class=tab-nav-text>Processor</span>
</button>
<button data-tab-item=exporter class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("9997c8343d2c1236dfe2f6aca28af6b8","exporter")'>
<span class=tab-nav-text>Exporter</span>
</button>
<button data-tab-item=ninja-connectors class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("9997c8343d2c1236dfe2f6aca28af6b8","ninja-connectors")'>
<span class=tab-nav-text><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Connectors</span></span></span></button></div><div class=tab-content-container><div data-tab-item=extension class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p>The business use case an extension helps solves for are:</p><ol><li>Having shared functionality that requires runtime configuration</li><li>Indirectly helps with observing the runtime of the collector</li></ol><p>See <a href=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/2-extensions/index.html><strong>Extensions Overview</strong></a> for more details.</p></div></div><div data-tab-item=receiver class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>The business use case a receiver solves for:</p><ul><li>Fetching data from a remote source</li><li>Receiving data from remote source(s)</li></ul><p>This is commonly referred to <em>pull</em> vs <em>push</em> based data collection, and you read more about the details in the <a href=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/3-receivers/index.html>Receiver Overview</a>.</p></div></div><div data-tab-item=processor class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>The business use case a processor solves for is:</p><ul><li>Adding or removing data, fields, or values</li><li>Observing and making decisions on the data</li><li>Buffering, queueing, and reordering</li></ul><p>The thing to keep in mind is the data type flowing through a processor needs to forward
the same data type to its downstream components. Read through <a href=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/4-processors/index.html>Processor Overview</a> for the details.</p></div></div><div data-tab-item=exporter class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>The business use case an exporter solves for:</p><ul><li>Send the data to a tool, service, or storage</li></ul><p>The OpenTelemetry collector does not want to be &ldquo;backend&rdquo;, an all-in-one observability suite, but rather
keep to the principles that founded OpenTelemetry to begin with; A vendor agnostic Observability for all.
To help revisit the details, please read through <a href=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/5-exporters/index.html><strong>Exporter Overview</strong></a>.</p></div></div><div data-tab-item=ninja-connectors class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>This is a component type that was missed in the workshop since it is a relatively new addition to the collector, but the best way to think about a connector is that it is like a processor that allows it to be used across different telemetry types and pipelines. Meaning that a connector can accept data as logs, and output metrics, or accept metrics from one pipeline and provide metrics on the data it has observed.</p><p>The business case that a connector solves for:</p><ul><li>Converting from different telemetry types<ul><li>logs to metrics</li><li>traces to metrics</li><li>metrics to logs</li></ul></li><li>Observing incoming data and producing its own data<ul><li>Accepting metrics and generating analytical metrics of the data.</li></ul></li></ul><p>There was a brief overview within the <strong>Ninja</strong> section as part of the <a href=/observability-workshop/v5.68/en/ninja-workshops/3-opentelemetry-collector/4-processors/index.html>Processor Overview</a>,
and be sure what the project for updates for new connector components.</p></div></div></div></div><p>From the component overviews, it is clear that developing a pull-based receiver for Jenkins.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-development>OpenTelemetry Collector Development</h1><h3 id=designing-the-metrics>Designing The Metrics</h3><p>To help define and export the metrics captured by our receiver, we will be using, <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/cmd/mdatagen rel=external target=_blank><strong>mdatagen</strong></a>, a tool developed for the collector that turns YAML defined metrics into code.</p><div class=tab-panel data-tab-group=05f9105d73a966dc27637ab23af1ad56><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=metadatayaml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("05f9105d73a966dc27637ab23af1ad56","metadatayaml")'>
<span class=tab-nav-text>metadata.yaml</span>
</button>
<button data-tab-item=gengo class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("05f9105d73a966dc27637ab23af1ad56","gengo")'>
<span class=tab-nav-text>gen.go</span></button></div><div class=tab-content-container><div data-tab-item=metadatayaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Type defines the name to reference the component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># in the configuration file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>jenkins</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Status defines the component type and the stability level</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>status</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>class</span><span class=p>:</span><span class=w> </span><span class=l>receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stability</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>development</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>metrics]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Attributes are the expected fields reported</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># with the exported values.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job.name</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>The name of the associated Jenkins job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job.status</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>Shows if the job had passed, or failed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enum</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>failed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>success</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>unknown</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Metrics defines all the pontentially exported values from this receiver. </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jenkins.jobs.count</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>Provides a count of the total number of configured jobs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{Count}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>gauge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value_type</span><span class=p>:</span><span class=w> </span><span class=l>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jenkins.job.duration</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>Show the duration of the job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;s&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>gauge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value_type</span><span class=p>:</span><span class=w> </span><span class=l>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>job.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>job.status</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jenkins.job.commit_delta</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>The calculation difference of the time job was finished minus commit timestamp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;s&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>gauge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value_type</span><span class=p>:</span><span class=w> </span><span class=l>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>job.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>job.status</span></span></span></code></pre></div></div></div><div data-tab-item=gengo class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// To generate the additional code needed to capture metrics, 
</span></span></span><span class=line><span class=cl><span class=c1>// the following command to be run from the shell:
</span></span></span><span class=line><span class=cl><span class=c1>//  go generate -x ./...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>//go:generate go run github.com/open-telemetry/opentelemetry-collector-contrib/cmd/mdatagen@v0.80.0 metadata.yaml
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// There is no code defined within this file.
</span></span></span></code></pre></div></div></div></div></div><p>Create these files within the project folder before continuing onto the next section.</p><h2 id=building-the-factory>Building The Factory</h2><p>The Factory is a software design pattern that effectively allows for an object, in this case a <code>jenkinscireceiver</code>, to be created dynamically with the provided configuration. To use a more real-world example, it would be going to a phone store, asking for a phone
that matches your exact description, and then providing it to you.</p><p>Run the following command <code>go generate -x ./...</code> , it will create a new folder, <code>jenkinscireceiver/internal/metadata</code>, that contains all code required to export the defined metrics. The required code is:</p><div class=tab-panel data-tab-group=5d21821161f466c1a964c63da35709c0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=factorygo class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5d21821161f466c1a964c63da35709c0","factorygo")'>
<span class=tab-nav-text>factory.go</span>
</button>
<button data-tab-item=configgo class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("5d21821161f466c1a964c63da35709c0","configgo")'>
<span class=tab-nav-text>config.go</span>
</button>
<button data-tab-item=scrapergo class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("5d21821161f466c1a964c63da35709c0","scrapergo")'>
<span class=tab-nav-text>scraper.go</span>
</button>
<button data-tab-item=build-configyaml class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("5d21821161f466c1a964c63da35709c0","build-configyaml")'>
<span class=tab-nav-text>build-config.yaml</span>
</button>
<button data-tab-item=project-layout class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("5d21821161f466c1a964c63da35709c0","project-layout")'>
<span class=tab-nav-text>project layout</span></button></div><div class=tab-content-container><div data-tab-item=factorygo class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;errors&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/component&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/config/confighttp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver/scraperhelper&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;splunk.conf/workshop/example/jenkinscireceiver/internal/metadata&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewFactory</span><span class=p>()</span> <span class=nx>receiver</span><span class=p>.</span><span class=nx>Factory</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>receiver</span><span class=p>.</span><span class=nf>NewFactory</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>metadata</span><span class=p>.</span><span class=nx>Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>newDefaultConfig</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>receiver</span><span class=p>.</span><span class=nf>WithMetrics</span><span class=p>(</span><span class=nx>newMetricsReceiver</span><span class=p>,</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>MetricsStability</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>newMetricsReceiver</span><span class=p>(</span><span class=nx>_</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>set</span> <span class=nx>receiver</span><span class=p>.</span><span class=nx>CreateSettings</span><span class=p>,</span> <span class=nx>cfg</span> <span class=nx>component</span><span class=p>.</span><span class=nx>Config</span><span class=p>,</span> <span class=nx>consumer</span> <span class=nx>consumer</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>)</span> <span class=p>(</span><span class=nx>receiver</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Convert the configuration into the expected type
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>conf</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>cfg</span><span class=p>.(</span><span class=o>*</span><span class=nx>Config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>!</span><span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;can not convert config&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>sc</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>newScraper</span><span class=p>(</span><span class=nx>conf</span><span class=p>,</span> <span class=nx>set</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>NewScraperControllerReceiver</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&amp;</span><span class=nx>conf</span><span class=p>.</span><span class=nx>ScraperControllerSettings</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>set</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>consumer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>AddScraper</span><span class=p>(</span><span class=nx>sc</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div data-tab-item=configgo class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/config/confighttp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver/scraperhelper&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;splunk.conf/workshop/example/jenkinscireceiver/internal/metadata&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Config</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// HTTPClientSettings contains all the values
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// that are commonly shared across all HTTP interactions
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// performed by the collector.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>confighttp</span><span class=p>.</span><span class=nx>HTTPClientSettings</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ScraperControllerSettings will allow us to schedule 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// how often to check for updates to builds.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>scraperhelper</span><span class=p>.</span><span class=nx>ScraperControllerSettings</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl>    <span class=c1>// MetricsBuilderConfig contains all the metrics
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// that can be configured.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>metadata</span><span class=p>.</span><span class=nx>MetricsBuilderConfig</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>newDefaultConfig</span><span class=p>()</span> <span class=nx>component</span><span class=p>.</span><span class=nx>Config</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>Config</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ScraperControllerSettings</span><span class=p>:</span> <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>NewDefaultScraperControllerSettings</span><span class=p>(</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>Type</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>HTTPClientSettings</span><span class=p>:</span>        <span class=nx>confighttp</span><span class=p>.</span><span class=nf>NewDefaultHTTPClientSettings</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=nx>MetricsBuilderConfig</span><span class=p>:</span>      <span class=nx>metadata</span><span class=p>.</span><span class=nf>DefaultMetricsBuilderConfig</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div data-tab-item=scrapergo class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>scraper</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>newScraper</span><span class=p>(</span><span class=nx>cfg</span> <span class=o>*</span><span class=nx>Config</span><span class=p>,</span> <span class=nx>set</span> <span class=nx>receiver</span><span class=p>.</span><span class=nx>CreateSettings</span><span class=p>)</span> <span class=p>(</span><span class=nx>scraperhelper</span><span class=p>.</span><span class=nx>Scraper</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Create a our scraper with our values 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>s</span> <span class=o>:=</span> <span class=nx>scraper</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// To be filled in later
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>NewScraper</span><span class=p>(</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>Type</span><span class=p>,</span> <span class=nx>s</span><span class=p>.</span><span class=nx>scrape</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>scraper</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// To be filled in
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nx>pmetrics</span><span class=p>.</span><span class=nf>NewMetrics</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div data-tab-item=build-configyaml class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>dist</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>otelcol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Conf workshop collector&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>output_path</span><span class=p>:</span><span class=w> </span><span class=l>./dist</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>v0.0.0-experimental</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/extension/basicauthextension v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/extension/healthcheckextension v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/receiver/otlpreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/jaegerreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/prometheusreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>splunk.conf/workshop/example/jenkinscireceiver v0.0.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./jenkinscireceiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/processor/batchprocessor v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/loggingexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/otlpexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/otlphttpexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># This replace is a go directive that allows for redefine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># where to fetch the code to use since the default would be from a remote project.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>replaces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>splunk.conf/workshop/example/jenkinscireceiver =&gt; ./jenkinscireceiver</span></span></span></code></pre></div></div></div><div data-tab-item=project-layout class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>├── build-config.yaml
</span></span><span class=line><span class=cl>└── jenkinscireceiver
</span></span><span class=line><span class=cl>    ├── go.mod
</span></span><span class=line><span class=cl>    ├── config.go
</span></span><span class=line><span class=cl>    ├── factory.go
</span></span><span class=line><span class=cl>    ├── scraper.go
</span></span><span class=line><span class=cl>    └── internal
</span></span><span class=line><span class=cl>      └── metadata</span></span></code></pre></div></div></div></div></div><p>Once you have written these files into the project with the expected contents run, <code>go mod tidy</code>, which will fetch all the remote dependencies and update <code>go.mod</code> and generate the <code>go.sum</code> files.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-development>OpenTelemetry Collector Development</h1><h2 id=building-the-business-logic>Building The Business Logic</h2><p>At this point, we have a custom component that currently does nothing so we need to add in the required
logic to capture this data from Jenkins.</p><p>From this point, the steps that we need to take are:</p><ol><li>Create a client that connect to Jenkins</li><li>Capture all the configured jobs</li><li>Report the status of the last build for the configured job</li><li>Calculate the time difference between commit timestamp and job completion.</li></ol><p>The changes will be made to <code>scraper.go</code>.</p><div class=tab-panel data-tab-group=18d729eb6941ae26ecaa9766e25d7e67><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=add-jenkins-client class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("18d729eb6941ae26ecaa9766e25d7e67","add-jenkins-client")'>
<span class=tab-nav-text><ol><li>Add Jenkins client</li></ol></span></button>
<button data-tab-item=capture-all-configured-jobs class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("18d729eb6941ae26ecaa9766e25d7e67","capture-all-configured-jobs")'>
<span class=tab-nav-text><ol start=2><li>Capture all configured jobs</li></ol></span></button>
<button data-tab-item=report-the-status-of-each-job class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("18d729eb6941ae26ecaa9766e25d7e67","report-the-status-of-each-job")'>
<span class=tab-nav-text><ol start=3><li>Report the status of each job</li></ol></span></button>
<button data-tab-item=report-the-delta class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("18d729eb6941ae26ecaa9766e25d7e67","report-the-delta")'>
<span class=tab-nav-text><ol start=4><li>Report the delta</li></ol></span></button></div><div class=tab-content-container><div data-tab-item=add-jenkins-client class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p>To be able to connect to the Jenkins server, we will be using the package,
<a href=https://pkg.go.dev/github.com/yosida95/golang-jenkins rel=external target=_blank>&ldquo;github.com/yosida95/golang-jenkins&rdquo;</a>,
which provides the functionality required to read data from the jenkins server.</p><p>Then we are going to utilise some of the helper functions from the,
<a href=https://pkg.go.dev/go.opentelemetry.io/collector/receiver/scraperhelper rel=external target=_blank>&ldquo;go.opentelemetry.io/collector/receiver/scraperhelper&rdquo;</a> ,
library to create a start function so that we can connect to the Jenkins server once component has finished starting.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>jenkins</span> <span class=s>&#34;github.com/yosida95/golang-jenkins&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/component&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/pdata/pmetric&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver/scraperhelper&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;splunk.conf/workshop/example/jenkinscireceiver/internal/metadata&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>scraper</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>mb</span>     <span class=o>*</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>MetricsBuilder</span>
</span></span><span class=line><span class=cl>    <span class=nx>client</span> <span class=o>*</span><span class=nx>jenkins</span><span class=p>.</span><span class=nx>Jenkins</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>newScraper</span><span class=p>(</span><span class=nx>cfg</span> <span class=o>*</span><span class=nx>Config</span><span class=p>,</span> <span class=nx>set</span> <span class=nx>receiver</span><span class=p>.</span><span class=nx>CreateSettings</span><span class=p>)</span> <span class=p>(</span><span class=nx>scraperhelper</span><span class=p>.</span><span class=nx>Scraper</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>s</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>scraper</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>mb</span> <span class=p>:</span> <span class=nx>metadata</span><span class=p>.</span><span class=nf>NewMetricsBuilder</span><span class=p>(</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>MetricsBuilderConfig</span><span class=p>,</span> <span class=nx>set</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>NewScraper</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>metadata</span><span class=p>.</span><span class=nx>Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>s</span><span class=p>.</span><span class=nx>scrape</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>WithStart</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>h</span> <span class=nx>component</span><span class=p>.</span><span class=nx>Host</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>cfg</span><span class=p>.</span><span class=nf>ToClient</span><span class=p>(</span><span class=nx>h</span><span class=p>,</span> <span class=nx>set</span><span class=p>.</span><span class=nx>TelemetrySettings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=c1>// The collector provides a means of injecting authentication
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// on our behalf, so this will ignore the libraries approach
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// and use the configured http client with authentication.
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>s</span><span class=p>.</span><span class=nx>client</span> <span class=p>=</span> <span class=nx>jenkins</span><span class=p>.</span><span class=nf>NewJenkins</span><span class=p>(</span><span class=kc>nil</span><span class=p>,</span> <span class=nx>cfg</span><span class=p>.</span><span class=nx>Endpoint</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nx>s</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>SetHTTPClient</span><span class=p>(</span><span class=nx>client</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>        <span class=p>}),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>scraper</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// To be filled in
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nx>pmetric</span><span class=p>.</span><span class=nf>NewMetrics</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>This finishes all the setup code that is required in order to initialise a Jenkins receiver.</p></div></div><div data-tab-item=capture-all-configured-jobs class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>From this point on, we will be focuses on the <code>scrape</code> method that has been waiting to be filled in.
This method will be run on each interval that is configured within the configuration (by default, every minute).</p><p>The reason we want to capture the number of jobs configured so we can see the growth of our Jenkins server,
and measure of many projects have onboarded. To do this we will call the jenkins client to list all jobs,
and if it reports an error, return that with no metrics, otherwise, emit the data from the metric builder.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>scraper</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>jobs</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>GetJobs</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Recording the timestamp to ensure
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// all captured data points within this scrape have the same value. 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>now</span> <span class=o>:=</span> <span class=nx>pcommon</span><span class=p>.</span><span class=nf>NewTimestampFromTime</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Casting to an int64 to match the expected type
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobsCountDataPoint</span><span class=p>(</span><span class=nx>now</span><span class=p>,</span> <span class=nb>int64</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>jobs</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// To be filled in
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>Emit</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div data-tab-item=report-the-status-of-each-job class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>In the last step, we were able to capture all jobs ands report the number of jobs
there was. Within this step, we are going to examine each job and use the report values
to capture metrics.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>scraper</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>jobs</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>GetJobs</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Recording the timestamp to ensure
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// all captured data points within this scrape have the same value. 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>now</span> <span class=o>:=</span> <span class=nx>pcommon</span><span class=p>.</span><span class=nf>NewTimestampFromTime</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Casting to an int64 to match the expected type
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobsCountDataPoint</span><span class=p>(</span><span class=nx>now</span><span class=p>,</span> <span class=nb>int64</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>jobs</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>job</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>jobs</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Ensure we have valid results to start off with
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>build</span>  <span class=p>=</span> <span class=nx>job</span><span class=p>.</span><span class=nx>LastCompletedBuild</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusUnknown</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// This will check the result of the job, however,
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// since the only defined attributes are 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// `success`, `failure`, and `unknown`. 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// it is assume that anything did not finish 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// with a success or failure to be an unknown status.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=nx>build</span><span class=p>.</span><span class=nx>Result</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s>&#34;aborted&#34;</span><span class=p>,</span> <span class=s>&#34;not_built&#34;</span><span class=p>,</span> <span class=s>&#34;unstable&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusUnknown</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s>&#34;success&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusSuccess</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s>&#34;failure&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusFailed</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobDurationDataPoint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>now</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nb>int64</span><span class=p>(</span><span class=nx>job</span><span class=p>.</span><span class=nx>LastCompletedBuild</span><span class=p>.</span><span class=nx>Duration</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nx>job</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>Emit</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div data-tab-item=report-the-delta class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>The final step is to calculate how long it took from
commit to job completion to help infer our DORA metrics.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>scraper</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>jobs</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>GetJobs</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Recording the timestamp to ensure
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// all captured data points within this scrape have the same value. 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>now</span> <span class=o>:=</span> <span class=nx>pcommon</span><span class=p>.</span><span class=nf>NewTimestampFromTime</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Casting to an int64 to match the expected type
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobsCountDataPoint</span><span class=p>(</span><span class=nx>now</span><span class=p>,</span> <span class=nb>int64</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>jobs</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>job</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>jobs</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Ensure we have valid results to start off with
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>build</span>  <span class=p>=</span> <span class=nx>job</span><span class=p>.</span><span class=nx>LastCompletedBuild</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusUnknown</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Previous step here
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=c1>// Ensure that the `ChangeSet` has values
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// set so there is a valid value for us to reference
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>build</span><span class=p>.</span><span class=nx>ChangeSet</span><span class=p>.</span><span class=nx>Items</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Making the assumption that the first changeset
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// item is the most recent change.
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>change</span> <span class=o>:=</span> <span class=nx>build</span><span class=p>.</span><span class=nx>ChangeSet</span><span class=p>.</span><span class=nx>Items</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Record the difference from the build time
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// compared against the change timestamp.
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobCommitDeltaDataPoint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>now</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nb>int64</span><span class=p>(</span><span class=nx>build</span><span class=p>.</span><span class=nx>Timestamp</span><span class=o>-</span><span class=nx>change</span><span class=p>.</span><span class=nx>Timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nx>job</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>Emit</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Once all of these steps have been completed, you now have built a custom Jenkins CI receiver!</p><h2 id=whats-next>Whats next?</h2><p>There are more than likely features that would be desired from component that you can think of, like:</p><ul><li>Can I include the branch name that the job used?</li><li>Can I include the project name for the job?</li><li>How I calculate the collective job durations for project?</li><li>How do I validate the changes work?</li></ul><p>Please take this time to play around, break it, change things around, or even try to capture logs from the builds.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section></section><article class=default><header class=headline></header><h1 id=splunk-synthetic-scripting>Splunk Synthetic Scripting</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>45 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Robert Castley</span></span><p>Proactively monitor the performance of your web app before problems affect your users. With <strong>Splunk Synthetic Monitoring</strong>, technical and business teams create detailed tests to proactively monitor the speed and reliability of websites, web apps, and resources over time, at any stage in the development cycle.</p><p><strong>Splunk Synthetic Monitoring</strong> offers the most comprehensive and in-depth capabilities for uptime and web performance optimization as part of the only complete observability suite, Splunk Observability Cloud.</p><p>Easily set up monitoring for APIs, service endpoints and end-user experience. With <strong>Splunk Synthetic Monitoring</strong>, go beyond basic uptime and performance monitoring and focus on proactively finding and fixing issues, optimizing web performance, and ensuring customers get the best user experience.</p><p>With <strong>Splunk Synthetic Monitoring</strong> you can:</p><ul><li>Detect and resolve issues fast across critical user flows, business transactions and API endpoints</li><li>Prevent web performance issues from affecting customers with an intelligent web optimization engine</li><li>And improve the performance of all page resources and third-party dependencies</li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Splunk Synthetic Scripting</h1><article class=default><header class=headline></header><h1 id=1-real-browser-test>1. Real Browser Test</h1><h2 id=introduction>Introduction</h2><p>This workshop walks you through using the <a href=https://developer.chrome.com/docs/devtools/recorder/ rel=external target=_blank>Chrome DevTools Recorder</a> to create a synthetic transaction against a Splunk demonstration instance.</p><p>The exported JSON from the Chrome DevTools Recorder will then be used to create a Splunk Synthetic Monitoring Real Browser Test.</p><p>In addition, you will also get to learn other Splunk Synthetic Monitoring checks like <a href=https://docs.splunk.com/Observability/synthetics/api-test/api-test.html rel=external target=_blank>API Test</a> and <a href=https://docs.splunk.com/Observability/synthetics/uptime-test/uptime-test.html rel=external target=_blank>Uptime Test</a>.</p><h2 id=pre-requisites>Pre-requisites</h2><ul><li>Google Chrome Browser installed</li><li>Access to Splunk Observability Cloud</li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of 1. Real Browser Test</h1><article class=default><header class=headline></header><h1 id=11-recording-a-test>1.1 Recording a test</h1><h2 id=open-the-starting-url>Open the starting URL</h2><p>Open the starting URL for the workshop in Chrome. Click on the appropriate link below to open the site in a new tab.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>The starting URL for the workshop is different for <strong>EMEA</strong> and <strong>AMER/APAC</strong>. Please use the correct URL for your region.</p><div class=tab-panel data-tab-group=324b94eb4dd782b1f246b8555e6a746e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=emea-workshop-url class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("324b94eb4dd782b1f246b8555e6a746e","emea-workshop-url")'>
<span class=tab-nav-text>EMEA Workshop URL</span>
</button>
<button data-tab-item=amerapac-workshop-url class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("324b94eb4dd782b1f246b8555e6a746e","amerapac-workshop-url")'>
<span class=tab-nav-text>AMER/APAC Workshop URL</span></button></div><div class=tab-content-container><div data-tab-item=emea-workshop-url class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p><a href=https://online-boutique-eu.splunko11y.com/ rel=external target=_blank>https://online-boutique-eu.splunko11y.com/</a></p></div></div><div data-tab-item=amerapac-workshop-url class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><a href=https://online-boutique-us.splunko11y.com/ rel=external target=_blank>https://online-boutique-us.splunko11y.com/</a></p></div></div></div></div></div></div><h2 id=open-the-chrome-devtools-recorder>Open the Chrome DevTools Recorder</h2><p>Next, open the Developer Tools (in the new tab that was opened above) by pressing <code>Ctrl + Shift + I</code> on Windows or <code>Cmd + Option + I</code> on a Mac, then select <strong>Recorder</strong> from the top-level menu or the <strong>More tools</strong> flyout menu.</p><p><a href=#R-image-40a3eb0661d8ea73fd75ff08973af4ec class=lightbox-link><img alt="Open Recorder" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/open-recorder.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-40a3eb0661d8ea73fd75ff08973af4ec><img alt="Open Recorder" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/open-recorder.png></a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>Site elements might change depending on viewport width. Before recording, set your browser window to the correct width for the test you want to create (Desktop, Tablet, or Mobile). Change the DevTools &ldquo;dock side&rdquo; to pop out as a separate window if it helps.</p></div></div><h2 id=create-a-new-recording>Create a new recording</h2><p>With the Recorder panel open in the DevTools window. Click on the <span class="btn cstyle blue"><span><span class=title>Create a new recording</span></span></span> button to start.</p><p><a href=#R-image-936d61c40324dfa4bfd648492700606a class=lightbox-link><img alt=Recorder class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/recorder.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-936d61c40324dfa4bfd648492700606a><img alt=Recorder class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/recorder.png></a></p><p>For the <strong>Recording Name</strong> use your initials to prefix the name of the recording e.g. <strong><code>&lt;your initials></code> - Online Boutique</strong>. Click on <strong>Start Recording</strong> to start recording your actions.</p><p><a href=#R-image-393e16cb1b270c877806c610aaba6130 class=lightbox-link><img alt="Recording Name" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/recording-name.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-393e16cb1b270c877806c610aaba6130><img alt="Recording Name" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/recording-name.png></a></p><p>Now that we are recording, complete the following actions on the site:</p><ul><li>Click on <strong>Vintage Camera Lens</strong></li><li>Click on <strong>Add to Cart</strong></li><li>Click on <strong>Place Order</strong></li><li>Click on <strong>End recording</strong> in the Recorder panel.</li></ul><p><a href=#R-image-91eab211b1fac9392041b40d0d0feba1 class=lightbox-link><img alt="End Recording" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/end-recording.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-91eab211b1fac9392041b40d0d0feba1><img alt="End Recording" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/end-recording.png></a></p><h2 id=exporting-the-recording>Exporting the recording</h2><p>Click on the <strong>Export</strong> button:</p><p><a href=#R-image-e1449d4d16badd3063835d4e9ea39864 class=lightbox-link><img alt="Export button" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/export-button.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e1449d4d16badd3063835d4e9ea39864><img alt="Export button" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/export-button.png></a></p><p>Select <strong>JSON</strong> as the format, then click on <strong>Save</strong></p><p><a href=#R-image-d2ae6946d36aa920f57fd22a3edae513 class=lightbox-link><img alt="Export JSON" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/export-json.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d2ae6946d36aa920f57fd22a3edae513><img alt="Export JSON" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/export-json.png></a></p><p><a href=#R-image-e2ef4e0daa862667e0d8f186534ab1af class=lightbox-link><img alt="Save JSON" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/save-json.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e2ef4e0daa862667e0d8f186534ab1af><img alt="Save JSON" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/save-json.png></a></p><p><strong>Congratulations!</strong> You have successfully created a recording using the Chrome DevTools Recorder. Next, we will use this recording to create a Real Browser Test in Splunk Synthetic Monitoring.</p><hr><div class=expand><input type=checkbox id=R-expand-f5466b3c77458b3d5da79b8878012c6c aria-controls=R-expandcontent-f5466b3c77458b3d5da79b8878012c6c>
<label class=expand-label for=R-expand-f5466b3c77458b3d5da79b8878012c6c><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> Click here to view the JSON file</label><div id=R-expandcontent-f5466b3c77458b3d5da79b8878012c6c class=expand-content><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;RWC - Online Boutique&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;steps&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;setViewport&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;width&#34;</span><span class=p>:</span> <span class=mi>1430</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;height&#34;</span><span class=p>:</span> <span class=mi>1016</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;deviceScaleFactor&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;isMobile&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;hasTouch&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;isLandscape&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;navigate&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://online-boutique-eu.splunko11y.com/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;assertedEvents&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;navigation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://online-boutique-eu.splunko11y.com/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Online Boutique&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;click&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;main&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;selectors&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;div:nth-of-type(2) &gt; div:nth-of-type(2) a &gt; div&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;xpath//html/body/main/div/div/div[2]/div[2]/div/a/div&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;pierce/div:nth-of-type(2) &gt; div:nth-of-type(2) a &gt; div&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetY&#34;</span><span class=p>:</span> <span class=mi>170</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetX&#34;</span><span class=p>:</span> <span class=mi>180</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;assertedEvents&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;navigation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://online-boutique-eu.splunko11y.com/product/66VCHSJNUP&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;click&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;main&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;selectors&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;aria/ADD TO CART&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;xpath//html/body/main/div[1]/div/div[2]/div/form/div/button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;pierce/button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;text/Add to Cart&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetY&#34;</span><span class=p>:</span> <span class=mf>35.0078125</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetX&#34;</span><span class=p>:</span> <span class=mf>46.4140625</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;assertedEvents&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;navigation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://online-boutique-eu.splunko11y.com/cart&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;click&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;main&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;selectors&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;aria/PLACE ORDER&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;div &gt; div &gt; div.py-3 button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;xpath//html/body/main/div/div/div[4]/div/form/div[4]/button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;pierce/div &gt; div &gt; div.py-3 button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;text/Place order&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetY&#34;</span><span class=p>:</span> <span class=mf>29.8125</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetX&#34;</span><span class=p>:</span> <span class=mf>66.8203125</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;assertedEvents&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;navigation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://online-boutique-eu.splunko11y.com/cart/checkout&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=12-create-real-browser-test>1.2 Create Real Browser Test</h1><p>In Splunk Observability Cloud, navigate to <strong>Synthetics</strong> and click on <span class="btn cstyle blue"><span><span class=title>Add new test</span></span></span>.</p><p>From the dropdown select <strong>Browser test</strong>.</p><p><a href=#R-image-18db8d357dcffadf0c0b7310564b3252 class=lightbox-link><img alt="Add new test" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/2-create-real-browser-test/../../img/add-new-test.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-18db8d357dcffadf0c0b7310564b3252><img alt="Add new test" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/2-create-real-browser-test/../../img/add-new-test.png></a></p><p>You will then be presented with the <strong>Browser test content</strong> configuration page.</p><p><a href=#R-image-667062099a83f6d60c02a564c1e8b588 class=lightbox-link><img alt="New Test" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/2-create-real-browser-test/../../img/new-test.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-667062099a83f6d60c02a564c1e8b588><img alt="New Test" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/2-create-real-browser-test/../../img/new-test.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=13-import-json>1.3 Import JSON</h1><p>To begin configuring our test, we need to import the JSON that we exported from the Chrome DevTools Recorder. To enable the <span class="btn cstyle transparent"><span><span class=title><strong>Import</strong></span></span></span> button, we must first give our test a name e.g. <strong><code>&lt;your initials></code> - Online Boutique</strong>.</p><p><a href=#R-image-4ff52887a0abd8a8931c2294a3fbfb6a class=lightbox-link><img alt=Import class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/3-import-json/../../img/import.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4ff52887a0abd8a8931c2294a3fbfb6a><img alt=Import class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/3-import-json/../../img/import.png></a></p><p>Once the <span class="btn cstyle transparent"><span><span class=title><strong>Import</strong></span></span></span> button is enabled, click on it and either drop the JSON file that you exported from the Chrome DevTools Recorder or upload the file.</p><p><a href=#R-image-2389b3cc58adbac1522be68c307ad6e0 class=lightbox-link><img alt="Import JSON" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/3-import-json/../../img/import-json.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2389b3cc58adbac1522be68c307ad6e0><img alt="Import JSON" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/3-import-json/../../img/import-json.png></a></p><p>Once the JSON file has been uploaded, click on <span class="btn cstyle blue"><span><span class=title>Continue to edit steps</span></span></span></p><p><a href=#R-image-009d70e1e566a5795e837cccd863a6fa class=lightbox-link><img alt="Import Complete" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/3-import-json/../../img/import-complete.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-009d70e1e566a5795e837cccd863a6fa><img alt="Import Complete" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/3-import-json/../../img/import-complete.png></a></p><p><a href=#R-image-0a13d7bc4bb107413ddd16bfc692abfa class=lightbox-link><img alt="Edit Steps" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/3-import-json/../../img/edit-steps.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0a13d7bc4bb107413ddd16bfc692abfa><img alt="Edit Steps" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/3-import-json/../../img/edit-steps.png></a></p><p>Before we make any edits to the test, let&rsquo;s first configure the settings, click on <span class="btn cstyle blue"><span><span class=title>&lt; Return to test</span></span></span></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=14-settings>1.4 Settings</h1><p>The simple settings allow you to configure the basics of the test:</p><ul><li><strong>Name</strong>: The name of the test (e.g. RWC - Online Boutique).</li><li><strong>Details</strong>:<ul><li><strong>Locations</strong>: The locations where the test will run from.</li><li><strong>Device</strong>: Emulate different devices and connection speeds. Also, the viewport will be adjusted to match the chosen device.</li><li><strong>Frequency</strong>: How often the test will run.</li><li><strong>Round-robin</strong>: If multiple locations are selected, the test will run from one location at a time, rather than all locations at once.</li><li><strong>Active</strong>: Set the test to active or inactive.</li></ul></li></ul><p>![Return to Test]For this workshop, we will configure the locations that we wish to monitor from. Click in the <strong>Locations</strong> field and you will be presented with a list of global locations (over 50 in total).</p><p><a href=#R-image-a748ea63bfcd6ec54f4df7726e30f679 class=lightbox-link><img alt="Global Locations" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/4-edit-test-settings/../../img/global-locations.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a748ea63bfcd6ec54f4df7726e30f679><img alt="Global Locations" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/4-edit-test-settings/../../img/global-locations.png></a></p><p>Select the following locations:</p><ul><li><strong>AWS - N. Virginia</strong></li><li><strong>AWS - London</strong></li><li><strong>AWS - Melbourne</strong></li></ul><p>Once complete, scroll down and click on Click on <span class="btn cstyle blue"><span><span class=title>Submit</span></span></span> to save the test.</p><p>The test will now be scheduled to run every 5 minutes from the 3 locations that we have selected. This does take a few minutes for the schedule to be created.</p><p>So whilst we wait for the test to be scheduled, click on <span class="btn cstyle transparent"><span><span class=title>Edit test</span></span></span> so we can go through the Advanced settings.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=15-advanced-settings>1.5 Advanced Settings</h1><p>Click on <strong>Advanced</strong>, these settings are optional and can be used to further configure the test.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>In the case of this workshop, we will <strong>not</strong> be using any of these settings as this is for informational purposes only.</p></div></div><p><a href=#R-image-2383423067f6240d8c43a6260dd2461a class=lightbox-link><img alt="Advanced Settings" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/5-advanced-settings/../../img/advanced-settings.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2383423067f6240d8c43a6260dd2461a><img alt="Advanced Settings" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/5-advanced-settings/../../img/advanced-settings.png></a></p><ul><li><strong>Security</strong>:<ul><li><strong>TLS/SSL validation</strong>: When activated, this feature is used to enforce the validation of expired, invalid hostname, or untrusted issuer on SSL/TLS certificates.</li><li><strong>Authentication</strong>: Add credentials to authenticate with sites that require additional security protocols, for example from within a corporate network. By using <a href=https://docs.splunk.com/Observability/synthetics/test-config/global-variables.html rel=external target=_blank>concealed global variables</a> in the Authentication field, you create an additional layer of security for your credentials and simplify the ability to share credentials across checks.</li></ul></li><li><strong>Custom Content</strong>:<ul><li><strong>Custom headers</strong>: Specify custom headers to send with each request. For example, you can add a header in your request to filter out requests from analytics on the back end by sending a specific header in the requests. You can also use custom headers to set cookies.</li><li><strong>Cookies</strong>: Set cookies in the browser before the test starts. For example, to prevent a popup modal from randomly appearing and interfering with your test, you can set cookies. Any cookies that are set will apply to the domain of the starting URL of the check. Splunk Synthetics Monitoring uses the public suffix list to determine the domain.</li><li><strong>Host overrides</strong>: Add host override rules to reroute requests from one host to another. For example, you can create a host override to test an existing production site against page resources loaded from a development site or a specific CDN edge node.</li></ul></li></ul><p>Next, we will edit the test steps to provide more meaningful names for each step.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=16-edit-test-steps>1.6 Edit test steps</h1><p>To edit the steps click on the <span class="btn cstyle transparent"><span><span class=title>+ Edit steps or synthetic transactions</span></span></span> button. From here, we are going to give meaningful names to each step.</p><p><a href=#R-image-40bcae9de8915e8fbf4575c55a8ddb7c class=lightbox-link><img alt="Edit steps" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/6-edit-steps/../../img/edit-steps.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-40bcae9de8915e8fbf4575c55a8ddb7c><img alt="Edit steps" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/6-edit-steps/../../img/edit-steps.png></a></p><p>For each of the four steps, we are going to give them a meaningful name.</p><ul><li><strong>Step 1</strong> replace the text <strong>Go to URL</strong> with <strong>HomePage - Online Boutique</strong></li><li><strong>Step 2</strong> enter the text <strong>Select Vintage Camera Lens</strong>.</li><li><strong>Step 3</strong> enter <strong>Add to Cart</strong>.</li><li><strong>Step 4</strong> enter <strong>Place Order</strong>.</li></ul><p><a href=#R-image-65d4b409706dba6d1b39db61a27be33b class=lightbox-link><img alt="Step names" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/6-edit-steps/../../img/step-names.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-65d4b409706dba6d1b39db61a27be33b><img alt="Step names" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/6-edit-steps/../../img/step-names.png></a></p><p>Click <span class="btn cstyle blue"><span><span class=title>&lt; Return to test</span></span></span> to return to the test configuration page and click <span class="btn cstyle blue"><span><span class=title>Save</span></span></span> to save the test.</p><p>You will be returned to the test dashboard where you will see test results start to appear.</p><p><a href=#R-image-395300f5048d49d73e953ca2d38edb77 class=lightbox-link><img alt=Scatterplot class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/6-edit-steps/../../img/scatterplot.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-395300f5048d49d73e953ca2d38edb77><img alt=Scatterplot class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/6-edit-steps/../../img/scatterplot.png></a></p><p><strong>Congratulations!</strong> You have successfully created a Real Browser Test in Splunk Synthetic Monitoring. Next, we will look into a test result in more detail.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=17-view-test-results>1.7 View test results</h1><p>In the Scatterplot from the previous step, click on one of the dots to drill into the test run data. Preferably, select the most recent test run (farthest to the right).</p><p><a href=#R-image-f7c6562614de8324311c56f8455c7ebe class=lightbox-link><img alt=Drilldown class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/7-view-test-results/../../img/drilldown.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f7c6562614de8324311c56f8455c7ebe><img alt=Drilldown class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/1-real-browser-test/7-view-test-results/../../img/drilldown.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=api-test>API Test</h1><p>The API Test provides a flexible way to check the functionality and performance of API endpoints. The shift toward API-first development has magnified the necessity to monitor the back-end services that provide your core front-end functionality.</p><p>Whether you&rsquo;re interested in testing the multi-step API interactions or you want to gain visibility into the performance of your endpoints, the API Test can help you accomplish your goals.</p><p><a href=#R-image-387972ead65e7efbad0880fd3170ff50 class=lightbox-link><img alt="API test result" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/2-api-test/../img/api-test-result.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-387972ead65e7efbad0880fd3170ff50><img alt="API test result" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/2-api-test/../img/api-test-result.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of API Test</h1><article class=default><header class=headline></header><h1 id=global-variables>Global Variables</h1><h2 id=global-variables>Global Variables</h2><p>View the global variable that we&rsquo;ll use to perform our API test. Click on <strong>Global Variables</strong> under the cog. The global variable named <code>env.encoded_auth</code> will be the one that we&rsquo;ll use to build the spotify API transaction.</p><p><a href=#R-image-1eb34d975bfef7c0ac7518962d5f2a58 class=lightbox-link><img alt=placeholder class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/2-api-test/1-global-varilables/../../img/global-variables.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1eb34d975bfef7c0ac7518962d5f2a58><img alt=placeholder class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/2-api-test/1-global-varilables/../../img/global-variables.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=create-new-api-test>Create new API test</h1><h2 id=create-a-new-api-test>Create a new API test</h2><p>Create a new API test by clicking on the <span class="btn cstyle blue"><span><span class=title>Add new test</span></span></span> button and select <strong>API test</strong> from the dropdown. Name the test using <strong>your initials</strong> followed by <strong>Spotify API</strong> e.g. <strong>RWC - Spotify API</strong></p><p><a href=#R-image-39f4c37ce94ec6730c30557d84ba5b8b class=lightbox-link><img alt=placeholder class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/2-api-test/2-create-new-check/../../img/new-api-check.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-39f4c37ce94ec6730c30557d84ba5b8b><img alt=placeholder class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/2-api-test/2-create-new-check/../../img/new-api-check.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=authentication-request>Authentication Request</h1><h2 id=add-authentication-request>Add Authentication Request</h2><p>Click on <span class="btn cstyle transparent"><span><span class=title>+ Add requests</span></span></span> and enter the request step name e.g. <strong>Authenticate with Spotify API</strong>.</p><p><a href=#R-image-f52d33d96ae7cefb9423069811ad8a70 class=lightbox-link><img alt=placeholder class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/2-api-test/3-authentication-request/../../img/add-request.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f52d33d96ae7cefb9423069811ad8a70><img alt=placeholder class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/2-api-test/3-authentication-request/../../img/add-request.png></a></p><p>Expand the Request section, from the drop-down change the request method to <strong>POST</strong> and enter the following URL:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>https://accounts.spotify.com/api/token</span></span></code></pre></div><p>In the <strong>Payload body</strong> section enter the following:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>grant_type=client_credentials</span></span></code></pre></div><p>Next, add two request headers with the following key/value pairings:</p><ul><li><strong>CONTENT-TYPE: application/x-www-form-urlencoded</strong></li><li><strong>AUTHORIZATION: Basic {{env.encoded_auth}}</strong></li></ul><p>Expand the <strong>Validation</strong> section and add the following extraction:</p><ul><li><strong>Extract</strong> from <strong>Response body</strong> <strong>JSON</strong> <strong>$.access_token</strong> <strong>as</strong> <strong>access_token</strong>.</li></ul><p>This will parse the JSON payload that is received from the Spotify API, extract the access token and store it as a custom variable.</p><p><a href=#R-image-5143419d3a074fbd0f4b03780a71629e class=lightbox-link><img alt="Add payload token" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/2-api-test/3-authentication-request/../../img/add-payload-token.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5143419d3a074fbd0f4b03780a71629e><img alt="Add payload token" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/2-api-test/3-authentication-request/../../img/add-payload-token.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=search-request>Search Request</h1><h2 id=add-search-request>Add Search Request</h2><p>Click on <span class="btn cstyle transparent"><span><span class=title>+ Add Request</span></span></span> to add the next step. Name the step <strong>Search for Tracks named &ldquo;Up around the bend&rdquo;</strong>.</p><p>Expand the <strong>Request</strong> section and change the request method to <strong>GET</strong> and enter the following URL:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>https://api.spotify.com/v1/search?q=Up%20around%20the%20bend&amp;type=track&amp;offset=0&amp;limit=5</span></span></code></pre></div><p>Next, add two request headers with the following key/value pairings:</p><ul><li><strong>CONTENT-TYPE: application/json</strong></li><li><strong>AUTHORIZATION: Bearer {{custom.access_token}}</strong></li></ul><p><a href=#R-image-94a3b42933344c5e32d2870bffc20ca8 class=lightbox-link><img alt="Add search request" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/2-api-test/4-search-request/../../img/add-search-request.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-94a3b42933344c5e32d2870bffc20ca8><img alt="Add search request" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/2-api-test/4-search-request/../../img/add-search-request.png></a></p><p>Expand the <strong>Validation</strong> section and add the following extraction:</p><ul><li><strong>Extract</strong> from <strong>Response body</strong> <strong>JSON</strong> <strong>$.tracks.items[0].id</strong> <strong>as</strong> <strong>track.id</strong>.</li></ul><p><a href=#R-image-c8b7115a53e61824bc732657b0c0b210 class=lightbox-link><img alt="Add search payload" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/2-api-test/4-search-request/../../img/add-search-payload.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c8b7115a53e61824bc732657b0c0b210><img alt="Add search payload" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/2-api-test/4-search-request/../../img/add-search-payload.png></a></p><p>Click on <span class="btn cstyle blue"><span><span class=title>< Return to test</span></span></span> to return to the test configuration page. And then click <span class="btn cstyle blue"><span><span class=title>Save</span></span></span> to save the API test.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=view-results>View results</h1><h2 id=view-results>View results</h2><p>Wait for a few minutes for the test to provision and run. Once you see the test has run successfully, click on the run to view the test results:</p><p><a href=#R-image-264d5e7494564be7e9ba15271b112de6 class=lightbox-link><img alt="API test result" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/2-api-test/5-view-results/../../img/api-test-result.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-264d5e7494564be7e9ba15271b112de6><img alt="API test result" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.68/en/ninja-workshops/4-synthetics-scripting/2-api-test/5-view-results/../../img/api-test-result.png></a></p><h2 id=6-resources>6. Resources</h2><ul><li><p><a href=https://docs.splunk.com/Observability/synthetics/api-test/set-up-api-test.html rel=external target=_blank>How to Create an API Test</a></p></li><li><p><a href=https://docs.splunk.com/Observability/synthetics/api-test/api-test.html rel=external target=_blank>API Test Overview</a></p></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section></section></section></div></main></div><script src=/observability-workshop/v5.68/js/clipboard.min.js?1727454570 defer></script><script src=/observability-workshop/v5.68/js/perfect-scrollbar.min.js?1727454570 defer></script><script src=/observability-workshop/v5.68/js/d3/d3-color.min.js?1727454570 defer></script><script src=/observability-workshop/v5.68/js/d3/d3-dispatch.min.js?1727454570 defer></script><script src=/observability-workshop/v5.68/js/d3/d3-drag.min.js?1727454570 defer></script><script src=/observability-workshop/v5.68/js/d3/d3-ease.min.js?1727454570 defer></script><script src=/observability-workshop/v5.68/js/d3/d3-interpolate.min.js?1727454570 defer></script><script src=/observability-workshop/v5.68/js/d3/d3-selection.min.js?1727454570 defer></script><script src=/observability-workshop/v5.68/js/d3/d3-timer.min.js?1727454570 defer></script><script src=/observability-workshop/v5.68/js/d3/d3-transition.min.js?1727454570 defer></script><script src=/observability-workshop/v5.68/js/d3/d3-zoom.min.js?1727454570 defer></script><script src=/observability-workshop/v5.68/js/js-yaml.min.js?1727454570 defer></script><script src=/observability-workshop/v5.68/js/mermaid.min.js?1727454570 defer></script><script>window.themeUseMermaid=JSON.parse("{}")</script><script src=/observability-workshop/v5.68/js/theme.js?1727454570 defer></script></body></html>