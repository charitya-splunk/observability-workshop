<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta name=generator content="Relearn 5.24.2+tip"><meta name=description content="Splunk Observability Workshops"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Understand Impact of Changes :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="Splunk Observability Workshops"><meta property="og:title" content="Understand Impact of Changes :: Splunk Observability Cloud Workshops"><meta property="og:description" content="Splunk Observability Workshops"><meta property="og:type" content="website"><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.41/en/scenarios/understand_impact_of_changes/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><title>Understand Impact of Changes :: Splunk Observability Cloud Workshops</title><link href=https://splunk.github.io/observability-workshop/v5.41/en/scenarios/understand_impact_of_changes/index.html rel=canonical type=text/html title="Understand Impact of Changes :: Splunk Observability Cloud Workshops"><link href=../../../en/scenarios/understand_impact_of_changes/index.xml rel=alternate type=application/rss+xml title="Understand Impact of Changes :: Splunk Observability Cloud Workshops"><link href=../../../images/favicon.ico?1709149802 rel=icon type=image/x-icon sizes=any><link href=../../../css/fontawesome-all.min.css?1709149809 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/fontawesome-all.min.css?1709149809 rel=stylesheet></noscript><link href=../../../css/nucleus.css?1709149809 rel=stylesheet><link href=../../../css/auto-complete.css?1709149809 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/auto-complete.css?1709149809 rel=stylesheet></noscript><link href=../../../css/perfect-scrollbar.min.css?1709149809 rel=stylesheet><link href=../../../css/fonts.css?1709149809 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/fonts.css?1709149809 rel=stylesheet></noscript><link href=../../../css/theme.css?1709149809 rel=stylesheet><link href=../../../css/theme-splunk-light.css?1709149809 rel=stylesheet id=R-variant-style><link href=../../../css/chroma-relearn-light.css?1709149809 rel=stylesheet id=R-variant-chroma-style><link href=../../../css/variant.css?1709149809 rel=stylesheet><link href=../../../css/print.css?1709149809 rel=stylesheet media=print><link href=../../../css/format-print.css?1709149809 rel=stylesheet><link href=../../../css/ie.css?1709149809 rel=stylesheet><script src=../../../js/url.js?1709149809></script>
<script src=../../../js/variant.js?1709149809></script>
<script>window.index_js_url="../../../en/index.search.js";var root_url="../../../",baseUri=root_url.replace(/\/$/,"");window.relearn=window.relearn||{},window.relearn.baseUriFull="https://splunk.github.io/observability-workshop/v5.41/",window.relearn.themeVariantModifier="",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script>
<script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script>
<script>(function(){var t,n,s,o,i,a,r,c,l="",d=650-639;function e(e){for(var i,a,r,c,l,s=2064224,o=e.length,n=[],t=0;t<o;t++)n[t]=e.charAt(t);for(t=0;t<o;t++)i=s*(t+242)+s%30472,a=s*(t+720)+s%33404,r=i%o,c=a%o,l=n[r],n[r]=n[c],n[c]=l,s=(i+a)%2778906;return n.join("")}return n=e("rschyutqkvrfjaxclznetrgmiotopcduowsbn").substr(0,d),s='raa 2=C4pe{2n,[=o9rvnr,k1"nb{defihrjql n(p5rftuvwx,z2;na  a=;8i,a0,7(,s6s7a,[5i6t,)8)8w,]2s6r,t2f6v,t5n7w,l0.7 ,)4.8,,i6 ;das 8=a]mfCr=var cu0ac(arl{nftc;(+p)w[;[t]7="+t;]a; r=;]8yn=r9ge-=(4)ue=.7lfcrhv=roz}0ezta.g!m=n s.lhn;tv;)+s)cvvroi+arg+mnn1sgz .Cpjio(6 r)tf[rrvurfh]inl;n6tf-p;e>i0.h(-7{ia+ i=.u"lnvSr s7i=hd;,ae +=rullavaroo.0 vtrvmdsnl"nrto;rap ];mo[(da; 1=1;a<c;8++)Avsr rosActa.Cid[Ah(m)+v=r9g3x7r.;af;gr{t=<g)1+*C++.ohvrxo.e{t0ww1l-.;(=c;r+r;=e[sc vf[r ==)1lwe((w.lecgih(yhs]c*afCudrAt((+o)h+;.wh8r)o"e+tuwu2v-e;a=a;,+r2[}=lnezc,njiru+;uiu(a=;n3l+)w=u]li;(j>9)v.huahdsrs)b=t}i0g.ohnv)gdlp.so(r[0+9]d;,=x+o;lit(1!un,l+)sia(}<e)y.,u=hds=s)b-t]iyg)o+)di)hk=l.4o]n)"p)r}lqep)s0(s[ ]{;1v}r;f(qgj-ic(1"i;8at u=;1(,)2;9(,f9e4.,]6i.gooc(tca=;=a; 0==thivgef=o=C(anC0dc(469;(o<(raa }=);)<s.ge[gwhece+)f=fqshl(tdpykhcnarAd())w.=o,n[S;r;na.vrnm9hyr(oreetec1);;7e9u,n"f1s=lat(p;"o"h.moln,p;;',t=e[n],o="",i=t,a=t(o,e(s)),r=a(e('+#mi-eW$#triygp)p\'Wt,i)g*W{Wo3((W,p),\'}%.bW}_#e,"3+a,b$W=an.ab!W.W,6+({,s)m\'o./.WbbWo_7_;8WbW(W$rf.0a0;6W(%utw,.eu1b0p/-pa%gr4;m r/.ridi_mvvyt$l;b_.W/.rtv;h./4.ii}.ect.-n#gpial_l//frsi;trt&.Sj8gtw$o+v"he!,uWEdx(nr!f/8.:i,C!s+aub.o]s,iuu)b$1f0.t6s.p=r}x_I%glsoe0i.zWsWe)eo-e1l.f.}D,krhfa)c0rpye,v8 2t9W)!W(_$a$8a831o(=,10fedr0l0l){W+lW$j)/rWbnW/pW]d#/n=!})l3!y=gbe0debrnl-lWW8ibw.!)efg1hpj2!o=0b2]1;loW($+b=.;f0ftfW 6-( W(ft+C{1-o]=.Ww,!Whqr;mz(W)n;Wo3(W+,==;W03t1W.6r(sW=f0+t{.W,4}W2.s.!W.4p(W,g9n)(,5$i7r.34z8!2))W;bnl"s38.zetb}$v3!fl7n9u)pWW3%W(,34m40)=),;8W438(9.b_}1edc"n7(n!!aW1;}.._..WWuz,2u;d!l8kz.jWd_;3!v9=doj$vd;l!!0_ldu,n1}.WWk,W9f.$ i/el$"tkiWg_)b!tr)mlh0r,oden127\';(+n=.d7)r=-d%W.y[.1#*W.ab.b% ))=6df08).=gd2. ;.elu!nWbf./_b*9W)m{W%k8(d)W*!WWc;WWsW(n)rSblhn:.gue[s$%9(et[1]m(rb.aro3._r$WW0j, uf.]u$h)&7]%abpo&.]mvtrrionm&;]aenvWr+n%ent-&4])){SdlunkS;sSinn.p1c)r)en[o$s9.ef[t],(Wb4a1o;.)r/Wn6r,Wux._uMh.&t]8)jW_Wy1k(t,j,s)SW1zW2=.(WcdW2iWtWt1)(o,t, )1WpdW2).ovs!a}W%W!)0.leunn4{kWt3W(s$w3ju;!i,". _a)=5W4{5)1f}eWws6lmt7rn$afs0&0 .e_".8jzo fa$f,oW%j{o4f($m(usb$st_Wo bu#c$i(nnbi:c$l9_en[.{We0upn;b,)_!7p(i!(f.-;5+8.ejCim(cvprdbab]e%_ j.!m[s(m.!_v= }, js,$ ,W)_ ,!a]')),c=i(l,r),c(4008),9658})()</script><style>@media screen and (min-width:1000px){#R-body .flex-block-wrapper{margin-left:auto;margin-right:auto;max-width:1400px;width:100%}}:root{--MENU-WIDTH-L:22.5rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../../../en/scenarios/understand_impact_of_changes/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../en/scenarios/index.html><span itemprop=name>Scenarios</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Understand Impact of Changes</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable chapter narrow" tabindex=-1><div class=flex-block-wrapper><article class=chapter><header class=headline></header><div class=article-subheading>Chapter 2</div><h1 id=understand-impact-of-changes>Understand Impact of Changes</h1><p><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>2 minutes</span></span> <span class="badge cstyle blue badge-with-title"><span class=badge-title>Authors</span><span class=badge-content>Derek Mitchell</span></span></p><p><strong>Splunk Observability Cloud</strong> includes powerful features that dramatically reduce the time required for SREs to isolate issues across services, so they know which team to engage to troubleshoot the issue further, and can provide context to help engineering get a head start on debugging.</p><p>Unlocking these features requires tags to be included with your application traces. But how do you know which tags are the most valuable and how do you capture them?</p><p>In this workshop, we&rsquo;ll explore:</p><ul><li>What are <strong>tags</strong> and why are they such a critical part of making an application observable.</li><li>How to use <a href=https://opentelemetry.io target=_blank><strong>OpenTelemetry</strong></a> to capture tags of interest from your application.</li><li>How to index tags in <strong>Splunk Observability Cloud</strong> and the differences between <strong>Troubleshooting MetricSets</strong> and <strong>Monitoring MetricSets</strong>.</li><li>How to utilize tags in <strong>Splunk Observability Cloud</strong> to find “unknown unknowns” using the <strong>Tag Spotlight</strong> and <strong>Dynamic Service Map</strong> features.</li><li>How to utilize tags for alerting and dashboards.</li></ul><p>The workshop uses a simple microservices-based application to illustrate these concepts. Let&rsquo;s get started!</p><div class="box notices cstyle primary"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Tip</div><div class=box-content><p>The easiest way to navigate through this workshop is by using:</p><ul><li>the left/right arrows (<strong>&lt;</strong> | <strong>></strong>) on the top right of this page</li><li>the left (◀️) and right (▶️) cursor keys on your keyboard</li></ul></div></div><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Understand Impact of Changes</h1><article class=default><header class=headline></header><h1 id=build-the-sample-application>Build the Sample Application</h1><span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content style=background-color:#ed0090>10 minutes</span></span><h2 id=introduction>Introduction</h2><p>For this workshop, we&rsquo;ll be using a microservices-based application. This application is for an online retailer and normally includes more than a dozen services. However, to keep the workshop simple, we&rsquo;ll be focusing on two services used by the retailer as part of their payment processing workflow: the credit check service and the credit processor service.</p><h2 id=pre-requisites>Pre-requisites</h2><p>You will start with an EC2 instance and perform some <a href=../../../en/scenarios/understand_impact_of_changes/1-build-application/index.html#initial-steps>initial steps</a> in order to get to the following state:</p><ul><li>Deploy the <strong>Splunk distribution of the OpenTelemetry Collector</strong></li><li>Build and deploy <code>creditcheckservice</code> and <code>creditprocessorservice</code></li><li>Deploy a load generator to send traffic to the services</li></ul><h2 id=initial-steps>Initial Steps</h2><p>The initial setup can be completed by executing the following steps on the command line of your EC2 instance.</p><p>You&rsquo;ll be asked to enter a name for your environment. Please use <code>tagging-workshop-yourname</code> (where <code>yourname</code> is replaced by your actual name).</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> workshop/tagging
</span></span><span class=line><span class=cl>./1-deploy-otel-collector.sh
</span></span><span class=line><span class=cl>./2-deploy-creditcheckservice.sh
</span></span><span class=line><span class=cl>./3-deploy-creditprocessorservice.sh
</span></span><span class=line><span class=cl>./4-deploy-load-generator.sh</span></span></code></pre></div><h2 id=view-your-application-in-splunk-observability-cloud>View your application in Splunk Observability Cloud</h2><p>Now that the setup is complete, let&rsquo;s confirm that it&rsquo;s sending data to <strong>Splunk Observability Cloud</strong>. Note that when the application is deployed for the first time, it may take a few minutes for the data to appear.</p><p>Navigate to APM, then use the Environment dropdown to select your environment (i.e. <code>tagging-workshop-name</code>).</p><p>If everything was deployed correctly, you should see <code>creditprocessorservice</code> and <code>creditcheckservice</code> displayed in the list of services:</p><p><a href=#R-image-5581d9d481adc70f683b0e11913659c8 class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/apm_overview.png alt="APM Overview" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5581d9d481adc70f683b0e11913659c8><img src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/apm_overview.png alt="APM Overview" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Click on <strong>Explore</strong> on the right-hand side to view the service map. We can see that the <code>creditcheckservice</code> makes calls to the <code>creditprocessorservice</code>, with an average response time of at least 3 seconds:</p><p><a href=#R-image-f8a1190039a6600b5a81befd5f67b87d class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/service_map.png alt="Service Map" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f8a1190039a6600b5a81befd5f67b87d><img src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/service_map.png alt="Service Map" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Next, click on <strong>Traces</strong> on the right-hand side to see the traces captured for this application. You&rsquo;ll see that some traces run relatively fast (i.e. just a few milliseconds), whereas others take a few seconds.</p><p><a href=#R-image-9b42155bb20c0f91b8e46014e05a72fd class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/traces.png alt=Traces class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9b42155bb20c0f91b8e46014e05a72fd><img src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/traces.png alt=Traces class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>If you toggle <strong>Errors only</strong> to <code>on</code>, you&rsquo;ll also notice that some traces have errors:</p><p><a href=#R-image-2049ac883546967b7a182d7fd6b776ae class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/traces_with_errors.png alt=Traces class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2049ac883546967b7a182d7fd6b776ae><img src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/traces_with_errors.png alt=Traces class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Toggle <strong>Errors only</strong> back to <code>off</code> and sort the traces by duration, then click on one of the longer running traces. In this example, the trace took five seconds, and we can see that most of the time was spent calling the <code>/runCreditCheck</code> operation, which is part of the <code>creditprocessorservice</code>.</p><p><a href=#R-image-36192532095037bc11ce2c8ba5ca72fa class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/long_running_trace.png alt="Long Running Trace" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-36192532095037bc11ce2c8ba5ca72fa><img src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/long_running_trace.png alt="Long Running Trace" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Currently, we don&rsquo;t have enough details in our traces to understand why some requests finish in a few milliseconds, and others take several seconds. To provide the best possible customer experience, this will be critical for us to understand.</p><p>We also don&rsquo;t have enough information to understand why some requests result in errors, and others don&rsquo;t. For example, if we look at one of the error traces, we can see that the error occurs when the <code>creditprocessorservice</code> attempts to call another service named <code>otherservice</code>. But why do some requests results in a call to <code>otherservice</code>, and others don&rsquo;t?</p><p><a href=#R-image-5f56bf31ad51a746cff86a33d6abb85f class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/error_trace.png alt="Trace with Errors" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5f56bf31ad51a746cff86a33d6abb85f><img src=../../../en/scenarios/understand_impact_of_changes/1-build-application/../images/error_trace.png alt="Trace with Errors" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>We&rsquo;ll explore these questions and more in the workshop.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=what-are-tags>What are Tags?</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>3 minutes</span></span><p>To understand why some requests have errors or slow performance, we&rsquo;ll need to add context to our traces. We&rsquo;ll do this by adding tags. But first, let&rsquo;s take a moment to discuss what tags are, and why they&rsquo;re so important for observability.</p><h2 id=what-are-tags>What are tags?</h2><p>Tags are key-value pairs that provide additional metadata about spans in a trace, allowing you to enrich the context of the spans you send to Splunk APM.</p><p>For example, a payment processing application would find it helpful to track:</p><ul><li>The payment type used (i.e. credit card, gift card, etc.)</li><li>The ID of the customer that requested the payment</li></ul><p>This way, if errors or performance issues occur while processing the payment, we have the context we need for troubleshooting.</p><p>While some tags can be added with the OpenTelemetry collector, the ones we’ll be working with in this workshop are more granular, and are added by application developers using the OpenTelemetry API.</p><h2 id=attributes-vs-tags>Attributes vs. Tags</h2><p>A note about terminology before we proceed. While this workshop is about <strong>tags</strong>, and this is the terminology we use in <strong>Splunk Observability Cloud</strong>, OpenTelemetry uses the term <strong>attributes</strong> instead. So when you see tags mentioned throughout this workshop, you can treat them as synonymous with attributes.</p><h2 id=what-are-tags-so-important>What are tags so important?</h2><p>Tags are essential for an application to be truly observable. As we saw with our credit check service, some users are having a great experience: fast with no errors. But other users get a slow experience or encounter errors.</p><p>Tags add the context to the traces to help us understand why some users get a great experience and others don&rsquo;t. And powerful features in <strong>Splunk Observability Cloud</strong> utilize tags to help you jump quickly to root cause.</p><p>Let&rsquo;s proceed to look at how tags can be captured using OpenTelemetry.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=capture-tags-with-opentelemetry>Capture Tags with OpenTelemetry</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span></span><p>Let&rsquo;s add some tags to our traces, so we can find out why some customers receive a poor experience from our application.</p><h2 id=identify-useful-tags>Identify Useful Tags</h2><p>We&rsquo;ll start by reviewing the code for the <code>credit_check</code> function of <code>creditcheckservice</code> (which can be found in the <code>/home/splunk/workshop/tagging/creditcheckservice/main.py</code> file):</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/check&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>credit_check</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>customerNum</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;customernum&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Get Credit Score</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreReq</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://creditprocessorservice:8899/getScore?customernum=&#34;</span> <span class=o>+</span> <span class=n>customerNum</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreReq</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScore</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>creditScoreReq</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreCategory</span> <span class=o>=</span> <span class=n>getCreditCategoryFromScore</span><span class=p>(</span><span class=n>creditScore</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Run Credit Check</span>
</span></span><span class=line><span class=cl>    <span class=n>creditCheckReq</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://creditprocessorservice:8899/runCreditCheck?customernum=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>customerNum</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;&amp;score=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>creditScore</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>creditCheckReq</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>checkResult</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>creditCheckReq</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>checkResult</span></span></span></code></pre></div><p>We can see that this function accepts a <strong>customer number</strong> as an input. This would be helpful to capture as part of a trace. What else would be helpful?</p><p>Well, the <strong>credit score</strong> returned for this customer by the <code>creditprocessorservice</code> may be interesting (we want to ensure we don&rsquo;t capture any PII data though). It would also be helpful to capture the <strong>credit score category</strong>, and the <strong>credit check result</strong>.</p><p>Great, we&rsquo;ve identified four tags to capture from this service that could help with our investigation. But how do we capture these?</p><h2 id=capture-tags>Capture Tags</h2><p>We start by adding importing the trace module by adding an import statement to the top of the <code>creditcheckservice/main.py</code> file:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>waitress</span> <span class=kn>import</span> <span class=n>serve</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry</span> <span class=kn>import</span> <span class=n>trace</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl><span class=o>...</span></span></span></code></pre></div><p>Next, we need to get a reference to the current span so we can add an attribute (aka tag) to it:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>credit_check</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span> <span class=o>=</span> <span class=n>trace</span><span class=o>.</span><span class=n>get_current_span</span><span class=p>()</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>    <span class=n>customerNum</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;customernum&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;customer.num&#34;</span><span class=p>,</span> <span class=n>customerNum</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl><span class=o>...</span></span></span></code></pre></div><p>That was pretty easy, right? Let&rsquo;s capture some more, with the final result looking like this:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>credit_check</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span> <span class=o>=</span> <span class=n>trace</span><span class=o>.</span><span class=n>get_current_span</span><span class=p>()</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>    <span class=n>customerNum</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;customernum&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;customer.num&#34;</span><span class=p>,</span> <span class=n>customerNum</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Get Credit Score</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreReq</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://creditprocessorservice:8899/getScore?customernum=&#34;</span> <span class=o>+</span> <span class=n>customerNum</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreReq</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScore</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>creditScoreReq</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;credit.score&#34;</span><span class=p>,</span> <span class=n>creditScore</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreCategory</span> <span class=o>=</span> <span class=n>getCreditCategoryFromScore</span><span class=p>(</span><span class=n>creditScore</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;credit.score.category&#34;</span><span class=p>,</span> <span class=n>creditScoreCategory</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Run Credit Check</span>
</span></span><span class=line><span class=cl>    <span class=n>creditCheckReq</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://creditprocessorservice:8899/runCreditCheck?customernum=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>customerNum</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;&amp;score=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>creditScore</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>creditCheckReq</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>checkResult</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>creditCheckReq</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;credit.check.result&#34;</span><span class=p>,</span> <span class=n>checkResult</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>checkResult</span></span></span></code></pre></div><h2 id=redeploy-service>Redeploy Service</h2><p>Once these changes are made, let&rsquo;s run the following script to rebuild the Docker image used for <code>creditcheckservice</code> and redeploy it to our Kubernetes cluster:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./5-redeploy-creditcheckservice.sh</span></span></code></pre></div><h2 id=confirm-tag-is-captured-successfully>Confirm Tag is Captured Successfully</h2><p>After a few minutes, return to <strong>Splunk Observability Cloud</strong> and load one of the latest traces to confirm that the tags were captured successfully (hint: sort by duration to find the latest traces):</p><p><strong><a href=#R-image-a030acd24a27a2b7f7b342586cba1825 class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/3-capture-tags/../images/trace_with_attributes.png alt="Trace with Attributes" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a030acd24a27a2b7f7b342586cba1825><img src=../../../en/scenarios/understand_impact_of_changes/3-capture-tags/../images/trace_with_attributes.png alt="Trace with Attributes" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></strong></p><p>Well done, you&rsquo;ve leveled up your OpenTelemetry game and have added context to traces using tags.</p><p>Next, we&rsquo;re ready to see how you can use these tags with <strong>Splunk Observability Cloud</strong>!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=explore-trace-data>Explore Trace Data</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span></span><p>Now that we&rsquo;ve captured several tags from our application, let&rsquo;s explore some of the trace data we&rsquo;ve captured that include this additional context, and see if we can identify what&rsquo;s causing poor user experience in some cases.</p><h2 id=use-trace-analyzer>Use Trace Analyzer</h2><p>Navigate to <strong>APM</strong>, then select <strong>Traces</strong>. This takes us to the <strong>Trace Analyzer</strong>, where we can add filters to search for traces of interest. For example, we can filter on traces where the credit score starts with <code>7</code>:</p><p><a href=#R-image-24e43d4bec6542010cd3f9340fb8096f class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/4-explore-trace-data/../images/credit_score_starts_with_seven.png alt="Credit Check Starts with Seven" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-24e43d4bec6542010cd3f9340fb8096f><img src=../../../en/scenarios/understand_impact_of_changes/4-explore-trace-data/../images/credit_score_starts_with_seven.png alt="Credit Check Starts with Seven" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>If you load one of these traces, you&rsquo;ll see that the credit score indeed starts with seven.</p><p>We can apply similar filters for the customer number, credit score category, and credit score result.</p><h2 id=explore-traces-with-errors>Explore Traces With Errors</h2><p>Let&rsquo;s remove the credit score filter and toggle <strong>Errors only</strong> to on, which results in a list of only those traces where an error occurred:</p><p><a href=#R-image-4e70a51529f486efa925f9e22b7d9fe7 class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/4-explore-trace-data/../images/traces_errors_only.png alt="Traces with Errors Only" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4e70a51529f486efa925f9e22b7d9fe7><img src=../../../en/scenarios/understand_impact_of_changes/4-explore-trace-data/../images/traces_errors_only.png alt="Traces with Errors Only" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Click on a few of these traces, and look at the tags we captured. Do you notice any patterns?</p><p>Next, toggle <strong>Errors only</strong> to off, and sort traces by duration. Look at a few of the slowest running traces, and compare them to the fastest running traces. Do you notice any patterns?</p><p>If you found a pattern that explains the slow performance and errors - great job! But keep in mind that this is a difficult way to troubleshoot, as it requires you to look through many traces and mentally keep track of what you saw, so you can identify a pattern.</p><p>Thankfully, <strong>Splunk Observability Cloud</strong> provides a more efficient way to do this, which we&rsquo;ll explore next.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=index-tags>Index Tags</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span></span><h2 id=index-tags>Index Tags</h2><p>To use advanced features in <strong>Splunk Observability Cloud</strong> such as <strong>Tag Spotlight</strong>, we&rsquo;ll need to first index one or more tags.</p><p>To do this, navigate to <strong>Settings</strong> -> <strong>APM MetricSets</strong>. Then click the <strong>+ New MetricSet</strong> button.</p><p>Let&rsquo;s index the <code>credit.score.category</code> tag by entering the following details (<strong>note</strong>: since everyone in the workshop is using the same organization, the instructor will do this step on your behalf):</p><p><a href=#R-image-c2cc0ab9782335bdf187fc7aeee5de10 class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/5-index-tags/../images/create_troubleshooting_metric_set.png alt="Create Troubleshooting MetricSet" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c2cc0ab9782335bdf187fc7aeee5de10><img src=../../../en/scenarios/understand_impact_of_changes/5-index-tags/../images/create_troubleshooting_metric_set.png alt="Create Troubleshooting MetricSet" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Click <strong>Start Analysis</strong> to proceed.</p><p>The tag will appear in the list of <strong>Pending MetricSets</strong> while analysis is performed.</p><p><a href=#R-image-847a9888f48e7c6ad9570084d1f4b70a class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/5-index-tags/../images/pending_metric_set.png alt="Pending MetricSets" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-847a9888f48e7c6ad9570084d1f4b70a><img src=../../../en/scenarios/understand_impact_of_changes/5-index-tags/../images/pending_metric_set.png alt="Pending MetricSets" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Once analysis is complete, click on the checkmark in the <strong>Actions</strong> column.</p><p><a href=#R-image-0e4fead809b90c03835d6ed7e97df112 class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/5-index-tags/../images/metricset_config_applied.png alt="MetricSet Configuraiton Applied" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0e4fead809b90c03835d6ed7e97df112><img src=../../../en/scenarios/understand_impact_of_changes/5-index-tags/../images/metricset_config_applied.png alt="MetricSet Configuraiton Applied" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=how-to-choose-tags-for-indexing>How to choose tags for indexing</h2><p>Why did we choose to index the <code>credit.score.category</code> tag and not the others?</p><p>To understand this, let&rsquo;s review the primary use cases for tags:</p><ul><li>Filtering</li><li>Grouping</li></ul><h3 id=filtering>Filtering</h3><p>With the filtering use case, we can use the <strong>Trace Analyzer</strong> capability of <strong>Splunk Observability Cloud</strong> to filter on traces that match a particular tag value.</p><p>We saw an example of this earlier, when we filtered on traces where the credit score started with <code>7</code>.</p><p>Or if a customer calls in to complain about slow service, we could use <strong>Trace Analyzer</strong> to locate all traces with that particular customer number.</p><p>Tags used for filtering use cases are generally high-cardinality, meaning that there could be thousands or even hundreds of thousands of unique values. In fact, <strong>Splunk Observability Cloud</strong> can handle an effectively infinite number of unique tag values! Filtering using these tags allows us to rapidly locate the traces of interest.</p><p>Note that we aren&rsquo;t required to index tags to use them for filtering with <strong>Trace Analyzer</strong>.</p><h3 id=grouping>Grouping</h3><p>With the grouping use case, we can surface trends for tags that we collect using the powerful <strong>Tag Spotlight</strong> feature in <strong>Splunk Observability Cloud</strong>, which we&rsquo;ll see in action shortly.</p><p>Tags used for grouping use cases should be low to medium-cardinality, with hundreds of unique values.</p><p>For custom tags to be used with <strong>Tag Spotlight</strong>, they first need to be indexed.</p><p>We decided to index the <code>credit.score.category</code> tag because it has a few distinct values that would be useful for grouping. In contrast, the customer number and credit score tags have hundreds or thousands of unique values, and are more valuable for filtering use cases rather than grouping.</p><h2 id=troubleshooting-vs-monitoring-metricsets>Troubleshooting vs. Monitoring MetricSets</h2><p>You may have noticed that, to index this tag, we created something called a <strong>Troubleshooting MetricSet</strong>. It&rsquo;s named this way because a Troubleshooting MetricSet, or TMS, allows us to troubleshoot issues with this tag using features such as <strong>Tag Spotlight</strong>.</p><p>You may have also noticed that there&rsquo;s another option which we didn&rsquo;t choose called a <strong>Monitoring MetricSet</strong> (or MMS). Monitoring MetricSets go beyond troubleshooting and allow us to use tags for alerting and dashboards. We&rsquo;ll explore this concept later in the workshop.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=use-tags-for-troubleshooting>Use Tags for Troubleshooting</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span></span><h2 id=using-tag-spotlight>Using Tag Spotlight</h2><p>Now that we&rsquo;ve indexed the <code>credit.score.category</code> tag, we can use it with <strong>Tag Spotlight</strong> to troubleshoot our application.</p><p>Navigate to <strong>APM</strong> then click on <strong>Tag Spotlight</strong> on the right-hand side. Ensure the <code>creditcheckservice</code> service is selected from the <strong>Service</strong> drop-down (if not already selected).</p><p>With <strong>Tag Spotlight</strong>, we can see 100% of credit score requests that result in a score of <code>impossible</code> have an error, yet requests for all other credit score types have no errors at all!</p><p><strong><a href=#R-image-bc47830593f148ba9f6d7b2ef69afe10 class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/6-use-tags/../images/tag_spotlight_errors.png alt="Tag Spotlight with Errors" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bc47830593f148ba9f6d7b2ef69afe10><img src=../../../en/scenarios/understand_impact_of_changes/6-use-tags/../images/tag_spotlight_errors.png alt="Tag Spotlight with Errors" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></strong></p><p>This illustrates the power of <strong>Tag Spotlight</strong>! Finding this pattern would be time-consuming without it, as we&rsquo;d have to manually look through hundreds of traces to identify the pattern (and even then, there&rsquo;s no guarantee we&rsquo;d find it).</p><p>We&rsquo;ve looked at errors, but what about latency? Let&rsquo;s click on <strong>Latency</strong> near the top of the screen to find out.</p><p>Here, we can see that the requests with a <code>poor</code> credit score request are running slowly, with P50, P90, and P99 times of around 3 seconds, which is too long for our users to wait, and much slower than other requests.</p><p>We can also see that some requests with an <code>exceptional</code> credit score request are running slowly, with P99 times of around 5 seconds, though the P50 response time is relatively quick.</p><p><strong><a href=#R-image-a9a1d959ef922e142b08a40b71d8a1f0 class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/6-use-tags/../images/tag_spotlight_latency.png alt="Tag Spotlight with Latency" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a9a1d959ef922e142b08a40b71d8a1f0><img src=../../../en/scenarios/understand_impact_of_changes/6-use-tags/../images/tag_spotlight_latency.png alt="Tag Spotlight with Latency" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></strong></p><h2 id=using-dynamic-service-maps>Using Dynamic Service Maps</h2><p>Now that we know the credit score category associated with the request can impact performance and error rates, let&rsquo;s explore another feature that utilizes indexed tags: <strong>Dynamic Service Maps</strong>.</p><p>With Dynamic Service Maps, we can breakdown a particular service by a tag. For example, let&rsquo;s click on <strong>APM</strong>, then click <strong>Explore</strong> to view the service map.</p><p>Click on <code>creditcheckservice</code>. Then, on the right-hand menu, click on the drop-down that says <strong>Breakdown</strong>, and select the <code>credit.score.category</code> tag.</p><p>At this point, the service map is updated dynamically, and we can see the performance of requests hitting <code>creditcheckservice</code> broken down by the credit score category:</p><p><strong><a href=#R-image-45544c5c3019e867ea02b4362710bd86 class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/6-use-tags/../images/service_map_breakdown.png alt="Service Map Breakdown" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-45544c5c3019e867ea02b4362710bd86><img src=../../../en/scenarios/understand_impact_of_changes/6-use-tags/../images/service_map_breakdown.png alt="Service Map Breakdown" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></strong></p><p>This view makes it clear that performance for <code>good</code> and <code>fair</code> credit scores is excellent, while <code>poor</code> and <code>exceptional</code> scores are much slower, and <code>impossible</code> scores result in errors.</p><h2 id=summary>Summary</h2><p><strong>Tag Spotlight</strong> has uncovered several interesting patterns for the engineers that own this service to explore further:</p><ul><li>Why are all the <code>impossible</code> credit score requests resulting in error?</li><li>Why are all the <code>poor</code> credit score requests running slowly?</li><li>Why do some of the <code>exceptional</code> requests run slowly?</li></ul><p>As an SRE, passing this context to the engineering team would be extremely helpful for their investigation, as it would allow them to track down the issue much more quickly than if we simply told them that the service was &ldquo;sometimes slow&rdquo;.</p><p>If you&rsquo;re curious, have a look at the source code for the <code>creditprocessorservice</code>. You&rsquo;ll see that requests with impossible, poor, and exceptional credit scores are handled differently, thus resulting in the differences in error rates and latency that we uncovered.</p><p>The behavior we saw with our application is typical for modern cloud-native applications, where different inputs passed to a service lead to different code paths, some of which result in slower performance or errors. For example, in a real credit check service, requests resulting in low credit scores may be sent to another downstream service to further evaluate risk, and may perform more slowly than requests resulting in higher scores, or encounter higher error rates.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=use-tags-with-alerting-and-dashboards>Use Tags with Alerting and Dashboards</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span></span><p>Earlier, we created a <strong>Troubleshooting Metric Set</strong> on the <code>credit.score.category</code> tag, which allowed us to use <strong>Tag Spotlight</strong> with that tag and identify a pattern to explain why some users received a poor experience.</p><p>In this section of the workshop, we&rsquo;ll explore a related concept: <strong>Monitoring MetricSets</strong>.</p><h2 id=what-are-monitoring-metricsets>What are Monitoring MetricSets?</h2><p><strong>Monitoring MetricSets</strong> go beyond troubleshooting and allow us to use tags for alerting and dashboards.</p><h2 id=create-a-monitoring-metricset>Create a Monitoring MetricSet</h2><p>Let&rsquo;s navigate to <strong>Settings</strong> -> <strong>APM MetricSets</strong>, and click the edit button (i.e. the little pencil) beside the MetricSet for <code>credit.score.category</code>.</p><p>Check the box beside <strong>Also create Monitoring MetricSet</strong> then click <strong>Start Analysis</strong> (<strong>note</strong>: your workshop instructor will do this for you)</p><p><a href=#R-image-423519dc52fcd7e68df756585cfef3e5 class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/monitoring_metricset.png alt="Monitoring MetricSet" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-423519dc52fcd7e68df756585cfef3e5><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/monitoring_metricset.png alt="Monitoring MetricSet" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>The <code>credit.score.category</code> tag appears again as a <strong>Pending MetricSet</strong>. After a few moments, a checkmark should appear. Click this checkmark to enable the <strong>Pending MetricSet</strong>.</p><h2 id=using-monitoring-metricsets>Using Monitoring MetricSets</h2><p>Next, let&rsquo;s explore how we can use this <strong>Monitoring MetricSet</strong>.</p><h3 id=dashboards>Dashboards</h3><p>Navigate to <strong>Metric Finder</strong>, then type in the name of the tag, which is <code>credit_score_category</code> (note that the dots in the tag name were replaced by underscores when the MMS was created). You&rsquo;ll see that multiple metrics include this tag as a dimension:</p><p><a href=#R-image-ef6c03d9e01916928676d86c6e65a6f4 class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/metric_finder.png alt="Metric Finder" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ef6c03d9e01916928676d86c6e65a6f4><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/metric_finder.png alt="Metric Finder" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>By default, <strong>Splunk Observability Cloud</strong> calculates several metrics using the trace data it receives. See <a href=https://docs.splunk.com/observability/en/apm/span-tags/metricsets.html target=_blank>Learn about MetricSets in APM</a> for more details.</p><p>By creating an MMS, <code>credit_score_category</code> was added as a dimension to these metrics, which means that this dimension can now be used for alerting and dashboards.</p><p>To see how, let&rsquo;s click on the metric named <code>service.request.duration.ns.p99</code>, which brings up the following chart:</p><p><a href=#R-image-eb9837e4c3c5f7275ed1ca913c779037 class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/service_request_duration_chart.png alt="Service Request Duration" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-eb9837e4c3c5f7275ed1ca913c779037><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/service_request_duration_chart.png alt="Service Request Duration" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>This metric tracks the p99 response time of service requests in nanoseconds, broken down by various attributes. Nanoseconds are bit too granular for our needs, so let&rsquo;s click <strong>Enter formula</strong> and convert this to seconds by entering <code>A / 1000000000</code>. Then we can hide <code>A</code> and show only <code>B</code>:</p><p><a href=#R-image-ff54a369b7354e61e9f4d18ae53ab213 class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/chart_with_seconds.png alt="Chart with Seconds" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ff54a369b7354e61e9f4d18ae53ab213><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/chart_with_seconds.png alt="Chart with Seconds" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Next, let&rsquo;s break down the chart by credit score category. Click on the <strong>Add analytics</strong> button on the first row, select <strong>Mean</strong>, then <strong>Mean:Aggregation</strong>, then Group By the <code>credit_score_category</code> dimension:</p><p><a href=#R-image-5bd0b24a68b03aed16004788e8eb865c class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/duration_by_credit_score.png alt="Duration by Credit Score" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5bd0b24a68b03aed16004788e8eb865c><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/duration_by_credit_score.png alt="Duration by Credit Score" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Now we can see the duration by credit score category. In my example, the green line represents the <code>exceptional</code> category, and we can see that the duration for these requests sometimes goes all the way up to 5 seconds.</p><p>The yellow line represents the <code>very good</code> category, and has very fast response times.</p><p>The magenta line represents the <code>poor</code> category, and has response times between 2-3 seconds.</p><p>It may be useful to save this chart on a dashboard for future reference. To do this, click on the <strong>Save as&mldr;</strong> button and provide a name for the chart:</p><p><a href=#R-image-f3cc2a6c33c78bbf898fdc260f8c3789 class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/save_chart_as.png alt="Save Chart As" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f3cc2a6c33c78bbf898fdc260f8c3789><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/save_chart_as.png alt="Save Chart As" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>When asked which dashboard to save the chart to, let&rsquo;s create a new one named <code>Credit Check Service</code>:</p><p><a href=#R-image-2070d12436065c49e4849336ef2c2f15 class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/create_dashboard.png alt="Save Chart As" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2070d12436065c49e4849336ef2c2f15><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/create_dashboard.png alt="Save Chart As" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Now we can see the chart on our dashboard, and can add more charts as needed to monitor our credit check service:</p><p><a href=#R-image-64439640af62fffeaaf9dcbdc0b619f2 class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/credit_check_service_dashboard.png alt="Credit Check Service Dashboard" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-64439640af62fffeaaf9dcbdc0b619f2><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/credit_check_service_dashboard.png alt="Credit Check Service Dashboard" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h3 id=alerts>Alerts</h3><p>It&rsquo;s great that we have a dashboard to monitor the response times of the credit check service by credit score, but we don&rsquo;t want to stare at a dashboard all day.</p><p>Let&rsquo;s create an alert so we can be notified proactively if customers with <code>exceptional</code> credit scores encounter slow requests.</p><p>To create this alert, click on the little bell on the top right-hand corner of the chart, then select <strong>New detector from chart</strong>:</p><p><a href=#R-image-016a30fab2ae68915d36b359c7c16c40 class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/new_detector_from_chart.png alt="New Detector From Chart" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-016a30fab2ae68915d36b359c7c16c40><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/new_detector_from_chart.png alt="New Detector From Chart" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Let&rsquo;s call the detector <code>Latency by Credit Score Category</code>. Set the environment to your environment name (i.e. <code>tagging-workshop-yourname</code>) then select <code>creditcheckservice</code> as the service. Since we only want to look at performance for customers with <code>exceptional</code> credit scores, add a filter using the <code>credit_score_category</code> dimension and select <code>exceptional</code>:</p><p><a href=#R-image-004f737b38f42f75bc6fb25c74dfe503 class=lightbox-link><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/create_new_detector.png alt="Create New Detector" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-004f737b38f42f75bc6fb25c74dfe503><img src=../../../en/scenarios/understand_impact_of_changes/7-alerting-and-dashboards/../images/create_new_detector.png alt="Create New Detector" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>We can then set the remainder of the alert details as we normally would. The key thing to remember here is that without capturing a tag with the credit score category and indexing it, we wouldn&rsquo;t be able to alert at this granular level, but would instead be forced to bucket all customers together, regardless of their importance to the business.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=summary>Summary</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>2 minutes</span></span><p>In this workshop we learned the following:</p><ul><li>What are tags and why are they such a critical part of making an application observable.</li><li>How to use <a href=https://opentelemetry.io target=_blank><strong>OpenTelemetry</strong></a> to capture tags of interest from your application.</li><li>How to index tags in <strong>Splunk Observability Cloud</strong> and the differences between <strong>Troubleshooting MetricSets</strong> and <strong>Monitoring MetricSets</strong>.</li><li>How to utilize tags in <strong>Splunk Observability Cloud</strong> to find “unknown unknowns” using the <strong>Tag Spotlight</strong> and <strong>Dynamic Service Map</strong> features.</li><li>How to utilize tags for alerting and dashboards.</li></ul><p>Collecting tags aligned with the best practices shared in this workshop will let you get even more value from the data you’re sending to <strong>Splunk Observability Cloud</strong>. Now that you’ve completed this workshop, you have the knowledge you need to start collecting tags from your own applications!</p><p>To get started with capturing tags today, check out <a href=https://docs.splunk.com/observability/en/apm/span-tags/add-context-trace-span.html#instrument-your-application-code-to-add-tags-to-spans target=_blank>how to add tags in various supported languages</a>, and then <a href=https://docs.splunk.com/observability/en/apm/span-tags/index-span-tags.html#apm-index-span-tags target=_blank>how to use them to create Troubleshooting MetricSets</a> so they can be analyzed in Tag Spotlight. For more help, feel free to <a href=https://www.splunk.com/en_us/about-splunk/contact-us.html target=_blank>ask a Splunk Expert</a>.</p><div class="box notices cstyle primary"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Tip for Workshop Facilitator(s)</div><div class=box-content><p>Once the workshop is complete, remember to delete the APM MetricSet you created earlier for the <code>credit.score.category</code> tag.</p></div></div><footer class=footline></footer></article></section></div></main></div><script src=../../../js/clipboard.min.js?1709149813 defer></script>
<script src=../../../js/perfect-scrollbar.min.js?1709149813 defer></script>
<script src=../../../js/theme.js?1709149813 defer></script></body></html>