<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta name=generator content="Relearn 5.23.2+tip"><meta name=description content="Auto-Instrumentation Workshops"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Auto-Instrumentation Workshops :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="Auto-Instrumentation Workshops"><meta property="og:title" content="Auto-Instrumentation Workshops :: Splunk Observability Cloud Workshops"><meta property="og:description" content="Auto-Instrumentation Workshops"><meta property="og:type" content="website"><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.38/en/other/3-auto-instrumentation/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><title>Auto-Instrumentation Workshops :: Splunk Observability Cloud Workshops</title><link href=https://splunk.github.io/observability-workshop/v5.38/en/other/3-auto-instrumentation/index.html rel=canonical type=text/html title="Auto-Instrumentation Workshops :: Splunk Observability Cloud Workshops"><link href=../../../en/other/3-auto-instrumentation/index.xml rel=alternate type=application/rss+xml title="Auto-Instrumentation Workshops :: Splunk Observability Cloud Workshops"><link href=../../../images/favicon.ico?1706259254 rel=icon type=image/x-icon sizes=any><link href=../../../css/fontawesome-all.min.css?1706259260 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/fontawesome-all.min.css?1706259260 rel=stylesheet></noscript><link href=../../../css/nucleus.css?1706259260 rel=stylesheet><link href=../../../css/auto-complete.css?1706259260 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/auto-complete.css?1706259260 rel=stylesheet></noscript><link href=../../../css/perfect-scrollbar.min.css?1706259260 rel=stylesheet><link href=../../../css/fonts.css?1706259260 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/fonts.css?1706259260 rel=stylesheet></noscript><link href=../../../css/theme.css?1706259260 rel=stylesheet><link href=../../../css/theme-splunk-light.css?1706259260 rel=stylesheet id=R-variant-style><link href=../../../css/variant.css?1706259260 rel=stylesheet><link href=../../../css/print.css?1706259260 rel=stylesheet media=print><link href=../../../css/format-print.css?1706259260 rel=stylesheet><link href=../../../css/ie.css?1706259260 rel=stylesheet><script src=../../../js/url.js?1706259260></script>
<script src=../../../js/variant.js?1706259260></script>
<script>window.index_js_url="../../../en/index.search.js";var root_url="../../../",baseUri=root_url.replace(/\/$/,"");window.relearn=window.relearn||{},window.relearn.baseUriFull="https://splunk.github.io/observability-workshop/v5.38/",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script>
<script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script>
<script>SplunkRum.init({beaconUrl:"https://rum-ingest.eu0.signalfx.com/v1/rum",rumAuth:"EDIbCJR4LlxWdXMLjkYX1g",app:"observability-workshop",version:"1",environment:"observability-workshop-env"}),SplunkSessionRecorder.init({beaconUrl:"https://rum-ingest.eu0.signalfx.com/v1/rumreplay",rumAuth:"EDIbCJR4LlxWdXMLjkYX1g"})</script><style>@media screen and (min-width:1000px){#R-body .flex-block-wrapper{margin-left:auto;margin-right:auto;max-width:1400px;width:100%}}:root{--MENU-WIDTH-L:22.5rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../../../en/other/3-auto-instrumentation/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)">
<i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../en/other/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Auto-Instrumentation Workshops</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=auto-instrumentation-workshops>Auto-Instrumentation Workshops</h1><ul class="children children-li children-sort-"><li><a href=../../../en/other/3-auto-instrumentation/1-java/index.html>PetClinic Java Workshop</a><p>A workshop using Zero Configuration Auto-Instrumentation for Java.</p></li><li><a href=../../../en/other/3-auto-instrumentation/2-nodejs/index.html>NodeJS Zero-Config Workshop</a><p>A workshop using Zero Configuration Auto-Instrumentation for NodeJS.</p></li></ul><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Auto-Instrumentation Workshops</h1><article class=default><header class=headline></header><h1 id=petclinic-java-workshop>PetClinic Java Workshop</h1><p>The goal is to walk through the basic steps to configure the following components of the <strong>Splunk Observability Cloud</strong> platform:</p><ul><li>Splunk Infrastructure Monitoring (IM)</li><li>Splunk Zero Configuration Auto Instrumentation for Java (APM)<ul><li>Database Query Performance</li><li>AlwaysOn Profiling</li></ul></li><li>Splunk Real User Monitoring (RUM)</li><li>RUM to APM Correlation</li><li>Splunk Log Observer (LO)</li></ul><p>We will also show the steps about how to clone (download) a sample Java application (Spring PetClinic), as well as how to compile, package and run the application.</p><p>Once the application is up and running, we will instantly start seeing metrics and traces via the <strong>Zero Configuration Auto Instrumentation</strong> for Java that will be used by the <strong>Splunk APM</strong> product.</p><p>After that, we will instrument PetClinic&rsquo;s end user interface (HTML pages rendered by the application) with the <strong>Splunk OpenTelemetry Javascript Libraries (RUM)</strong> that will generate RUM traces around all the individual clicks and page loads executed by an end user.</p><p>Lastly, we will configure the Spring PetClinic application to write application logs to the filesystem and also configure the Splunk OpenTelemetry Collector to read (tail) the logs and send them to <strong>Splunk Cloud</strong>.</p><div class="box notices cstyle primary"><div class=box-label><i class="fa-fw fas fa-info"></i> Prerequisites</div><div class=box-content><ul><li>Outbound SSH access to port <code>2222</code>.</li><li>Outbound HTTP access to port <code>8083</code>.</li><li>Familiarity with the <code>bash</code> shell and <code>vi/vim</code> editor.</li></ul></div></div><p><a href=#R-image-9d4de0781e2ccf50c7f1498d37f78494 class=lightbox-link><img src=../../../en/other/3-auto-instrumentation/1-java/images/petclinic-exercise.png alt="PetClinic Exercise" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9d4de0781e2ccf50c7f1498d37f78494><img src=../../../en/other/3-auto-instrumentation/1-java/images/petclinic-exercise.png alt="PetClinic Exercise" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of PetClinic Java Workshop</h1><article class=default><header class=headline></header><h1 id=installing-the-opentelemetry-collector>Installing the OpenTelemetry Collector</h1><h2 id=1-introduction>1. Introduction</h2><p>The Splunk OpenTelemetry Collector is the core component of instrumenting infrastructure and applications. Its role is to collect and send:</p><ul><li>Infrastructure metrics (disk, CPU, memory, etc)</li><li>Application Performance Monitoring (APM) traces</li><li>Profiling data</li><li>Host and application logs</li></ul><p>Splunk Observability Cloud offers a wizard to walk you through the setup of the Collector on both your infrastructure and applications.</p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Delete any existing OpenTelemetry Collectors</div><div class=box-content><p>If you have completed the Splunk IM workshop, please ensure you have deleted the collector running in Kubernetes before continuing. This can be done by running the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></div></div><h2 id=2-confirm-environment-variables>2. Confirm environment variables</h2><p>To ensure your instance is configured correctly, we need to confirm that the required environment variables for this workshop are set correctly. In your terminal run the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>env</span></span></code></pre></div><p>In the output check the following environment variables are present and have values set:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>ACCESS_TOKEN
</span></span><span class=line><span class=cl>REALM
</span></span><span class=line><span class=cl>RUM_TOKEN
</span></span><span class=line><span class=cl>HEC_TOKEN
</span></span><span class=line><span class=cl>HEC_URL</span></span></code></pre></div><p>For this workshop, <strong>all</strong> of the above are required. If any are missing, please contact your instructor.</p><h2 id=3-install-the-opentelemetry-collector>3. Install the OpenTelemetry Collector</h2><p>We can then go ahead and install the Collector. Some additional parameters are passed to the install script, they are:</p><ul><li><code>--with-instrumentation</code> - This will install the agent from the Splunk distribution of OpenTelemetry Java, which is then loaded automatically when the PetClinic Java application starts up. No configuration is required!</li><li><code>--deployment-environment</code> - Sets the resource attribute <code>deployment.environment</code> to the value passed. This is used to filter views in the UI.</li><li><code>--enable-profiler</code> - Enables the profiler for the Java application. This will generate CPU profiles for the application.</li><li><code>--enable-profiler-memory</code> - Enables the profiler for the Java application. This will generate memory profiles for the application.</li><li><code>--enable-metrics</code> - Enables the exporting of Micrometer metrics</li><li><code>--hec-token</code> - Sets the HEC token for the collector to use</li><li><code>--hec-url</code> - Sets the HEC URL for the collector to use</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo sh /tmp/splunk-otel-collector.sh --realm <span class=nv>$REALM</span> -- <span class=nv>$ACCESS_TOKEN</span> --mode agent --without-fluentd --with-instrumentation --deployment-environment <span class=nv>$INSTANCE</span>-petclinic --enable-profiler --enable-profiler-memory --enable-metrics --hec-token <span class=nv>$HEC_TOKEN</span> --hec-url <span class=nv>$HEC_URL</span></span></span></code></pre></div><p>When prompted to restart services, select &lsquo;OK&rsquo; and press enter.</p><p>Next, we will patch the collector to expose the hostname of the instance and not the AWS instance ID. This will make it easier to filter data in the UI. Run the following command to patch the collector:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo sed -i <span class=s1>&#39;s/gcp, ecs, ec2, azure, system/system, gcp, ecs, ec2, azure/g&#39;</span> /etc/otel/collector/agent_config.yaml</span></span></code></pre></div><p>Once the <code>agent_config.yaml</code> has been patched, you will need to restart the collector:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector</span></span></code></pre></div><p>Once the installation is completed, you can navigate to the <strong>Hosts with agent installed</strong> dashboard to see the data from your host, <strong>Dashboards → Hosts with agent installed</strong>.</p><p>Use the dashboard filter and select <code>host.name</code> and type or select the hostname of your workshop instance (you can get this from the command prompt in your terminal session). Once you see data flowing for your host, we are then ready to get started with the APM component.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=zero-configuration-auto-instrumentation-for-java>Zero Configuration Auto Instrumentation for Java</h1><h2 id=1-spring-petclinic-application>1. Spring PetClinic Application</h2><p>The first thing we need to set up APM is&mldr; well, an application. For this exercise, we will use the Spring PetClinic application. This is a very popular sample Java application built with the Spring framework (Springboot).</p><p>First, clone the PetClinic GitHub repository, and then we will compile, build, package and test the application:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/spring-projects/spring-petclinic</span></span></code></pre></div><p>Change into the <code>spring-petclinic</code> directory (and checkout a specific commit):</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> spring-petclinic <span class=o>&amp;&amp;</span> git checkout 276880e</span></span></code></pre></div><p>Start a MySQL database for PetClinic to use:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d -e <span class=nv>MYSQL_USER</span><span class=o>=</span>petclinic -e <span class=nv>MYSQL_PASSWORD</span><span class=o>=</span>petclinic -e <span class=nv>MYSQL_ROOT_PASSWORD</span><span class=o>=</span>root -e <span class=nv>MYSQL_DATABASE</span><span class=o>=</span>petclinic -p 3306:3306 docker.io/mysql:5.7.8</span></span></code></pre></div><p>Next, we will start a Docker container running Locust that will generate some simple traffic to the PetClinic application. Locust is a simple load-testing tool that can be used to generate traffic to a web application.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --network<span class=o>=</span><span class=s2>&#34;host&#34;</span> -d -p 8090:8090 -v ~/workshop/petclinic:/mnt/locust docker.io/locustio/locust -f /mnt/locust/locustfile.py --headless -u <span class=m>1</span> -r <span class=m>1</span> -H http://127.0.0.1:8083</span></span></code></pre></div><p>Next, run the <code>maven</code> command to compile/build/package PetClinic:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>This will take a few minutes the first time you run, <code>maven</code> will download a lot of dependencies before it compiles the application. Future builds will be a lot quicker.</p></div></div><p>Once the build completes, you need to obtain the public IP address of the instance you are running on. You can do this by running the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl ifconfig.me</span></span></code></pre></div><p>You will see an IP address returned, make a note of this as we will need it to validate that the application is running.</p><p>We also need to obtain the <code>INSTANCE</code> environment variable value, as this is what is being used as the <code>otel.service.name</code> attribute. You can do this by running the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=nv>$INSTANCE</span></span></span></code></pre></div><p>Also, make a note of this value as we will need it to filter the data in the UI.</p><p>You can now run the application with the following command. Notice that we are passing the <code>mysql</code> profile to the application, this will tell the application to use the MySQL database we started earlier. We are also setting the <code>otel.service.name</code> to a logical service name that will also be used in the UI for filtering:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>You can validate if the application is running by visiting <code>http://&lt;IP_ADDRESS>:8083</code> (replace <code>&lt;IP_ADDRESS></code> with the IP address you obtained earlier). You should see the PetClinic application running.</p><h2 id=2-alwayson-profiling-and-metrics>2. AlwaysOn Profiling and Metrics</h2><p>When we installed the collector we configured it to enable <strong>AlwaysOn Profiling</strong> and <strong>Metrics</strong>. This means that the collector will automatically generate CPU and Memory profiles for the application and send them to Splunk Observability Cloud.</p><p>When you start the PetClinic application you will see the collector automatically detect the application and instrument it for traces and profiling.</p><div class=tab-panel data-tab-group=74f1ae26fe86d96d5df7bab29c5abaf7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("74f1ae26fe86d96d5df7bab29c5abaf7","example-output")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Picked up JAVA_TOOL_OPTIONS: -javaagent:/usr/lib/splunk-instrumentation/splunk-otel-javaagent.jar -Dsplunk.profiler.enabled=true -Dsplunk.profiler.memory.enabled=true
</span></span><span class=line><span class=cl>OpenJDK 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:04:661 +0100] [main] INFO io.opentelemetry.javaagent.tooling.VersionLogger - opentelemetry-javaagent - version: splunk-1.25.0-otel-1.27.0
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:05:294 +0100] [main] INFO com.splunk.javaagent.shaded.io.micrometer.core.instrument.push.PushMeterRegistry - publishing metrics for SignalFxMeterRegistry every 30s
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:043 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:044 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - Profiler configuration:
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:047 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                  splunk.profiler.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:048 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                splunk.profiler.directory : /tmp
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:049 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -       splunk.profiler.recording.duration : 20s
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:050 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -               splunk.profiler.keep-files : false
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:051 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -            splunk.profiler.logs-endpoint : null
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:053 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -              otel.exporter.otlp.endpoint : null
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:054 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -           splunk.profiler.memory.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:055 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -             splunk.profiler.tlab.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:056 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -        splunk.profiler.memory.event.rate : 150/s
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:057 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.call.stack.interval : PT10S
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:058 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -  splunk.profiler.include.internal.stacks : false
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:059 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.tracing.stacks.only : false
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:059 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:060 +0100] [main] INFO com.splunk.opentelemetry.profiler.JfrActivator - Profiler is active.</span></span></code></pre></div></div></div></div></div><h2 id=3-review-profiling-data-collection>3. Review Profiling Data Collection</h2><p>You can now visit the Splunk APM UI and examine the application components, traces, profiling, DB Query performance and metrics. From the left-hand menu <strong>APM</strong> → <strong>Explore</strong>, click the environment dropdown and select your environment e.g. <code>&lt;INSTANCE>-petclinic</code> (where<code>&lt;INSTANCE></code> is replaced with the value you noted down earlier).</p><p><a href=#R-image-0fa224c4afb9ef094d76b05a9616ee9c class=lightbox-link><img src=../../../en/other/3-auto-instrumentation/1-java/2-zero-configuration/../images/apm-environment.png alt="APM Environment" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0fa224c4afb9ef094d76b05a9616ee9c><img src=../../../en/other/3-auto-instrumentation/1-java/2-zero-configuration/../images/apm-environment.png alt="APM Environment" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Once your validation is complete you can stop the application by pressing <code>Ctrl-c</code>.</p><h2 id=4-adding-resource-attributes-to-spans>4. Adding Resource Attributes to Spans</h2><p>Resource attributes can be added to every reported span. For example <code>version=0.314</code>. A comma-separated list of resource attributes can also be defined e.g. <code>key1=val1,key2=val2</code>.</p><p>Let&rsquo;s launch the PetClinic again using new resource attributes. Note, that adding resource attributes to the run command will override what was defined when we installed the collector. Let&rsquo;s add two new resource attributes <code>deployment.environment=$INSTANCE-petclinic-env,version=0.314</code>:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-env,version<span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>Back in the Splunk APM UI we can drill down on a recent trace and see the new <code>version</code> attribute in a span.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=3-real-user-monitoring>3. Real User Monitoring</h1><h2 id=1-enable-rum>1. Enable RUM</h2><p>For the Real User Monitoring (RUM) instrumentation, we will add the Open Telemetry Javascript <a href=https://github.com/signalfx/splunk-otel-js-web target=_blank><strong>https://github.com/signalfx/splunk-otel-js-web</strong></a> snippet in the pages, we will use the wizard again <strong>Data Management → Add Integration → RUM Instrumentation → Browser Instrumentation</strong>.</p><p>Your instructor will inform you which token to use from the dropdown, click <strong>Next</strong>. Enter <strong>App name</strong> and <strong>Environment</strong> using the following syntax:</p><ul><li><code>&lt;INSTANCE>-petclinic-service</code> - replacing <code>&lt;INSTANCE></code> with the value you noted down earlier.</li><li><code>&lt;INSTANCE>-petclinic-env</code> - replacing <code>&lt;INSTANCE></code> with the value you noted down earlier.</li></ul><p>The wizard will then show a snippet of HTML code that needs to be placed at the top of the pages in the <code>&lt;head></code> section. The following is an example of the (do not use this snippet, use the one generated by the wizard):</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>/*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>IMPORTANT: Replace the <span class=p>&lt;</span><span class=nt>version</span><span class=p>&gt;</span> placeholder in the src URL with a
</span></span><span class=line><span class=cl>version from https://github.com/signalfx/splunk-otel-js-web/releases
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*/
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>realm</span><span class=o>:</span> <span class=s2>&#34;eu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>rumAccessToken</span><span class=o>:</span> <span class=s2>&#34;&lt;redacted&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>applicationName</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>deploymentEnvironment</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-env&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div><p>The Spring PetClinic application uses a single HTML page as the &ldquo;layout&rdquo; page, that is reused across all pages of the application. This is the perfect location to insert the Splunk RUM Instrumentation Library as it will be loaded in all pages automatically.</p><p>Let&rsquo;s then edit the layout page:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi src/main/resources/templates/fragments/layout.html</span></span></code></pre></div><p>Next, insert the snippet we generated above in the <code>&lt;head></code> section of the page. Make sure you don&rsquo;t include the comment and replace <code>&lt;version></code> in the source URL to <code>latest</code> e.g.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!doctype html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>th:fragment</span><span class=o>=</span><span class=s>&#34;layout (template, menu)&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>realm</span><span class=o>:</span> <span class=s2>&#34;eu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>rumAccessToken</span><span class=o>:</span> <span class=s2>&#34;&lt;redacted&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>applicationName</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>deploymentEnvironment</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-env&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>...</span></span></code></pre></div><h2 id=2-rebuild-petclinic>2. Rebuild PetClinic</h2><p>With the code changes complete, we need to rebuild the application and run it again. Run the <code>maven</code> command to compile/build/package PetClinic:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-env,version<span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>Then let&rsquo;s visit the application using a browser to generate real-user traffic <code>http://&lt;IP_ADDRESS>:8083</code>.</p><p>In RUM, filter down into the environment as defined in the RUM snippet above and click through to the dashboard.</p><p>When you drill down into a RUM trace you will see a link to APM in the spans. Clicking on the trace ID will take you to the corresponding APM trace for the current RUM trace.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=4-log-observer>4. Log Observer</h1><h2 id=1-introduction>1. Introduction</h2><p>For the Splunk Log Observer component, we will configure the Spring PetClinic application to write logs to a file and configure the Splunk OpenTelemetry Collector to read (tail) that log file and send the logs to Splunk Cloud.</p><h2 id=2-opentelemetry-filelog-configuration>2. OpenTelemetry Filelog Configuration</h2><p>We need to configure the Splunk OpenTelemetry Collector to tail the Spring PetClinic log file and send the log data to Splunk Cloud.</p><p>The Splunk OpenTelemetry Collector uses <strong>Fluentd</strong> by default but we will change the configuration to use the OpenTelemetry <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/receiver/filelogreceiver/README.md target=_blank><strong>Filelog Receiver</strong></a> to consume the logs. We will need to edit the collectors&rsquo; configuration file:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/otel/collector/agent_config.yaml</span></span></code></pre></div><p>Under the <code>receivers:</code> section create the Filelog Receiver (make sure to indent correctly):</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>filelog</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>include</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>/tmp/spring-petclinic.log]</span></span></span></code></pre></div><p>Then under the <code>service:</code> section, find the <code>logs:</code> pipeline, replace <code>fluentforward</code> with<code>filelog</code> (again, make sure to indent correctly):</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>filelog, otlp]</span></span></span></code></pre></div><p>Save the file and exit the editor. Next, we need to validate that the HEC Token and HEC URL are configured for the collector to use. We will inspect the <code>/etc/otel/collector/splunk-otel-collector.conf</code> file:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo cat /etc/otel/collector/splunk-otel-collector.conf</span></span></code></pre></div><p>Make sure <code>SPLUNK_HEC_URL</code> and <code>SPLUNK_HEC_TOKEN</code> have values set. If they are not set, please reach out to your instructor. With the configuration change complete and validated, we can now restart the collector:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector</span></span></code></pre></div><h2 id=3-logback-settings>3. Logback Settings</h2><p>The Spring PetClinic application can be configured to use several different Java logging libraries. In this scenario, we are going to use <code>logback</code>. We just need to create a file named <code>logback.xml</code> in the configuration folder:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi ~/spring-petclinic/src/main/resources/logback.xml</span></span></code></pre></div><p>Copy and paste the following XML content:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE xml&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;configuration</span> <span class=na>scan=</span><span class=s>&#34;true&#34;</span> <span class=na>scanPeriod=</span><span class=s>&#34;30 seconds&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;contextListener</span> <span class=na>class=</span><span class=s>&#34;ch.qos.logback.classic.jul.LevelChangePropagator&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;resetJUL&gt;</span>true<span class=nt>&lt;/resetJUL&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/contextListener&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;logger</span> <span class=na>name=</span><span class=s>&#34;org.springframework.samples.petclinic&#34;</span> <span class=na>level=</span><span class=s>&#34;info&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;appender</span> <span class=na>name=</span><span class=s>&#34;file&#34;</span> <span class=na>class=</span><span class=s>&#34;ch.qos.logback.core.rolling.RollingFileAppender&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;file&gt;</span>/tmp/spring-petclinic.log<span class=nt>&lt;/file&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;rollingPolicy</span> <span class=na>class=</span><span class=s>&#34;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;fileNamePattern&gt;</span>springLogFile.%d{yyyy-MM-dd}.log<span class=nt>&lt;/fileNamePattern&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;maxHistory&gt;</span>5<span class=nt>&lt;/maxHistory&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;totalSizeCap&gt;</span>1GB<span class=nt>&lt;/totalSizeCap&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/rollingPolicy&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;encoder&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;pattern&gt;</span>
</span></span><span class=line><span class=cl>        %d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg trace_id=%X{trace_id} span_id=%X{span_id} trace_flags=%X{trace_flags} %n service.name=%property{otel.resource.service.name}, deployment.environment=%property{otel.resource.deployment.environment}: %m%n
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/pattern&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/encoder&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/appender&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;root</span> <span class=na>level=</span><span class=s>&#34;info&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;appender-ref</span> <span class=na>ref=</span><span class=s>&#34;file&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/root&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span></span></span></code></pre></div><p>Now we need to rebuild the application and run it again:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><p>Once the rebuild has been completed we can then run the application again:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-env,version<span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><h2 id=4-view-logs>4. View Logs</h2><p>From the left-hand menu click on <strong>Log Observer</strong> and ensure <strong>Index</strong> is set to <strong>splunk4rookies-workshop</strong>.</p><p>Next, click <strong>Add Filter</strong> search for the field <code>service_name</code> select the value <code>&lt;INSTANCE>-petclinic-service</code> and click <code>=</code> (include). You should now see only the log messages from your PetClinic application.</p><p><a href=#R-image-521772b8593ce3dde4d9cd883bddff8e class=lightbox-link><img src=../../../en/other/3-auto-instrumentation/1-java/4-log-observer-connect/../images/log-observer.png alt="Log Observer" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-521772b8593ce3dde4d9cd883bddff8e><img src=../../../en/other/3-auto-instrumentation/1-java/4-log-observer-connect/../images/log-observer.png alt="Log Observer" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=4-summary>4. Summary</h2><p>This is the end of the workshop and we have certainly covered a lot of ground. At this point, you should have metrics, traces (APM & RUM), logs, database query performance and code profiling being reported into Splunk Observability Cloud.</p><p><strong>Congratulations!</strong></p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=nodejs-zero-config-workshop>NodeJS Zero-Config Workshop</h1><p><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>30 minutes</span></span> <span class="badge cstyle blue badge-with-title"><span class=badge-title>Author</span><span class=badge-content>Robert Castley</span></span></p><p>The goal is to walk through the basic steps to configure the following components of the <strong>Splunk Observability Cloud</strong> platform:</p><ul><li>Splunk Infrastructure Monitoring (IM)</li><li>Splunk Zero Configuration Auto Instrumentation for NodeJS (APM)<ul><li>AlwaysOn Profiling</li></ul></li><li>Splunk Log Observer (LO)</li></ul><p>We will deploy the OpenTelemetry Astronomy Shop application in Kubernetes, which contains two NodeJS services (<strong>Frontend</strong> & <strong>Payment Service</strong>). Once the application and the OpenTelemetry Connector are up and running, we will start seeing metrics, traces and logs via the <strong>Zero Configuration Auto Instrumentation</strong> for NodeJS that will be used by the <strong>Splunk Observability Cloud</strong> platform to provide insights into the application.</p><div class="box notices cstyle primary"><div class=box-label><i class="fa-fw fas fa-info"></i> Prerequisites</div><div class=box-content><ul><li>Outbound SSH access to port <code>2222</code>.</li><li>Outbound HTTP access to port <code>8083</code>.</li><li>Familiarity with the <code>bash</code> shell and <code>vi/vim</code> editor.</li></ul></div></div><p>Next, we will deploy the <strong>OpenTelemetry Demo</strong>.</p><pre class="mermaid align-center">
graph TD
subgraph Service Diagram
accountingservice(Accounting Service):::golang
adservice(Ad Service):::java
cache[(Cache)]
cartservice(Cart Service):::dotnet
checkoutservice(Checkout Service):::golang
currencyservice(Currency Service):::cpp
emailservice(Email Service):::ruby
frauddetectionservice(Fraud Detection Service):::kotlin
frontend(Frontend):::typescript
frontendproxy(Frontend Proxy):::cpp
loadgenerator([Load Generator]):::python
paymentservice(Payment Service):::javascript
productcatalogservice(Product Catalog Service):::golang
quoteservice(Quote Service):::php
recommendationservice(Recommendation Service):::python
shippingservice(Shipping Service):::rust
featureflagservice(Feature Flag Service):::erlang
featureflagstore[(Feature Flag Store)]
queue[(queue)]
Internet --&gt;|HTTP| frontendproxy
frontendproxy --&gt;|HTTP| frontend
frontendproxy --&gt;|HTTP| featureflagservice
loadgenerator --&gt;|HTTP| frontendproxy
accountingservice --&gt;|TCP| queue
cartservice ---&gt;|gRPC| featureflagservice
checkoutservice ---&gt;|gRPC| cartservice --&gt; cache
checkoutservice ---&gt;|gRPC| productcatalogservice
checkoutservice ---&gt;|gRPC| currencyservice
checkoutservice ---&gt;|HTTP| emailservice
checkoutservice ---&gt;|gRPC| paymentservice
checkoutservice --&gt;|gRPC| shippingservice
checkoutservice ---&gt;|TCP| queue
frontend --&gt;|gRPC| adservice
frontend --&gt;|gRPC| cartservice
frontend --&gt;|gRPC| productcatalogservice
frontend --&gt;|gRPC| checkoutservice
frontend --&gt;|gRPC| currencyservice
frontend --&gt;|gRPC| recommendationservice --&gt;|gRPC| productcatalogservice
frontend --&gt;|gRPC| shippingservice --&gt;|HTTP| quoteservice
frauddetectionservice --&gt;|TCP| queue
adservice ---&gt;|gRPC| featureflagservice
productcatalogservice --&gt;|gRPC| featureflagservice
recommendationservice --&gt;|gRPC| featureflagservice
shippingservice --&gt;|gRPC| featureflagservice
featureflagservice --&gt; featureflagstore
end

classDef dotnet fill:#178600,color:white;
classDef cpp fill:#f34b7d,color:white;
classDef erlang fill:#b83998,color:white;
classDef golang fill:#00add8,color:black;
classDef java fill:#b07219,color:white;
classDef javascript fill:#f1e05a,color:black;
classDef kotlin fill:#560ba1,color:white;
classDef php fill:#4f5d95,color:white;
classDef python fill:#3572A5,color:white;
classDef ruby fill:#701516,color:white;
classDef rust fill:#dea584,color:black;
classDef typescript fill:#e98516,color:black;
</pre><pre class="mermaid align-center">
graph TD
subgraph Service Legend
  dotnetsvc(.NET):::dotnet
  cppsvc(C&#43;&#43;):::cpp
  erlangsvc(Erlang/Elixir):::erlang
  golangsvc(Go):::golang
  javasvc(Java):::java
  javascriptsvc(JavaScript):::javascript
  kotlinsvc(Kotlin):::kotlin
  phpsvc(PHP):::php
  pythonsvc(Python):::python
  rubysvc(Ruby):::ruby
  rustsvc(Rust):::rust
  typescriptsvc(TypeScript):::typescript
end

classDef dotnet fill:#178600,color:white;
classDef cpp fill:#f34b7d,color:white;
classDef erlang fill:#b83998,color:white;
classDef golang fill:#00add8,color:black;
classDef java fill:#b07219,color:white;
classDef javascript fill:#f1e05a,color:black;
classDef kotlin fill:#560ba1,color:white;
classDef php fill:#4f5d95,color:white;
classDef python fill:#3572A5,color:white;
classDef ruby fill:#701516,color:white;
classDef rust fill:#dea584,color:black;
classDef typescript fill:#e98516,color:black;
</pre><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of NodeJS Zero-Config Workshop</h1><article class=default><header class=headline></header><h1 id=deploying-the-opentelemetry-demo>Deploying the OpenTelemetry Demo</h1><h2 id=1-create-a-namespace>1. Create a namespace</h2><p>To not conflict with other workshops, we will deploy the OpenTelemetry Demo in a separate namespace called <code>otel-demo</code>. To create the namespace, run the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create namespace otel-demo</span></span></code></pre></div><h2 id=2-deploy-the-opentelemetry-demo>2. Deploy the OpenTelemetry Demo</h2><p>Next, change to the directory containing the OpenTelemetry Demo application:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/workshop/apm</span></span></code></pre></div><p>Deploy the OpenTelemetry Demo application:</p><div class=tab-panel data-tab-group=f940bbb5f4b39b75b60ddddbaafaada4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("f940bbb5f4b39b75b60ddddbaafaada4","command")'>
<span class=tab-nav-text>Command</span></button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("f940bbb5f4b39b75b60ddddbaafaada4","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -n otel-demo -f otel-demo.yaml</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>serviceaccount/opentelemetry-demo created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-adservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-cartservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-checkoutservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-currencyservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-emailservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-featureflagservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-ffspostgres created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-frontend created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-kafka created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-loadgenerator created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-paymentservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-productcatalogservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-quoteservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-recommendationservice created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-redis created
</span></span><span class=line><span class=cl>service/opentelemetry-demo-shippingservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-accountingservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-adservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-cartservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-checkoutservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-currencyservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-emailservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-featureflagservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-ffspostgres created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-frauddetectionservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-frontend created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-kafka created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-loadgenerator created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-paymentservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-productcatalogservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-quoteservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-recommendationservice created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-redis created
</span></span><span class=line><span class=cl>deployment.apps/opentelemetry-demo-shippingservice created</span></span></code></pre></div></div></div></div></div><p>Once the application is deployed, we need to wait for the pods to be in a <code>Running</code> state. To check the status of the pods, run the following command:</p><div class=tab-panel data-tab-group=bc0f7c16030fa4b1666809e70ffa4d17><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("bc0f7c16030fa4b1666809e70ffa4d17","command")'>
<span class=tab-nav-text>Command</span></button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("bc0f7c16030fa4b1666809e70ffa4d17","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods -n otel-demo</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                                        READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>opentelemetry-demo-emailservice-847d6fb577-bxll6            1/1     Running   0          40s
</span></span><span class=line><span class=cl>opentelemetry-demo-ffspostgres-55f65465dd-2gsj4             1/1     Running   0          40s
</span></span><span class=line><span class=cl>opentelemetry-demo-adservice-5b7c68859d-5hx5f               1/1     Running   0          40s
</span></span><span class=line><span class=cl>opentelemetry-demo-currencyservice-c4cb78446-qsd68          1/1     Running   0          40s
</span></span><span class=line><span class=cl>opentelemetry-demo-frontend-5d7cdb8786-5dl76                1/1     Running   0          39s
</span></span><span class=line><span class=cl>opentelemetry-demo-kafka-79868d56d8-62wsd                   1/1     Running   0          39s
</span></span><span class=line><span class=cl>opentelemetry-demo-paymentservice-5cb4ccc47c-65hxl          1/1     Running   0          39s
</span></span><span class=line><span class=cl>opentelemetry-demo-productcatalogservice-59d955f9d6-xtnjr   1/1     Running   0          38s
</span></span><span class=line><span class=cl>opentelemetry-demo-loadgenerator-755d6cd5b-r5lqs            1/1     Running   0          39s
</span></span><span class=line><span class=cl>opentelemetry-demo-quoteservice-5fbfb97778-vm62m            1/1     Running   0          38s
</span></span><span class=line><span class=cl>opentelemetry-demo-redis-57c49b7b5b-b2klr                   1/1     Running   0          37s
</span></span><span class=line><span class=cl>opentelemetry-demo-shippingservice-6667f69f78-cwj8q         1/1     Running   0          37s
</span></span><span class=line><span class=cl>opentelemetry-demo-recommendationservice-749f55f9b6-5k4lc   1/1     Running   0          37s
</span></span><span class=line><span class=cl>opentelemetry-demo-featureflagservice-67677647c-85xtm       1/1     Running   0          40s
</span></span><span class=line><span class=cl>opentelemetry-demo-checkoutservice-5474bf74b8-2nmns         1/1     Running   0          40s
</span></span><span class=line><span class=cl>opentelemetry-demo-frauddetectionservice-77fd69d967-lnjcg   1/1     Running   0          39s
</span></span><span class=line><span class=cl>opentelemetry-demo-accountingservice-96d44cfbc-vmtzb        1/1     Running   0          40s
</span></span><span class=line><span class=cl>opentelemetry-demo-cartservice-7c4f59bdd5-rfkf4             1/1     Running   0          40s</span></span></code></pre></div></div></div></div></div><h2 id=3-validate-the-application-is-running>3. Validate the application is running</h2><p>To validate the application is running, we will port-forward the frontend service. To do this, run the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl port-forward svc/opentelemetry-demo-frontend 8083:8080 -n otel-demo --address<span class=o>=</span><span class=s1>&#39;0.0.0.0&#39;</span></span></span></code></pre></div><p>Obtain the <strong>public IP address</strong> of the instance you are running on. You can do this by running the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl ifconfig.me</span></span></code></pre></div><p>Once the port-forward is running, you can access the application by opening a browser and navigating to <code>http://&lt;public IP address>:8083</code>. You should see the following:</p><p><a href=#R-image-3d027d89ddabc5be5c35b4350782a901 class=lightbox-link><img src=../../../en/other/3-auto-instrumentation/2-nodejs/1-otel-demo/../images/otel-demo.png alt="OpenTelemetry Demo" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-3d027d89ddabc5be5c35b4350782a901><img src=../../../en/other/3-auto-instrumentation/2-nodejs/1-otel-demo/../images/otel-demo.png alt="OpenTelemetry Demo" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Once you have confirmed the application is running, you can close the port-forward by pressing <code>ctrl + c</code>.</p><p>Next, we will deploy the <strong>OpenTelemetry Collector</strong>.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=installing-the-opentelemetry-collector>Installing the OpenTelemetry Collector</h1><h2 id=1-introduction>1. Introduction</h2><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Delete any existing OpenTelemetry Collectors</div><div class=box-content><p>If you have completed any other Observability workshops, please ensure you delete the collector running in Kubernetes before continuing. This can be done by running the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></div></div><h2 id=2-confirm-environment-variables>2. Confirm environment variables</h2><p>To ensure your instance is configured correctly, we need to confirm that the required environment variables for this workshop are set correctly. In your terminal run the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>env</span></span></code></pre></div><p>In the output check the following environment variables are present and have values set:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>ACCESS_TOKEN
</span></span><span class=line><span class=cl>REALM
</span></span><span class=line><span class=cl>RUM_TOKEN
</span></span><span class=line><span class=cl>HEC_TOKEN
</span></span><span class=line><span class=cl>HEC_URL</span></span></code></pre></div><p>For this workshop, <strong>all</strong> of the above are required. If any are missing, please contact your instructor.</p><h2 id=3-install-the-opentelemetry-collector>3. Install the OpenTelemetry Collector</h2><p>We can then go ahead and install the Collector. Some additional parameters are passed to the <code>helm install</code> command, they are:</p><ul><li><code>--set="operator.enabled=true"</code> - Enabled the Splunk OpenTelemetry Collector Operator for Kubernetes.</li><li><code>--set="certmanager.enabled=true"</code> - The cert-manager adds certificates and certificate issuers as resource types in Kubernetes clusters and simplifies the process of obtaining, renewing and using those certificates.</li><li><code>--set="splunkObservability.profilingEnabled=true"</code> - Enables CPU/Memory profiling for supported languages.</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart <span class=o>&amp;&amp;</span> helm repo update</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;operator.enabled=true&#34;</span>, <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;certmanager.enabled=true&#34;</span>, <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.logsEnabled=false&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;logsEngine=otel&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.profilingEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.infrastructureMonitoringEventsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;environment=</span><span class=nv>$INSTANCE</span><span class=s2>-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.endpoint=</span><span class=nv>$HEC_URL</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.token=</span><span class=nv>$HEC_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.index=splunk4rookies-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/otel-collector.yaml</span></span></code></pre></div><p>Once the installation is completed, you can navigate to the <strong>Kubernetes Navigator</strong> to see the data from your host.</p><p>Click on <strong>Add filters</strong> select <code>k8s.cluster.name</code> and select the cluster of your workshop instance.
You can determine your instance name from the command prompt in your terminal session:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=nv>$INSTANCE</span></span></span></code></pre></div><p>Once you see data flowing for your host, we are then ready to get started with the APM component.</p><p><a href=#R-image-82729e94c446be732e7460126f46ee17 class=lightbox-link><img src=../../../en/other/3-auto-instrumentation/2-nodejs/2-otel-collector/../images/k8s-navigator.png alt="Kubernetes Navigator" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-82729e94c446be732e7460126f46ee17><img src=../../../en/other/3-auto-instrumentation/2-nodejs/2-otel-collector/../images/k8s-navigator.png alt="Kubernetes Navigator" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=zero-configuration---frontend-service>Zero Configuration - Frontend Service</h1><h2 id=1-patching-the-frontend-service>1. Patching the Frontend service</h2><p>First, confirm that you can see your environment in <strong>APM</strong>. There should be a service called <code>loadgenerator</code> displayed in the Service map.</p><p><a href=#R-image-9bbb59edf4822df6450870062acdecaa class=lightbox-link><img src=../../../en/other/3-auto-instrumentation/2-nodejs/3-frontend-service/../images/apm-servicemap.png alt="APM Service Map" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9bbb59edf4822df6450870062acdecaa><img src=../../../en/other/3-auto-instrumentation/2-nodejs/3-frontend-service/../images/apm-servicemap.png alt="APM Service Map" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Next, we will patch the <code>frontend</code> deployment with an annotation to inject the NodeJS auto instrumentation. This will allow us to see the <code>frontend</code> service in <strong>APM</strong>. Note, that at this point we have not edited any code.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl patch deployment opentelemetry-demo-frontend -n otel-demo -p <span class=s1>&#39;{&#34;spec&#34;: {&#34;template&#34;:{&#34;metadata&#34;:{&#34;annotations&#34;:{&#34;instrumentation.opentelemetry.io/inject-nodejs&#34;:&#34;default/splunk-otel-collector&#34;}}}} }&#39;</span></span></span></code></pre></div><ul><li>This will cause the <code>opentelemetry-demo-frontend</code> pod to restart.</li><li>The annotation value <code>default/splunk-otel-collector</code> refers to the instrumentation configuration named <code>splunk-otel-collector</code> in the <code>default</code> namespace.</li><li>If the chart is not installed in the <code>default</code> namespace, modify the annotation value to be <code>{chart_namespace}/splunk-otel-collector</code>.</li></ul><p>After a few minutes, you should see the <code>frontend</code> service in <strong>APM</strong>.</p><p><a href=#R-image-eb9f8bd546bd0a6fe39bda844545bc23 class=lightbox-link><img src=../../../en/other/3-auto-instrumentation/2-nodejs/3-frontend-service/../images/apm-frontend.png alt=Frontend class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-eb9f8bd546bd0a6fe39bda844545bc23><img src=../../../en/other/3-auto-instrumentation/2-nodejs/3-frontend-service/../images/apm-frontend.png alt=Frontend class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>With the <code>frontend</code> service highlighted, click on the <strong>Traces</strong> tab to see the traces for the service. Select one of the traces and confirm that the trace contains metadata confirming that the Splunk Zero-Configuration Auto-Instrumentation for NodeJS is being used.</p><p><a href=#R-image-f36b998703aa7038fde7ac8ccdc08707 class=lightbox-link><img src=../../../en/other/3-auto-instrumentation/2-nodejs/3-frontend-service/../images/apm-frontend-trace.png alt="Zero Configuration" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f36b998703aa7038fde7ac8ccdc08707><img src=../../../en/other/3-auto-instrumentation/2-nodejs/3-frontend-service/../images/apm-frontend-trace.png alt="Zero Configuration" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=zero-configuration---payment-service>Zero Configuration - Payment Service</h1><h2 id=1-patching-the-payment-service>1. Patching the Payment Service</h2><p>Finally, we will patch the <code>paymentservice</code> deployment with an annotation to inject the NodeJS auto instrumentation. This will allow us to see the <code>paymentservice</code> service in <strong>APM</strong>.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl patch deployment opentelemetry-demo-paymentservice -n otel-demo -p <span class=s1>&#39;{&#34;spec&#34;: {&#34;template&#34;:{&#34;metadata&#34;:{&#34;annotations&#34;:{&#34;instrumentation.opentelemetry.io/inject-nodejs&#34;:&#34;default/splunk-otel-collector&#34;}}}} }&#39;</span></span></span></code></pre></div><p>This will cause the <code>opentelemetry-demo-paymentservice</code> pod to restart and after a few minutes, you should see the <code>paymentservice</code> service in <strong>APM</strong>.</p><p><a href=#R-image-b1e1e6e0db7116ad49c18fd17ab72843 class=lightbox-link><img src=../../../en/other/3-auto-instrumentation/2-nodejs/4-payment-service/../images/apm-paymentservice.png alt=Paymentservice class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b1e1e6e0db7116ad49c18fd17ab72843><img src=../../../en/other/3-auto-instrumentation/2-nodejs/4-payment-service/../images/apm-paymentservice.png alt=Paymentservice class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=code-profiling---payment-service>Code Profiling - Payment Service</h1><h2 id=1-alwayson-profiling-for-the-payment-service>1. AlwaysOn Profiling for the Payment Service</h2><p><strong>AlwaysOn Profiling</strong> is a feature of the Splunk Distribution of OpenTelemetry Collector that allows you to collect CPU and Memory profiling data for your services without having to modify your code. This is useful for troubleshooting performance issues in your services. Here are some of the benefits of AlwaysOn Profiling:</p><ul><li>Perform continuous profiling of your applications. The profiler is always on once you activate it.</li><li>Collect code performance context and link it to trace data.</li><li>Explore memory usage and garbage collection of your application.</li><li>Analyze code bottlenecks that impact service performance.</li><li>Identify inefficiencies that increase the need for scaling up cloud resources.</li></ul><p>With the <code>opentelemetry-demo-paymentservice</code> selected, click on <strong>AlwaysOn Profiling</strong> to view the code profiling data for the service.</p><p><a href=#R-image-adb97b8bc36c2540dbb879d50d02a375 class=lightbox-link><img src=../../../en/other/3-auto-instrumentation/2-nodejs/5-profiling/../images/alwayson-profiling.png alt="AlwaysOn Profiling" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-adb97b8bc36c2540dbb879d50d02a375><img src=../../../en/other/3-auto-instrumentation/2-nodejs/5-profiling/../images/alwayson-profiling.png alt="AlwaysOn Profiling" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Here you can see the CPU and Memory profiling data for the <code>paymentservice</code> service. You can also see the CPU and Memory profiling data for the <code>frontend</code> service by selecting the <code>opentelemetry-demofrontend</code> service from the <strong>Service</strong> dropdown.</p><p><a href=#R-image-854089cd2303c1949511007d1f461d6f class=lightbox-link><img src=../../../en/other/3-auto-instrumentation/2-nodejs/5-profiling/../images/profiling-service.png alt="Profiling Service" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-854089cd2303c1949511007d1f461d6f><img src=../../../en/other/3-auto-instrumentation/2-nodejs/5-profiling/../images/profiling-service.png alt="Profiling Service" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=logs---payment-service>Logs - Payment Service</h1><h2 id=1-viewing-the-logs-for-the-payment-service>1. Viewing the logs for the Payment Service</h2><p>Navigate back to APM from the main menu and under <strong>Services</strong> click on <code>opentelemetry-demo-paymentservice</code>. This will open up the Service map for the <code>paymentservice</code> service only.</p><p>At the bottom of the page, click on the <strong>Logs(1)</strong> tab to view the logs for the <code>paymentservice</code> service.</p><p><a href=#R-image-fb0b304d9c600503f850ca0154d3cc49 class=lightbox-link><img src=../../../en/other/3-auto-instrumentation/2-nodejs/6-logs/../images/related-logs.png alt="Related Logs" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fb0b304d9c600503f850ca0154d3cc49><img src=../../../en/other/3-auto-instrumentation/2-nodejs/6-logs/../images/related-logs.png alt="Related Logs" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Once in <strong>Log Observer</strong> select one of the log entries to view the metadata for the log entry.</p><p><a href=#R-image-99d7a7073e40e40c074e5bbcdd853d49 class=lightbox-link><img src=../../../en/other/3-auto-instrumentation/2-nodejs/6-logs/../images/log-entry.png alt="Log Entry" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-99d7a7073e40e40c074e5bbcdd853d49><img src=../../../en/other/3-auto-instrumentation/2-nodejs/6-logs/../images/log-entry.png alt="Log Entry" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article></section></section></div></main></div><script src=../../../js/clipboard.min.js?1706259261 defer></script>
<script src=../../../js/perfect-scrollbar.min.js?1706259261 defer></script>
<script src=../../../js/d3/d3-color.min.js?1706259261 defer></script>
<script src=../../../js/d3/d3-dispatch.min.js?1706259261 defer></script>
<script src=../../../js/d3/d3-drag.min.js?1706259261 defer></script>
<script src=../../../js/d3/d3-ease.min.js?1706259261 defer></script>
<script src=../../../js/d3/d3-interpolate.min.js?1706259261 defer></script>
<script src=../../../js/d3/d3-selection.min.js?1706259261 defer></script>
<script src=../../../js/d3/d3-timer.min.js?1706259261 defer></script>
<script src=../../../js/d3/d3-transition.min.js?1706259261 defer></script>
<script src=../../../js/d3/d3-zoom.min.js?1706259261 defer></script>
<script src=../../../js/js-yaml.min.js?1706259261 defer></script>
<script src=../../../js/mermaid.min.js?1706259261 defer></script>
<script>window.themeUseMermaid=JSON.parse("{}")</script><script src=../../../js/theme.js?1706259261 defer></script></body></html>