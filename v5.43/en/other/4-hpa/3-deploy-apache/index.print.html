<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta name=generator content="Relearn 5.25.0+tip"><meta name=description content="Splunk Observability Workshops"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Deploying PHP/Apache :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="1. Namespaces in Kubernetes Most of our customers will make use of some kind of private or public cloud service to run Kubernetes. They often choose to have only a few large Kubernetes clusters as it is easier to manage centrally.
Namespaces are a way to organize these large Kubernetes clusters into virtual sub-clusters. This can be helpful when different teams or projects share a Kubernetes cluster as this will give them the easy ability to just see and work with their resources."><meta property="og:title" content="Deploying PHP/Apache :: Splunk Observability Cloud Workshops"><meta property="og:description" content="1. Namespaces in Kubernetes Most of our customers will make use of some kind of private or public cloud service to run Kubernetes. They often choose to have only a few large Kubernetes clusters as it is easier to manage centrally.
Namespaces are a way to organize these large Kubernetes clusters into virtual sub-clusters. This can be helpful when different teams or projects share a Kubernetes cluster as this will give them the easy ability to just see and work with their resources."><meta property="og:type" content="article"><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.43/en/other/4-hpa/3-deploy-apache/index.html"><meta property="article:section" content="Monitoring Horizontal Pod Autoscaling in Kubernetes :: Splunk Observability Cloud Workshops"><meta property="article:modified_time" content="2024-02-06T11:52:03+00:00"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><title>Deploying PHP/Apache :: Splunk Observability Cloud Workshops</title><link href=https://splunk.github.io/observability-workshop/v5.43/en/other/4-hpa/3-deploy-apache/index.html rel=canonical type=text/html title="Deploying PHP/Apache :: Splunk Observability Cloud Workshops"><link href=../../../../en/other/4-hpa/3-deploy-apache/index.xml rel=alternate type=application/rss+xml title="Deploying PHP/Apache :: Splunk Observability Cloud Workshops"><link href=../../../../images/favicon.ico?1710879578 rel=icon type=image/x-icon sizes=any><link href=../../../../css/fontawesome-all.min.css?1710879585 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../css/fontawesome-all.min.css?1710879585 rel=stylesheet></noscript><link href=../../../../css/nucleus.css?1710879585 rel=stylesheet><link href=../../../../css/auto-complete.css?1710879585 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../css/auto-complete.css?1710879585 rel=stylesheet></noscript><link href=../../../../css/perfect-scrollbar.min.css?1710879585 rel=stylesheet><link href=../../../../css/fonts.css?1710879585 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../css/fonts.css?1710879585 rel=stylesheet></noscript><link href=../../../../css/theme.css?1710879585 rel=stylesheet><link href=../../../../css/theme-splunk-light.css?1710879585 rel=stylesheet id=R-variant-style><link href=../../../../css/chroma-relearn-light.css?1710879585 rel=stylesheet id=R-variant-chroma-style><link href=../../../../css/variant.css?1710879585 rel=stylesheet><link href=../../../../css/print.css?1710879585 rel=stylesheet media=print><link href=../../../../css/format-print.css?1710879585 rel=stylesheet><link href=../../../../css/ie.css?1710879585 rel=stylesheet><script src=../../../../js/url.js?1710879585></script>
<script src=../../../../js/variant.js?1710879585></script>
<script>window.index_js_url="../../../../en/index.search.js";var root_url="../../../../",baseUri=root_url.replace(/\/$/,"");window.relearn=window.relearn||{},window.relearn.baseUriFull="https://splunk.github.io/observability-workshop/v5.43/",window.relearn.themeVariantModifier="",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script>
<script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script>
<script>(function(){var t,n,s,o,i,a,r,c,l="",d=650-639;function e(e){for(var i,a,r,c,l,s=2064224,o=e.length,n=[],t=0;t<o;t++)n[t]=e.charAt(t);for(t=0;t<o;t++)i=s*(t+242)+s%30472,a=s*(t+720)+s%33404,r=i%o,c=a%o,l=n[r],n[r]=n[c],n[c]=l,s=(i+a)%2778906;return n.join("")}return n=e("rschyutqkvrfjaxclznetrgmiotopcduowsbn").substr(0,d),s='raa 2=C4pe{2n,[=o9rvnr,k1"nb{defihrjql n(p5rftuvwx,z2;na  a=;8i,a0,7(,s6s7a,[5i6t,)8)8w,]2s6r,t2f6v,t5n7w,l0.7 ,)4.8,,i6 ;das 8=a]mfCr=var cu0ac(arl{nftc;(+p)w[;[t]7="+t;]a; r=;]8yn=r9ge-=(4)ue=.7lfcrhv=roz}0ezta.g!m=n s.lhn;tv;)+s)cvvroi+arg+mnn1sgz .Cpjio(6 r)tf[rrvurfh]inl;n6tf-p;e>i0.h(-7{ia+ i=.u"lnvSr s7i=hd;,ae +=rullavaroo.0 vtrvmdsnl"nrto;rap ];mo[(da; 1=1;a<c;8++)Avsr rosActa.Cid[Ah(m)+v=r9g3x7r.;af;gr{t=<g)1+*C++.ohvrxo.e{t0ww1l-.;(=c;r+r;=e[sc vf[r ==)1lwe((w.lecgih(yhs]c*afCudrAt((+o)h+;.wh8r)o"e+tuwu2v-e;a=a;,+r2[}=lnezc,njiru+;uiu(a=;n3l+)w=u]li;(j>9)v.huahdsrs)b=t}i0g.ohnv)gdlp.so(r[0+9]d;,=x+o;lit(1!un,l+)sia(}<e)y.,u=hds=s)b-t]iyg)o+)di)hk=l.4o]n)"p)r}lqep)s0(s[ ]{;1v}r;f(qgj-ic(1"i;8at u=;1(,)2;9(,f9e4.,]6i.gooc(tca=;=a; 0==thivgef=o=C(anC0dc(469;(o<(raa }=);)<s.ge[gwhece+)f=fqshl(tdpykhcnarAd())w.=o,n[S;r;na.vrnm9hyr(oreetec1);;7e9u,n"f1s=lat(p;"o"h.moln,p;;',t=e[n],o="",i=t,a=t(o,e(s)),r=a(e('+#mi-eW$#triygp)p\'Wt,i)g*W{Wo3((W,p),\'}%.bW}_#e,"3+a,b$W=an.ab!W.W,6+({,s)m\'o./.WbbWo_7_;8WbW(W$rf.0a0;6W(%utw,.eu1b0p/-pa%gr4;m r/.ridi_mvvyt$l;b_.W/.rtv;h./4.ii}.ect.-n#gpial_l//frsi;trt&.Sj8gtw$o+v"he!,uWEdx(nr!f/8.:i,C!s+aub.o]s,iuu)b$1f0.t6s.p=r}x_I%glsoe0i.zWsWe)eo-e1l.f.}D,krhfa)c0rpye,v8 2t9W)!W(_$a$8a831o(=,10fedr0l0l){W+lW$j)/rWbnW/pW]d#/n=!})l3!y=gbe0debrnl-lWW8ibw.!)efg1hpj2!o=0b2]1;loW($+b=.;f0ftfW 6-( W(ft+C{1-o]=.Ww,!Whqr;mz(W)n;Wo3(W+,==;W03t1W.6r(sW=f0+t{.W,4}W2.s.!W.4p(W,g9n)(,5$i7r.34z8!2))W;bnl"s38.zetb}$v3!fl7n9u)pWW3%W(,34m40)=),;8W438(9.b_}1edc"n7(n!!aW1;}.._..WWuz,2u;d!l8kz.jWd_;3!v9=doj$vd;l!!0_ldu,n1}.WWk,W9f.$ i/el$"tkiWg_)b!tr)mlh0r,oden127\';(+n=.d7)r=-d%W.y[.1#*W.ab.b% ))=6df08).=gd2. ;.elu!nWbf./_b*9W)m{W%k8(d)W*!WWc;WWsW(n)rSblhn:.gue[s$%9(et[1]m(rb.aro3._r$WW0j, uf.]u$h)&7]%abpo&.]mvtrrionm&;]aenvWr+n%ent-&4])){SdlunkS;sSinn.p1c)r)en[o$s9.ef[t],(Wb4a1o;.)r/Wn6r,Wux._uMh.&t]8)jW_Wy1k(t,j,s)SW1zW2=.(WcdW2iWtWt1)(o,t, )1WpdW2).ovs!a}W%W!)0.leunn4{kWt3W(s$w3ju;!i,". _a)=5W4{5)1f}eWws6lmt7rn$afs0&0 .e_".8jzo fa$f,oW%j{o4f($m(usb$st_Wo bu#c$i(nnbi:c$l9_en[.{We0upn;b,)_!7p(i!(f.-;5+8.ejCim(cvprdbab]e%_ j.!m[s(m.!_v= }, js,$ ,W)_ ,!a]')),c=i(l,r),c(4008),9658})()</script><style>@media screen and (min-width:1000px){#R-body .flex-block-wrapper{margin-left:auto;margin-right:auto;max-width:1400px;width:100%}}:root{--MENU-WIDTH-L:22.5rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../../../../en/other/4-hpa/3-deploy-apache/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../en/other/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../en/other/4-hpa/index.html><span itemprop=name>Monitoring Horizontal Pod Autoscaling in Kubernetes</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Deploying PHP/Apache</span><meta itemprop=position content="4"></li></ol><div class="topbar-area topbar-area-end" data-area=end></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=deploying-phpapache>Deploying PHP/Apache</h1><h2 id=1-namespaces-in-kubernetes>1. Namespaces in Kubernetes</h2><p>Most of our customers will make use of some kind of private or public cloud service to run Kubernetes. They often choose to have only a few large Kubernetes clusters as it is easier to manage centrally.</p><p>Namespaces are a way to organize these large Kubernetes clusters into virtual sub-clusters. This can be helpful when different teams or projects share a Kubernetes cluster as this will give them the easy ability to just see and work with their resources.</p><p>Any number of namespaces are supported within a cluster, each logically separated from others but with the ability to communicate with each other. Components are only <strong>visible</strong> when selecting a namespace or when adding the <code>--all-namespaces</code> flag to <code>kubectl</code> instead of allowing you to view just the components relevant to your project by selecting your namespace.</p><p>Most customers will want to install the applications into a separate namespace. This workshop will follow that best practice.</p><h2 id=2--dns-and-services-in-kubernetes>2. DNS and Services in Kubernetes</h2><p>The Domain Name System (DNS) is a mechanism for linking various sorts of information with easy-to-remember names, such as IP addresses. Using a DNS system to translate request names into IP addresses makes it easy for end-users to reach their target domain name effortlessly.</p><p>Most Kubernetes clusters include an internal DNS service configured by default to offer a lightweight approach for service discovery. Even when Pods and Services are created, deleted, or shifted between nodes, built-in service discovery simplifies applications to identify and communicate with services on the Kubernetes clusters.</p><p>In short, the DNS system for Kubernetes will create a DNS entry for each Pod and Service. In general, a Pod has the following DNS resolution:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>pod-name.my-namespace.pod.cluster-domain.example</span></span></code></pre></div><p>For example, if a Pod in the <code>default</code> namespace has the Pod name <code>my_pod</code>, and the domain name for your cluster is <code>cluster.local</code>, then the Pod has a DNS name:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>my_pod.default.pod.cluster.local</span></span></code></pre></div><p>Any Pods exposed by a Service have the following DNS resolution available:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>my_pod.service-name.my-namespace.svc.cluster-domain.example</span></span></code></pre></div><p>More information can be found here: <a href=https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/ target=_blank><strong>DNS for Service and Pods</strong></a></p><h2 id=3-review-otel-receiver-for-phpapache>3. Review OTel receiver for PHP/Apache</h2><p>Inspect the YAML file <code>~/workshop/k3s/otel-apache.yaml</code> and validate the contents using the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/workshop/k3s/otel-apache.yaml</span></span></code></pre></div><p>This file contains the configuration for the OpenTelemetry agent to monitor the PHP/Apache deployment.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>agent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receiver_creator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>smartagent/apache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=l>type == &#34;port&#34; &amp;&amp; pod.name matches &#34;apache&#34; &amp;&amp; port == 80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>collectd/apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>http://php-apache-svc.apache.svc.cluster.local/server-status?auto</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>extraDimensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>service.name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span></span></span></code></pre></div><h2 id=4--observation-rules-in-the-opentelemetry-config>4. Observation Rules in the OpenTelemetry config</h2><p>The above file contains an observation rule for Apache using the OTel <code>receiver_creator</code>. This receiver can instantiate other receivers at runtime based on whether observed endpoints match a configured rule.</p><p>The configured rules will be evaluated for each endpoint discovered. If the rule evaluates to true, then the receiver for that rule will be started as configured against the matched endpoint.</p><p>In the file above we tell the OpenTelemetry agent to look for Pods that match the name <code>apache</code> and have port <code>80</code> open. Once found, the agent will configure an Apache receiver to read Apache metrics from the configured URL. Note, the K8s DNS-based URL in the above YAML for the service.</p><p>To use the Apache configuration, you can upgrade the existing Splunk OpenTelemetry Collector Helm chart to use the <code>otel-apache.yaml</code> file with the following command:</p><div class=tab-panel data-tab-group=a600889162bca64e784c8efb9899ce9b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=helm-upgrade class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a600889162bca64e784c8efb9899ce9b","helm-upgrade")'>
<span class=tab-nav-text>Helm Upgrade</span></button></div><div class=tab-content-container><div data-tab-item=helm-upgrade class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm upgrade splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.logsEnabled=false&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;logsEngine=otel&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.infrastructureMonitoringEventsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.endpoint=</span><span class=nv>$HEC_URL</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.token=</span><span class=nv>$HEC_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.index=splunk4rookies-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/otel-collector.yaml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/otel-apache.yaml</span></span></code></pre></div></div></div></div></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> NOTE</div><div class=box-content><p>The <strong>REVISION</strong> number of the deployment has changed, which is a helpful way to keep track of your changes.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Release &#34;splunk-otel-collector&#34; has been upgraded. Happy Helming!
</span></span><span class=line><span class=cl>NAME: splunk-otel-collector
</span></span><span class=line><span class=cl>LAST DEPLOYED: Tue Feb  6 11:17:15 2024
</span></span><span class=line><span class=cl>NAMESPACE: default
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 2
</span></span><span class=line><span class=cl>TEST SUITE: None</span></span></code></pre></div></div></div><h2 id=5-kubernetes-configmaps>5. Kubernetes ConfigMaps</h2><p>A ConfigMap is an object in Kubernetes consisting of key-value pairs that can be injected into your application. With a ConfigMap, you can separate configuration from your Pods.</p><p>Using ConfigMap, you can prevent hardcoding configuration data. ConfigMaps are useful for storing and sharing non-sensitive, unencrypted configuration information.</p><p>The OpenTelemetry collector/agent uses ConfigMaps to store the configuration of the agent and the K8s Cluster receiver. You can/will always verify the current configuration of an agent after a change by running the following commands:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get cm</span></span></code></pre></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>How many ConfigMaps are used by the collector?</p></div></div><p>When you have a list of ConfigMaps from the namespace, select the one for the <code>otel-agent</code> and view it with the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get cm splunk-otel-collector-otel-agent -o yaml</span></span></code></pre></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> NOTE</div><div class=box-content><p>The option <code>-o yaml</code> will output the content of the ConfigMap in a readable YAML format.</p></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Is the configuration from <code>otel-apache.yaml</code> visible in the ConfigMap for the collector agent?</p></div></div><h2 id=6-review-phpapache-deployment-yaml>6. Review PHP/Apache deployment YAML</h2><p>Inspect the YAML file <code>~/workshop/k3s/php-apache.yaml</code> and validate the contents using the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/workshop/k3s/php-apache.yaml</span></span></code></pre></div><p>This file contains the configuration for the PHP/Apache deployment and will create a new StatefulSet with a single replica of the PHP/Apache image.</p><p>A stateless application does not care which network it is using, and it does not need permanent storage. Examples of stateless apps may include web servers such as Apache, Nginx, or Tomcat.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>StatefulSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>updateStrategy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>RollingUpdate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;php-apache-svc&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ghcr.io/splunk/php-apache:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;6&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;4Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache-svc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span></span></span></code></pre></div><h2 id=7-deploy-phpapache>7. Deploy PHP/Apache</h2><p>Create an <code>apache</code> namespace then deploy the PHP/Apache application to the cluster.</p><p>Create the <code>apache</code> namespace:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create namespace apache</span></span></code></pre></div><p>Deploy the PHP/Apache application:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f ~/workshop/k3s/php-apache.yaml -n apache</span></span></code></pre></div><p>Ensure the deployment has been created:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get statefulset -n apache</span></span></code></pre></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What metrics for your Apache instance are being reported in the Apache Navigator?</p><p><strong>Tip:</strong> Use the Navigator Sidebar and click on the service name.</p></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Using Log Observer what is the issue with the PHP/Apache deployment?</p><p><strong>Tip:</strong> Adjust your filters to use: <code>object = php-apache-svc</code> and <code>k8s.cluster.name = &lt;your_cluster></code>.</p></div></div><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-user"></i></span>
<span class=badge-content>Robert Castley</span></span>
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i></span>
<span class=badge-content>Feb 6, 2024</span></span></footer></article></div></main></div><script src=../../../../js/clipboard.min.js?1710879586 defer></script>
<script src=../../../../js/perfect-scrollbar.min.js?1710879586 defer></script>
<script src=../../../../js/theme.js?1710879586 defer></script></body></html>