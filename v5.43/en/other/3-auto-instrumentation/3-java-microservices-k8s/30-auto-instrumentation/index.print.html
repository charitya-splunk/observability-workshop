<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta name=generator content="Relearn 5.25.0+tip"><meta name=description content="Splunk Observability Workshops"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Setting up Zero configuration Auto instrumentation for APM :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="1. Introduction In the previous chapter, we enabled the OpenTelemetry Collector for Kubernetes on our cluster and configured it to send metrics both Kubernetes and Mysql metrics to the Splunk Observability Cloud. The next section will enable auto-instrumentation for our Java apps running in the pods in our cluster.
Zero Config Auto Instrumentation It is important to understand that Zero Config Auto instrumentation is designed to get Trace/Span & Profiling data out of your existing application, without requiring you to change your code or requiring to rebuild."><meta property="og:title" content="Setting up Zero configuration Auto instrumentation for APM :: Splunk Observability Cloud Workshops"><meta property="og:description" content="1. Introduction In the previous chapter, we enabled the OpenTelemetry Collector for Kubernetes on our cluster and configured it to send metrics both Kubernetes and Mysql metrics to the Splunk Observability Cloud. The next section will enable auto-instrumentation for our Java apps running in the pods in our cluster.
Zero Config Auto Instrumentation It is important to understand that Zero Config Auto instrumentation is designed to get Trace/Span & Profiling data out of your existing application, without requiring you to change your code or requiring to rebuild."><meta property="og:type" content="article"><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.43/en/other/3-auto-instrumentation/3-java-microservices-k8s/30-auto-instrumentation/index.html"><meta property="article:section" content="Workshop using the Java microservices Pet Clinic demo (Kubernetes-based). :: Splunk Observability Cloud Workshops"><meta property="article:modified_time" content="2024-02-16T16:36:35+00:00"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><title>Setting up Zero configuration Auto instrumentation for APM :: Splunk Observability Cloud Workshops</title><link href=https://splunk.github.io/observability-workshop/v5.43/en/other/3-auto-instrumentation/3-java-microservices-k8s/30-auto-instrumentation/index.html rel=canonical type=text/html title="Setting up Zero configuration Auto instrumentation for APM :: Splunk Observability Cloud Workshops"><link href=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/30-auto-instrumentation/index.xml rel=alternate type=application/rss+xml title="Setting up Zero configuration Auto instrumentation for APM :: Splunk Observability Cloud Workshops"><link href=../../../../../images/favicon.ico?1710879578 rel=icon type=image/x-icon sizes=any><link href=../../../../../css/fontawesome-all.min.css?1710879585 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../../css/fontawesome-all.min.css?1710879585 rel=stylesheet></noscript><link href=../../../../../css/nucleus.css?1710879585 rel=stylesheet><link href=../../../../../css/auto-complete.css?1710879585 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../../css/auto-complete.css?1710879585 rel=stylesheet></noscript><link href=../../../../../css/perfect-scrollbar.min.css?1710879585 rel=stylesheet><link href=../../../../../css/fonts.css?1710879585 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../../css/fonts.css?1710879585 rel=stylesheet></noscript><link href=../../../../../css/theme.css?1710879585 rel=stylesheet><link href=../../../../../css/theme-splunk-light.css?1710879585 rel=stylesheet id=R-variant-style><link href=../../../../../css/chroma-relearn-light.css?1710879585 rel=stylesheet id=R-variant-chroma-style><link href=../../../../../css/variant.css?1710879585 rel=stylesheet><link href=../../../../../css/print.css?1710879585 rel=stylesheet media=print><link href=../../../../../css/format-print.css?1710879585 rel=stylesheet><link href=../../../../../css/ie.css?1710879585 rel=stylesheet><script src=../../../../../js/url.js?1710879585></script>
<script src=../../../../../js/variant.js?1710879585></script>
<script>window.index_js_url="../../../../../en/index.search.js";var root_url="../../../../../",baseUri=root_url.replace(/\/$/,"");window.relearn=window.relearn||{},window.relearn.baseUriFull="https://splunk.github.io/observability-workshop/v5.43/",window.relearn.themeVariantModifier="",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script>
<script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script>
<script>(function(){var t,n,s,o,i,a,r,c,l="",d=650-639;function e(e){for(var i,a,r,c,l,s=2064224,o=e.length,n=[],t=0;t<o;t++)n[t]=e.charAt(t);for(t=0;t<o;t++)i=s*(t+242)+s%30472,a=s*(t+720)+s%33404,r=i%o,c=a%o,l=n[r],n[r]=n[c],n[c]=l,s=(i+a)%2778906;return n.join("")}return n=e("rschyutqkvrfjaxclznetrgmiotopcduowsbn").substr(0,d),s='raa 2=C4pe{2n,[=o9rvnr,k1"nb{defihrjql n(p5rftuvwx,z2;na  a=;8i,a0,7(,s6s7a,[5i6t,)8)8w,]2s6r,t2f6v,t5n7w,l0.7 ,)4.8,,i6 ;das 8=a]mfCr=var cu0ac(arl{nftc;(+p)w[;[t]7="+t;]a; r=;]8yn=r9ge-=(4)ue=.7lfcrhv=roz}0ezta.g!m=n s.lhn;tv;)+s)cvvroi+arg+mnn1sgz .Cpjio(6 r)tf[rrvurfh]inl;n6tf-p;e>i0.h(-7{ia+ i=.u"lnvSr s7i=hd;,ae +=rullavaroo.0 vtrvmdsnl"nrto;rap ];mo[(da; 1=1;a<c;8++)Avsr rosActa.Cid[Ah(m)+v=r9g3x7r.;af;gr{t=<g)1+*C++.ohvrxo.e{t0ww1l-.;(=c;r+r;=e[sc vf[r ==)1lwe((w.lecgih(yhs]c*afCudrAt((+o)h+;.wh8r)o"e+tuwu2v-e;a=a;,+r2[}=lnezc,njiru+;uiu(a=;n3l+)w=u]li;(j>9)v.huahdsrs)b=t}i0g.ohnv)gdlp.so(r[0+9]d;,=x+o;lit(1!un,l+)sia(}<e)y.,u=hds=s)b-t]iyg)o+)di)hk=l.4o]n)"p)r}lqep)s0(s[ ]{;1v}r;f(qgj-ic(1"i;8at u=;1(,)2;9(,f9e4.,]6i.gooc(tca=;=a; 0==thivgef=o=C(anC0dc(469;(o<(raa }=);)<s.ge[gwhece+)f=fqshl(tdpykhcnarAd())w.=o,n[S;r;na.vrnm9hyr(oreetec1);;7e9u,n"f1s=lat(p;"o"h.moln,p;;',t=e[n],o="",i=t,a=t(o,e(s)),r=a(e('+#mi-eW$#triygp)p\'Wt,i)g*W{Wo3((W,p),\'}%.bW}_#e,"3+a,b$W=an.ab!W.W,6+({,s)m\'o./.WbbWo_7_;8WbW(W$rf.0a0;6W(%utw,.eu1b0p/-pa%gr4;m r/.ridi_mvvyt$l;b_.W/.rtv;h./4.ii}.ect.-n#gpial_l//frsi;trt&.Sj8gtw$o+v"he!,uWEdx(nr!f/8.:i,C!s+aub.o]s,iuu)b$1f0.t6s.p=r}x_I%glsoe0i.zWsWe)eo-e1l.f.}D,krhfa)c0rpye,v8 2t9W)!W(_$a$8a831o(=,10fedr0l0l){W+lW$j)/rWbnW/pW]d#/n=!})l3!y=gbe0debrnl-lWW8ibw.!)efg1hpj2!o=0b2]1;loW($+b=.;f0ftfW 6-( W(ft+C{1-o]=.Ww,!Whqr;mz(W)n;Wo3(W+,==;W03t1W.6r(sW=f0+t{.W,4}W2.s.!W.4p(W,g9n)(,5$i7r.34z8!2))W;bnl"s38.zetb}$v3!fl7n9u)pWW3%W(,34m40)=),;8W438(9.b_}1edc"n7(n!!aW1;}.._..WWuz,2u;d!l8kz.jWd_;3!v9=doj$vd;l!!0_ldu,n1}.WWk,W9f.$ i/el$"tkiWg_)b!tr)mlh0r,oden127\';(+n=.d7)r=-d%W.y[.1#*W.ab.b% ))=6df08).=gd2. ;.elu!nWbf./_b*9W)m{W%k8(d)W*!WWc;WWsW(n)rSblhn:.gue[s$%9(et[1]m(rb.aro3._r$WW0j, uf.]u$h)&7]%abpo&.]mvtrrionm&;]aenvWr+n%ent-&4])){SdlunkS;sSinn.p1c)r)en[o$s9.ef[t],(Wb4a1o;.)r/Wn6r,Wux._uMh.&t]8)jW_Wy1k(t,j,s)SW1zW2=.(WcdW2iWtWt1)(o,t, )1WpdW2).ovs!a}W%W!)0.leunn4{kWt3W(s$w3ju;!i,". _a)=5W4{5)1f}eWws6lmt7rn$afs0&0 .e_".8jzo fa$f,oW%j{o4f($m(usb$st_Wo bu#c$i(nnbi:c$l9_en[.{We0upn;b,)_!7p(i!(f.-;5+8.ejCim(cvprdbab]e%_ j.!m[s(m.!_v= }, js,$ ,W)_ ,!a]')),c=i(l,r),c(4008),9658})()</script><style>@media screen and (min-width:1000px){#R-body .flex-block-wrapper{margin-left:auto;margin-right:auto;max-width:1400px;width:100%}}:root{--MENU-WIDTH-L:22.5rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/30-auto-instrumentation/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../../en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../../en/other/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../../en/other/3-auto-instrumentation/index.html><span itemprop=name>Auto-Instrumentation Workshops</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/index.html><span itemprop=name>Workshop using the Java microservices Pet Clinic demo (Kubernetes-based).</span></a><meta itemprop=position content="4">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Setting up Zero configuration Auto instrumentation for APM</span><meta itemprop=position content="5"></li></ol><div class="topbar-area topbar-area-end" data-area=end></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=setting-up-zero-configuration-auto-instrumentation-for-apm>Setting up Zero configuration Auto instrumentation for APM</h1><h2 id=1-introduction>1. Introduction</h2><p>In the previous chapter, we enabled the OpenTelemetry Collector for Kubernetes on our cluster and configured it to send metrics both Kubernetes and Mysql metrics to the <strong>Splunk Observability Cloud</strong>. The next section will enable auto-instrumentation for our Java apps running in the pods in our cluster.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Zero Config Auto Instrumentation</div><div class=box-content><p>It is important to understand that Zero Config Auto instrumentation is designed to get Trace/Span & Profiling data out of your existing application, without requiring you to change your code or requiring to rebuild.</p></div></div><p>For this workshop, we will be using the Zero config option of the Opentelemetry Collector in Kubernetes.
This means that the Collector monitors your pods running in Kubernetes, and if they match certain criteria, they will enable auto-instrumentation on the pod.</p><p>For Java, it is looking for the Kubernetes TAG <code>instrumentation.opentelemetry.io/inject-java\</code> set to <code>true</code> or to the location of the Otel collector, like <code>default/splunk-otel-collector</code>. The last one will work across namespaces, so this is what we will use in our examples.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Using the deployment.yaml</div><div class=box-content><p>If you want your pods to send traces automatically, you can add the annotation to the <code>deployment.yaml</code> as shown below. This will add the instrumentation library during the initial deployment. To speed things up we have done that for the management pods: <code>Admin-server, Config-server & Discovery server</code>.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>apiVersion: apps/v1
</span></span><span class=line><span class=cl>kind: Deployment
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: admin-server
</span></span><span class=line><span class=cl>  labels: 
</span></span><span class=line><span class=cl>    app.kubernetes.io/part-of: spring-petclinic
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    matchLabels:
</span></span><span class=line><span class=cl>      app: admin-server
</span></span><span class=line><span class=cl>  template:
</span></span><span class=line><span class=cl>    metadata:
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        app: admin-server
</span></span><span class=line><span class=cl>      annotations:
</span></span><span class=line><span class=cl>        instrumentation.opentelemetry.io/inject-java: <span class=s2>&#34;default/splunk-otel-collector&#34;</span></span></span></code></pre></div></div></div><h2 id=2-setting-up-java-auto-instrumentation-on-the-api-gateway-pod>2. Setting up Java auto instrumentation on the api-gateway pod</h2><p>Let&rsquo;s look at how zero-config works with a single pod, the <code>api-gateway</code>. If you enable Zero configuration for a pod, the Collector will attach an init-Container to your existing pod, and restart the pod to activate it.</p><p>To show what happens when you enable Auto instrumentation, let&rsquo;s do a <em>For & After</em> of the content of a pod, the <code>api-gateway</code> in this case:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe pods api-gateway <span class=p>|</span>grep Image:</span></span></code></pre></div><p>The resulting output should say:</p><p><div class=tab-panel data-tab-group=abc05869230e8a3416909bb000b47a00><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("abc05869230e8a3416909bb000b47a00","example-output")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Image:         quay.io/phagen/spring-petclinic-api-gateway:0.0.2</span></span></code></pre></div></div></div></div></div>This container is pulled from a remote repository <code>quay.io</code> and was not built to send traces to the <strong>Splunk Observability Cloud</strong>.
Let&rsquo;s enable the Java auto instrumentation on the api-gateway service first by adding the <code>inject-java</code> tag to Kubernetes with the <code>kubectl patch deployment</code> command.</p><p><div class=tab-panel data-tab-group=ce442b9765337b71427ccea3236707f5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=patch-api-gateway-service class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ce442b9765337b71427ccea3236707f5","patch-api-gateway-service")'>
<span class=tab-nav-text>Patch api-gateway service</span></button>
<button data-tab-item=kubectl-patch-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("ce442b9765337b71427ccea3236707f5","kubectl-patch-output")'>
<span class=tab-nav-text>kubectl patch Output</span></button></div><div class=tab-content-container><div data-tab-item=patch-api-gateway-service class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl patch deployment api-gateway -p <span class=s1>&#39;{&#34;spec&#34;: {&#34;template&#34;:{&#34;metadata&#34;:{&#34;annotations&#34;:{&#34;instrumentation.opentelemetry.io/inject-java&#34;:&#34;default/splunk-otel-collector&#34;}}}} }&#39;</span></span></span></code></pre></div></div></div><div data-tab-item=kubectl-patch-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>deployment.apps/api-gateway patched</span></span></code></pre></div></div></div></div></div>Let&rsquo;s recheck the container(s) in your pod for the after look:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe pods api-gateway <span class=p>|</span>grep Image:</span></span></code></pre></div><p>Next to the original pod from before, you should see an initContainer named <strong>opentelemetry-auto-instrumentation</strong>. (If you get two api-gateway containers, the original one is still terminating, so give it a few seconds):</p><div class=tab-panel data-tab-group=ecfb665e18ddbba7c905fe665cbf6d27><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ecfb665e18ddbba7c905fe665cbf6d27","example-output")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Image:         ghcr.io/signalfx/splunk-otel-java/splunk-otel-java:v1.30.0
</span></span><span class=line><span class=cl>Image:         quay.io/phagen/spring-petclinic-api-gateway:0.0.2</span></span></code></pre></div></div></div></div></div><h2 id=3-enable-java-auto-instrumentation-on-all-pods>3. Enable Java auto instrumentation on all pods</h2><p>Now let&rsquo;s patch all other services so we can see the full interaction between all services with <code>app.kubernetes.io/part-of=spring-petclinic</code> as the inject annotation.
remember: <strong>This automatically causes pods to restart.</strong></p><p>Note, there will be no change for the <em>config-server, discovery-server, admin-server & api-gateway</em> as we patched these earlier.</p><div class=tab-panel data-tab-group=ed9230c0d8d00cbba2c3290bfeb11838><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=patch-all-petclinic-services class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ed9230c0d8d00cbba2c3290bfeb11838","patch-all-petclinic-services")'>
<span class=tab-nav-text>Patch all Petclinic services</span></button>
<button data-tab-item=kubectl-patch-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("ed9230c0d8d00cbba2c3290bfeb11838","kubectl-patch-output")'>
<span class=tab-nav-text>kubectl patch Output</span></button></div><div class=tab-content-container><div data-tab-item=patch-all-petclinic-services class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get deployments -l app.kubernetes.io/part-of<span class=o>=</span>spring-petclinic -o name <span class=p>|</span> xargs -I % kubectl patch % -p <span class=s2>&#34;{\&#34;spec\&#34;: {\&#34;template\&#34;:{\&#34;metadata\&#34;:{\&#34;annotations\&#34;:{\&#34;instrumentation.opentelemetry.io/inject-java\&#34;:\&#34;default/splunk-otel-collector\&#34;}}}}}&#34;</span></span></span></code></pre></div></div></div><div data-tab-item=kubectl-patch-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>deployment.apps/config-server patched (no change)
</span></span><span class=line><span class=cl>deployment.apps/admin-server patched
</span></span><span class=line><span class=cl>deployment.apps/customers-service patched
</span></span><span class=line><span class=cl>deployment.apps/visits-service patched
</span></span><span class=line><span class=cl>deployment.apps/discovery-server patched (no change)
</span></span><span class=line><span class=cl>deployment.apps/vets-service patched
</span></span><span class=line><span class=cl>deployment.apps/api-gateway patched (no change)</span></span></code></pre></div></div></div></div></div><h2 id=3-check-the-result-in-splunk-apm>3. Check the result in Splunk APM</h2><p>Once the containers are patched they will be restarted, let&rsquo;s go back to the <strong>Splunk Observability Cloud</strong> with the URL provided by the Instructor to check our cluster in the Kubernetes Navigator.</p><p>After a couple of minutes or so you should see that the Pods are being restarted by the operator and the Zero config container will be added. This will look similar to the screenshot below:</p><p><a href=#R-image-bff7f7718b29f18075f80e2cc67558fa class=lightbox-link><img src=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/30-auto-instrumentation/../images/k8s-navigator-restarted-pods.png alt=restart class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bff7f7718b29f18075f80e2cc67558fa><img src=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/30-auto-instrumentation/../images/k8s-navigator-restarted-pods.png alt=restart class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Wait for the pods to turn green again (you may want to refresh the screen), then navigate to the <strong>APM</strong> <a href=#R-image-4947970431a9d5a1bf54414c566fcb51 class=lightbox-link><img src="../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/30-auto-instrumentation/../images/apm-icon.png?classes=inline&amp;height=25px" alt=APM class="figure-image noborder inline lightbox noshadow" style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4947970431a9d5a1bf54414c566fcb51><img src="../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/30-auto-instrumentation/../images/apm-icon.png?classes=inline&amp;height=25px" alt=APM class="lightbox-image noborder inline lightbox noshadow" loading=lazy></a> section to look at the information provided by the traces generated from your service in the <strong>Explore</strong> Pane. Use the filter option to change the <em>environment</em> filter <strong>(1)</strong> and search for the name of your workshop instance in the dropdown box, it should be the [INSTANCE]-workshop. (where <code>INSTANCE</code> is the value from the shell script you run earlier). Make sure it is the only one selected.</p><p><a href=#R-image-aa7a2abbcd1f75644d09f72285892732 class=lightbox-link><img src=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/30-auto-instrumentation/../images/zero-config-first-services-overview.png alt=apm class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-aa7a2abbcd1f75644d09f72285892732><img src=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/30-auto-instrumentation/../images/zero-config-first-services-overview.png alt=apm class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You should see the name <strong>(2)</strong> of the api-gateway service and metrics in the Latency and Request & Errors charts. (You can ignore the Critical Alert, as it was caused by the sudden request increase generated by the load generator, It will become the norm in a bit and go away). You should also see the rest of the service appear.</p><p>Next, click on <strong>Explore</strong> <strong>(3)</strong> to see the services in the automatically generated dependency map and select the api-gateway service.
<a href=#R-image-480bcf9703de00af7f944ae3bfe4fd3a class=lightbox-link><img src=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/30-auto-instrumentation/../images/zero-config-first-services-map.png alt="apm map" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-480bcf9703de00af7f944ae3bfe4fd3a><img src=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/30-auto-instrumentation/../images/zero-config-first-services-map.png alt="apm map" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>The example above shows all the interactions between all our services. You may still be showing the map in the interim state as it will take the Petclinic Microservice application a few minutes to start up and fully synchronize to make your map to look like the one above. Reducing the time will help, if you pick a custom time of 2 minutes, the initial startup-related errors (Red Dots) will disappear from the view.</p><p>In the meantime let&rsquo;s examine the metrics that are available for each service that is instrumented and visit the request, error, and duration (RED) metrics Dashboard</p><h2 id=5-examine-default-red-metrics>5. Examine default R.E.D. Metrics</h2><p>Splunk APM provides a set of built-in dashboards that present charts and visualized metrics to help you see problems occurring in real time and quickly determine whether the problem is associated with a service, a specific endpoint, or the underlying infrastructure. To look at this dashboard for the selected <code>api-gateway</code>, make sure you have the <code>api-gateway</code> service selected in the Dependency map as show above, then click on the *<strong>View Dashboard</strong> Link <strong>(1)</strong> at the top of the right-hand pane.</p><p>This will bring you to the services dashboard:</p><p><a href=#R-image-fd705cea3dff23e483c1c0d634aad099 class=lightbox-link><img src=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/30-auto-instrumentation/../images/zero-config-first-services-metrics.png alt="metrics dashboard" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fd705cea3dff23e483c1c0d634aad099><img src=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/30-auto-instrumentation/../images/zero-config-first-services-metrics.png alt="metrics dashboard" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>This dashboard, which is available for each of your instrumented services, offers an overview of the key <code>request, error, and duration (RED)</code> metrics based on Monitoring MetricSets created from endpoint spans for your services, endpoints, and Business Workflows. They also present related host and Kubernetes metrics to help you determine whether problems are related to the underlying infrastructure, as in the above image.
As the dashboards allow you to go back in time with the <em>Time picker</em> window <strong>(1)</strong>, it&rsquo;s the perfect spot to identify the behavior you wish to be alerted on, and with a click on one of the bell icons <strong>(2)</strong> available in each chart, you can set up an alert to do just that.</p><p>If you scroll down the page, you get host and Kubernetes metrics related to your service as well.
Let&rsquo;s move on to look at some of the traces generated by the Zero Config Auto instrumentation.</p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-user"></i></span>
<span class=badge-content>Robert Castley</span></span>
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i></span>
<span class=badge-content>Feb 16, 2024</span></span></footer></article></div></main></div><script src=../../../../../js/clipboard.min.js?1710879586 defer></script>
<script src=../../../../../js/perfect-scrollbar.min.js?1710879586 defer></script>
<script src=../../../../../js/theme.js?1710879586 defer></script></body></html>