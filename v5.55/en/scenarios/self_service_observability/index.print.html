<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.125.5"><meta name=generator content="Relearn 6.0.0+tip"><meta name=description content="This scenario helps platform engineering (or central tools) teams enable engineers with self-service observability tooling at scale, so developers and SREs can spend less time managing their toolchain and more time building and delivering cool software."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Self-Service Observability :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="This scenario helps platform engineering (or central tools) teams enable engineers with self-service observability tooling at scale, so developers and SREs can spend less time managing their toolchain and more time building and delivering cool software."><meta property="og:url" content="https://splunk.github.io/observability-workshop/observability-workshop/v5.55/en/scenarios/self_service_observability/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Self-Service Observability :: Splunk Observability Cloud Workshops"><meta property="og:description" content="This scenario helps platform engineering (or central tools) teams enable engineers with self-service observability tooling at scale, so developers and SREs can spend less time managing their toolchain and more time building and delivering cool software."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Self-Service Observability :: Splunk Observability Cloud Workshops"><meta itemprop=description content="This scenario helps platform engineering (or central tools) teams enable engineers with self-service observability tooling at scale, so developers and SREs can spend less time managing their toolchain and more time building and delivering cool software."><meta itemprop=dateModified content="2024-04-25T14:30:07-04:00"><meta itemprop=wordCount content="147"><title>Self-Service Observability :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/observability-workshop/v5.55/en/scenarios/self_service_observability/index.html rel=canonical type=text/html title="Self-Service Observability :: Splunk Observability Cloud Workshops"><link href=../../../images/favicon.ico?1715859593 rel=icon type=image/x-icon sizes=any><link href=../../../css/fontawesome-all.min.css?1715859609 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/fontawesome-all.min.css?1715859609 rel=stylesheet></noscript><link href=../../../css/nucleus.css?1715859609 rel=stylesheet><link href=../../../css/auto-complete.css?1715859609 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/auto-complete.css?1715859609 rel=stylesheet></noscript><link href=../../../css/perfect-scrollbar.min.css?1715859609 rel=stylesheet><link href=../../../css/fonts.css?1715859609 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/fonts.css?1715859609 rel=stylesheet></noscript><link href=../../../css/theme.css?1715859609 rel=stylesheet><link href=../../../css/theme-splunk-light.css?1715859609 rel=stylesheet id=R-variant-style><link href=../../../css/chroma-relearn-light.css?1715859609 rel=stylesheet id=R-variant-chroma-style><link href=../../../css/variant.css?1715859609 rel=stylesheet><link href=../../../css/print.css?1715859609 rel=stylesheet media=print><link href=../../../css/format-print.css?1715859609 rel=stylesheet><script src=../../../js/variant.js?1715859609></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/observability-workshop/v5.55",window.index_js_url="../../../en/index.search.js",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA"})</script></script><style>:root{--MAIN-WIDTH-MAX:1000rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../../../en/scenarios/self_service_observability/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../en/scenarios/index.html><span itemprop=name>Scenarios</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Self-Service Observability</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=../../../en/scenarios/optimize_end_user_experiences/6-summary/index.html title="Summary (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=../../../en/scenarios/self_service_observability/1-background/index.html title="Background (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable chapter narrow" tabindex=-1><div class=flex-block-wrapper><article class=chapter><header class=headline></header><h1 id=self-service-observability>Self-Service Observability</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>1 minute</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Bill Grant</span></span><p><strong>Splunk Observability Cloud</strong> includes powerful features that help central platform teams that are responsible for creating consistency, standards and best practices in an organization.</p><p>This workshop will go through some of the ways to apply standardization in your Observability practice.</p><p>We will cover:</p><ul><li>Collecting data with standards, and applying metadata at various points in the process</li><li>Managing costs, by reviewing metrics and applying metrics pipeline management to it</li><li>Configuring Observability-as-code, using terraform and api&rsquo;s</li></ul><p>We will use a variety of scripts to demonstrate these examples. Be sure to pick a unique name, so your data won&rsquo;t cross over with anyone else taking the workshop at the same time.</p><p>Let&rsquo;s get started!</p><div class="box notices cstyle primary"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Tip</div><div class=box-content><p>The easiest way to navigate through this workshop is by using:</p><ul><li>the left/right arrows (<strong>&lt;</strong> | <strong>></strong>) on the top right of this page</li><li>the left (‚óÄÔ∏è) and right (‚ñ∂Ô∏è) cursor keys on your keyboard</li></ul></div></div><footer class=footline><span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Bill Grant
</span></span>&nbsp;
<span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>Bill Grant</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Apr 25, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Self-Service Observability</h1><article class=default><header class=headline></header><h1 id=background>Background</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>3 minutes</span>
</span>&nbsp;<h2 id=background>Background</h2><p>Let&rsquo;s review a few background concepts on <strong>Open Telemetry</strong> before jumping into the details.</p><p>First we have the <strong>Open Telemetry Collector</strong>, which lives on hosts or kubernetes nodes. These collectors can collect local information (like cpu, disk, memory, etc.). They can also collect metrics from other sources like prometheus (push or pull) or databases and other middleware.</p><p><a href=#R-image-01724dae95b7a258378b0590e5351080 class=lightbox-link><img alt="OTel Diagram" class="noborder lazy lightbox noshadow figure-image" loading=lazy src="../../../en/scenarios/self_service_observability/1-background/../images/otel-diagram.svg?width=60vw" style=height:auto;width:60vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-01724dae95b7a258378b0590e5351080><img alt="OTel Diagram" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src="../../../en/scenarios/self_service_observability/1-background/../images/otel-diagram.svg?width=60vw"></a>
Source: <a href=https://opentelemetry.io/docs/ rel=external target=_blank>OTel Documentation</a></p><p>The way the <strong>OTel Collector</strong> collects and sends data is using <strong>pipelines</strong>. Pipelines are made up of:</p><ul><li><strong>Receivers</strong>: Collect telemetry from one or more sources; they are pull- or push-based.</li><li><strong>Processors</strong>: Take data from receivers and modify or transform them. Unlike receivers and exporters, processors process data in a specific order.</li><li><strong>Exporters</strong>: Send data to one or more observability backends or other destinations.</li></ul><p><a href=#R-image-919f024abbee6dfa45bc8a3d4fd23c89 class=lightbox-link><img alt="OTel Diagram" class="noborder lazy lightbox noshadow figure-image" loading=lazy src="../../../en/scenarios/self_service_observability/1-background/../images/otel-collector-details.svg?width=60vw" style=height:auto;width:60vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-919f024abbee6dfa45bc8a3d4fd23c89><img alt="OTel Diagram" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src="../../../en/scenarios/self_service_observability/1-background/../images/otel-collector-details.svg?width=60vw"></a>
Source: <a href=https://opentelemetry.io/docs/collector/ rel=external target=_blank>OTel Documentation</a></p><p>The final piece is applications which are instrumented; they will send traces (spans), metrics, and logs.</p><p>By default the instrumentation is designed to send data to the local collector (on the host or kubernetes node). This is desirable because we can then add metadata on it &ndash; like which pod or which node/host the application is running on.</p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>Bill Grant</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Apr 10, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=collect-data-with-standards>Collect Data with Standards</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<h2 id=introduction>Introduction</h2><p>For this workshop, we&rsquo;ll be doing things that only a central tools or administration would do.</p><p>The workshop uses scripts to help with steps that aren&rsquo;t part of the focus of this workshop &ndash; like how to change a kubernetes app, or start an application from a host.</p><div class="box notices cstyle primary"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Tip</div><div class=box-content><p>It can be useful to review what the scripts are doing.</p><p>So along the way it is advised to run <code>cat &lt;filename></code> from time to time to see what that step just did.</p><p>The workshop won&rsquo;t call this out, so do it when you are curious.</p></div></div><p>We&rsquo;ll also be running some scripts to simulate data that we want to deal with.</p><p>A simplified version of the architecture (leaving aside the specifics of kubernetes) will look something like the following:</p><p><a href=#R-image-8f7d882083c8b1eff737d055c1cffd7f class=lightbox-link><img alt=Architecture class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/../images/arch.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8f7d882083c8b1eff737d055c1cffd7f><img alt=Architecture class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/../images/arch.png></a></p><ul><li>The <strong>App</strong> sends metrics and traces to the <strong>Otel Collector</strong></li><li>The <strong>Otel Collector</strong> also collects metrics of its own</li><li>The <strong>Otel Collector</strong> adds metadata to its own metrics and data that passes through it</li><li>The <strong>OTel Gateway</strong> offers another opportunity to add metadata</li></ul><p>Let&rsquo;s start by deploying the gateway.</p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>Bill Grant</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Apr 10, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Collect Data with Standards</h1><article class=default><header class=headline></header><h1 id=deploy-gateway>Deploy Gateway</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<h2 id=gateway>Gateway</h2><p>First we will deploy the <strong>OTel Gateway</strong>. The workshop instructor will deploy the gateway, but we will walk through the steps here if you wish to try this yourself on a second instance.</p><p>The steps:</p><ul><li>Click the <strong>Data Management</strong> icon in the toolbar</li><li>Click the <strong>+ Add integration</strong> button</li><li>Click <strong>Deploy the Splunk OpenTelemetry Collector</strong> button</li><li>Click <strong>Next</strong></li><li>Select <strong>Linux</strong></li><li>Change mode to <strong>Data forwarding (gateway)</strong></li><li>Set the environment to <strong>prod</strong></li><li>Choose the access token for this workshop</li><li>Click <strong>Next</strong></li><li>Copy the installer script and run it in the provided linux environment.</li></ul><p>Once our gateway is started we will notice&mldr; <strong>Nothing</strong>. The gateway, by default, doesn&rsquo;t send any data. It can be configured to send data, but it doesn&rsquo;t by default.</p><p>We can review the config file with:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo cat /etc/otel/collector/splunk-otel-collector.conf</span></span></code></pre></div><p>And see that the config being used is <code>gateway_config.yaml</code>.</p><div class="box notices cstyle primary"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Tip</div><div class=box-content><p>Diagrams created with <a href=https://www.otelbin.io rel=external target=_blank>OTelBin.io</a>. Click on them to see them in detail.</p></div></div><table><thead><tr><th>Diagram</th><th>What it Tells Us</th></tr></thead><tbody><tr><td><a href=#R-image-1bebc8a764698ddeff72bf19d2905bbc class=lightbox-link><img alt="metrics Config" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/../images/metrics.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1bebc8a764698ddeff72bf19d2905bbc><img alt="metrics Config" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/../images/metrics.png></a></td><td><strong>Metrics</strong>:<br>The gateway will receive metrics over <strong>otlp</strong> or <strong>signalfx</strong> protocols, and then send these metrics to <strong>Splunk Observability Cloud</strong> with the <strong>signalfx</strong> protocol.<br><br>There is also a pipeline for <strong>prometheus metrics</strong> to be sent to Splunk. That pipeline is labeled <strong>internal</strong> and is meant to be for the collector. (In other words if we want to receive prometheus directly we should add it to the main pipeline.)</td></tr><tr><td><a href=#R-image-a2b30d15b141eeca5e18522b17e76ef4 class=lightbox-link><img alt="traces Config" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/../images/traces.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a2b30d15b141eeca5e18522b17e76ef4><img alt="traces Config" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/../images/traces.png></a></td><td><strong>Traces</strong>:<br>The gateway will receive traces over <strong>jaeger</strong>, <strong>otlp</strong>, <strong>sapm</strong>, or <strong>zipkin</strong> and then send these traces to <strong>Splunk Observability Cloud</strong> with the <strong>sapm</strong> protocol.</td></tr><tr><td><a href=#R-image-fb00919e92b1099b32975f81112cfff2 class=lightbox-link><img alt="logs Config" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/../images/logs.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fb00919e92b1099b32975f81112cfff2><img alt="logs Config" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/../images/logs.png></a></td><td><strong>Logs</strong>:<br>The gateway will receive logs over <strong>otlp</strong> and then send these logs to 2 places: <strong>Splunk Enterprise (Cloud)</strong> (for logs) and <strong>Splunk Observability Cloud</strong> (for profiling data).<br><br>There is also a pipeline labeled <strong>signalfx</strong> that is sending <strong>signalfx</strong> to <strong>Splunk Observability Cloud</strong>; these are events that can be used to add events to charts, as well as the process list.</td></tr></tbody></table><p>We&rsquo;re not going to see any host metrics, and we aren&rsquo;t send any other data through the gateway yet. But we do have the <strong>internal</strong> metrics being sent in.</p><p>You can find it by creating a new chart and adding a metric:</p><ul><li>Click the <strong>+</strong> in the top-right</li><li>Click <strong>Chart</strong></li><li>For the signal of Plot A, type <code>otelcol_process_uptime</code></li><li>Add a filter with the + to the right, and type: <code>host.id:&lt;name of instance></code></li></ul><p>You should get a chart like the following:
<a href=#R-image-a331783249b8729fae8219131e0c7468 class=lightbox-link><img alt="Chart of gateway" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/../images/gateway_metric_chart.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a331783249b8729fae8219131e0c7468><img alt="Chart of gateway" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/../images/gateway_metric_chart.png></a></p><p>You can look at the <strong>Metric Finder</strong> to find other internal metrics to explore.</p><h2 id=add-metadata>Add Metadata</h2><p>Before we deploy a collector (agent) let&rsquo;s add some metada onto metrics and traces with the gateway. That&rsquo;s how we will know data is passing through it.</p><p>The <a href=https://docs.splunk.com/observability/en/gdi/opentelemetry/components/attributes-processor.html rel=external target=_blank>attributes processor</a> let&rsquo;s us add some metadata.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/otel/collector/agent_config.yaml</span></span></code></pre></div><p>Here&rsquo;s what we want to add to the processors section:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>attributes/gateway_config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>oac</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span></span></span></code></pre></div><p>And then to the pipelines (adding <code>attributes/gateway_config</code> to each):</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>jaeger, otlp, smartagent/signalfx-forwarder, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>attributes/gateway_config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#- resource/add_environment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>sapm, signalfx]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Use instead when sending to gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#exporters: [otlp, signalfx]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, signalfx, smartagent/signalfx-forwarder]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>memory_limiter, batch, resourcedetection, attributes/gateway_config]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>signalfx]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Use instead when sending to gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#exporters: [otlp]</span></span></span></code></pre></div><p>And finally we need to restart the gateway:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector.service</span></span></code></pre></div><p>We can make sure it is still running fine by checking the status:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl status splunk-otel-collector.service </span></span></code></pre></div><h2 id=next>Next</h2><p>Next, let&rsquo;s deploy a collector and then configure it to this gateway.</p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>Bill Grant</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Apr 10, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=deploy-collector-agent>Deploy Collector (Agent)</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<h2 id=collector-agent>Collector (Agent)</h2><p>Now we will deploy a collector. At first this will be configured to go directly to the back-end, but we will change the configuration and restart the collector to use the gateway.</p><p>The steps:</p><ul><li>Click the <strong>Data Management</strong> icon in the toolbar</li><li>Click the <strong>+ Add integration</strong> button</li><li>Click <strong>Deploy the Splunk OpenTelemetry Collector</strong> button</li><li>Click <strong>Next</strong></li><li>Select <strong>Linux</strong></li><li>Leave the mode as <strong>Host monitoring (agent)</strong></li><li>Set the environment to <strong>prod</strong></li><li>Leave the rest as defaults</li><li>Choose the access token for this workshop</li><li>Click <strong>Next</strong></li><li>Copy the installer script and run it in the provided linux environment.</li></ul><p>This collector is sending host metrics, so you can find it in common navigators:</p><ul><li>Click the <strong>Infrastructure</strong> icon in the toolbar</li><li>Click the <strong>EC2</strong> panel under <strong>Amazon Web Services</strong></li><li>The <code>AWSUniqueId</code> is the easiest thing to find; add a filter and look for it with a wildcard (i.e. <code>i-0ba6575181cb05226*</code>)</li></ul><p><a href=#R-image-b515cad99d6f1e48660eccc51defb270 class=lightbox-link><img alt="Chart of agent" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/2-deploy_collector_agent/../images/collector_agent_chart.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b515cad99d6f1e48660eccc51defb270><img alt="Chart of agent" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/2-deploy_collector_agent/../images/collector_agent_chart.png></a></p><p>We can also simply look at the <code>cpu.utilization</code> metric. Create a new chart to display it, filtered on the AWSUniqueId:</p><p><a href=#R-image-22f1587d61ae24c545f307675f316b9d class=lightbox-link><img alt="Chart 2 of agent" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/2-deploy_collector_agent/../images/collector_agent_chart_2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-22f1587d61ae24c545f307675f316b9d><img alt="Chart 2 of agent" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/2-deploy_collector_agent/../images/collector_agent_chart_2.png></a></p><p>The reason we wanted to do that is so we can easily see the new dimension added on once we send the collector through the gateway. You can click on the <strong>Data table</strong> to see the dimensions currently being sent:</p><p><a href=#R-image-5d562242ec58ec01c21b8169715ddc0a class=lightbox-link><img alt="Data Table" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/2-deploy_collector_agent/../images/collector_agent_data_table.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5d562242ec58ec01c21b8169715ddc0a><img alt="Data Table" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/2-deploy_collector_agent/../images/collector_agent_data_table.png></a></p><h2 id=next>Next</h2><p>Next we&rsquo;ll reconfigure the collector to send to the gateway.</p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>Bill Grant</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Apr 10, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=reconfigure-collector>Reconfigure Collector</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<h2 id=reconfigure-collector>Reconfigure Collector</h2><p>To reconfigure the collector we need to make these changes:</p><ul><li>In <code>agent_config.yaml</code><ul><li>We need to adjust the <strong>signalfx</strong> exporter to use the gateway</li><li>The <strong>otlp</strong> exporter is already there, so we leave it alone</li><li>We need to change the pipelines to use <strong>otlp</strong></li></ul></li><li>In <code>splunk-otel-collector.conf</code><ul><li>We need to set the <code>SPLUNK_GATEWAY_URL</code> to the url provided by the instructor</li></ul></li></ul><p>See this <a href=https://docs.splunk.com/observability/en/gdi/opentelemetry/deployment-modes.html#agent-configuration rel=external target=_blank>docs page</a> for more details.</p><p>The exporters will be the following:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Metrics + Events</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>signalfx</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>access_token</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;${SPLUNK_ACCESS_TOKEN}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>#api_url: &#34;${SPLUNK_API_URL}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>#ingest_url: &#34;${SPLUNK_INGEST_URL}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Use instead when sending to gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>api_url</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://${SPLUNK_GATEWAY_URL}:6060&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ingest_url</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://${SPLUNK_GATEWAY_URL}:9943&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sync_host_metadata</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>correlation</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Send to gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;${SPLUNK_GATEWAY_URL}:4317&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tls</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>insecure</span><span class=p>:</span><span class=w> </span><span class=kc>true</span></span></span></code></pre></div><p>The others you can leave as they are but they won&rsquo;t be used, as you will see in the pipelines.</p><p>The pipeline changes (you can see the items commented out and uncommented out):</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>jaeger, otlp, smartagent/signalfx-forwarder, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#- resource/add_environment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#exporters: [sapm, signalfx]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Use instead when sending to gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, signalfx]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, signalfx, smartagent/signalfx-forwarder]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>memory_limiter, batch, resourcedetection]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#exporters: [signalfx]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Use instead when sending to gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>prometheus/internal]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>memory_limiter, batch, resourcedetection]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># When sending to gateway, at least one metrics pipeline needs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># to use signalfx exporter so host metadata gets emitted</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>signalfx]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs/signalfx</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>signalfx, smartagent/processlist]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>memory_limiter, batch, resourcedetection]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>signalfx]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>fluentforward, otlp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#- resource/add_environment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#exporters: [splunk_hec, splunk_hec/profiling]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Use instead when sending to gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span></span></span></code></pre></div><p>And finally we can add the <code>SPLUNK_GATEWAY_URL</code> in <code>splunk-otel-collector.conf</code>, for example:</p><div class="highlight wrap-code"><pre tabindex=0><code class=language-conf data-lang=conf>SPLUNK_GATEWAY_URL=gateway.splunk011y.com</code></pre></div><p>Then we can restart the collector:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector.service</span></span></code></pre></div><p>And check the status:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl status splunk-otel-collector.service</span></span></code></pre></div><p>And finally see the new dimension on the metrics:
<a href=#R-image-e5e5b075c9e9d9920e509d744b30ba5d class=lightbox-link><img alt="New Dimension" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/3-reconfigure_collector/../images/gateway_dimension.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e5e5b075c9e9d9920e509d744b30ba5d><img alt="New Dimension" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../en/scenarios/self_service_observability/2-collect_with_standards/3-reconfigure_collector/../images/gateway_dimension.png></a></p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>Bill Grant</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Apr 10, 2024</span></span></footer></article></section></section></div></main></div><script src=../../../js/clipboard.min.js?1715859609 defer></script><script src=../../../js/perfect-scrollbar.min.js?1715859609 defer></script><script src=../../../js/theme.js?1715859609 defer></script></body></html>