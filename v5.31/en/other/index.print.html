<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta name=generator content="Relearn 5.23.2+tip"><meta name=description content="Splunk Observability Workshops"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Ninja Workshops :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="Splunk Observability Workshops"><meta property="og:title" content="Ninja Workshops :: Splunk Observability Cloud Workshops"><meta property="og:description" content="Splunk Observability Workshops"><meta property="og:type" content="website"><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.31/en/other/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><title>Ninja Workshops :: Splunk Observability Cloud Workshops</title><link href=https://splunk.github.io/observability-workshop/v5.31/en/other/index.html rel=alternate hreflang=x-default><link href=https://splunk.github.io/observability-workshop/v5.31/en/other/index.html rel=alternate hreflang=en><link href=https://splunk.github.io/observability-workshop/v5.31/ja/other/index.html rel=alternate hreflang=ja><link href=https://splunk.github.io/observability-workshop/v5.31/en/other/index.html rel=canonical type=text/html title="Ninja Workshops :: Splunk Observability Cloud Workshops"><link href=../../en/other/index.xml rel=alternate type=application/rss+xml title="Ninja Workshops :: Splunk Observability Cloud Workshops"><link href=../../images/favicon.ico?1701863654 rel=icon type=image/x-icon sizes=any><link href=../../css/fontawesome-all.min.css?1701863659 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/fontawesome-all.min.css?1701863659 rel=stylesheet></noscript><link href=../../css/nucleus.css?1701863659 rel=stylesheet><link href=../../css/auto-complete.css?1701863659 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/auto-complete.css?1701863659 rel=stylesheet></noscript><link href=../../css/perfect-scrollbar.min.css?1701863659 rel=stylesheet><link href=../../css/fonts.css?1701863659 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/fonts.css?1701863659 rel=stylesheet></noscript><link href=../../css/theme.css?1701863659 rel=stylesheet><link href=../../css/theme-splunk-light.css?1701863659 rel=stylesheet id=R-variant-style><link href=../../css/variant.css?1701863659 rel=stylesheet><link href=../../css/print.css?1701863659 rel=stylesheet media=print><link href=../../css/format-print.css?1701863659 rel=stylesheet><link href=../../css/ie.css?1701863659 rel=stylesheet><script src=../../js/url.js?1701863659></script>
<script src=../../js/variant.js?1701863659></script>
<script>window.index_js_url="../../en/index.search.js";var root_url="../../",baseUri=root_url.replace(/\/$/,"");window.relearn=window.relearn||{},window.relearn.baseUriFull="https://splunk.github.io/observability-workshop/v5.31/",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script>
<script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script>
<script>SplunkRum.init({beaconUrl:"https://rum-ingest.eu0.signalfx.com/v1/rum",rumAuth:"EDIbCJR4LlxWdXMLjkYX1g",app:"observability-workshop",version:"1",environment:"observability-workshop-env"}),SplunkSessionRecorder.init({beaconUrl:"https://rum-ingest.eu0.signalfx.com/v1/rumreplay",rumAuth:"EDIbCJR4LlxWdXMLjkYX1g"})</script><style>@media screen and (min-width:1000px){#R-body .flex-block-wrapper{margin-left:auto;margin-right:auto;max-width:1000px;width:100%}}:root{--MENU-WIDTH-L:19.75rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../../en/other/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)">
<i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Ninja Workshops</span><meta itemprop=position content="2"></li></ol><div class="topbar-area topbar-area-end" data-area=end></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable home" tabindex=-1><div class=flex-block-wrapper><article class=home><header class=headline></header><h1 id=ninja-workshops>Ninja Workshops</h1><div class="children children-h5 children-sort-"><h5><a href=../../en/other/pet-clinic/index.html>PetClinic Java Workshop</a></h5><p>A workshop using Zero Configuration Auto-Instrumentation for Java.</p><h5><a href=../../en/other/gdi/index.html>Getting Data In (GDI) with OTel and UF</a></h5><p>Learn how to get data into Splunk Observability Cloud with OpenTelemetry and the Splunk Universal Forwarder.</p><h5><a href=../../en/other/hpa/index.html>Monitoring Horizontal Pod Autoscaling in Kubernetes</a></h5><p>This workshop will equip you with the basic understanding of monitoring Kubernetes using the Splunk OpenTelemetry Collector</p><h5><a href=../../en/other/lambda-kinesis/index.html>Build a Distributed Trace in Lambda and Kinesis</a></h5><p>This workshop will equip you with how a distributed trace is constructed for a small serverless application that runs on AWS Lambda, producing and consuming a message via AWS Kinesis</p><h5><a href=../../en/other/dev-mttr-custom-tags/index.html>Improving MTTR with Custom Tags</a></h5><p>This workshop will equip you with...</p><h5><a href=../../en/other/rum/index.html>Splunk RUM</a></h5><p>End-to-end visibility helps you pinpoint customer-impacting issues from web browsers and native mobile apps to your backend services.</p><h5><a href=../../en/other/synthetics-scripting/index.html>Splunk Synthetic Scripting</a></h5><p>Proactively find and fix performance issues across user flows, business transactions and APIs to deliver better digital experiences.</p><h5><a href=../../en/other/oncall/index.html>Splunk OnCall</a></h5><p>Make expensive service outages a thing of the past. Remediate issues faster, reduce on-call burnout and keep your services up and running.</p><h5><a href=../../en/other/opentelemetry-collector/index.html>Making Your Observability Cloud Native With OpenTelemetry</a></h5><p>Learn the concepts of the OpenTelemetry Collector and how to use it to send data to Splunk Observability Cloud.</p></div><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Ninja Workshops</h1><article class=default><header class=headline></header><h1 id=petclinic-java-workshop>PetClinic Java Workshop</h1><p>The goal is to walk through the basic steps to configure the following components of the Splunk Observability platform:</p><ul><li>Splunk Infrastructure Monitoring (IM)</li><li>Splunk Zero Configuration Auto Instrumentation for Java (APM)<ul><li>Database Query Performance</li><li>AlwaysOn Profiling</li></ul></li><li>Splunk Real User Monitoring (RUM)</li><li>RUM to APM Correlation</li><li>Splunk Log Observer</li></ul><p>We will also show the steps about how to clone (download) a sample Java application (Spring PetClinic), as well as how to compile, package and run the application.</p><p>Once the application is up and running, we will instantly start seeing metrics and traces via the Zero Configuration Auto Instrumentation for Java that will be used by the Splunk APM product.</p><p>After that, we will instrument PetClinic&rsquo;s end user interface (HTML pages rendered by the application) with the Splunk OpenTelemetry Javascript Libraries (RUM) that will generate RUM traces around all the individual clicks and page loads executed by an end user.</p><p>Lastly, we will configure the Spring PetClinic application to write application logs to the filesystem and also configure the Splunk OpenTelemetry Collector to read (tail) the logs and send them to Splunk Cloud.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Prerequisites</div><div class=box-content><p>A Splunk-run workshop where a host/instance is provided <strong>OR</strong> a self-led workshop on your own host / <a href=https://github.com/splunk/observability-workshop/tree/main/multipass target=_blank>multipass instance</a></p><p>For your own system, you will need the following installed and enabled:</p><ol><li>JDK 17 installed</li><li>Maven</li><li>Port <code>8083</code> open inbound/outbound</li></ol></div></div><p><a href=#R-image-2f5599712836325cb1a090cedc805e1d class=lightbox-link><img src=../../en/other/pet-clinic/images/petclinic-exercise.png alt="PetClinic Exercise" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2f5599712836325cb1a090cedc805e1d><img src=../../en/other/pet-clinic/images/petclinic-exercise.png alt="PetClinic Exercise" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of PetClinic Java Workshop</h1><article class=default><header class=headline></header><h1 id=installing-the-opentelemetry-collector>Installing the OpenTelemetry Collector</h1><h2 id=1-introduction>1. Introduction</h2><p>The OpenTelemetry Collector is the core component of instrumenting infrastructure and applications. Its role is to collect and send:</p><ul><li>Infrastructure metrics (disk, cpu, memory, etc)</li><li>Application Performance Monitoring (APM) traces</li><li>Profiling data</li><li>Host and application logs</li></ul><p>Splunk Observability Cloud offers a wizard to walk you through the setup of the Collector on both your infrastructure and applications.</p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Delete any existing OpenTelemetry Collectors</div><div class=box-content><p>If you have completed the Splunk IM workshop, please ensure you have deleted the collector running in Kubernetes before continuing. This can be done by running the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></div></div><h2 id=2-confirm-environment-variables>2. Confirm environment variables</h2><p>To ensure your instance is configured correctly, we need to confirm that the required environment variables for this workshop are set correctly. In your terminal run the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>env</span></span></code></pre></div><p>In the output check the following environment variables are present and have values set:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>ACCESS_TOKEN
</span></span><span class=line><span class=cl>REALM
</span></span><span class=line><span class=cl>RUM_TOKEN</span></span></code></pre></div><p>For this workshop, <strong>all</strong> of the above are required. If any are missing, please contact your instructor.</p><h2 id=3-install-the-opentelemetry-collector>3. Install the OpenTelemetry Collector</h2><p>We can then go ahead and install the Collector. Some additional parameters are passed to the install script, they are:</p><ul><li><code>--with-instrumentation</code> - This will install the agent from the Splunk distribution of OpenTelemetry Java, which is then loaded automatically when the PetClinic Java application starts up. No configuration is required!</li><li><code>--deployment-environment</code> - Sets the resource attribute <code>deployment.environment</code> to the value passed. This is used to filter views in the UI.</li><li><code>--enable-profiler</code> - Enables the profiler for the Java application. This will generate CPU profiles for the application.</li><li><code>--enable-profiler-memory</code> - Enables the profiler for the Java application. This will generate memory profiles for the application.</li><li><code>--enable-metrics</code> - Enables the exporting of Micrometer metrics</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo sh /tmp/splunk-otel-collector.sh --realm <span class=nv>$REALM</span> -- <span class=nv>$ACCESS_TOKEN</span> --mode agent --without-fluentd --with-instrumentation --deployment-environment <span class=nv>$INSTANCE</span>-petclinic --enable-profiler --enable-profiler-memory --enable-metrics</span></span></code></pre></div><p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> AWS/EC2 instances</div><div class=box-content><p>If you are attempting this workshop on an AWS/EC2 instance you will have to patch the collector to expose the hostname of the instance:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo sed -i <span class=s1>&#39;s/gcp, ecs, ec2, azure, system/system, gcp, ecs, ec2, azure/g&#39;</span> /etc/otel/collector/agent_config.yaml</span></span></code></pre></div><p>Once the <code>agent_config.yaml</code> has been patched, you will need to restart the collector:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector</span></span></code></pre></div></div></div>Once the installation is completed, you can navigate to the <strong>Hosts with agent installed</strong> dashboard to see the data from your host, <strong>Dashboards → Hosts with agent installed</strong>.</p><p>Use the dashboard filter and select <code>host.name</code> and type or select the hostname of your virtual machine. Once you see data flowing for your host, we are then ready to get started with the APM component.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=zero-configuration-auto-instrumentation-for-java>Zero Configuration Auto Instrumentation for Java</h1><h2 id=1-spring-petclinic-application>1. Spring PetClinic Application</h2><p>The first thing we need to set up APM is&mldr; well, an application. For this exercise, we will use the Spring PetClinic application. This is a very popular sample Java application built with Spring framework (Springboot).</p><p>First, clone the PetClinic GitHub repository, and then we will compile, build, package and test the application:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/spring-projects/spring-petclinic</span></span></code></pre></div><p>Change into the <code>spring-petclinic</code> directory (and checkout a specific commit):</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> spring-petclinic <span class=o>&amp;&amp;</span> git checkout 276880e</span></span></code></pre></div><p>Start a MySQL database for PetClinic to use:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d -e <span class=nv>MYSQL_USER</span><span class=o>=</span>petclinic -e <span class=nv>MYSQL_PASSWORD</span><span class=o>=</span>petclinic -e <span class=nv>MYSQL_ROOT_PASSWORD</span><span class=o>=</span>root -e <span class=nv>MYSQL_DATABASE</span><span class=o>=</span>petclinic -p 3306:3306 docker.io/mysql:5.7.8</span></span></code></pre></div><p>Next, we will start a Docker container running Locust that will generate some simple traffic to the PetClinic application. Locust is a simple load-testing tool that can be used to generate traffic to a web application.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --network<span class=o>=</span><span class=s2>&#34;host&#34;</span> -d -p 8090:8090 -v /home/ubuntu/workshop/petclinic:/mnt/locust docker.io/locustio/locust -f /mnt/locust/locustfile.py --headless -u <span class=m>1</span> -r <span class=m>1</span> -H http://127.0.0.1:8083</span></span></code></pre></div><p>Next, run the <code>maven</code> command to compile/build/package PetClinic:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>This will take a few minutes the first time you run, <code>maven</code> will download a lot of dependencies before it compiles the application. Future executions will be a lot quicker.</p></div></div><p>Once the compilation is complete, you can run the application with the following command. Notice that we are passing the <code>mysql</code> profile to the application, this will tell the application to use the MySQL database we started earlier. We are also setting the <code>otel.service.name</code> to a logical service name that will also be used in the UI for filtering:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>You can validate if the application is running by visiting <code>http://&lt;VM_IP_ADDRESS>:8083</code>.</p><h2 id=2-alwayson-profiling-and-metrics>2. AlwaysOn Profiling and Metrics</h2><p>When we installed the collector we configured it to enable AlwaysOn Profiling and Metrics. This means that the collector will automatically generate CPU and Memory profiles for the application and send them to Splunk Observability Cloud.</p><p>When you start the PetClinic application you will see the collector automatically detect the application and instrument it for traces and profiling.</p><div class=tab-panel data-tab-group=c83318fea808717ac081dd1a69e4099d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("c83318fea808717ac081dd1a69e4099d","example-output")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Picked up JAVA_TOOL_OPTIONS: -javaagent:/usr/lib/splunk-instrumentation/splunk-otel-javaagent.jar -Dsplunk.profiler.enabled=true -Dsplunk.profiler.memory.enabled=true
</span></span><span class=line><span class=cl>OpenJDK 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:04:661 +0100] [main] INFO io.opentelemetry.javaagent.tooling.VersionLogger - opentelemetry-javaagent - version: splunk-1.25.0-otel-1.27.0
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:05:294 +0100] [main] INFO com.splunk.javaagent.shaded.io.micrometer.core.instrument.push.PushMeterRegistry - publishing metrics for SignalFxMeterRegistry every 30s
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:043 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:044 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - Profiler configuration:
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:047 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                  splunk.profiler.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:048 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                splunk.profiler.directory : /tmp
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:049 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -       splunk.profiler.recording.duration : 20s
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:050 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -               splunk.profiler.keep-files : false
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:051 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -            splunk.profiler.logs-endpoint : null
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:053 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -              otel.exporter.otlp.endpoint : null
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:054 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -           splunk.profiler.memory.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:055 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -             splunk.profiler.tlab.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:056 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -        splunk.profiler.memory.event.rate : 150/s
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:057 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.call.stack.interval : PT10S
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:058 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -  splunk.profiler.include.internal.stacks : false
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:059 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.tracing.stacks.only : false
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:059 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:060 +0100] [main] INFO com.splunk.opentelemetry.profiler.JfrActivator - Profiler is active.</span></span></code></pre></div></div></div></div></div><h2 id=3-review-profiling-data-collection>3. Review Profiling Data Collection</h2><p>You can now visit the Splunk APM UI and examine the application components, traces, profiling, DB Query performance and metrics. From the left-hand menu <strong>APM</strong> → Explore**, click the environment dropdown and select your environment (which is prefixed with the hostname of your instance).</p><p><a href=#R-image-ba03a42d62887b19b480810069117123 class=lightbox-link><img src=../../en/other/pet-clinic/2-zero-configuration/../images/apm-environment.png alt="APM Environment" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ba03a42d62887b19b480810069117123><img src=../../en/other/pet-clinic/2-zero-configuration/../images/apm-environment.png alt="APM Environment" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Once your validation is complete you can stop the application by pressing <code>Ctrl-c</code>.</p><h2 id=4-adding-resource-attributes-to-spans>4. Adding Resource Attributes to Spans</h2><p>Resource attributes can be added to every reported span. For example <code>version=0.314</code>. A comma-separated list of resource attributes can also be defined e.g. <code>key1=val1,key2=val2</code>.</p><p>Let&rsquo;s launch the PetClinic again using a new resource attribute. Note, that adding resource attributes to the run command will override what was defined when we installed the collector. Let&rsquo;s add a new resource attribute <code>version=0.314</code>:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span><span class=nv>version</span><span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>Back in the Splunk APM UI we can drill down on a recent trace and see the new <code>version</code> attribute in a span.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=3-real-user-monitoring>3. Real User Monitoring</h1><h2 id=1-enable-rum>1. Enable RUM</h2><p>For the Real User Monitoring (RUM) instrumentation, we will add the Open Telemetry Javascript <a href=https://github.com/signalfx/splunk-otel-js-web target=_blank>https://github.com/signalfx/splunk-otel-js-web</a> snippet in the pages, we will use the wizard again <strong>Data Management → Add Integration → RUM Instrumentation → Browser Instrumentation</strong>.</p><p>Select the preconfigured <strong>RUM ACCESS TOKEN</strong> from the dropdown, and click <strong>Next</strong>. Enter <strong>App name</strong> and <strong>Environment</strong> using the following syntax:</p><ul><li><code>[hostname]-petclinic-service</code> - replacing <code>[hostname]</code> with your actual hostname.</li><li><code>[hostname]-petclinic-env</code> - replacing <code>[hostname]</code> with your actual hostname.</li></ul><p>Then you&rsquo;ll need to select the workshop RUM token and define the application and environment names. The wizard will then show a snippet of HTML code that needs to be placed at the top of the pages in the <code>&lt;head></code> section. In this example, we are using:</p><ul><li>Application Name: <code>&lt;hostname>-petclinic-service</code></li><li>Environment: <code>&lt;hostname>-petclinic-env</code></li></ul><p>Copy the generated code snippet in the wizard or copy and edit the snippet below accordingly. You need to replace <code>&lt;REALM></code>, <code>&lt;RUM_ACCESS_TOKEN></code> and <code>&lt;hostname></code> with the actual values.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>beaconUrl</span><span class=o>:</span> <span class=s2>&#34;https://rum-ingest.&lt;REALM&gt;.signalfx.com/v1/rum&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>rumAuth</span><span class=o>:</span> <span class=s2>&#34;&lt;RUM_ACCESS_TOKEN&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>app</span><span class=o>:</span> <span class=s2>&#34;&lt;hostname&gt;-petclinic-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>environment</span><span class=o>:</span> <span class=s2>&#34;&lt;hostname&gt;-petclinic-env&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div><p>The Spring PetClinic application uses a single HTML page as the &ldquo;layout&rdquo; page, that is reused across all pages of the application. This is the perfect location to insert the Splunk RUM Instrumentation Library as it will be loaded in all pages automatically.</p><p>Let&rsquo;s then edit the layout page:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi src/main/resources/templates/fragments/layout.html</span></span></code></pre></div><p>Next, insert the snippet we generated above in the <code>&lt;head></code> section of the page. Now we need to rebuild the application and run it again:</p><h2 id=2-rebuild-petclinic>2. Rebuild PetClinic</h2><p>Run the <code>maven</code> command to compile/build/package PetClinic:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span><span class=nv>version</span><span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>Then let&rsquo;s visit the application using a browser to generate real-user traffic <code>http://&lt;VM_IP_ADDRESS>:8083</code>, now we should see RUM traces being reported.</p><p>Let&rsquo;s visit RUM and see some of the traces and metrics <strong>Hamburger Menu → RUM</strong> and you will see some of the Spring PetClinic URLs showing up in the UI.</p><p>When you drill down into a RUM trace you will see a link to APM in the spans. Clicking on the trace ID will take you to the corresponding APM trace for the current RUM trace.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=4-log-observer>4. Log Observer</h1><h2 id=1-introduction>1. Introduction</h2><p>For the Splunk Log Observer component, we will configure the Spring PetClinic application to write logs to a file in the filesystem and configure the Splunk OpenTelemetry Collect to read (tail) that log file and report the information to the Splunk Observability Platform.</p><h2 id=2-opentelemetry-filelog-configuration>2. OpenTelemetry Filelog Configuration</h2><p>We need to configure the Splunk OpenTelemetry Collector to tail the Spring PetClinic log file and report the data to the Splunk Cloud HEC URL.</p><p>The Splunk OpenTelemetry Collector uses the <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/receiver/filelogreceiver/README.md target=_blank>Filelog Receiver</a> to consume logs. We will need to edit the collectors&rsquo; configuration file:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/otel/collector/agent_config.yaml</span></span></code></pre></div><p>Under <code>receivers:</code> create the Filelog Receiver (make sure to indent correctly):</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>filelog</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>include</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>/home/ubuntu/spring-petclinic.log]</span></span></span></code></pre></div><p>The under the <code>service:</code> section, find the <code>logs:</code> pipeline, replace <code>fluentforward</code> with<code>filelog</code> and remove <code>otlp</code>(again, make sure to indent correctly):</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>filelog]</span></span></span></code></pre></div><p>Save the file and exit the editor. Next, we need to validate that the HEC Token and HEC URL are configured for the collector to use. We will inspect the <code>/etc/otel/collector/splunk-otel-collector.conf</code> file:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo cat /etc/otel/collector/splunk-otel-collector.conf</span></span></code></pre></div><p>Make sure <code>SPLUNK_HEC_URL</code> and <code>SPLUNK_HEC_TOKEN</code> have values set, we can then restart the collector to apply the changes:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector</span></span></code></pre></div><h2 id=3-logback-settings>3. Logback Settings</h2><p>The Spring PetClinic application can be configured to use several different Java logging libraries. In this scenario, we are going to use logback. We just need to create a file named <code>logback.xml</code> in the configuration folder:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi ~/spring-petclinic/src/main/resources/logback.xml</span></span></code></pre></div><p>Copy and paste the following XML content:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE xml&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;configuration</span> <span class=na>scan=</span><span class=s>&#34;true&#34;</span> <span class=na>scanPeriod=</span><span class=s>&#34;30 seconds&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;contextListener</span> <span class=na>class=</span><span class=s>&#34;ch.qos.logback.classic.jul.LevelChangePropagator&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;resetJUL&gt;</span>true<span class=nt>&lt;/resetJUL&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/contextListener&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;logger</span> <span class=na>name=</span><span class=s>&#34;org.springframework.samples.petclinic&#34;</span> <span class=na>level=</span><span class=s>&#34;info&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;appender</span> <span class=na>name=</span><span class=s>&#34;file&#34;</span> <span class=na>class=</span><span class=s>&#34;ch.qos.logback.core.rolling.RollingFileAppender&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;file&gt;</span>/home/ubuntu/spring-petclinic.log<span class=nt>&lt;/file&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;rollingPolicy</span> <span class=na>class=</span><span class=s>&#34;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;fileNamePattern&gt;</span>springLogFile.%d{yyyy-MM-dd}.log<span class=nt>&lt;/fileNamePattern&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;maxHistory&gt;</span>5<span class=nt>&lt;/maxHistory&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;totalSizeCap&gt;</span>1GB<span class=nt>&lt;/totalSizeCap&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/rollingPolicy&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;encoder&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;pattern&gt;</span>
</span></span><span class=line><span class=cl>        %d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg trace_id=%X{trace_id} span_id=%X{span_id} trace_flags=%X{trace_flags} %n service.name=%property{otel.resource.service.name}, deployment.environment=%property{otel.resource.deployment.environment}: %m%n
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/pattern&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/encoder&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/appender&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;root</span> <span class=na>level=</span><span class=s>&#34;info&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;appender-ref</span> <span class=na>ref=</span><span class=s>&#34;file&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/root&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span></span></span></code></pre></div><p>Now we need to rebuild the application and run it again:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><p>Once the rebuild has been completed we can then run the application again:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span><span class=nv>version</span><span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><h2 id=4-view-logs>4. View Logs</h2><p>From the left-hand menu click on <strong>Log Observer</strong>. Click on <strong>Index</strong> and select <strong>o11y-workshop-XXX.splunkcloud.com</strong> (where <strong>XXX</strong> will be the realm you are running in). On the right-hand side select <strong>petclinic-workshop</strong> and then click <strong>Apply</strong>. You should see log messages being reported.</p><p>Next, click <strong>Add Filter</strong> search for the field <code>service_name</code> select the value <code>&lt;your host name>-petclinic-service</code> and click <code>=</code> (include). You should now see only the log messages from your PetClinic application.</p><p><a href=#R-image-1f366fa2e5c8deae9ebc620e0d653dda class=lightbox-link><img src=../../en/other/pet-clinic/4-log-observer-connect/../images/log-observer.png alt="Log Observer" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1f366fa2e5c8deae9ebc620e0d653dda><img src=../../en/other/pet-clinic/4-log-observer-connect/../images/log-observer.png alt="Log Observer" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=4-summary>4. Summary</h2><p>This is the end of the exercise and we have certainly covered a lot of ground. At this point, you should have metrics, traces (APM & RUM), logs, database query performance and code profiling being reported into Splunk Observability Cloud. <strong>Congratulations</strong>!</p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=getting-data-in-gdi-with-otel-and-uf>Getting Data In (GDI) with OTel and UF</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
45 minutes</button></span><p>During this technical workshop you will learn how to:</p><ul><li>Efficiently deploy complex environments</li><li>Capture metrics from these environments to Splunk Observability Cloud</li><li>Auto-instrument a python application</li><li>Enable OS logging to Splunk Enterprise via Universal Forwarder</li></ul><p>In order to simplify the workshop modules, a pre-configured AWS EC2 instance is provided.</p><p>By the end of this technical workshop you will have an approach to demonstrating metrics collection for complex environments and services.</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Getting Data In (GDI) with OTel and UF</h1><article class=default><header class=headline></header><h1 id=getting-started-with-o11y-gdi---real-time-enrichment-workshop>Getting Started with O11y GDI - Real Time Enrichment Workshop</h1><p>Please note to begin the following lab, you must have completed the prework:</p><ul><li>Obtain a Splunk Observability Cloud access key</li><li>Understand cli commands</li></ul><p>Follow these steps if using O11y Workshop EC2 instances</p><h2 id=1-verify-yelp-data-files-are-present>1. Verify yelp data files are present</h2><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ll /var/appdata/yelp*</span></span></code></pre></div><h2 id=2-export-the-following-variables>2. Export the following variables</h2><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>ACCESS_TOKEN</span><span class=o>=</span>&lt;your-access-token&gt;
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>REALM</span><span class=o>=</span>&lt;your-o11y-cloud-realm&gt;
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>clusterName</span><span class=o>=</span>&lt;your-k8s-cluster&gt;</span></span></code></pre></div><h2 id=3-clone-the-following-repo>3. Clone the following repo</h2><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/ubuntu 
</span></span><span class=line><span class=cl>git clone https://github.com/leungsteve/realtime_enrichment.git 
</span></span><span class=line><span class=cl><span class=nb>cd</span> realtime_enrichment/workshop 
</span></span><span class=line><span class=cl>python3 -m venv rtapp-workshop 
</span></span><span class=line><span class=cl><span class=nb>source</span> rtapp-workshop/bin/activate</span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=deploy-complex-environments-and-capture-metrics>Deploy Complex Environments and Capture Metrics</h1><p><strong>Objective:</strong> Learn how to efficiently deploy complex infrastructure components such as Kafka and MongoDB to demonstrate metrics collection with Splunk O11y IM integrations</p><p><strong>Duration</strong>: 15 Minutes</p><h2 id=scenario>Scenario</h2><p>A prospect uses Kafka and MongoDB in their environment. Since there are integrations for these services, you’d like to demonstrate this to the prospect. What is a quick and efficient way to set up a live environment with these services and have metrics collected?</p><h3 id=1-where-can-i-find-helm-charts>1. Where can I find helm charts?</h3><ul><li>Google “myservice helm chart”</li><li><code>https://artifacthub.io/</code> (<strong>Note:</strong> Look for charts from trusted organizations, with high star count and frequent updates)</li></ul><h3 id=2-review-apache-kafka-packaged-by-bitnamihttpsgithubcombitnamichartstreemainbitnamikafkainstalling-the-chart>2. Review <a href=https://github.com/bitnami/charts/tree/main/bitnami/kafka/#installing-the-chart target=_blank>Apache Kafka packaged by Bitnami</a></h3><p>We will deploy the helm chart with these options enabled:</p><ul><li><code>replicaCount=3</code></li><li><code>metrics.jmx.enabled=true</code></li><li><code>metrics.kafka.enabled=true</code></li><li><code>deleteTopicEnable=true</code></li></ul><h3 id=3-review-mongodbr-packaged-by-bitnamihttpsgithubcombitnamichartstreemasterbitnamimongodbinstalling-the-chart>3. Review <a href=https://github.com/bitnami/charts/tree/master/bitnami/mongodb/#installing-the-chart target=_blank>MongoDB(R) packaged by Bitnami</a></h3><p>We will deploy the helm chart with these options enabled:</p><ul><li><code>version 12.1.31</code></li><li><code>metrics.enabled=true</code></li><li><code>global.namespaceOverride=default</code></li><li><code>auth.rootUser=root</code></li><li><code>auth.rootPassword=splunk</code></li><li><code>auth.enabled=false</code></li></ul><h3 id=4-install-kafka-and-mongodb-with-helm-charts>4. Install Kafka and MongoDB with helm charts</h3><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add bitnami https://charts.bitnami.com/bitnami</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install kafka --set <span class=nv>replicaCount</span><span class=o>=</span><span class=m>3</span> --set metrics.jmx.enabled<span class=o>=</span><span class=nb>true</span> --set metrics.kafka.enabled<span class=o>=</span><span class=nb>true</span>  --set <span class=nv>deleteTopicEnable</span><span class=o>=</span><span class=nb>true</span> bitnami/kafka</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install mongodb --set metrics.enabled<span class=o>=</span><span class=nb>true</span> bitnami/mongodb --set global.namespaceOverride<span class=o>=</span>default --set auth.rootUser<span class=o>=</span>root --set auth.rootPassword<span class=o>=</span>splunk --set auth.enabled<span class=o>=</span><span class=nb>false</span> --version 12.1.31</span></span></code></pre></div><p>Verify the helm chart installation</p><div class=tab-panel data-tab-group=34800e32ea197a0e6cd5abaf2444aace><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=helm-list class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("34800e32ea197a0e6cd5abaf2444aace","helm-list")'>
<span class=tab-nav-text>helm list</span></button>
<button data-tab-item=helm-list-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("34800e32ea197a0e6cd5abaf2444aace","helm-list-output")'>
<span class=tab-nav-text>helm list output</span></button></div><div class=tab-content-container><div data-tab-item=helm-list class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm list</span></span></code></pre></div></div></div><div data-tab-item=helm-list-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME    NAMESPACE   REVISION    UPDATED                                 STATUS      CHART           APP VERSION
</span></span><span class=line><span class=cl>kafka   default     1           2022-11-14 11:21:36.328956822 -0800 PST deployed    kafka-19.1.3    3.3.1
</span></span><span class=line><span class=cl>mongodb default     1           2022-11-14 11:19:36.507690487 -0800 PST deployed    mongodb-12.1.31 5.0.10</span></span></code></pre></div></div></div></div></div><p>Verify the helm chart installation</p><div class=tab-panel data-tab-group=b7618b907c3610eadb61e427d1877ad0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-get-pods class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("b7618b907c3610eadb61e427d1877ad0","kubectl-get-pods")'>
<span class=tab-nav-text>kubectl get pods</span></button>
<button data-tab-item=kubectl-get-pods-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("b7618b907c3610eadb61e427d1877ad0","kubectl-get-pods-output")'>
<span class=tab-nav-text>kubectl get pods Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-get-pods class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div data-tab-item=kubectl-get-pods-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                              READY   STATUS              RESTARTS   AGE
</span></span><span class=line><span class=cl>kafka-exporter-595778d7b4-99ztt   0/1     ContainerCreating   0          17s
</span></span><span class=line><span class=cl>mongodb-b7c968dbd-jxvsj           0/2     Pending             0          6s
</span></span><span class=line><span class=cl>kafka-1                           0/2     ContainerCreating   0          16s
</span></span><span class=line><span class=cl>kafka-2                           0/2     ContainerCreating   0          16s
</span></span><span class=line><span class=cl>kafka-zookeeper-0                 0/1     Pending             0          17s
</span></span><span class=line><span class=cl>kafka-0                           0/2     Pending             0          17s</span></span></code></pre></div></div></div></div></div><p>Use information for each Helm chart and Splunk O11y Data Setup to generate values.yaml for capturing metrics from Kafka and MongoDB.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p><code>values.yaml</code> for the different services will be passed to the Splunk Helm Chart at installation time. These will configure the OTEL collector to capture metrics from these services.</p></div></div><ul><li>References:<ul><li><a href=https://github.com/bitnami/charts/tree/master/bitnami/spark/#installing-the-chart target=_blank>Apache Kafka packaged by Bitnami</a></li><li><a href=https://docs.splunk.com/Observability/gdi/kafka/kafka.html target=_blank>Configure application receivers for databases » Apache Kafka</a></li><li><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/kafkametricsreceiver target=_blank>Kafkametricsreceiver</a></li></ul></li></ul><h4 id=41-example-kafkavaluesyaml>4.1 Example kafka.values.yaml</h4><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>otelAgent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receiver_creator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>smartagent/kafka</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=l>type == &#34;pod&#34; &amp;&amp; name matches &#34;kafka&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c>#endpoint: &#39;`endpoint`:5555&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>5555</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>collectd/kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>clusterName</span><span class=p>:</span><span class=w> </span><span class=l>sl-kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>otelK8sClusterReceiver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>k8sEventsEnabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kafkametrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>brokers</span><span class=p>:</span><span class=w> </span><span class=l>kafka:9092</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>protocol_version</span><span class=p>:</span><span class=w> </span><span class=m>2.0.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>brokers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>topics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>consumers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c>#- prometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>k8s_cluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>kafkametrics</span></span></span></code></pre></div><h4 id=42-example-mongodbvaluesyaml>4.2 Example mongodb.values.yaml</h4><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>otelAgent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>receiver_creator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>smartagent/mongodb</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=l>type == &#34;pod&#34; &amp;&amp; name matches &#34;mongo&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>collectd/mongodb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>mongodb.default.svc.cluster.local</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>27017</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>databases</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;admin&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;O11y&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;local&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;config&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>sendCollectionMetrics</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>sendCollectionTopMetrics</span><span class=p>:</span><span class=w> </span><span class=kc>true</span></span></span></code></pre></div><h4 id=43-example-zookeepervaluesyaml>4.3 Example zookeeper.values.yaml</h4><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>otelAgent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>receiver_creator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>smartagent/zookeeper</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=l>type == &#34;pod&#34; &amp;&amp; name matches &#34;kafka-zookeeper&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>collectd/zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>kafka-zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>2181</span></span></span></code></pre></div><h3 id=5-install-the-splunk-otel-helm-chart>5. Install the Splunk OTEL helm chart</h3><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/ubuntu/realtime_enrichment/otel_yamls/ 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>helm repo update</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install --set <span class=nv>provider</span><span class=o>=</span><span class=s1>&#39; &#39;</span> --set <span class=nv>distro</span><span class=o>=</span><span class=s1>&#39; &#39;</span> --set splunkObservability.accessToken<span class=o>=</span><span class=nv>$ACCESS_TOKEN</span> --set <span class=nv>clusterName</span><span class=o>=</span><span class=nv>$clusterName</span> --set splunkObservability.realm<span class=o>=</span><span class=nv>$REALM</span> --set otelCollector.enabled<span class=o>=</span><span class=s1>&#39;false&#39;</span> --set splunkObservability.logsEnabled<span class=o>=</span><span class=s1>&#39;true&#39;</span> --set gateway.enabled<span class=o>=</span><span class=s1>&#39;false&#39;</span> --values kafka.values.yaml --values mongodb.values.yaml --values zookeeper.values.yaml --values alwayson.values.yaml --values k3slogs.yaml --generate-name splunk-otel-collector-chart/splunk-otel-collector</span></span></code></pre></div><h3 id=6-verify-installation>6. Verify installation</h3><p>Verify that the Kafka, MongoDB and Splunk OTEL Collector helm charts are installed, note that names may differ.</p><div class=tab-panel data-tab-group=31b7416d1cea06a628bcb8a3659ddcf1><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=helm-list class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("31b7416d1cea06a628bcb8a3659ddcf1","helm-list")'>
<span class=tab-nav-text>helm list</span></button>
<button data-tab-item=helm-list-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("31b7416d1cea06a628bcb8a3659ddcf1","helm-list-output")'>
<span class=tab-nav-text>helm list Output</span></button></div><div class=tab-content-container><div data-tab-item=helm-list class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm list</span></span></code></pre></div></div></div><div data-tab-item=helm-list-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                NAMESPACE   REVISION    UPDATED                                 STATUS      CHART                           APP VERSION
</span></span><span class=line><span class=cl>kafka                               default     1           2021-12-07 12:48:47.066421971 -0800 PST deployed    kafka-14.4.1                    2.8.1
</span></span><span class=line><span class=cl>mongodb                             default     1           2021-12-07 12:49:06.132771625 -0800 PST deployed    mongodb-10.29.2                 4.4.10
</span></span><span class=line><span class=cl>splunk-otel-collector-1638910184    default     1           2021-12-07 12:49:45.694013749 -0800 PST deployed    splunk-otel-collector-0.37.1    0.37.1</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=d185f1b450afd2b08504125056bdc6ad><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-get-pods class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("d185f1b450afd2b08504125056bdc6ad","kubectl-get-pods")'>
<span class=tab-nav-text>kubectl get pods</span></button>
<button data-tab-item=kubectl-get-pods-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("d185f1b450afd2b08504125056bdc6ad","kubectl-get-pods-output")'>
<span class=tab-nav-text>kubectl get pods Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-get-pods class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div data-tab-item=kubectl-get-pods-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                                              READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>kafka-zookeeper-0                                                 1/1     Running   0          18m
</span></span><span class=line><span class=cl>kafka-2                                                           2/2     Running   1          18m
</span></span><span class=line><span class=cl>mongodb-79cf87987f-gsms8                                          2/2     Running   0          18m
</span></span><span class=line><span class=cl>kafka-1                                                           2/2     Running   1          18m
</span></span><span class=line><span class=cl>kafka-exporter-7c65fcd646-dvmtv                                   1/1     Running   3          18m
</span></span><span class=line><span class=cl>kafka-0                                                           2/2     Running   1          18m
</span></span><span class=line><span class=cl>splunk-otel-collector-1638910184-agent-27s5c                      2/2     Running   0          17m
</span></span><span class=line><span class=cl>splunk-otel-collector-1638910184-k8s-cluster-receiver-8587qmh9l   1/1     Running   0          17m</span></span></code></pre></div></div></div></div></div><h3 id=7-verify-dashboards>7. Verify dashboards</h3><p>Verify that out of the box dashboards for Kafka, MongoDB and Zookeeper are populated in the Infrastructure Monitor landing page. Drill down into each component to view granular details for each service.</p><p>Tip: You can use the filter <code>k8s.cluster.name</code> with your cluster name to find your instance.</p><ul><li>Infrastructure Monitoring Landing page:</li></ul><p><a href=#R-image-a1de821d9f52baafbf2a63044fc0c05a class=lightbox-link><img src=../../en/other/gdi/2-deploy/../images/inframon.jpg alt=IM-landing-page class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a1de821d9f52baafbf2a63044fc0c05a><img src=../../en/other/gdi/2-deploy/../images/inframon.jpg alt=IM-landing-page class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><ul><li>K8 Navigator:</li></ul><p><a href=#R-image-30c343fb6a11d7b3e8aab411e7543c28 class=lightbox-link><img src=../../en/other/gdi/2-deploy/../images/k8navigator.jpg alt=k8-navigator class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-30c343fb6a11d7b3e8aab411e7543c28><img src=../../en/other/gdi/2-deploy/../images/k8navigator.jpg alt=k8-navigator class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><ul><li>MongoDB Dashboard:</li></ul><p><a href=#R-image-a7221244a60e146aacd84864e68599e6 class=lightbox-link><img src=../../en/other/gdi/2-deploy/../images/mongoDB.jpg alt=mongodb-dash class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a7221244a60e146aacd84864e68599e6><img src=../../en/other/gdi/2-deploy/../images/mongoDB.jpg alt=mongodb-dash class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><ul><li>Kafka Dashboard:</li></ul><p><a href=#R-image-3a98de254120f7dc49ad82c686f2631b class=lightbox-link><img src=../../en/other/gdi/2-deploy/../images/kafka.jpg alt=kafka-dash class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-3a98de254120f7dc49ad82c686f2631b><img src=../../en/other/gdi/2-deploy/../images/kafka.jpg alt=kafka-dash class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=code-to-kubernetes---python>Code to Kubernetes - Python</h1><h2 id=code-to-kubernetes---python>Code to Kubernetes - Python</h2><p><strong>Objective:</strong> Understand activities to instrument a python application and run it on Kubernetes.</p><ul><li>Verify the code</li><li>Containerize the app</li><li>Deploy the container in Kubernetes</li></ul><p><strong>Note:</strong> these steps do not involve Splunk</p><p><strong>Duration:</strong> 15 Minutes</p><h2 id=1-verify-the-code---review-service>1. Verify the code - Review service</h2><p>Navigate to the review directory</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/ubuntu/realtime_enrichment/flask_apps/review/</span></span></code></pre></div><p>Inspect review.py (realtime_enrichment/flask_apps/review)</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat review.py</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>jsonify</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>review</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>num_reviews</span> <span class=o>=</span> <span class=mi>8635403</span>
</span></span><span class=line><span class=cl><span class=n>num_reviews</span> <span class=o>=</span> <span class=mi>100000</span>
</span></span><span class=line><span class=cl><span class=n>reviews_file</span> <span class=o>=</span> <span class=s1>&#39;/var/appdata/yelp_academic_dataset_review.json&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@review.route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hello_world</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>(</span><span class=n>message</span><span class=o>=</span><span class=s1>&#39;Hello, you want to hit /get_review. We have &#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>num_reviews</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39; reviews!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@review.route</span><span class=p>(</span><span class=s1>&#39;/get_review&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_review</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>random_review_int</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>num_reviews</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>line_num</span> <span class=o>=</span> <span class=n>random_review_int</span> <span class=o>+</span> <span class=s1>&#39;q;d&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>command</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;sed&#34;</span><span class=p>,</span> <span class=n>line_num</span><span class=p>,</span> <span class=n>reviews_file</span><span class=p>]</span> <span class=c1># sed &#34;7997242q;d&#34; &lt;file&gt;</span>
</span></span><span class=line><span class=cl>    <span class=n>random_review</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>command</span><span class=p>,</span> <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span> <span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>random_review</span><span class=o>.</span><span class=n>stdout</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>review</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span> <span class=o>=</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>,</span> <span class=n>port</span> <span class=o>=</span> <span class=mi>5000</span><span class=p>,</span> <span class=n>debug</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span></span></span></code></pre></div><p>Inspect requirements.txt</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Flask==2.0.2</span></span></code></pre></div><p>Create a virtual environment and Install the necessary python packages</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/ubuntu/realtime_enrichment/workshop/flask_apps_start/review/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pip freeze <span class=c1>#note output</span>
</span></span><span class=line><span class=cl>pip install -r requirements.txt
</span></span><span class=line><span class=cl>pip freeze <span class=c1>#note output</span></span></span></code></pre></div><p>Start the REVIEW service. <strong>Note:</strong> You can stop the app with control+C</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 review.py
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> * Serving Flask app <span class=s1>&#39;review&#39;</span> <span class=o>(</span>lazy loading<span class=o>)</span>
</span></span><span class=line><span class=cl> * Environment: production
</span></span><span class=line><span class=cl>         ...snip...
</span></span><span class=line><span class=cl> * Running on http://10.160.145.246:5000/ <span class=o>(</span>Press CTRL+C to quit<span class=o>)</span>
</span></span><span class=line><span class=cl> * Restarting with stat
</span></span><span class=line><span class=cl>127.0.0.1 - - <span class=o>[</span>17/May/2022 22:46:38<span class=o>]</span> <span class=s2>&#34;GET / HTTP/1.1&#34;</span> <span class=m>200</span> -
</span></span><span class=line><span class=cl>127.0.0.1 - - <span class=o>[</span>17/May/2022 22:47:02<span class=o>]</span> <span class=s2>&#34;GET /get_review HTTP/1.1&#34;</span> <span class=m>200</span> -
</span></span><span class=line><span class=cl>127.0.0.1 - - <span class=o>[</span>17/May/2022 22:47:58<span class=o>]</span> <span class=s2>&#34;GET /get_review HTTP/1.1&#34;</span> <span class=m>200</span> -</span></span></code></pre></div><p>Verify that the service is working</p><ul><li>Open a new terminal and ssh into your ec2 instance. Then use the curl command in your terminal.</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:5000</span></span></code></pre></div><ul><li>Or hit the URL <code>http://{Your_EC2_IP_address}:5000</code> and <code>http://{Your_EC2_IP_address}:5000/get_review</code> with a browser</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl localhost:5000
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;message&#34;</span>: <span class=s2>&#34;Hello, you want to hit /get_review. We have 100000 reviews!&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl localhost:5000/get_review
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;review_id&#34;</span>:<span class=s2>&#34;NjbiESXotcEdsyTc4EM3fg&#34;</span>,<span class=s2>&#34;user_id&#34;</span>:<span class=s2>&#34;PR9LAM19rCM_HQiEm5OP5w&#34;</span>,<span class=s2>&#34;business_id&#34;</span>:<span class=s2>&#34;UAtX7xmIfdd1W2Pebf6NWg&#34;</span>,<span class=s2>&#34;stars&#34;</span>:3.0,<span class=s2>&#34;useful&#34;</span>:0,<span class=s2>&#34;funny&#34;</span>:0,<span class=s2>&#34;cool&#34;</span>:0,<span class=s2>&#34;text&#34;</span>:<span class=s2>&#34;-If you&#39;re into cheap beer (pitcher of bud-light for </span><span class=nv>$7</span><span class=s2>) decent wings and a good time, this is the place for you. Its generally very packed after work hours and weekends. Don&#39;t expect cocktails. \n\n-You run into a lot of sketchy characters here sometimes but for the most part if you&#39;re chilling with friends its not that bad. \n\n-Friendly bouncer and bartenders.&#34;</span>,<span class=s2>&#34;date&#34;</span>:<span class=s2>&#34;2016-04-12 20:23:24&#34;</span><span class=o>}</span></span></span></code></pre></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><ul><li>What does this application do?</li><li>Do you see the yelp dataset being used?</li><li>Why did the output of pip freeze differ each time you ran it?</li><li>Which port is the REVIEW app listening on? Can other python apps use this same port?</li></ul></div></div><h2 id=2-create-a-review-container>2. Create a REVIEW container</h2><p>To create a container image, you need to create a Dockerfile, run docker build to build the image referencing the Docker file and push it up to a remote repository so it can be pulled by other sources.</p><ul><li><a href=https://docs.docker.com/get-started/02_our_app/ target=_blank>Create a Dockerfile</a></li><li>Creating a Dockerfile typically requires you to consider the following:<ul><li>Identify an appropriate container image<ul><li>ubuntu vs. python vs. alpine/slim</li><li>ubuntu - overkill, large image size, wasted resources when running in K8</li><li>this is a python app, so pick an image that is optimized for it</li><li><a href=https://lih-verma.medium.com/alpine-makes-python-docker-builds-way-too-50-slower-and-images-double-2-larger-61d1d43cbc79 target=_blank>avoid alpine for python</a></li></ul></li><li>Order matters<ul><li>you&rsquo;re building layers.</li><li>re-use the layers as much as possible</li><li>have items that change often towards the end</li></ul></li><li><a href=https://docs.docker.com/develop/develop-images/dockerfile_best-practices/ target=_blank>Other Best practices for writing Dockerfiles</a></li></ul></li></ul><p>Dockerfile for review</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> python:3.10-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> requirements.txt /app<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install -r requirements.txt<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> ./review.py /app<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 5000</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span> <span class=s2>&#34;python&#34;</span><span class=p>,</span> <span class=s2>&#34;review.py&#34;</span> <span class=p>]</span></span></span></code></pre></div><p>Create a container image (locally)
Run ‘docker build’ to build a local container image referencing the Dockerfile</p><div class=tab-panel data-tab-group=c9162fddf5ab9a5a5defffbd1b67f5dd><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=docker-build class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("c9162fddf5ab9a5a5defffbd1b67f5dd","docker-build")'>
<span class=tab-nav-text>docker build</span></button>
<button data-tab-item=docker-build-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("c9162fddf5ab9a5a5defffbd1b67f5dd","docker-build-output")'>
<span class=tab-nav-text>docker build Output</span></button></div><div class=tab-content-container><div data-tab-item=docker-build class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build -f Dockerfile -t localhost:8000/review:0.01 .</span></span></code></pre></div></div></div><div data-tab-item=docker-build-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[+] Building 35.5s (11/11) FINISHED
</span></span><span class=line><span class=cl> =&gt; [internal] load build definition from Dockerfile                              0.0s
</span></span><span class=line><span class=cl>         ...snip...
</span></span><span class=line><span class=cl> =&gt; [3/5] COPY requirements.txt /app                                              0.0s
</span></span><span class=line><span class=cl> =&gt; [4/5] RUN pip install -r requirements.txt                                     4.6s
</span></span><span class=line><span class=cl> =&gt; [5/5] COPY ./review.py /app                                                   0.0s
</span></span><span class=line><span class=cl> =&gt; exporting to image                                                            0.2s
</span></span><span class=line><span class=cl> =&gt; =&gt; exporting layers                                                           0.2s
</span></span><span class=line><span class=cl> =&gt; =&gt; writing image sha256:61da27081372723363d0425e0ceb34bbad6e483e698c6fe439c5  0.0s
</span></span><span class=line><span class=cl> =&gt; =&gt; naming to docker.io/localhost:8000/review:0.1                                   0.0</span></span></code></pre></div></div></div></div></div><p>Push the container image into a container repository
Run ‘docker push’ to place a copy of the REVIEW container to a remote location</p><div class=tab-panel data-tab-group=a2e0f027942504a9068f213723c7788b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=docker-push class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("a2e0f027942504a9068f213723c7788b","docker-push")'>
<span class=tab-nav-text>docker push</span></button>
<button data-tab-item=docker-push-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("a2e0f027942504a9068f213723c7788b","docker-push-output")'>
<span class=tab-nav-text>docker push Output</span></button></div><div class=tab-content-container><div data-tab-item=docker-push class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker push localhost:8000/review:0.01</span></span></code></pre></div></div></div><div data-tab-item=docker-push-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>The push refers to repository [docker.io/localhost:8000/review]
</span></span><span class=line><span class=cl>02c36dfb4867: Pushed
</span></span><span class=line><span class=cl>         ...snip...
</span></span><span class=line><span class=cl>fd95118eade9: Pushed
</span></span><span class=line><span class=cl>0.1: digest: sha256:3651f740abe5635af95d07acd6bcf814e4d025fcc1d9e4af9dee023a9b286f38 size: 2202</span></span></code></pre></div></div></div></div></div><p>Verify that the image is in Docker Hub. The same info can be found in Docker Desktop</p><div class=tab-panel data-tab-group=f8473aef096cd33f69b4e15069b0622c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=get-catalog class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("f8473aef096cd33f69b4e15069b0622c","get-catalog")'>
<span class=tab-nav-text>get catalog</span></button>
<button data-tab-item=get-catalog-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("f8473aef096cd33f69b4e15069b0622c","get-catalog-output")'>
<span class=tab-nav-text>get catalog Output</span></button></div><div class=tab-content-container><div data-tab-item=get-catalog class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -s http://localhost:8000/v2/_catalog</span></span></code></pre></div></div></div><div data-tab-item=get-catalog-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>{&#34;repositories&#34;:[&#34;review&#34;]}</span></span></code></pre></div></div></div></div></div><h2 id=3-run-review-in-kubernetes>3. Run REVIEW in Kubernetes</h2><p>Create K8 deployment yaml file for the REVIEW app</p><p>Reference: <a href=https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#creating-a-deployment target=_blank>Creating a Deployment</a></p><p>review.deployment.yaml</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>imagePullSecrets</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>regcred</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>localhost:8000/review:0.01</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/var/appdata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>appdata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>appdata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>hostPath</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/var/appdata</span></span></span></code></pre></div><p>Notes regarding review.deployment.yaml:</p><ul><li>labels - K8 uses labels and selectors to tag and identify resources<ul><li>In the next step, we&rsquo;ll create a service and associate it to this deployment using the label</li></ul></li><li>replicas = 1<ul><li>K8 allows you to scale your deployments horizontally</li><li>We&rsquo;ll leverage this later to add load and increase our ingestion rate</li></ul></li><li>regcred provides this deployment with the ability to access your dockerhub credentials which is necessary to pull the container image.</li><li>The volume definition and volumemount make the yelp dataset visible to the container</li></ul><p>Create a K8 service yaml file for the review app.</p><p>Reference: <a href=https://kubernetes.io/docs/concepts/services-networking/service/#defining-a-service target=_blank>Creating a service:</a></p><p>review.service.yaml</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>5000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>5000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class=m>30000</span></span></span></code></pre></div><p>Notes about review.service.yaml:</p><ul><li>the selector associates this service to pods with the label app with the value being review</li><li>the review service exposes the review pods as a network service<ul><li>other pods can now ping &lsquo;review&rsquo; and they will hit a review pod.</li><li>a pod would get a review if it ran <code>curl http://review:5000</code></li></ul></li><li>NodePort service<ul><li>the service is accessible to the K8 host by the nodePort, 30000</li><li>Another machine that has this can get a review if it ran <code>curl http://&lt;k8 host ip>:30000</code></li></ul></li></ul><p>Apply the review deployment and service</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f review.service.yaml -f review.deployment.yaml</span></span></code></pre></div><p>Verify that the deployment and services are running:</p><div class=tab-panel data-tab-group=0626dc42deea18b53456e43fb2744349><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-get-deployments class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("0626dc42deea18b53456e43fb2744349","kubectl-get-deployments")'>
<span class=tab-nav-text>kubectl get deployments</span></button>
<button data-tab-item=kubectl-get-deployments-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("0626dc42deea18b53456e43fb2744349","kubectl-get-deployments-output")'>
<span class=tab-nav-text>kubectl get deployments output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-get-deployments class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get deployments</span></span></code></pre></div></div></div><div data-tab-item=kubectl-get-deployments-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                                    READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>review                                                  1/1     1            1           19h</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=27d8a73287744c5bfe0138e647c19308><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-get-services class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("27d8a73287744c5bfe0138e647c19308","kubectl-get-services")'>
<span class=tab-nav-text>kubectl get services</span></button>
<button data-tab-item=kubectl-get-services-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("27d8a73287744c5bfe0138e647c19308","kubectl-get-services-output")'>
<span class=tab-nav-text>kubectl get services output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-get-services class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get services</span></span></code></pre></div></div></div><div data-tab-item=kubectl-get-services-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                         AGE
</span></span><span class=line><span class=cl>review                     NodePort    10.43.175.21    &lt;none&gt;        5000:30000/TCP                  154d</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=c9642f10a2dc255d5c68a7a1829ddb63><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=curl-localhost class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("c9642f10a2dc255d5c68a7a1829ddb63","curl-localhost")'>
<span class=tab-nav-text>curl localhost</span></button>
<button data-tab-item=curl-localhost-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("c9642f10a2dc255d5c68a7a1829ddb63","curl-localhost-output")'>
<span class=tab-nav-text>curl localhost Output</span></button></div><div class=tab-content-container><div data-tab-item=curl-localhost class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl localhost:30000</span></span></code></pre></div></div></div><div data-tab-item=curl-localhost-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>  &#34;message&#34;: &#34;Hello, you want to hit /get_review. We have 100000 reviews!&#34;
</span></span><span class=line><span class=cl>}</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=125d93fdce892c5eee9d01dabfe73df6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=get-review class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("125d93fdce892c5eee9d01dabfe73df6","get-review")'>
<span class=tab-nav-text>get review</span></button>
<button data-tab-item=get-review-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("125d93fdce892c5eee9d01dabfe73df6","get-review-output")'>
<span class=tab-nav-text>get review Output</span></button></div><div class=tab-content-container><div data-tab-item=get-review class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl localhost:30000/get_review</span></span></code></pre></div></div></div><div data-tab-item=get-review-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>{&#34;review_id&#34;:&#34;Vv9rHtfBrFc-1M1DHRKN9Q&#34;,&#34;user_id&#34;:&#34;EaNqIwKkM7p1bkraKotqrg&#34;,&#34;business_id&#34;:&#34;TA1KUSCu8GkWP9w0rmElxw&#34;,&#34;stars&#34;:3.0,&#34;useful&#34;:1,&#34;funny&#34;:0,&#34;cool&#34;:0,&#34;text&#34;:&#34;This is the first time I&#39;ve actually written a review for Flip, but I&#39;ve probably been here about 10 times.  \n\nThis used to be where I would take out of town guests who wanted a good, casual, and relatively inexpensive meal.  \n\nI hadn&#39;t been for a while, so after a long day in midtown, we decided to head to Flip.  \n\nWe had the fried pickles, onion rings, the gyro burger, their special burger, and split a nutella milkshake.  I have tasted all of the items we ordered previously (with the exception of the special) and have been blown away with how good they were.  My guy had the special which was definitely good, so no complaints there.  The onion rings and the fried pickles were greasier than expected.  Though I&#39;ve thought they were delicious in the past, I probably wouldn&#39;t order either again.  The gyro burger was good, but I could have used a little more sauce.  It almost tasted like all of the ingredients didn&#39;t entirely fit together.  Something was definitely off. It was a friday night and they weren&#39;t insanely busy, so I&#39;m not sure I would attribute it to the staff not being on their A game...\n\nDon&#39;t get me wrong.  Flip is still good.  The wait staff is still amazingly good looking.  They still make delicious milk shakes.  It&#39;s just not as amazing as it once was, which really is a little sad.&#34;,&#34;date&#34;:&#34;2010-10-11 18:18:35&#34;}</span></span></code></pre></div></div></div></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What changes are required if you need to make an update to your Dockerfile now?</p></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=instrument-reviews-for-tracing>Instrument REVIEWS for Tracing</h1><h2 id=1-use-data-setup-to-instrument-a-python-application>1. Use Data Setup to instrument a Python application</h2><p>Within the O11y Cloud UI:</p><p>Data Management -> Add Integration -> Monitor Applications -> Python (traces) -> Add Integration</p><p>Provide the following to the Configure Integration Wizard:</p><ul><li><p>Service: review</p></li><li><p>Django: no</p></li><li><p>collector endpoint: <code>http://localhost:4317</code></p></li><li><p>Environment: rtapp-workshop-[YOURNAME]</p></li><li><p>Kubernetes: yes</p></li><li><p>Legacy Agent: no</p></li></ul><p><a href=#R-image-af543cb019520f12b43e9153f73c73b9 class=lightbox-link><img src=../../en/other/gdi/4-instrument/../images/configureintegration.png alt=o11y_cloud_ui class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-af543cb019520f12b43e9153f73c73b9><img src=../../en/other/gdi/4-instrument/../images/configureintegration.png alt=o11y_cloud_ui class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>We are instructed to:</p><ul><li>Install the instrumentation packages for your Python environment.</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>pip install splunk-opentelemetry[all]
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>splunk-py-trace-bootstrap</span></span></code></pre></div><ul><li><p>Configure the Downward API to expose environment variables to Kubernetes resources.</p><p>For example, update a Deployment to inject environment variables by adding <code>.spec.template.spec.containers.env</code> like:</p></li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>your-application</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>SPLUNK_OTEL_AGENT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>fieldRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class=l>status.hostIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_EXPORTER_OTLP_ENDPOINT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://$(SPLUNK_OTEL_AGENT):4317&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_SERVICE_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;review&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_RESOURCE_ATTRIBUTES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;deployment.environment=rtapp-workshop-stevel&#34;</span></span></span></code></pre></div><ul><li><p>Enable the Splunk OTel Python agent by editing your Python service command.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>splunk-py-trace python3 main.py --port=8000</span></span></code></pre></div></li><li><p>The actions we must perform include:</p><ul><li>Update the Dockerfile to install the splunk-opentelemetry packages</li><li>Update the deployment.yaml for each service to include these environment variables which will be used by the pod and container.</li><li>Update our Dockerfile for REVIEW so that our program is bootstrapped with splunk-py-trace</li></ul></li></ul><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>We will accomplish this by:</p><ol><li>generating a new requirements.txt file</li><li>generating a new container image with an updated Dockerfile for REVIEW and then</li><li>update the review.deployment.yaml to capture all of these changes.</li></ol></div></div><h2 id=2-update-the-review-container>2. Update the REVIEW container</h2><ul><li><p>Generate a new container image</p></li><li><p>Update the Dockerfile for REVIEW (<code>/workshop/flask_apps_finish/review</code>)</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> python:3.10-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> requirements.txt /app<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install -r requirements.txt<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install splunk-opentelemetry<span class=o>[</span>all<span class=o>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> splk-py-trace-bootstrap<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> ./review.py /app<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 5000</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span> <span class=s2>&#34;splunk-py-trace&#34;</span> <span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span> <span class=s2>&#34;python&#34;</span><span class=p>,</span> <span class=s2>&#34;review.py&#34;</span> <span class=p>]</span></span></span></code></pre></div></li></ul><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>Note that the only lines, in bold, added to the Dockerfile</p></div></div><ul><li>Generate a new container image with docker build in the ‘finished’ directory</li><li>Notice that I have changed the repository name from <code>localhost:8000/review:0.01</code> to <code>localhost:8000/review-splkotel:0.01</code></li></ul><p>Ensure you are in the correct directory.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>pwd</span>
</span></span><span class=line><span class=cl>./workshop/flask_apps_finish/review</span></span></code></pre></div><div class=tab-panel data-tab-group=0ce4fc12c9146b9966635c94d4d5e76c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=docker-build class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("0ce4fc12c9146b9966635c94d4d5e76c","docker-build")'>
<span class=tab-nav-text>docker build</span></button>
<button data-tab-item=docker-build-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("0ce4fc12c9146b9966635c94d4d5e76c","docker-build-output")'>
<span class=tab-nav-text>docker build Output</span></button></div><div class=tab-content-container><div data-tab-item=docker-build class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build -f Dockerfile.review -t localhost:8000/review-splkotel:0.01 .</span></span></code></pre></div></div></div><div data-tab-item=docker-build-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[+] Building 27.1s (12/12) FINISHED
</span></span><span class=line><span class=cl>=&gt; [internal] load build definition from Dockerfile                                                        0.0s
</span></span><span class=line><span class=cl>=&gt; =&gt; transferring dockerfile: 364B                                                                        0.0s
</span></span><span class=line><span class=cl>=&gt; [internal] load .dockerignore                                                                           0.0s
</span></span><span class=line><span class=cl>=&gt; =&gt; transferring context: 2B                                                                             0.0s
</span></span><span class=line><span class=cl>=&gt; [internal] load metadata for docker.io/library/python:3.10-slim                                         1.6s
</span></span><span class=line><span class=cl>=&gt; [auth] library/python:pull token for registry-1.docker.io                                               0.0s
</span></span><span class=line><span class=cl>=&gt; [1/6] FROM docker.io/library/python:3.10-slim@sha256:54956d6c929405ff651516d5ebbc204203a6415c9d2757aad  0.0s
</span></span><span class=line><span class=cl>=&gt; [internal] load build context                                                                           0.3s
</span></span><span class=line><span class=cl>=&gt; =&gt; transferring context: 1.91kB                                                                         0.3s
</span></span><span class=line><span class=cl>=&gt; CACHED [2/6] WORKDIR /app                                                                               0.0s
</span></span><span class=line><span class=cl>=&gt; [3/6] COPY requirements.txt /app                                                                        0.0s
</span></span><span class=line><span class=cl>=&gt; [4/6] RUN pip install -r requirements.txt                                                              15.3s
</span></span><span class=line><span class=cl>=&gt; [5/6] RUN splk-py-trace-bootstrap                                                                       9.0s
</span></span><span class=line><span class=cl>=&gt; [6/6] COPY ./review.py /app                                                                             0.0s
</span></span><span class=line><span class=cl>=&gt; exporting to image                                                                                      0.6s
</span></span><span class=line><span class=cl>=&gt; =&gt; exporting layers                                                                                     0.6s
</span></span><span class=line><span class=cl>=&gt; =&gt; writing image sha256:164977dd860a17743b8d68bcc50c691082bd3bfb352d1025dc3a54b15d5f4c4d                0.0s
</span></span><span class=line><span class=cl>=&gt; =&gt; naming to docker.io/localhost:8000/review-splkotel:0.01                                              0.0s</span></span></code></pre></div></div></div></div></div><ul><li>Push the image to Docker Hub with docker push command</li></ul><div class=tab-panel data-tab-group=f7527cd6bef102f53995e4b837364a21><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=docker-push class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("f7527cd6bef102f53995e4b837364a21","docker-push")'>
<span class=tab-nav-text>docker push</span></button>
<button data-tab-item=docker-push-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("f7527cd6bef102f53995e4b837364a21","docker-push-output")'>
<span class=tab-nav-text>docker push Output</span></button></div><div class=tab-content-container><div data-tab-item=docker-push class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker push localhost:8000/review-splkotel:0.01</span></span></code></pre></div></div></div><div data-tab-item=docker-push-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>The push refers to repository [docker.io/localhost:8000/review-splkotel]
</span></span><span class=line><span class=cl>682f0e550f2c: Pushed
</span></span><span class=line><span class=cl>dd7dfa312442: Pushed
</span></span><span class=line><span class=cl>917fd8334695: Pushed
</span></span><span class=line><span class=cl>e6782d51030d: Pushed
</span></span><span class=line><span class=cl>c6b19a64e528: Mounted from localhost:8000/review
</span></span><span class=line><span class=cl>8f52e3bfc0ab: Mounted from localhost:8000/review
</span></span><span class=line><span class=cl>f90b85785215: Mounted from localhost:8000/review
</span></span><span class=line><span class=cl>d5c0beb90ce6: Mounted from localhost:8000/review
</span></span><span class=line><span class=cl>3759be374189: Mounted from localhost:8000/review
</span></span><span class=line><span class=cl>fd95118eade9: Mounted from localhost:8000/review
</span></span><span class=line><span class=cl>0.01: digest: sha256:3b251059724dbb510ea81424fc25ed03554221e09e90ef965438da33af718a45 size: 2412</span></span></code></pre></div></div></div></div></div><h2 id=3-update-the-review-deployment-in-kubernetes>3. Update the REVIEW deployment in Kubernetes</h2><ul><li><p>review.deployment.yaml must be updated with the following changes:</p><ul><li>Load the new container image on Docker Hub</li><li>Add environment variables so traces can be emitted to the OTEL collector</li></ul></li><li><p>The deployment must be replaced using the updated review.deployment.yaml</p><ul><li><p>Update review.deployment.yaml (updates highlighted in bold)</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>imagePullSecrets</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>regcred</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>localhost:8000/review-splkotel:0.01</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/var/appdata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>appdata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>SPLUNK_OTEL_AGENT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>fieldRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class=l>status.hostIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_SERVICE_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;review&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>SPLUNK_METRICS_ENDPOINT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://$(SPLUNK_OTEL_AGENT):9943&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_EXPORTER_OTLP_ENDPOINT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://$(SPLUNK_OTEL_AGENT):4317&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_RESOURCE_ATTRIBUTES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;deployment.environment=rtapp-workshop-stevel&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>appdata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>hostPath</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/var/appdata</span></span></span></code></pre></div></li></ul></li><li><p>Apply review.deployment.yaml. Kubernetes will automatically pick up the changes to the deployment and redeploy new pods with these updates</p><ul><li>Notice that the review-* pod has been restarted</li></ul></li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f review.deployment.yaml</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                                              READY   STATUS        RESTARTS   AGE
</span></span><span class=line><span class=cl>kafka-client                                                      0/1     Unknown       0          155d
</span></span><span class=line><span class=cl>curl                                                              0/1     Unknown       0          155d
</span></span><span class=line><span class=cl>kafka-zookeeper-0                                                 1/1     Running       0          26h
</span></span><span class=line><span class=cl>kafka-2                                                           2/2     Running       0          26h
</span></span><span class=line><span class=cl>kafka-exporter-647bddcbfc-h9gp5                                   1/1     Running       2          26h
</span></span><span class=line><span class=cl>mongodb-6f6c78c76-kl4vv                                           2/2     Running       0          26h
</span></span><span class=line><span class=cl>kafka-1                                                           2/2     Running       1          26h
</span></span><span class=line><span class=cl>kafka-0                                                           2/2     Running       1          26h
</span></span><span class=line><span class=cl>splunk-otel-collector-1653114277-agent-n4dfn                      2/2     Running       0          26h
</span></span><span class=line><span class=cl>splunk-otel-collector-1653114277-k8s-cluster-receiver-5f48v296j   1/1     Running       0          26h
</span></span><span class=line><span class=cl>splunk-otel-collector-1653114277-agent-jqxhh                      2/2     Running       0          26h
</span></span><span class=line><span class=cl>review-6686859bd7-4pf5d                                           1/1     Running       0          11s
</span></span><span class=line><span class=cl>review-5dd8cfd77b-52jbd                                           0/1     Terminating   0          2d10h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl get pods
</span></span><span class=line><span class=cl>NAME                                                              READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>kafka-client                                                      0/1     Unknown   0          155d
</span></span><span class=line><span class=cl>curl                                                              0/1     Unknown   0          155d
</span></span><span class=line><span class=cl>kafka-zookeeper-0                                                 1/1     Running   0          26h
</span></span><span class=line><span class=cl>kafka-2                                                           2/2     Running   0          26h
</span></span><span class=line><span class=cl>kafka-exporter-647bddcbfc-h9gp5                                   1/1     Running   2          26h
</span></span><span class=line><span class=cl>mongodb-6f6c78c76-kl4vv                                           2/2     Running   0          26h
</span></span><span class=line><span class=cl>kafka-1                                                           2/2     Running   1          26h
</span></span><span class=line><span class=cl>kafka-0                                                           2/2     Running   1          26h
</span></span><span class=line><span class=cl>splunk-otel-collector-1653114277-agent-n4dfn                      2/2     Running   0          26h
</span></span><span class=line><span class=cl>splunk-otel-collector-1653114277-k8s-cluster-receiver-5f48v296j   1/1     Running   0          26h
</span></span><span class=line><span class=cl>splunk-otel-collector-1653114277-agent-jqxhh                      2/2     Running   0          26h
</span></span><span class=line><span class=cl>review-6686859bd7-4pf5d                                           1/1     Running   0          15s</span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=monitor-system-logs-with-splunk-universal-forwarder>Monitor System Logs with Splunk Universal Forwarder</h1><p><strong>Objective:</strong> Learn how to monitor Linux system logs with the Universal Forwarder sending logs to Splunk Enterprise</p><p><strong>Duration</strong>: 10 Minutes</p><h2 id=scenario>Scenario</h2><p>You&rsquo;ve been tasked with monitoring the OS logs of the host running your Kubernetes cluster. We are going to utilize a script that will autodeploy the Splunk Universal Forwarder. You will then configure the Universal Forwarder to send logs to the Splunk Enterprise instance assigned to you.</p><h3 id=1-ensure-youre-in-the-correct-directory>1. Ensure You&rsquo;re in the Correct Directory</h3><ul><li>we will need to be in /home/ubuntu/session-2</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/ubuntu/session-2</span></span></code></pre></div><h3 id=2-review-the-universal-forwarder-install-script>2. Review the Universal Forwarder Install Script</h3><ul><li>Let&rsquo;s take a look at the script that will install the Universal Forwarder and Linux TA automatically for you.<ul><li>This script is primarily used for remote instances.</li><li>Note we are not using a deployment server in this lab, however it is recommended in production we do that.</li><li>What user are we installing Splunk as?</li></ul></li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/sh  
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># This EXAMPLE script shows how to deploy the Splunk universal forwarder</span>
</span></span><span class=line><span class=cl><span class=c1># to many remote hosts via ssh and common Unix commands.</span>
</span></span><span class=line><span class=cl><span class=c1># For &#34;real&#34; use, this script needs ERROR DETECTION AND LOGGING!!</span>
</span></span><span class=line><span class=cl><span class=c1># --Variables that you must set -----</span>
</span></span><span class=line><span class=cl><span class=c1># Set username using by splunkd to run.</span>
</span></span><span class=line><span class=cl>  <span class=nv>SPLUNK_RUN_USER</span><span class=o>=</span><span class=s2>&#34;ubuntu&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Populate this file with a list of hosts that this script should install to,</span>
</span></span><span class=line><span class=cl><span class=c1># with one host per line. This must be specified in the form that should</span>
</span></span><span class=line><span class=cl><span class=c1># be used for the ssh login, ie. username@host</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># Example file contents:</span>
</span></span><span class=line><span class=cl><span class=c1># splunkuser@10.20.13.4</span>
</span></span><span class=line><span class=cl><span class=c1># splunkker@10.20.13.5</span>
</span></span><span class=line><span class=cl>  <span class=nv>HOSTS_FILE</span><span class=o>=</span><span class=s2>&#34;myhost.txt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># This should be a WGET command that was *carefully* copied from splunk.com!!</span>
</span></span><span class=line><span class=cl><span class=c1># Sign into splunk.com and go to the download page, then look for the wget</span>
</span></span><span class=line><span class=cl><span class=c1># link near the top of the page (once you have selected your platform)</span>
</span></span><span class=line><span class=cl><span class=c1># copy and paste your wget command between the &#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nv>WGET_CMD</span><span class=o>=</span><span class=s2>&#34;wget -O splunkforwarder-9.0.3-dd0128b1f8cd-Linux-x86_64.tgz &#39;https://download.splunk.com/products/universalforwarder/releases/9.0.3/linux/splunkforwarder-9.0.3-dd0128b1f8cd-Linux-x86_64.tgz&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># Set the install file name to the name of the file that wget downloads</span>
</span></span><span class=line><span class=cl><span class=c1># (the second argument to wget)</span>
</span></span><span class=line><span class=cl>  <span class=nv>INSTALL_FILE</span><span class=o>=</span><span class=s2>&#34;splunkforwarder-9.0.3-dd0128b1f8cd-Linux-x86_64.tgz&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># After installation, the forwarder will become a deployment client of this</span>
</span></span><span class=line><span class=cl><span class=c1># host.  Specify the host and management (not web) port of the deployment server</span>
</span></span><span class=line><span class=cl><span class=c1># that will be managing these forwarder instances.</span>
</span></span><span class=line><span class=cl><span class=c1># Example 1.2.3.4:8089</span>
</span></span><span class=line><span class=cl><span class=c1>#  DEPLOY_SERVER=&#34;x.x.x.x:8089&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># After installation, the forwarder can have additional TA&#39;s added to the </span>
</span></span><span class=line><span class=cl><span class=c1># /app directory please provide the local where TA&#39;s will be. </span>
</span></span><span class=line><span class=cl>  <span class=nv>TA_INSTALL_DIRECTORY</span><span class=o>=</span><span class=s2>&#34;/home/ubuntu/session-2&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Set the seed app folder name for deploymentclien.conf</span>
</span></span><span class=line><span class=cl><span class=c1>#  DEPLOY_APP_FOLDER_NAME=&#34;seed_all_deploymentclient&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># Set the new Splunk admin password</span>
</span></span><span class=line><span class=cl>  <span class=nv>PASSWORD</span><span class=o>=</span><span class=s2>&#34;buttercup&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>REMOTE_SCRIPT_DEPLOY</span><span class=o>=</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>  cd /opt
</span></span></span><span class=line><span class=cl><span class=s2>  sudo </span><span class=nv>$WGET_CMD</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  sudo tar xvzf </span><span class=nv>$INSTALL_FILE</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  sudo rm </span><span class=nv>$INSTALL_FILE</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  #sudo useradd </span><span class=nv>$SPLUNK_RUN_USER</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  sudo find </span><span class=nv>$TA_INSTALL_DIRECTORY</span><span class=s2> -name &#39;*.tgz&#39; -exec tar xzvf {} --directory /opt/splunkforwarder/etc/apps \;
</span></span></span><span class=line><span class=cl><span class=s2>  sudo chown -R </span><span class=nv>$SPLUNK_RUN_USER</span><span class=s2>:</span><span class=nv>$SPLUNK_RUN_USER</span><span class=s2> /opt/splunkforwarder
</span></span></span><span class=line><span class=cl><span class=s2>  echo \&#34;[user_info] 
</span></span></span><span class=line><span class=cl><span class=s2>  USERNAME = admin
</span></span></span><span class=line><span class=cl><span class=s2>  PASSWORD = </span><span class=nv>$PASSWORD</span><span class=s2>\&#34; &gt; /opt/splunkforwarder/etc/system/local/user-seed.conf   
</span></span></span><span class=line><span class=cl><span class=s2>  #sudo cp </span><span class=nv>$TA_INSTALL_DIRECTORY</span><span class=s2>/*.tgz /opt/splunkforwader/etc/apps/
</span></span></span><span class=line><span class=cl><span class=s2>  #sudo find /opt/splunkforwarder/etc/apps/ -name &#39;*.tgz&#39; -exec tar xzvf {} \;
</span></span></span><span class=line><span class=cl><span class=s2>  #sudo -u splunk /opt/splunkforwarder/bin/splunk start --accept-license --answer-yes --auto-ports --no-prompt
</span></span></span><span class=line><span class=cl><span class=s2>  /opt/splunkforwarder/bin/splunk start --accept-license --answer-yes --auto-ports --no-prompt
</span></span></span><span class=line><span class=cl><span class=s2>  #sudo /opt/splunkforwarder/bin/splunk enable boot-start -user </span><span class=nv>$SPLUNK_RUN_USER</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  /opt/splunkforwarder/bin/splunk enable boot-start -user </span><span class=nv>$SPLUNK_RUN_USER</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  #sudo cp </span><span class=nv>$TA_INSTALL_DIRECTORY</span><span class=s2>/*.tgz /opt/splunkforwarder/etc/apps/
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  exit
</span></span></span><span class=line><span class=cl><span class=s2> &#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>DIR</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span> <span class=nb>cd</span> <span class=s2>&#34;</span><span class=k>$(</span> dirname <span class=s2>&#34;</span><span class=si>${</span><span class=nv>BASH_SOURCE</span><span class=p>[0]</span><span class=si>}</span><span class=s2>&#34;</span> <span class=k>)</span><span class=s2>&#34;</span> &gt;/dev/null <span class=o>&amp;&amp;</span> <span class=nb>pwd</span> <span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#===============================================================================================</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;In 5 seconds, will run the following script on each remote host:&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;====================&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$REMOTE_SCRIPT_DEPLOY</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;====================&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> 
</span></span><span class=line><span class=cl>  sleep <span class=m>5</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;Reading host logins from </span><span class=nv>$HOSTS_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;Starting.&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> DST in <span class=sb>`</span>cat <span class=s2>&#34;</span><span class=nv>$DIR</span><span class=s2>/</span><span class=nv>$HOSTS_FILE</span><span class=s2>&#34;</span><span class=sb>`</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> -z <span class=s2>&#34;</span><span class=nv>$DST</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>      <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;---------------------------&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;Installing to </span><span class=nv>$DST</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;Initial UF deployment&#34;</span>
</span></span><span class=line><span class=cl>    sudo ssh -t <span class=s2>&#34;</span><span class=nv>$DST</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$REMOTE_SCRIPT_DEPLOY</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>done</span>  
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;---------------------------&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;Done&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;Please use the following app folder name to override deploymentclient.conf options: </span><span class=nv>$DEPLOY_APP_FOLDER_NAME</span><span class=s2>&#34;</span></span></span></code></pre></div><h3 id=3-run-the-install-script>3. Run the install script</h3><p>We will run the install script now. You will see some Warnings at the end. This is totally normal. The script is built for use on remote machines, however for todays lab you will be using localhost.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./install.sh</span></span></code></pre></div><p>You will be asked <code>Are you sure you want to continue connecting (yes/no/[fingerprint])?</code>
Answer Yes.</p><p>Enter your ssh password when prompted.</p><h3 id=4-verify-installation-of-the-universal-forwarader>4. Verify installation of the Universal Forwarader</h3><ul><li>We need to verify that the Splunk Universal Forwarder is installed and running.<ul><li>You should see a couple PID&rsquo;s return and a &ldquo;Splunk is currently running.&rdquo; message.</li></ul></li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/opt/splunkforwarder/bin/splunk status</span></span></code></pre></div><h4 id=5-configure-the-universal-forwarder-to-send-data-to-splunk-enterprise>5. Configure the Universal Forwarder to Send Data to Splunk Enterprise</h4><ul><li>We will be able to send the data to our Splunk Enterprise environment easily by entering one line into the cli.<ul><li><a href=https://docs.splunk.com/Documentation/Forwarder/9.0.3/Forwarder/Configuretheuniversalforwarder target=_blank>Universal Forwarder Config Guide</a></li></ul></li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/opt/splunkforwarder/bin/splunk add forward-server &lt;your_splunk_enterprise_ip&gt;:9997</span></span></code></pre></div><h4 id=6-verify-the-data-in-your-splunk-enterprise-environment>6. Verify the Data in Your Splunk Enterprise Environment</h4><ul><li><p>We are now going to take a look at the Splunk Enterprise environment to verify logs are coming in.</p><ul><li>Logs will be coming into <code>index=main</code></li></ul></li><li><p>Open your web browser and navigate to: <code>http://&lt;your_splunk_enterprise_ip:8000</code></p><ul><li>You will use the credentials <code>admin:&lt;your_ssh_password></code></li></ul></li><li><p>In the search bar, type in the following:</p></li><li><p><code>index=main host=&lt;your_host_name></code></p></li><li><p>You should see data from your host. Take note of the interesting fields and the different data sources flowing in.</p></li></ul><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=monitoring-horizontal-pod-autoscaling-in-kubernetes>Monitoring Horizontal Pod Autoscaling in Kubernetes</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
45 minutes</button></span><p>This workshop will equip you with the basic understanding of monitoring Kubernetes using the Splunk OpenTelemetry Collector. During the workshop you will deploy PHP/Apache and a load generator.</p><p>You will learn about OpenTelemetry Receivers, Kubernetes Namespaces, ReplicaSets, Kubernetes Horizontal Pod AutoScaling and how to monitor all this using the Splunk Observability Cloud. The main learnings from the workshop will be a better understanding of the Kubernetes Navigator (and Dashboards) in Splunk Observability Cloud as well as seeing Kubernetes metrics, events and Detectors.</p><p>For this workshop Splunk has prepared an Ubuntu Linux instance in AWS/EC2 all pre-configured for you.</p><p>To get access to the instance that you will be using in the workshop, please visit the URL provided by the workshop leader.</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Monitoring Horizontal Pod Autoscaling in Kubernetes</h1><article class=default><header class=headline></header><h1 id=deploying-the-opentelemetry-collector-in-kubernetes-using-a-namespace>Deploying the OpenTelemetry Collector in Kubernetes using a NameSpace</h1><h2 id=1-kubernetes-navigator-20-ui>1. Kubernetes Navigator 2.0 UI</h2><p>We will be starting this workshop using the new Kubernetes Navigator so please check that you are already using the new Navigator.</p><p>When you select <strong>Infrastructure</strong> from the main menu on the left, followed by selecting <strong>Kubernetes</strong>, you should see two services panes (<strong>K8s nodes</strong> and <strong>K8s workloads</strong>) for Kubernetes, similar like the ones below:</p><p><a href=#R-image-b94bbeb337e0a99ed00237bdc8420b91 class=lightbox-link><img src=../../en/other/hpa/1-deploy-otel/../images/k8s-nav2-two.png alt=k8s-navi-v-2 class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b94bbeb337e0a99ed00237bdc8420b91><img src=../../en/other/hpa/1-deploy-otel/../images/k8s-nav2-two.png alt=k8s-navi-v-2 class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=2-connect-to-ec2-instance>2. Connect to EC2 instance</h2><p>You will be able to connect to the workshop instance by using SSH from your Mac, Linux or Windows device. Open the link to the sheet provided by your instructor. This sheet contains the IP addresses and the password for the workshop instances.</p><p>To use SSH, open a terminal on your system and type <code>ssh ubuntu@x.x.x.x</code> (replacing x.x.x.x with the IP address assigned to you). The password for this workshop is also provided in the sheet.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>Your workshop instance has been pre-configured with the correct <strong>Access Token</strong> and <strong>Realm</strong> for this workshop. There is no need for you to configure these.</p></div></div><h2 id=3-namespaces-in-kubernetes>3. Namespaces in Kubernetes</h2><p>Most of our customers will make use of some kind of private or public cloud service to run Kubernetes. They often choose to have only a few large Kubernetes clusters as it is easier to manage centrally.</p><p>Namespaces are a way to organize these large Kubernetes clusters into virtual sub-clusters. This can be helpful when different teams or projects share a Kubernetes cluster as this will give them the easy ability to just see and work with their own resources.</p><p>Any number of namespaces are supported within a cluster, each logically separated from others but with the ability to communicate with each other. Components are only <strong>visible</strong> when selecting a namespace or when adding the <code>--all-namespaces</code> flag to <code>kubectl</code> instead of allowing you to view just the components relevant to your project by selecting your namespace.</p><p>Most customers will want to install the Splunk OpenTelemetry Collector into a separate namespace. This workshop will follow that best practice.</p><h2 id=4-install-splunk-otel-using-helm>4. Install Splunk OTel using Helm</h2><p>Install the OpenTelemetry Collector using the Splunk Helm chart. First, add the Splunk Helm chart repository and update.</p><div class=tab-panel data-tab-group=72ef968ca660dacc64a0260d4fd79ccd><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=helm-repo-add class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("72ef968ca660dacc64a0260d4fd79ccd","helm-repo-add")'>
<span class=tab-nav-text>helm repo add</span></button>
<button data-tab-item=helm-repo-add-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("72ef968ca660dacc64a0260d4fd79ccd","helm-repo-add-output")'>
<span class=tab-nav-text>helm repo add output</span></button></div><div class=tab-content-container><div data-tab-item=helm-repo-add class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart <span class=o>&amp;&amp;</span> helm repo update</span></span></code></pre></div></div></div><div data-tab-item=helm-repo-add-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Using ACCESS_TOKEN={REDACTED}
</span></span><span class=line><span class=cl>Using REALM=eu0
</span></span><span class=line><span class=cl>&#34;splunk-otel-collector-chart&#34; has been added to your repositories
</span></span><span class=line><span class=cl>Using ACCESS_TOKEN={REDACTED}
</span></span><span class=line><span class=cl>Using REALM=eu0
</span></span><span class=line><span class=cl>Hang tight while we grab the latest from your chart repositories...
</span></span><span class=line><span class=cl>...Successfully got an update from the &#34;splunk-otel-collector-chart&#34; chart repository
</span></span><span class=line><span class=cl>Update Complete. ⎈Happy Helming!⎈</span></span></code></pre></div></div></div></div></div><p>Install the OpenTelemetry Collector Helm chart into a new <strong>splunk</strong> namespace with the following commands, do <strong>NOT</strong> edit this:</p><div class=tab-panel data-tab-group=23d6e671889e96f1c83692c9cd467b54><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=helm-install class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("23d6e671889e96f1c83692c9cd467b54","helm-install")'>
<span class=tab-nav-text>helm install</span></button></div><div class=tab-content-container><div data-tab-item=helm-install class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.logsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.infrastructureMonitoringEventsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--namespace splunk <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--create-namespace <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/splunk-defaults.yaml</span></span></code></pre></div></div></div></div></div><h2 id=5-verify-deployment>5. Verify Deployment</h2><p>You can monitor the progress of the deployment by running <code>kubectl get pods</code> and adding <code>-n splunk</code> to the command to see the pods in the <code>splunk</code> namespace which should typically report that the new pods are up and running after about 30 seconds.</p><p>Ensure the status is reported as <strong>Running</strong> before continuing.</p><div class=tab-panel data-tab-group=95b37f4a4939d6c121635795be142fe5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-get-pods class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("95b37f4a4939d6c121635795be142fe5","kubectl-get-pods")'>
<span class=tab-nav-text>kubectl get pods</span></button>
<button data-tab-item=kubectl-get-pods-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("95b37f4a4939d6c121635795be142fe5","kubectl-get-pods-output")'>
<span class=tab-nav-text>kubectl get pods Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-get-pods class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods -n splunk</span></span></code></pre></div></div></div><div data-tab-item=kubectl-get-pods-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                                          READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>splunk-otel-collector-agent-pvstb                             2/2     Running   0          19s
</span></span><span class=line><span class=cl>splunk-otel-collector-k8s-cluster-receiver-6c454894f8-mqs8n   1/1     Running   0          19s</span></span></code></pre></div></div></div></div></div><p>Use the label set by the <code>helm</code> install to tail logs (You will need to press <code>ctrl + c</code> to exit).</p><div class=tab-panel data-tab-group=bff0eaac6a02d764bbc67cc44338525b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-logs class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("bff0eaac6a02d764bbc67cc44338525b","kubectl-logs")'>
<span class=tab-nav-text>kubectl logs</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-logs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>app</span><span class=o>=</span>splunk-otel-collector -f --container otel-collector -n splunk</span></span></code></pre></div></div></div></div></div><p>Or use the installed <code>k9s</code> terminal UI.</p><p><a href=#R-image-8f0f01039df3283f9a09af8770dbb0a0 class=lightbox-link><img src=../../en/other/hpa/1-deploy-otel/../images/k9s.png alt=k9s class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8f0f01039df3283f9a09af8770dbb0a0><img src=../../en/other/hpa/1-deploy-otel/../images/k9s.png alt=k9s class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Deleting a failed installation</div><div class=box-content><p>If you make an error installing the Splunk OpenTelemetry Collector you can start over by deleting the installation using:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>helm delete splunk-otel-collector -n splunk</span></span></code></pre></div></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=tour-of-the-kubernetes-navigator-v2>Tour of the Kubernetes Navigator v2</h1><h2 id=1-cluster-vs-workload-view>1. Cluster vs Workload View</h2><p>The Kubernetes Navigator offers you two separate use cases to view your Kubernetes data.</p><ul><li>The <strong>K8s workloads</strong> is focusing on providing information in regards to workloads a.k.a. <em>your deployments</em>.</li><li>The <strong>K8s nodes</strong> is focusing on providing insight into the performance of clusters, nodes, pods and containers.</li></ul><p>You will initially select either view depending on your need (you can switch between the view on the fly if required). The most common one we will use in this workshop is the workload view and we will focus on that specifically.</p><h3 id=11-finding-your-k8s-cluster-name>1.1 Finding your K8s Cluster name</h3><p>Your first task is to identify and find your own cluster. The cluster will be named after your EC2 instance name.</p><p>To confirm your EC2 instance name, look at the prompt of your EC2 instance. For example, if you are assigned the 7th EC2 instance, the prompt will show:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@emea-ws-7 ~ $</span></span></code></pre></div><p>This means your cluster will be named: <code>emea-ws-7-k3s-cluster</code>. Please make a note of your cluster name as you will need this later in the workshop for filtering.</p><h2 id=2-workloads--workload-details-pane>2. Workloads & Workload Details Pane</h2><p>Go to the <strong>Infrastructure</strong> page in the Observability UI and select <strong>Kubernetes</strong>, this will offer you a set of Kubernetes services, one of them being the <strong>K8s workloads</strong> pane.</p><p>The pane will show a tiny graph giving you a bird&rsquo;s eye view of the load being handled across those Workloads. Also, if there are any alerts for one of the workloads, you will see a small alert indicator as shown in the image below.</p><p><a href=#R-image-76d638129d743840275154a06df0b9e4 class=lightbox-link><img src=../../en/other/hpa/2-check-new-navigator-short/../images/K8s-Workloads.png alt=k8sWorkloads class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-76d638129d743840275154a06df0b9e4><img src=../../en/other/hpa/2-check-new-navigator-short/../images/K8s-Workloads.png alt=k8sWorkloads class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Click on the <strong>K8s workloads</strong> pane and you will be taken to the workload view.</p><p>Initially, you will see all the workloads for all clusters that are reported into your Observability Cloud Org. If an alert has fired for any of the workloads, it will be highlighted on the top right (as marked with a red stripe) in the image below. You can go directly to the alert by clicking it to expand it.</p><p><a href=#R-image-754a8e575ae726e67027bc17d4a4bf54 class=lightbox-link><img src=../../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-screen.png alt=Workloads class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-754a8e575ae726e67027bc17d4a4bf54><img src=../../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-screen.png alt=Workloads class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Now, let&rsquo;s find your own cluster by filtering on the field <code>k8s.cluster.name</code> in the filter toolbar (as marked with a blue stripe).</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>You can enter a partial name into the search box, such as &rsquo;emea-ws-7*&rsquo;, to quickly find your Cluster.</p><p>Also, it&rsquo;s a very good idea to switch the default time from the default <strong>-3h</strong> back to last 15 minutes (<strong>-15m</strong>).</p></div></div><p><a href=#R-image-8cc038f6682a30ec1f13c605ef42a051 class=lightbox-link><img src=../../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-filter.png alt=Workloads class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8cc038f6682a30ec1f13c605ef42a051><img src=../../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-filter.png alt=Workloads class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You should now just see information for your own cluster.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>How many workloads are running & how many namespaces are in your Cluster?</p></div></div><h3 id=21-using-the-navigator-selection-chart>2.1 Using the Navigator Selection chart</h3><p>The <strong>K8s workloads</strong> table is a common feature used across most of the Navigator&rsquo;s and will offer you a list view of the data you are viewing. In our case, it shows a list of <code>Pods Failed</code> grouped by <code>k8s.namespace.name</code>.</p><p><a href=#R-image-a7f114da64aaa053f8602d0bbd9cd7ac class=lightbox-link><img src=../../en/other/hpa/2-check-new-navigator-short/../images/workload-selection.png alt=k8s-workload-list class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a7f114da64aaa053f8602d0bbd9cd7ac><img src=../../en/other/hpa/2-check-new-navigator-short/../images/workload-selection.png alt=k8s-workload-list class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Now let&rsquo;s change the list view to a heat map view by selecting either the Heat map icon or List icon in the upper-right corner of the screen (as marked with the purple line).</p><p>Changing this option will result in the following visualisation:</p><p><a href=#R-image-4970c1a3699fb4cd7abc124a74d0cd36 class=lightbox-link><img src=../../en/other/hpa/2-check-new-navigator-short/../images/heatmap.png alt=k8s-Heat-map class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4970c1a3699fb4cd7abc124a74d0cd36><img src=../../en/other/hpa/2-check-new-navigator-short/../images/heatmap.png alt=k8s-Heat-map class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>In this view, you will note that each workload is now a colored square. These squares will change color according to the <strong>Color by</strong> option you selected, <em>as marked by the first green line</em> in the image above. The colors give a visual indication of health and/or usage. You can check the meaning by hovering over the <strong>legend</strong> exclamation icon <i class="fa-fw fas fa-exclamation-circle"></i>
bottom right of the heatmaps.</p><p>Another valuable option in this screen is <strong>Find Outliers</strong> which provides historical analytics of your clusters based on what is selected in the <strong>Color by</strong> dropdown.</p><p>Now, let&rsquo;s select the <strong>File system usage (bytes)</strong> from the <strong>Color by</strong> drop down box, then click on the <strong>Find outliers</strong> drop down <em>as marked by a yellow line</em> in the above image and make sure you change the <strong>Scope</strong> in the dialog to <strong>Per k8s.namespace.name</strong> and <strong>Deviation from Median</strong> as below:</p><p><a href=#R-image-3ed3f826dce3c61dba2b3f1c4647ef23 class=lightbox-link><img src=../../en/other/hpa/2-check-new-navigator-short/../images/set-find-outliers.png alt=k8s-Heat-map class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-3ed3f826dce3c61dba2b3f1c4647ef23><img src=../../en/other/hpa/2-check-new-navigator-short/../images/set-find-outliers.png alt=k8s-Heat-map class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>The <strong>Find outliers</strong> view is very useful when you need to view a selection of your workloads (or any service depending on the Navigator used) and quickly need to figure out if something has changed.</p><p>It will give you fast insight into items (workloads in our case) that are performing differently (both increased or decreased) which helps to make it easier to spot problems.</p><h3 id=22-the-deployment-overview-pane>2.2 The Deployment overview pane</h3><p>The Deployment overview pane gives you a quick insight of the status of your deployments. You can see at once if the pods of your deployments are Pending, Running, Succeeded, Failed or in an Unknown state.</p><p><a href=#R-image-88973a8779a47effcd8e58120aacb3ee class=lightbox-link><img src=../../en/other/hpa/2-check-new-navigator-short/../images/k8s-deployment-overview.png alt=k8s-workload-overview class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-88973a8779a47effcd8e58120aacb3ee><img src=../../en/other/hpa/2-check-new-navigator-short/../images/k8s-deployment-overview.png alt=k8s-workload-overview class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><ul><li><em>Running:</em> Pod is deployed and in a running state</li><li><em>Pending:</em> Waiting to be deployed</li><li><em>Succeeded:</em> Pod has been deployed and completed its job and is finished</li><li><em>Failed:</em> Containers in the pod have run and returned some kind of error</li><li><em>Unknown:</em> Kubernetes isn&rsquo;t reporting any of the known states. (This may be during the starting or stopping of pods, for example).</li></ul><p>You can expand the Workload name by hovering your mouse on it, in case the name is longer than the chart allows.</p><p><a href=#R-image-ce8961c971a5b61e8448597105e36e69 class=lightbox-link><img src=../../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-hover.png alt=k8s-workload-hoover class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ce8961c971a5b61e8448597105e36e69><img src=../../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-hover.png alt=k8s-workload-hoover class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>To filter to a specific workload, you can click on three dots <strong>&mldr;</strong> next to the workload name in the <strong>k8s.workload.name</strong> column and choose <strong>Filter</strong> from the dropdown box.</p><p><a href=#R-image-f06f63b305aa82ce2548eae9a603bb01 class=lightbox-link><img src=../../en/other/hpa/2-check-new-navigator-short/../images/workload-add-filter.png alt=workload-add-filter class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f06f63b305aa82ce2548eae9a603bb01><img src=../../en/other/hpa/2-check-new-navigator-short/../images/workload-add-filter.png alt=workload-add-filter class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>This will add the selected workload to your filters. Try this for the <strong>splunk-otel-collector-k8s-cluster-receiver</strong> workload. It will then list a single workload in the <strong>splunk</strong> namespace.</p><p>The Heat map above will also filter down to a single coloured square. Click on the square to see more information about the workload.</p><p><a href=#R-image-ea1bf0c4ce41c1fb237514a39d4bc1eb class=lightbox-link><img src=../../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-detail.png alt=workload-add-filter class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ea1bf0c4ce41c1fb237514a39d4bc1eb><img src=../../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-detail.png alt=workload-add-filter class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What are the CPU request & CPU limit units for the otel-collector?</p></div></div><p>At this point you can drill into the information of the pods, but that is outside the scope of this workshop, for now reset your view by removing the filter for the <strong>splunk-otel-collector-k8s-cluster-receiver</strong> workload and setting the <strong>Color by</strong> option to <strong>Pods Running</strong>.</p><p><a href=#R-image-caa777039f6f89351a302c2f5f8d491d class=lightbox-link><img src=../../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-remove-filter.png alt=workload-add-filter class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-caa777039f6f89351a302c2f5f8d491d><img src=../../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-remove-filter.png alt=workload-add-filter class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=3-navigator-sidebar>3. Navigator Sidebar</h2><p>Later in the workshop, you will deploy an Apache server into your cluster which will display an icon in the <strong>Navigator Sidebar</strong>.</p><p>In navigators for Kubernetes, you can track dependent services and containers in the navigator sidebar. To get the most out of the navigator sidebar you configure the services you want to track by configuring an extra dimension called <code>service.name</code>. For this workshop, we have already configured the <code>extraDimensions</code> in the collector configuration for monitoring Apache e.g.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extraDimensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>service.name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span></span></span></code></pre></div><p>The Navigator Sidebar will expand and a link to the discovered service will be added as seen in the image below:</p><p><a href=#R-image-37c662f7d7865373736e1fce43f3b032 class=lightbox-link><img src=../../en/other/hpa/2-check-new-navigator-short/../images/pivotbar.png alt=pivotbar class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-37c662f7d7865373736e1fce43f3b032><img src=../../en/other/hpa/2-check-new-navigator-short/../images/pivotbar.png alt=pivotbar class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>This will allow for easy switching between Navigators. The same applies for your Apache server instance, it will have a Navigator Sidebar allowing you to quickly jump back to the Kubernetes Navigator.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=deploying-phpapache>Deploying PHP/Apache</h1><h2 id=1--dns-and-services-in-kubernetes>1. DNS and Services in Kubernetes</h2><p>The Domain Name System (DNS) is a mechanism for linking various sorts of information with easy-to-remember names, such as IP addresses. Using a DNS system to translate request names into IP addresses makes it easy for end-users to reach their target domain name effortlessly.</p><p>Most Kubernetes clusters include an internal DNS service configured by default to offer a lightweight approach for service discovery. Even when Pods and Services are created, deleted, or shifted between nodes, built-in service discovery simplifies applications to identify and communicate with services on the Kubernetes clusters.</p><p>In short, the DNS system for Kubernetes will create a DNS entry for each Pod and Service. In general, a Pod has the following DNS resolution:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>pod-name.my-namespace.pod.cluster-domain.example</span></span></code></pre></div><p>For example, if a Pod in the <code>default</code> namespace has the Pod name <code>my_pod</code>, and the domain name for your cluster is <code>cluster.local</code>, then the Pod has a DNS name:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>my_pod.default.pod.cluster.local</span></span></code></pre></div><p>Any Pods exposed by a Service have the following DNS resolution available:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>my_pod.service-name.my-namespace.svc.cluster-domain.example</span></span></code></pre></div><p>More information can be found here : <a href=https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/ target=_blank>DNS for Service and Pods</a></p><h2 id=2-review-otel-receiver-for-phpapache>2. Review OTel receiver for PHP/Apache</h2><p>Inspect the YAML file <code>~/workshop/k3s/otel-apache.yaml</code> and validate the contents using the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/workshop/k3s/otel-apache.yaml</span></span></code></pre></div><p>This file contains the configuration for the OpenTelemetry agent to monitor the PHP/Apache deployment.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>agent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receiver_creator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>smartagent/apache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=l>type == &#34;port&#34; &amp;&amp; pod.name matches &#34;apache&#34; &amp;&amp; port == 80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>collectd/apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>http://php-apache-svc.apache.svc.cluster.local/server-status?auto</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>extraDimensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>service.name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span></span></span></code></pre></div><h2 id=3--observation-rules-in-the-opentelemetry-config>3. Observation Rules in the OpenTelemetry config</h2><p>The above file contains an observation rule for Apache using the OTel <code>receiver_creator</code>. This receiver can instantiate other receivers at runtime based on whether observed endpoints match a configured rule.</p><p>The configured rules will be evaluated for each endpoint discovered. If the rule evaluates to true, then the receiver for that rule will be started as configured against the matched endpoint.</p><p>In the file above we tell the OpenTelemetry agent to look for Pods that match the name <code>apache</code> and have port <code>80</code> open. Once found, the agent will configure an Apache receiver to read Apache metrics from the configured URL. Note, the K8s DNS based URL in the above YAML for the service.</p><p>To use the Apache configuration, you can upgrade the existing Splunk OpenTelemetry Collector Helm chart to use the <code>otel-apache.yaml</code> file with the following command:</p><div class=tab-panel data-tab-group=76003fd78e4ccd405aca1d57a5b3547f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=helm-upgrade class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("76003fd78e4ccd405aca1d57a5b3547f","helm-upgrade")'>
<span class=tab-nav-text>Helm Upgrade</span></button></div><div class=tab-content-container><div data-tab-item=helm-upgrade class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm upgrade splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.logsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.infrastructureMonitoringEventsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--namespace splunk <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/splunk-defaults.yaml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/otel-apache.yaml</span></span></code></pre></div></div></div></div></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> NOTE</div><div class=box-content><p>The <strong>REVISION</strong> number of the deployment has changed, which is a helpful way to keep track of your changes.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Release &#34;splunk-otel-collector&#34; has been upgraded. Happy Helming!
</span></span><span class=line><span class=cl>NAME: splunk-otel-collector
</span></span><span class=line><span class=cl>LAST DEPLOYED: Tue Jan 31 16:57:22 2023
</span></span><span class=line><span class=cl>NAMESPACE: splunk
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 2
</span></span><span class=line><span class=cl>TEST SUITE: None</span></span></code></pre></div></div></div><h2 id=4-kubernetes-configmaps>4. Kubernetes ConfigMaps</h2><p>A ConfigMap is an object in Kubernetes consisting of key-value pairs which can be injected into your application. With a ConfigMap, you can separate configuration from your Pods.</p><p>Using ConfigMap, you can prevent hardcoding configuration data. ConfigMaps are useful for storing and sharing non-sensitive, unencrypted configuration information.</p><p>The OpenTelemetry collector/agent uses ConfigMaps to store the configuration of the agent and the K8s Cluster receiver. You can/will always verify the current configuration of an agent after a change by running the following commands:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get cm -n splunk</span></span></code></pre></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>How many ConfigMaps are used by the collector?</p></div></div><p>When you have list of ConfigMaps from the namespace, select the one for the <code>otel-agent</code> and view it with the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get cm splunk-otel-collector-otel-agent -n splunk -o yaml</span></span></code></pre></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> NOTE</div><div class=box-content><p>The option <code>-o yaml</code> will output the content of the ConfigMap in a readable YAML format.</p></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Is the configuration from <code>otel-apache.yaml</code> visible in the ConfigMap for the collector agent?</p></div></div><h2 id=5-review-phpapache-deployment-yaml>5. Review PHP/Apache deployment YAML</h2><p>Inspect the YAML file <code>~/workshop/k3s/php-apache.yaml</code> and validate the contents using the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/workshop/k3s/php-apache.yaml</span></span></code></pre></div><p>This file contains the configuration for the PHP/Apache deployment and will create a new StatefulSet with a single replica of the PHP/Apache image.</p><p>A stateless application is one that does not care which network it is using, and it does not need permanent storage. Examples of stateless apps may include web servers such as Apache, Nginx, or Tomcat.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>StatefulSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>updateStrategy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>RollingUpdate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;php-apache-svc&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ghcr.io/splunk/php-apache:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;9Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;6&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;4Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache-svc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span></span></span></code></pre></div><h2 id=6-deploy-phpapache>6. Deploy PHP/Apache</h2><p>Create an apache namespace then deploy the PHP/Apache application to the cluster.</p><p>Create the <code>apache</code> namespace:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create namespace apache</span></span></code></pre></div><p>Deploy the PHP/Apache application:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f ~/workshop/k3s/php-apache.yaml -n apache</span></span></code></pre></div><p>Ensure the deployment has been created:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get statefulset -n apache</span></span></code></pre></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What metrics for your Apache instance are being reported in the Apache Navigator?</p><p><strong>Tip:</strong> Use the Navigator Sidebar and click on the service name.</p></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Using Log Observer what is the issue with the PHP/Apache deployment?</p><p><strong>Tip:</strong> Adjust your <strong>Table settings</strong> by clicking on the cog to use only <code>object.involvedObject.name</code>, <code>object.message</code> and <code>k8s.cluster.name</code>. Make sure you unselect <code>_raw</code>!</p></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=fix-phpapache-issue>Fix PHP/Apache Issue</h1><h2 id=1-kubernetes-resources>1. Kubernetes Resources</h2><p>Especially in Production Kubernetes Clusters, CPU and Memory are considered precious resources. Cluster Operators will normally require you to specify the amount of CPU and Memory your Pod or Service will require in the deployment, so they can have the Cluster automatically manage on which Node(s) your solution will be placed.</p><p>You do this by placing a Resource section in the deployment of you application/Pod</p><p><strong>Example:</strong></p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>limits</span><span class=p>:</span><span class=w>         </span><span class=c># Maximum amount of CPU &amp; memory for peek use</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8&#34;</span><span class=w>      </span><span class=c># Maximum of 8 cores of CPU allowed at for peek use</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;9Mi&#34;</span><span class=w> </span><span class=c># Maximum allowed 9Mb of memory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>requests</span><span class=p>:</span><span class=w>       </span><span class=c># Request are the expected amount of CPU &amp; memory for normal use</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;6&#34;</span><span class=w>      </span><span class=c># Requesting 4 cores of a CPU</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;4Mi&#34;</span><span class=w> </span><span class=c># Requesting 4Mb of memory</span></span></span></code></pre></div><p>More information can be found here : <a href=https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/ target=_blank>Resource Management for Pods and Containers</a></p><p>If your application or Pod will go over the limits set in your deployment, Kubernetes will kill and restart your Pod to protect the other applications on the Cluster.</p><p>Another scenario that you will run into is when there is not enough Memory or CPU on a Node. In that case, the Cluster will try to reschedule your Pod(s) on a different Node with more space.</p><p>If that fails, or if there is not enough space when you deploy your application, the Cluster will put your workload/deployment in schedule mode until there is enough room on any of the available Nodes to deploy the Pods according their limits.</p><h2 id=2-fix-phpapache-deployment>2. Fix PHP/Apache Deployment</h2><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Before we start, let&rsquo;s check the current status of the PHP/Apache deployment. Under <strong>Alerts & Detectors</strong> which detector has fired? Where else can you find this information?</p></div></div><p>To fix the PHP/Apache StatefulSet, edit <code>~/workshop/k3s/php-apache.yaml</code> using the following commands to reduce the CPU resources:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim ~/workshop/k3s/php-apache.yaml</span></span></code></pre></div><p>Find the resources section and reduce the CPU limits to <strong>1</strong> and the CPU requests to <strong>0.5</strong>:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;9Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.5&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;4Mi&#34;</span></span></span></code></pre></div><p>Save the changes youhave made. (Hint: Use <code>Esc</code> followed by <code>:wq!</code> to save your changes).</p><p>Now, we must delete the existing StatefulSet and re-create it. StatefulSets are immutable, so we must delete the existing one and re-create it with the new changes.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl delete statefulset php-apache -n apache</span></span></code></pre></div><p>Now, deploy your changes:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f ~/workshop/k3s/php-apache.yaml -n apache</span></span></code></pre></div><h2 id=3-validate-the-changes>3. Validate the changes</h2><p>You can validate the changes have been applied by running the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe statefulset php-apache -n apache</span></span></code></pre></div><p>Validate the Pod is now running in Splunk Observability Cloud.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Is the <strong>Apache Web Servers</strong> dashboard showing any data now?</p><p><strong>Tip:</strong> Don&rsquo;t forget to use filters and time frames to narrow down your data.</p></div></div><p>Monitor the Apache web servers Navigator dashboard for a few minutes.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What is happening with the # Hosts reporting chart?</p></div></div><h2 id=4-fix-memory-issue>4. Fix memory issue</h2><p>If you navigate back to the Apache dashboard, you will notice that metrics are no longer coming in. We have another resource issue and this time we are Out of Memory. Let&rsquo;s edit the stateful set and increase the memory to what is shown in the image below:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl edit statefulset php-apache -n apache</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>16Mi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=l>500m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>12Mi</span></span></span></code></pre></div><p>Save the changes you have made.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-exclamation"></i> Hint</div><div class=box-content><p><code>kubectl edit</code> will open the contents in the <code>vi</code> editor, use <code>Esc</code> followed by <code>:wq!</code> to save your changes.</p></div></div><p>Because StatefulSets are immutable, we must delete the existing Pod and let the StatefulSet re-create it with the new changes.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl delete pod php-apache-0 -n apache</span></span></code></pre></div><p>Validate the changes have been applied by running the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe statefulset php-apache -n apache</span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=deploy-load-generator>Deploy Load Generator</h1><p>Now let&rsquo;s apply some load against the <code>php-apache</code> pod. To do this, you will need start a different Pod to act as a client. The container within the client Pod runs in an infinite loop, sending HTTP GETs to the <code>php-apache</code> service.</p><h2 id=1-review-loadgen-yaml>1. Review loadgen YAML</h2><p>Inspect the YAML file <code>~/workshop/k3s/loadgen.yaml</code> and validate the contents using the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/workshop/k3s/loadgen.yaml</span></span></code></pre></div><p>This file contains the configuration for the load generator and will create a new ReplicaSet with a two replicas of the load generator image.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ReplicaSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>loadgen</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>loadgen</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>loadgen</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>loadgen</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>loadgen</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>infinite-calls</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>/bin/sh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- -<span class=l>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=s2>&#34;while true; do wget -q -O- http://php-apache-svc.apache.svc.cluster.local; done&#34;</span></span></span></code></pre></div><h2 id=2-create-a-new-namespace>2. Create a new namespace</h2><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl create namespace loadgen</span></span></code></pre></div><h2 id=3-deploy-the-loadgen-yaml>3. Deploy the loadgen YAML</h2><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl apply -f ~/workshop/k3s/loadgen.yaml --namespace loadgen</span></span></code></pre></div><p>Once you have deployed the load generator, you can see the Pods running in the <code>loadgen</code> namespace. Use previous similar commands to check the status of the Pods from the command line.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Which metrics in the Apache Navigator have now significantly increased?</p></div></div><h2 id=4-scale-the-load-generator>4. Scale the load generator</h2><p>A ReplicaSet is a process that runs multiple instances of a Pod and keeps the specified number of Pods constant. Its purpose is to maintain the specified number of Pod instances running in a cluster at any given time to prevent users from losing access to their application when a Pod fails or is inaccessible.</p><p>ReplicaSet helps bring up a new instance of a Pod when the existing one fails, scale it up when the running instances are not up to the specified number, and scale down or delete Pods if another instance with the same label is created. A ReplicaSet ensures that a specified number of Pod replicas are running continuously and helps with load-balancing in case of an increase in resource usage.</p><p>Let&rsquo;s scale our ReplicaSet to 4 replicas using the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl scale replicaset/loadgen --replicas 4 -n loadgen</span></span></code></pre></div><p>Validate the replicas are running from both the command line and Splunk Observability Cloud:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl get replicaset loadgen -n loadgen</span></span></code></pre></div><p><a href=#R-image-407742e12c0e3630a3f7f0f6da394a25 class=lightbox-link><img src=../../en/other/hpa/5-deploy-loadgen/../images/k8s-workload-replicaset.png alt=Replicaset class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-407742e12c0e3630a3f7f0f6da394a25><img src=../../en/other/hpa/5-deploy-loadgen/../images/k8s-workload-replicaset.png alt=Replicaset class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What impact can you see in the Apache Navigator?</p></div></div><p>Let the load generator run for around 2-3 minutes and keep observing the metrics in the Kubernetes Navigator and the Apache Navigator.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=setup-horizontal-pod-autoscaling-hpa>Setup Horizontal Pod Autoscaling (HPA)</h1><p>In Kubernetes, a HorizontalPodAutoscaler automatically updates a workload resource (such as a Deployment or StatefulSet), with the aim of automatically scaling the workload to match demand.</p><p>Horizontal scaling means that the response to increased load is to deploy more Pods. This is different from vertical scaling, which for Kubernetes would mean assigning more resources (for example: memory or CPU) to the Pods that are already running for the workload.</p><p>If the load decreases, and the number of Pods is above the configured minimum, the HorizontalPodAutoscaler instructs the workload resource (the Deployment, StatefulSet, or other similar resource) to scale back down.</p><h2 id=1-setup-hpa>1. Setup HPA</h2><p>Inspect the <code>~/workshop/k3s/hpa.yaml</code> file and validate the contents using the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/workshop/k3s/hpa.yaml</span></span></code></pre></div><p>This file contains the configuration for the Horizontal Pod Autoscaler and will create a new HPA for the <code>php-apache</code> deployment.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>autoscaling/v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>HorizontalPodAutoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>maxReplicas</span><span class=p>:</span><span class=w> </span><span class=m>4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cpu</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>averageUtilization</span><span class=p>:</span><span class=w> </span><span class=m>50</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Utilization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>memory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>averageUtilization</span><span class=p>:</span><span class=w> </span><span class=m>75</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Utilization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>minReplicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scaleTargetRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>StatefulSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span></span></span></code></pre></div><p>Once deployed, <code>php-apache</code> will autoscale when either the average CPU usage goes above 50% and average memory usage for the deployment goes above 75%, with a minimum of 1 pod and a maximum of 4 pods.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl apply -f ~/workshop/k3s/hpa.yaml</span></span></code></pre></div><h2 id=2-validate-hpa>2. Validate HPA</h2><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl get hpa -n apache</span></span></code></pre></div><p>Go to the <strong>Workloads</strong> or <strong>Node Detail</strong> tab in Kubernetes and check the HPA deployment.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>How many additional <code>php-apache-x</code> pods have been created?</p></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Which metrics in the Apache Navigator have significantly increased again?</p></div></div><h2 id=3-increase-the-hpa-replica-count>3. Increase the HPA replica count</h2><p>Increase the <code>maxReplicas</code> to 8</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl edit hpa php-apache -n apache</span></span></code></pre></div><p>Save the changes you have made. (Hint: Use <code>Esc</code> followed by <code>:wq!</code> to save your changes).</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Questions</div><div class=box-content><ol><li><p>How many pods are now in a running state?</p></li><li><p>How many are pending?</p></li><li><p>Why are they pending?</p></li></ol></div></div><p><strong>Congratulations!</strong> You have successfully completed the workshop.</p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=build-a-distributed-trace-in-lambda-and-kinesis>Build a Distributed Trace in Lambda and Kinesis</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
45 minutes</button></span><p>This workshop will equip you with how a distributed trace is constructed for a small serverless application that runs on AWS Lambda, producing and consuming a message via AWS Kinesis.</p><p>We will see how auto-instrumentation works with manual steps to force a Producer function&rsquo;s context to be sent to Consumer function via a Record put on a Kinesis stream.</p><p>For this workshop Splunk has prepared an Ubuntu Linux instance in AWS/EC2 all pre-configured for you.</p><p>To get access to the instance that you will be using in the workshop, please visit the URL provided by the workshop leader.d</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Build a Distributed Trace in Lambda and Kinesis</h1><article class=default><header class=headline></header><h1 id=setup>Setup</h1><p>This lab will make a tracing superhero out of you!</p><p>In this lab you will learn how a distributed trace is constructed for a small serverless application that runs on AWS Lambda, producing and consuming your message via AWS Kinesis.</p><p><a href=#R-image-2764c2cec2ae720894cda226b4a7df7a class=lightbox-link><img src=../../en/other/lambda-kinesis/1-setup/../images/1-architecture.png alt=1-architecture class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2764c2cec2ae720894cda226b4a7df7a><img src=../../en/other/lambda-kinesis/1-setup/../images/1-architecture.png alt=1-architecture class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=pre-requisites>Pre-requisites</h2><p>You should already have the lab content available on your EC2 lab host.</p><p>Ensure that this lab&rsquo;s required folder o11y-lambda-lab is on your home directory:</p><div class=tab-panel data-tab-group=fbe6a2e41a2914c7f619f289a4142eba><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("fbe6a2e41a2914c7f619f289a4142eba","command")'>
<span class=tab-nav-text>Command</span></button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("fbe6a2e41a2914c7f619f289a4142eba","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~ <span class=o>&amp;&amp;</span> ls</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>o11y-lambda-lab</span></span></code></pre></div></div></div></div></div><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>If you don&rsquo;t see it, fetch the lab contents by running the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/kdroukman/o11y-lambda-lab.git</span></span></code></pre></div></div></div><h2 id=set-environment-variables>Set Environment Variables</h2><p>In your Splunk Observability Cloud Organisation (Org) obtain your Access Token and Realm Values.</p><p>Please reset your environment variables from the earlier lab. Take care that for this lab we may be using different names - make sure to match the Environment Variable names bellow.</p><div class=tab-panel data-tab-group=b7f7408068249d161ffa6cfc54585f0f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=export-environment-variables class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("b7f7408068249d161ffa6cfc54585f0f","export-environment-variables")'>
<span class=tab-nav-text>Export Environment Variables</span></button></div><div class=tab-content-container><div data-tab-item=export-environment-variables class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>export ACCESS_TOKEN</span><span class=o>=</span><span class=s>CHANGE_ME \</span>
</span></span><span class=line><span class=cl><span class=na>export REALM</span><span class=o>=</span><span class=s>CHANGE_ME \</span>
</span></span><span class=line><span class=cl><span class=na>export PREFIX</span><span class=o>=</span><span class=s>$(hostname)</span></span></span></code></pre></div></div></div></div></div><h2 id=update-auto-instrumentation-serverless-template>Update Auto-instrumentation serverless template</h2><p>Update your auto-instrumentation Serverless template to include new values from the Enviornment variables.</p><div class=tab-panel data-tab-group=abc7eb6b2dc73550c8dd8f50d29fd4a8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=substitute-environment-variables class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("abc7eb6b2dc73550c8dd8f50d29fd4a8","substitute-environment-variables")'>
<span class=tab-nav-text>Substitute Environment Variables</span></button></div><div class=tab-content-container><div data-tab-item=substitute-environment-variables class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/o11y-lambda-lab/auto/serverless_unset.yml <span class=p>|</span> envsubst &gt; ~/o11y-lambda-lab/auto/serverless.yml</span></span></code></pre></div></div></div></div></div><p>Examine the output of the updated serverless.yml contents (you may need to scroll up to the relevant section).</p><div class=tab-panel data-tab-group=5fa84a9326a17b01bf644e8350f7c5d5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=check-file-contents class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("5fa84a9326a17b01bf644e8350f7c5d5","check-file-contents")'>
<span class=tab-nav-text>Check file contents</span></button>
<button data-tab-item=expected-content class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("5fa84a9326a17b01bf644e8350f7c5d5","expected-content")'>
<span class=tab-nav-text>Expected Content</span></button></div><div class=tab-content-container><div data-tab-item=check-file-contents class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/o11y-lambda-lab/auto/serverless.yml</span></span></code></pre></div></div></div><div data-tab-item=expected-content class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># USER SET VALUES =====================              </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>custom</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>accessToken</span><span class=p>:</span><span class=w> </span><span class=l>&lt;updated to your Access Token&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>realm</span><span class=p>:</span><span class=w> </span><span class=l>&lt;updated to your Realm&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=l>&lt;updated to your Hostname&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#====================================== </span></span></span></code></pre></div></div></div></div></div><h2 id=update-manual-instrumentation-template>Update Manual instrumentation template</h2><p>Update your manual instrumentation Serverless template to include new values from the Enviornment variables.</p><div class=tab-panel data-tab-group=6c8460e54d3c3cce572e9bd4b8b9c3ed><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=substitute-environment-variables class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("6c8460e54d3c3cce572e9bd4b8b9c3ed","substitute-environment-variables")'>
<span class=tab-nav-text>Substitute Environment Variables</span></button></div><div class=tab-content-container><div data-tab-item=substitute-environment-variables class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/o11y-lambda-lab/manual/serverless_unset.yml <span class=p>|</span> envsubst &gt; ~/o11y-lambda-lab/manual/serverless.yml</span></span></code></pre></div></div></div></div></div><p>Examine the output of the updated serverless.yml contents (you may need to scroll up to the relevant section).</p><div class=tab-panel data-tab-group=4ee88ce74b3f32499f63eeeb2d2339b7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=check-file-contents class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("4ee88ce74b3f32499f63eeeb2d2339b7","check-file-contents")'>
<span class=tab-nav-text>Check file contents</span></button>
<button data-tab-item=expected-content class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("4ee88ce74b3f32499f63eeeb2d2339b7","expected-content")'>
<span class=tab-nav-text>Expected Content</span></button></div><div class=tab-content-container><div data-tab-item=check-file-contents class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/o11y-lambda-lab/manual/serverless.yml</span></span></code></pre></div></div></div><div data-tab-item=expected-content class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># USER SET VALUES =====================              </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>custom</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>accessToken</span><span class=p>:</span><span class=w> </span><span class=l>&lt;updated to your Access Token&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>realm</span><span class=p>:</span><span class=w> </span><span class=l>&lt;updated to your Realm&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=l>&lt;updated to your Hostname&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#====================================== </span></span></span></code></pre></div></div></div></div></div><h2 id=set-your-aws-credentials>Set your AWS Credentials</h2><p>You will be provided with AWS Access Key ID and AWS Secret Access Key values - substitue these values in place of AWS_ACCESS_KEY_ID and AWS_ACCESS_KEY_SECRET in the bellow command:</p><div class=tab-panel data-tab-group=6a7e1206bd5a93be7186a37b7c8872d9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=set-aws-credentials class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("6a7e1206bd5a93be7186a37b7c8872d9","set-aws-credentials")'>
<span class=tab-nav-text>Set AWS Credentials</span></button></div><div class=tab-content-container><div data-tab-item=set-aws-credentials class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sls config credentials --provider aws --key AWS_ACCCESS_KEY_ID --secret AWS_ACCESS_KEY_SECRET</span></span></code></pre></div></div></div></div></div><p>This command will create a file <code>~/.aws/credentials</code> with your AWS Credentials populated.</p><p>Note that we are using sls here, which is a Serverless framework for developing and deploying AWS Lambda functions. We will be using this command throughout the lab.</p><p>Now you are set up and ready go!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=auto-instrumentation>Auto-Instrumentation</h1><h2 id=auto-instrumentation>Auto-Instrumentation</h2><p>Navigate to the auto directory that contains auto-instrumentation code.</p><div class=tab-panel data-tab-group=805b93a03a1ded022ef02da2bbe2d8b7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("805b93a03a1ded022ef02da2bbe2d8b7","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>cd ~/o11y-lambda-lab/auto</code></pre></div></div></div></div></div><p>Inspect the contents of the files in this directory. Take a look at the serverless.yml template.</p><div class=tab-panel data-tab-group=a527275c8bbf206f2954e6561a4a974f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("a527275c8bbf206f2954e6561a4a974f","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>cat serverless.yml</code></pre></div></div></div></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><ul><li>Can you identify which AWS entities are being created by this template?</li><li>Can you identify where OpenTelemetry instrumentation is being set up?</li><li>Can you determine which instrumentation information is being provided by the Environment Variables?</li></ul></div></div><p>You should see the Splunk OpenTelemetry Lambda layer being added to each fuction.</p><div class="wrap-code highlight"><pre tabindex=0><code>layers:
      - arn:aws:lambda:us-east-1:254067382080:layer:splunk-apm:70</code></pre></div><p>You can see the relevant layer ARNs (Amazon Resource Name) and latest versions for each AWS region here: <a href=https://github.com/signalfx/lambda-layer-versions/blob/main/splunk-apm/splunk-apm.md target=_blank>https://github.com/signalfx/lambda-layer-versions/blob/main/splunk-apm/splunk-apm.md</a></p><p>You should also see a section where the Environment variables that are being set.</p><div class="wrap-code highlight"><pre tabindex=0><code>environment:
  AWS_LAMBDA_EXEC_WRAPPER: /opt/nodejs-otel-handler
  OTEL_RESOURCE_ATTRIBUTES: deployment.environment=${self:custom.prefix}-apm-lambda
  OTEL_SERVICE_NAME: consumer-lambda
  SPLUNK_ACCESS_TOKEN: ${self:custom.accessToken}
  SPLUNK_REALM: ${self:custom.realm}</code></pre></div><p>Using the environment variables we are configuring and enriching our auto-instrumentation.</p><p>Here we provide minimum information, such as NodeJS wrapper location in the Splunk APM Layer, environment name, service name, and our Splunk Org credentials. We are sending trace data directly to Splunk Observability Cloud. You could alternatively export traces to an OpenTelemetry Collector set up in Gateway mode.</p><p>Take a look at the function code.</p><div class=tab-panel data-tab-group=e15a533da28a6f56d84e80b010a5fe3a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("e15a533da28a6f56d84e80b010a5fe3a","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>cat handler.js</code></pre></div></div></div></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><ul><li>Can you identify the code for producer function?</li><li>Can you identify the code for consumer function?</li></ul></div></div><p>Notice there is no mention of Splunk or OpenTelemetry in the code. We are adding the instrumentation using the Lambda layer and Environment Variables only.</p><h2 id=deploy-your-lambdas>Deploy your Lambdas</h2><p>Run the following command to deploy your Lambda Functions:</p><div class=tab-panel data-tab-group=68e82d1473854bfcc5820e6b65484b82><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=deploy-command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("68e82d1473854bfcc5820e6b65484b82","deploy-command")'>
<span class=tab-nav-text>Deploy Command</span></button>
<button data-tab-item=expected-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("68e82d1473854bfcc5820e6b65484b82","expected-output")'>
<span class=tab-nav-text>Expected Output</span></button></div><div class=tab-content-container><div data-tab-item=deploy-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>sls deploy</code></pre></div></div></div><div data-tab-item=expected-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>Deploying hostname-lambda-lab to stage dev (us-east-1)
...
...
endpoint: POST - https://randomstring.execute-api.us-east-1.amazonaws.com/dev/producer
functions:
  producer: hostname-lambda-lab-dev-producer (1.6 kB)
  consumer: hostname-lambda-lab-dev-consumer (1.6 kB)</code></pre></div></div></div></div></div><p>This command will follow the instructions in your serverless.yml template to create your Lambda functions and your Kinesis stream. Note it may take a 1-2 minutes to execute.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>serverless.yml is in fact a CloudFormation template. CloudFormation is an infrastructure as code service from AWS. You can read more about it here - <a href=https://aws.amazon.com/cloudformation/ target=_blank>https://aws.amazon.com/cloudformation/</a></div></div><p>Check the details of your serverless functions:</p><div class=tab-panel data-tab-group=c58df186136d79bbb83edf8d6dd1e6ae><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("c58df186136d79bbb83edf8d6dd1e6ae","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>sls info</code></pre></div></div></div></div></div><p>Take note of your endpoint value:
<a href=#R-image-2280014f511f995eaf81ba4cd5fd348a class=lightbox-link><img src=../../en/other/lambda-kinesis/2-auto-instrumentation/../images/2-auto-1-endpoint-value.png alt=2-auto-1-endpoint-value class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2280014f511f995eaf81ba4cd5fd348a><img src=../../en/other/lambda-kinesis/2-auto-instrumentation/../images/2-auto-1-endpoint-value.png alt=2-auto-1-endpoint-value class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=send-some-traffic>Send some Traffic</h2><p>Use the curl command to send a payload to your producer function. Note the command option -d is followed by your message payload.</p><p>Try changing the value of name to your name and telling the Lambda function about your superpower. Replace YOUR_ENDPOINT with the endpoint from your previous step.</p><div class=tab-panel data-tab-group=dcdb2a48240354c7347a8adea4c7a52a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("dcdb2a48240354c7347a8adea4c7a52a","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>curl -d &#39;{ &#34;name&#34;: &#34;CHANGE_ME&#34;, &#34;superpower&#34;: &#34;CHANGE_ME&#34; }&#39; YOUR_ENDPOINT</code></pre></div></div></div></div></div><p>For example:</p><div class="wrap-code highlight"><pre tabindex=0><code>curl -d &#39;{ &#34;name&#34;: &#34;Kate&#34;, &#34;superpower&#34;: &#34;Distributed Tracing&#34; }&#39; https://xvq043lj45.execute-api.us-east-1.amazonaws.com/dev/producer</code></pre></div><p>You should see the following output if your message is successful:</p><div class="wrap-code highlight"><pre tabindex=0><code>{&#34;message&#34;:&#34;Message placed in the Event Stream: hostname-eventSteam&#34;}</code></pre></div><p>If unsuccessful, you will see:</p><div class="wrap-code highlight"><pre tabindex=0><code>{&#34;message&#34;: &#34;Internal server error&#34;}</code></pre></div><p>If this occurs, ask one of the lab facilitators for assistance.</p><p>If you see a success message, generate more load: re-send that messate 5+ times. You should keep seeing a success message after each send.</p><p>Check the lambda logs output:</p><p>Producer function logs:</p><div class=tab-panel data-tab-group=089043b95681ca245ae8de43edafbf70><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=producer-function-logs class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("089043b95681ca245ae8de43edafbf70","producer-function-logs")'>
<span class=tab-nav-text>Producer Function Logs</span></button></div><div class=tab-content-container><div data-tab-item=producer-function-logs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>sls logs -f producer</code></pre></div></div></div></div></div><p>Consumer function logs:</p><div class=tab-panel data-tab-group=63982dd7e36a2a57c3bbfc9b64bba8a0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=consumer-function-logs class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("63982dd7e36a2a57c3bbfc9b64bba8a0","consumer-function-logs")'>
<span class=tab-nav-text>Consumer Function Logs</span></button></div><div class=tab-content-container><div data-tab-item=consumer-function-logs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>sls logs -f consumer</code></pre></div></div></div></div></div><p>Examine the logs carefully.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Do you see OpenTelemetry being loaded? Look out for lines with splunk-extension-wrapper.</p></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=lambdas-in-splunk-apm>Lambdas in Splunk APM</h1><h2 id=lambdas-in-splunk-apm>Lambdas in Splunk APM</h2><p>Now it&rsquo;s time to check how your Lambda traffic has been captured in Splunk APM.</p><h2 id=navigate-to-your-splunk-observability-cloud>Navigate to your Splunk Observability Cloud</h2><p>Select APM from the Main Menu and then select your APM Environment. Your APM environment should be in the format <code>$(hostname)-apm-lambda</code> where the hostname value is a four letter name of your lab host. (Check it by looking at your command prompt, or by running <code>echo $(hostname)</code>).</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>It may take a few minutes for you traces to appear in Splunk APM. Try hitting refresh on your browser until you find your environement name in the list of Envrionments</div></div><p><a href=#R-image-82cc77c95fa2b1b6494946bdc1d2d995 class=lightbox-link><img src=../../en/other/lambda-kinesis/3-lambdas-in-splunk/../images/3-splunk-1-filter.png alt=3-splunk-1-filter class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-82cc77c95fa2b1b6494946bdc1d2d995><img src=../../en/other/lambda-kinesis/3-lambdas-in-splunk/../images/3-splunk-1-filter.png alt=3-splunk-1-filter class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Go to <code>Explore</code> the Service Map to see the Dependencies between your Lambda Functions.</p><p><a href=#R-image-500fff31600eb6e76f9f95bc74a22d7f class=lightbox-link><img src=../../en/other/lambda-kinesis/3-lambdas-in-splunk/../images/3-splunk-2-explore.png alt=3-splunk-2-explore class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-500fff31600eb6e76f9f95bc74a22d7f><img src=../../en/other/lambda-kinesis/3-lambdas-in-splunk/../images/3-splunk-2-explore.png alt=3-splunk-2-explore class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You should be able to see the <code>producer-lambda</code> and the call it is making to <code>Kinesis</code> service.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What about your <code>consumer-lambda</code>?</p></div></div><p><a href=#R-image-45ec797f5a9554f62f8a9c48d1690e33 class=lightbox-link><img src=../../en/other/lambda-kinesis/3-lambdas-in-splunk/../images/3-splunk-3-map-producer.png alt=3-splunk-3-map-producer class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-45ec797f5a9554f62f8a9c48d1690e33><img src=../../en/other/lambda-kinesis/3-lambdas-in-splunk/../images/3-splunk-3-map-producer.png alt=3-splunk-3-map-producer class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Click into <code>Traces</code> and examine some traces that container procuder function calls and traces with consumer function calls.</p><p><a href=#R-image-1d586f0547d40287d7fc450871cd81fd class=lightbox-link><img src=../../en/other/lambda-kinesis/3-lambdas-in-splunk/../images/3-splunk-4-trace-producer.png alt=3-splunk-4-trace-producer.png class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1d586f0547d40287d7fc450871cd81fd><img src=../../en/other/lambda-kinesis/3-lambdas-in-splunk/../images/3-splunk-4-trace-producer.png alt=3-splunk-4-trace-producer.png class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>We can see the <code>producer-lambda</code> putting a Record on the Kinesis stream. But the action of <code>consumer-function</code> is disconnected!</p><p>This is because the Trace Context is not being propagated.</p><p>This is not something that is supported automatically Out-of-the-Box by Kinesis service at the time of this lab. Our Distributed Trace stops at Kinesis inferred service, and we can&rsquo;t see the propagation any further.</p><p>Not yet&mldr;</p><p>Let&rsquo;s see how we work around this in the next section of this lab.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=manual-instrumentation>Manual Instrumentation</h1><h2 id=manual-instrumentation>Manual Instrumentation</h2><p>Navigate to the manual directory that contains manually instrumentated code.</p><div class=tab-panel data-tab-group=5bd8e61c2be64fabcd39041051e62bda><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("5bd8e61c2be64fabcd39041051e62bda","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/o11y-lambda-lab/manual</span></span></code></pre></div></div></div></div></div><p>Inspect the contents of the files in this directory. Take a look at the serverless.yml template.</p><div class=tab-panel data-tab-group=0ee99905bce10b1ed6d7d53d917da230><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("0ee99905bce10b1ed6d7d53d917da230","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat serverless.yml</span></span></code></pre></div></div></div></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Do you see any difference from the same file in your auto directory?</p></div></div><p>You can try to compare them with a diff command:</p><div class=tab-panel data-tab-group=52ae9a7043b271bf6c2a0086e725a748><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=diff-command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("52ae9a7043b271bf6c2a0086e725a748","diff-command")'>
<span class=tab-nav-text>Diff Command</span></button>
<button data-tab-item=expected-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("52ae9a7043b271bf6c2a0086e725a748","expected-output")'>
<span class=tab-nav-text>Expected Output</span></button></div><div class=tab-content-container><div data-tab-item=diff-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>diff ~/o11y-lambda-lab/auto/serverless.yml ~/o11y-lambda-lab/manual/serverless.yml </span></span></code></pre></div></div></div><div data-tab-item=expected-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>19c19
</span></span><span class=line><span class=cl>&lt; #======================================    
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>&gt; #======================================   </span></span></code></pre></div></div></div></div></div><p>There is no difference! (Well, there shouldn&rsquo;t be. Ask your lab facilitator to assist you if there is)</p><p>Now compare handler.js it with the same file in auto directory using the diff command:</p><div class=tab-panel data-tab-group=1ec849f28d5ec24dbc00c790c91918ba><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=diff-command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("1ec849f28d5ec24dbc00c790c91918ba","diff-command")'>
<span class=tab-nav-text>Diff Command</span></button></div><div class=tab-content-container><div data-tab-item=diff-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>diff ~/o11y-lambda-lab/auto/handler.js ~/o11y-lambda-lab/manual/handler.js </span></span></code></pre></div></div></div></div></div><p>Look at all these differences!</p><p>You may wish to view the entire file with <code>cat handler.js</code> command and examine its content.</p><p>Notice how we are now importing some OpenTelemetry libraries directly into our function to handle some of the manual instrumenation tasks we require.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>otelapi</span>  <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;@opentelemetry/api&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>otelcore</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;@opentelemetry/core&#39;</span><span class=p>);</span></span></span></code></pre></div><p>We are using <a href=https://www.npmjs.com/package/@opentelemetry/api target=_blank>https://www.npmjs.com/package/@opentelemetry/api</a> to manipulate the tracing logic in our functions. We are using <a href=https://www.npmjs.com/package/@opentelemetry/core target=_blank>https://www.npmjs.com/package/@opentelemetry/core</a> to access the Propagator objects that we will use to manually propagate our context with.</p><h2 id=inject-trace-context-in-producer-function>Inject Trace Context in Producer Function</h2><p>The below code executes the following steps inside the Producer function:</p><ol><li>Get the current Active Span.</li><li>Create a Propagator.</li><li>Initialize a context carrier object.</li><li>Inject the context of the active span into the carrier object.</li><li>Modify the record we are about to put on our Kinesis stream to include the carrier that will carry the active span&rsquo;s context to the consumer.</li></ol><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>activeSpan</span> <span class=o>=</span> <span class=nx>otelapi</span><span class=p>.</span><span class=nx>trace</span><span class=p>.</span><span class=nx>getSpan</span><span class=p>(</span><span class=nx>otelapi</span><span class=p>.</span><span class=nx>context</span><span class=p>.</span><span class=nx>active</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>propagator</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>otelcore</span><span class=p>.</span><span class=nx>W3CTraceContextPropagator</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>carrier</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=nx>propagator</span><span class=p>.</span><span class=nx>inject</span><span class=p>(</span><span class=nx>otelapi</span><span class=p>.</span><span class=nx>trace</span><span class=p>.</span><span class=nx>setSpanContext</span><span class=p>(</span><span class=nx>otelapi</span><span class=p>.</span><span class=nx>ROOT_CONTEXT</span><span class=p>,</span> <span class=nx>activeSpan</span><span class=p>.</span><span class=nx>spanContext</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>    <span class=nx>carrier</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>otelapi</span><span class=p>.</span><span class=nx>defaultTextMapSetter</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=s2>&#34;{\&#34;tracecontext\&#34;: &#34;</span> <span class=o>+</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>carrier</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;, \&#34;record\&#34;:&#34;</span> <span class=o>+</span> <span class=nx>event</span><span class=p>.</span><span class=nx>body</span> <span class=o>+</span> <span class=s2>&#34;}&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Record with Trace Context added: 
</span></span></span><span class=line><span class=cl><span class=sb>  </span><span class=si>${</span><span class=nx>data</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span></span></span></code></pre></div><h2 id=extract-trace-context-in-consumer-function>Extract Trace Context in Consumer Function</h2><p>The bellow code executes the following steps inside the Consumer function:</p><ol><li>Extract the context that we obtained from the Producer into a carrier object.</li><li>Create a Propagator.</li><li>Extract the context from the carrier object in Customer function&rsquo;s parent span context.</li><li>Start a new span with the parent span context.</li><li>Bonus: Add extra attributes to your span, including custom ones with the values from your message!</li><li>Once completed, end the span.</li></ol><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>carrier</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span> <span class=nx>message</span> <span class=p>).</span><span class=nx>tracecontext</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>propagator</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>otelcore</span><span class=p>.</span><span class=nx>W3CTraceContextPropagator</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>parentContext</span> <span class=o>=</span> <span class=nx>propagator</span><span class=p>.</span><span class=nx>extract</span><span class=p>(</span><span class=nx>otelapi</span><span class=p>.</span><span class=nx>ROOT_CONTEXT</span><span class=p>,</span> <span class=nx>carrier</span><span class=p>,</span> <span class=nx>otelapi</span><span class=p>.</span><span class=nx>defaultTextMapGetter</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>tracer</span> <span class=o>=</span> <span class=nx>otelapi</span><span class=p>.</span><span class=nx>trace</span><span class=p>.</span><span class=nx>getTracer</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>OTEL_SERVICE_NAME</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>span</span> <span class=o>=</span> <span class=nx>tracer</span><span class=p>.</span><span class=nx>startSpan</span><span class=p>(</span><span class=s2>&#34;Kinesis.getRecord&#34;</span><span class=p>,</span> <span class=kc>undefined</span><span class=p>,</span> <span class=nx>parentContext</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                         
</span></span><span class=line><span class=cl><span class=nx>span</span><span class=p>.</span><span class=nx>setAttribute</span><span class=p>(</span><span class=s2>&#34;span.kind&#34;</span><span class=p>,</span> <span class=s2>&#34;server&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>body</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span> <span class=nx>message</span> <span class=p>).</span><span class=nx>record</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>body</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>span</span><span class=p>.</span><span class=nx>setAttribute</span><span class=p>(</span><span class=s2>&#34;custom.tag.name&#34;</span><span class=p>,</span> <span class=nx>body</span><span class=p>.</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl> <span class=k>if</span> <span class=p>(</span><span class=nx>body</span><span class=p>.</span><span class=nx>superpower</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>span</span><span class=p>.</span><span class=nx>setAttribute</span><span class=p>(</span><span class=s2>&#34;custom.tag.superpower&#34;</span><span class=p>,</span> <span class=nx>body</span><span class=p>.</span><span class=nx>superpower</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=o>---</span> <span class=kd>function</span> <span class=nx>does</span> <span class=nx>some</span> <span class=nx>work</span>
</span></span><span class=line><span class=cl> <span class=nx>span</span><span class=p>.</span><span class=nx>end</span><span class=p>();</span></span></span></code></pre></div><p>Now let&rsquo;s see the difference this makes.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=redeploy-lambdas>Redeploy Lambdas</h1><h2 id=re-deploy-your-lambdas>Re-deploy your Lambdas</h2><p>While remaining in your manual directory, run the following commandd to re-deploy your Lambda Functions:</p><div class=tab-panel data-tab-group=44609583955b0902554bdbb9a778bf2a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=deploy-producer-code class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("44609583955b0902554bdbb9a778bf2a","deploy-producer-code")'>
<span class=tab-nav-text>Deploy Producer Code</span></button>
<button data-tab-item=expected-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("44609583955b0902554bdbb9a778bf2a","expected-output")'>
<span class=tab-nav-text>Expected Output</span></button></div><div class=tab-content-container><div data-tab-item=deploy-producer-code class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sls deploy -f producer</span></span></code></pre></div></div></div><div data-tab-item=expected-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Deploying function producer to stage dev (us-east-1)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>✔ Function code deployed (6s)
</span></span><span class=line><span class=cl>Configuration did not change. Configuration update skipped. (6s)</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=189924b984a3e1ad852ffab67cf4270e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=deploy-consumer-code class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("189924b984a3e1ad852ffab67cf4270e","deploy-consumer-code")'>
<span class=tab-nav-text>Deploy Consumer Code</span></button>
<button data-tab-item=expected-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("189924b984a3e1ad852ffab67cf4270e","expected-output")'>
<span class=tab-nav-text>Expected Output</span></button></div><div class=tab-content-container><div data-tab-item=deploy-consumer-code class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sls deploy -f consumer</span></span></code></pre></div></div></div><div data-tab-item=expected-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Deploying function consumer to stage dev (us-east-1)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>✔ Function code deployed (6s)
</span></span><span class=line><span class=cl>Configuration did not change. Configuration update skipped. (6s)</span></span></code></pre></div></div></div></div></div><p>Note that this deployment now only updates the code changes within the function. Our configuration remains the same.</p><p>Check the details of your serverless functions:</p><div class=tab-panel data-tab-group=45cd9ba1e670af457881dd533a1b864c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("45cd9ba1e670af457881dd533a1b864c","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sls info</span></span></code></pre></div></div></div></div></div><p>You endpoint value should remain the same:</p><p><a href=#R-image-c929e8ccea14917b3f4bc40d426c0dac class=lightbox-link><img src=../../en/other/lambda-kinesis/5-redeploy-lambdas/../images/5-redeploy-1-endpoint-value.png alt=5-redeploy-1-endpoint-value class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c929e8ccea14917b3f4bc40d426c0dac><img src=../../en/other/lambda-kinesis/5-redeploy-lambdas/../images/5-redeploy-1-endpoint-value.png alt=5-redeploy-1-endpoint-value class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=send-some-traffic-again>Send some Traffic again</h2><p>Use the <code>curl</code> command to send a payload to your producer function. Note the command option <code>-d</code> is followed by your message payload.</p><p>Try changing the value of name to your name and telling the Lambda function about your superpower. Replace <code>YOUR_ENDPOINT</code> with the endpoint from your previous step.</p><div class=tab-panel data-tab-group=bf7e251a1ac8ebbee2f2d94c9f2ee8ed><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("bf7e251a1ac8ebbee2f2d94c9f2ee8ed","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -d <span class=s1>&#39;{ &#34;name&#34;: &#34;CHANGE_ME&#34;, &#34;superpower&#34;: &#34;CHANGE_ME&#34; }&#39;</span> YOUR_ENDPOINT</span></span></code></pre></div></div></div></div></div><p>For example:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -d <span class=s1>&#39;{ &#34;name&#34;: &#34;Kate&#34;, &#34;superpower&#34;: &#34;Distributed Tracing&#34; }&#39;</span> https://xvq043lj45.execute-api.us-east-1.amazonaws.com/dev/producer</span></span></code></pre></div><p>You should see the following output if your message is successful:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;message&#34;</span><span class=p>:</span><span class=s2>&#34;Message placed in the Event Stream: hostname-eventSteam&#34;</span><span class=p>}</span></span></span></code></pre></div><p>If unsuccessful, you will see:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Internal server error&#34;</span><span class=p>}</span></span></span></code></pre></div><p>If this occurs, ask one of the lab facilitators for assistance.</p><p>If you see a success message, generate more load: re-send that messate 5+ times. You should keep seeing a success message after each send.</p><p>Check the lambda logs output:</p><div class=tab-panel data-tab-group=279bf63e75f189d1d4c5afed7477293e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=producer-function-logs class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("279bf63e75f189d1d4c5afed7477293e","producer-function-logs")'>
<span class=tab-nav-text>Producer Function Logs</span></button></div><div class=tab-content-container><div data-tab-item=producer-function-logs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sls logs -f producer</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=fe162ba6bc10d3c357c09121b6a8c8a9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=consumer-function-logs class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("fe162ba6bc10d3c357c09121b6a8c8a9","consumer-function-logs")'>
<span class=tab-nav-text>Consumer Function Logs</span></button></div><div class=tab-content-container><div data-tab-item=consumer-function-logs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sls logs -f consumer</span></span></code></pre></div></div></div></div></div><p>Examine the logs carefully.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Do you notice the difference?</p></div></div><p>Note that we are logging our Record together with the Trace context that we have added to it. Copy one of the underlined sub-sections of your trace parent context, and save it for later.</p><p><a href=#R-image-e0f61c304d11c231802d099bc8cf2f19 class=lightbox-link><img src=../../en/other/lambda-kinesis/5-redeploy-lambdas/../images/5-redeploy-2-logs.png alt=5-redeploy-2-logs class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e0f61c304d11c231802d099bc8cf2f19><img src=../../en/other/lambda-kinesis/5-redeploy-lambdas/../images/5-redeploy-2-logs.png alt=5-redeploy-2-logs class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=updated-lambdas-in-splunk-apm>Updated Lambdas in Splunk APM</h1><p>Navigate back to APM in <a href=https://app.us1.signalfx.com/#/apm target=_blank>Splunk Observabilty Cloud</a></p><p>Go back to your Service Dependency map.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Notice the difference?</p></div></div><p><a href=#R-image-424863c262d0007b458ffc9c3123f438 class=lightbox-link><img src=../../en/other/lambda-kinesis/6-updated-in-splunk/../images/6-updated-1-map.png alt=6-updated-1-map class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-424863c262d0007b458ffc9c3123f438><img src=../../en/other/lambda-kinesis/6-updated-in-splunk/../images/6-updated-1-map.png alt=6-updated-1-map class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You should be able to see the <code>consumer-lambda</code> now clearly connected to the <code>producer-lambda</code>.</p><p>Remember the value you copied from your producer logs? You can run <code>sls logs -f consumer</code> command again on your EC2 lab host to fetch one.</p><p>Take that value, and paste it into trace search:</p><p><a href=#R-image-8fc70ae0c98f38306099e40268827bd5 class=lightbox-link><img src=../../en/other/lambda-kinesis/6-updated-in-splunk/../images/6-updated-2-trace-search.png alt=6-updated-2-trace-search class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8fc70ae0c98f38306099e40268827bd5><img src=../../en/other/lambda-kinesis/6-updated-in-splunk/../images/6-updated-2-trace-search.png alt=6-updated-2-trace-search class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Click on Go and you should be able to find the logged Trace:</p><p><a href=#R-image-d5b6c893edb1e5ed3a10711ae71e1309 class=lightbox-link><img src=../../en/other/lambda-kinesis/6-updated-in-splunk/../images/6-updated-3-trace.png alt=6-updated-3-trace class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d5b6c893edb1e5ed3a10711ae71e1309><img src=../../en/other/lambda-kinesis/6-updated-in-splunk/../images/6-updated-3-trace.png alt=6-updated-3-trace class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Notice that the <code>Trace ID</code> is something that makes up the trace context that we propagated.</p><p>You can read up on the two common propagation standards:</p><ol><li>W3C: <a href=https://www.w3.org/TR/trace-context/#traceparent-header target=_blank>https://www.w3.org/TR/trace-context/#traceparent-header</a></li><li>B3: <a href=https://github.com/openzipkin/b3-propagation#overall-process target=_blank>https://github.com/openzipkin/b3-propagation#overall-process</a></li></ol><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Which one are we using?</p></div></div><p>It should be self-explanatory from the Propagator we are creating in the Functions</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Bonus Question: What happens if we mix and match the W3C and B3 headers?</p></div></div><p>Expand the <code>consumer-lambda</code> span.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Can you find the attributes from your message?</p></div></div><p><a href=#R-image-7f59c155091f223326404f1ce8f9fce1 class=lightbox-link><img src=../../en/other/lambda-kinesis/6-updated-in-splunk/../images/6-updated-4-attributes.png alt=6-updated-4-attributes class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7f59c155091f223326404f1ce8f9fce1><img src=../../en/other/lambda-kinesis/6-updated-in-splunk/../images/6-updated-4-attributes.png alt=6-updated-4-attributes class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=summary>Summary</h1><h2 id=before-you-go>Before you Go</h2><p>Please kindly clean up your lab using the following command:</p><div class=tab-panel data-tab-group=ee1c85ab2593999b7d30c260e897d12f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=remove-functions class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("ee1c85ab2593999b7d30c260e897d12f","remove-functions")'>
<span class=tab-nav-text>Remove Functions</span></button></div><div class=tab-content-container><div data-tab-item=remove-functions class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sls remove</span></span></code></pre></div></div></div></div></div><h2 id=conclusion>Conclusion</h2><p>Congratuations on finishing the lab. You have seen how we complement auto-instrumentation with manual steps to force <code>Producer</code> function&rsquo;s context to be sent to <code>Consumer</code> function via a Record put on a Kinesis stream. This allowed us to build the expected Distributed Trace.</p><p><a href=#R-image-a58efa011dac524abc546bc442d8e782 class=lightbox-link><img src=../../en/other/lambda-kinesis/7-summary/../images/7-conclusion-1-architecture.png alt=7-conclusion-1-architecture class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a58efa011dac524abc546bc442d8e782><img src=../../en/other/lambda-kinesis/7-summary/../images/7-conclusion-1-architecture.png alt=7-conclusion-1-architecture class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You can now build out a Trace manually by linking two different functions together. This is very powerful when your auto-instrumenation, or third-party systems, do not support context propagation out of the box.</p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=improving-mttr-with-custom-tags>Improving MTTR with Custom Tags</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
45 minutes</button></span><p>This workshop will ..</p><p>For this workshop Splunk has prepared an Ubuntu Linux instance in AWS/EC2 all pre-configured for you.</p><p>To get access to the instance that you will be using in the workshop, please visit the URL provided by the workshop leader.</p><h2 id=splunk-observability-cloud>Splunk Observability Cloud</h2><p>You must have the ability to send traces to Splunk Observability Cloud. If you do not have an account already, please start a trial here: <a href=https://www.splunk.com/en_us/download/apm-free-trial.html target=_blank>https://www.splunk.com/en_us/download/apm-free-trial.html</a></p><h2 id=workshop-story>Workshop Story</h2><p>Here at Splunk Instruments, our business is expanding!</p><p>We have recently added 3 new locations: Two locations in the USA (Colorado and Chicago) and one international location in Sri Lanka.</p><p>Our technical staff has already on-boarded the data from these new locations and incorporated them into our inventory application and it is our job to review these improvements and send any issues back to our developers for repairs.</p><p>We now have a total of 6 locations!</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Improving MTTR with Custom Tags</h1><article class=default><header class=headline></header><h1 id=setting-up-your-aws-instance>Setting up your AWS Instance</h1><h2 id=environment-setup---mac>Environment Setup - Mac</h2><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>If you wish to run this on Mac directly, you can see the instructions <a href=../../en/other/dev-mttr-custom-tags/appendix-a-setup-mac/index.html>here in the appendix</a> and skip the next section on Linux.</p><p>All installs must continue at <a href=../../en/other/dev-mttr-custom-tags/2-setup-app/index.html>setting up the app</a>.</p></div></div><h2 id=environment-setup---linux>Environment Setup - Linux</h2><p>You can skip past the EC2 configuration to Linux Software Requirements if you already have an Ec2 that meets the specifications below !!!!</p><ul><li>ubuntu 22.04</li></ul><p><a href=#R-image-59c405180d9ae7e2ad58b646f02e9670 class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/1-setup-os/../images/1-setup-config-1.png alt=1-setup-config-1 class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-59c405180d9ae7e2ad58b646f02e9670><img src=../../en/other/dev-mttr-custom-tags/1-setup-os/../images/1-setup-config-1.png alt=1-setup-config-1 class="lightbox-image noborder lightbox noshadow" loading=lazy></a>
<a href=#R-image-ba7719342855ab32282215f0630cbb60 class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/1-setup-os/../images/1-setup-config-2.png alt=1-setup-config-2 class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ba7719342855ab32282215f0630cbb60><img src=../../en/other/dev-mttr-custom-tags/1-setup-os/../images/1-setup-config-2.png alt=1-setup-config-2 class="lightbox-image noborder lightbox noshadow" loading=lazy></a>
<a href=#R-image-d7ea6342ac11c4279dee279308eccdaa class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/1-setup-os/../images/1-setup-config-3.png alt=1-setup-config-3 class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d7ea6342ac11c4279dee279308eccdaa><img src=../../en/other/dev-mttr-custom-tags/1-setup-os/../images/1-setup-config-3.png alt=1-setup-config-3 class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><ul><li>Security Group Security Settings<ul><li>HTTP inbound open on 8010</li><li>All Traffic open outbound</li></ul></li></ul><p><a href=#R-image-b78573f2f26ef05e143362b62b90403f class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/1-setup-os/../images/1-setup-config-4.png alt=1-setup-config-4 class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b78573f2f26ef05e143362b62b90403f><img src=../../en/other/dev-mttr-custom-tags/1-setup-os/../images/1-setup-config-4.png alt=1-setup-config-4 class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><ul><li>Linux Software Requirements: docker, docker-compose, git, maven</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt update
</span></span><span class=line><span class=cl>sudo apt upgrade
</span></span><span class=line><span class=cl>sudo apt install docker docker-compose maven</span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=setting-up-your-application>Setting up your Application</h1><h2 id=environment-setup---application>Environment Setup - Application</h2><ul><li>Clone the workshop repository:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone -b tko-fy24-distributed-tracing https://github.com/shabuhabs/javashop-otel.git</span></span></code></pre></div><ul><li>Access the workshop directory:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> javashop-otel</span></span></code></pre></div><ul><li>Set Environment Variables</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano .env</span></span></code></pre></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><ul><li>NO spaces in &lt;your_name></li><li>The shop_user provides us an Environment Tag.</li><li>To get your access token, go to your Splunk O11y UI -> Settings ->Access Tokens.</li><li>It is assumed in this workshop that you can send traces to the org and token you are using.</li></ul></div></div><ul><li>Set the following values:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>SHOP_USER</span><span class=o>=</span><span class=s>&lt;your_name&gt;</span>
</span></span><span class=line><span class=cl><span class=na>SPLUNK_ACCESS_TOKEN</span><span class=o>=</span><span class=s>&lt;your_token&gt;</span>
</span></span><span class=line><span class=cl><span class=na>SPLUNK_REALM</span><span class=o>=</span><span class=s>&lt;your_realm&gt;</span></span></span></code></pre></div><ul><li>Save in nano with <strong>[CTRL]-o [ENTER]</strong></li><li>Exit nano with <strong>[CTRL]-x</strong></li></ul><h2 id=build-and-deploy-application>Build and Deploy Application</h2><p>Let&rsquo;s get started by building and deploying our Application, the Splunk Instrument Shop. Run the commands below to begin and start reading ahead as your traces are coming up!</p><ul><li>Build the app</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./BuildAndDeploy.sh</span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=overview-of-the-workshop>Overview of the Workshop</h1><h2 id=users-and-workflows>Users and Workflows</h2><p>As we go through this workshop we will be switching roles from SRE to Developer. First we will start with alert responders or SREs who will identify an issue in Splunk Observability UI. Next, we will jump to a Developer Role to see how a Developer will debug and repair/fix a software problem using trace data provided by our SRE.</p><p>Of course, we are not requiring 2 people for this workshop as each participant will play both roles.</p><h2 id=today-we-will-learn>Today we will learn</h2><p>Today we will learn how Splunk APM with Full Fidelity tracing can accelerate the time to repair for Development teams. We will focus on the full fidelity data ( In the form of traces ) that an SRE or alert responder would send to a developer to then repair/fix software. We will do this with both Auto-Instrumentation data and Custom attributes or Custom Tags, via Manual Instrumentation data.</p><p>While we will be spending time Debugging code, &mldr;. Don&rsquo;t worry, &mldr;there is no programming experience necessary, as our goal here is for every participant to understand how using Custom Attributes/Tags in Splunk APM @ Full Fidelity accelerates Mean Time to Repair Software problems for Development Teams.</p><h2 id=important-definitions>Important Definitions</h2><p>Let&rsquo;s define a few terms for those new to APM / Software Development or Java</p><ul><li>What Are Custom Attributes / Custom Tags in Splunk APM ?</li></ul><p>First, you will hear poeple refer to Custom Attributes in the context of Splunk Enterprise, however in Splunk APM Custom Attributes are called Custom Tags as defined in Opentelemetry and shown in Splunk APM Tag Splotlight.</p><ul><li>What is a Function or a method in Java?</li></ul><p>A Function in most languages, including Java, is a logical chunk of code that &ndash; when executed &ndash; solves a repeatable task. This is basically what development teams spend thier time building and where software issues will most commonly be.</p><ul><li>What is an Exception in Java?</li></ul><p>An exception is an exceptional error condition that indicates abonormal behavior, or an unhandled condition, that interrupts program execution abnormally.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=review-apm-in-the-ui>Review APM in the UI</h1><h2 id=view-service-map>View Service Map</h2><p>Next step is open your Observability UI, accessing the proper org ( where you sent the traces to ) and click APM and Access the Environemnnt that matches the username you put in .env.</p><p><a href=#R-image-82a853052a00b0fbe76aa87b06cb485e class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-1-filter.png alt=4-overview-1-filter class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-82a853052a00b0fbe76aa87b06cb485e><img src=../../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-1-filter.png alt=4-overview-1-filter class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Please note it may take 4-5 minutes or more for traces to show up and you will see full map &ldquo;form&rdquo; as traces are coming in, so you may have to refresh the page a few times each time we Build and Deploy.</p><p>It is recommended to use a -15m look back during this lab. You may need to change it from time to time (for example to -5m or a custom -10m) to make sure you are only looking at the newer traces after your changes.</p><p>NOTE: You may have to refresh the page several times to see your Environment Tag in the UI. The prefix of the Environment tag should match what you entered for SHOP_USER in the .env file.</p><p><a href=#R-image-b362102eea28675f79b862dabad11872 class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-2-time-window.png alt=4-overview-2-time-window class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b362102eea28675f79b862dabad11872><img src=../../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-2-time-window.png alt=4-overview-2-time-window class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>NOTE: Typically, to identify root cause and route an issue, an SRE or alert responder would check metrics and logs to determine if it is a software or hardware related issue, and thus route to the correct party. In this excercise we are ONLY handling software issues, so we are skipping the metrics and logs parts of normal triage.</p><p>If your instrumentation was successful, the service-map will show latency from the shop service to the products service.</p><p><a href=#R-image-409016d002bac89b84a3b37bc14e7829 class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-3-map.png alt=4-overview-3-map class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-409016d002bac89b84a3b37bc14e7829><img src=../../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-3-map.png alt=4-overview-3-map class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Ok let&rsquo;s triage this SOFTWARE ISSUE and skip directly to the traces.</p><ul><li>Click on shop service</li><li>Click Traces (on the right side)</li><li>Sort by Duration</li><li>Select the longest duration trace<ul><li>Or one of the obvious much longer ones</li></ul></li></ul><p><a href=#R-image-23f27ee6b05e769884c5704569a705b1 class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-4-trace.png alt=4-overview-4-trace class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-23f27ee6b05e769884c5704569a705b1><img src=../../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-4-trace.png alt=4-overview-4-trace class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Now we can see the long latency occurred in the products service and if we click on <strong>products: /products</strong> we can see the offending method was <strong>products:ProductResource.getAllProducts</strong></p><p><a href=#R-image-291c0d576bd53ed766e85096f2153604 class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-5-span.png alt=4-overview-5-span class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-291c0d576bd53ed766e85096f2153604><img src=../../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-5-span.png alt=4-overview-5-span class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Our next step here would be to send that trace to a developer by clicking download trace and they will have to debug the function. Since we will be the developer there is no need to download the trace. Just remember that is normal workflow for alert responders to route an issue to the &ldquo;Repairers&rdquo; while providing trace data.</p><p>Before we do that please take note of the Tags available for the developer to leverage to find root cause. We see standard out of the box Otel tags on the span, environmental information, but no indications of data specific to something inside custom code (which is where the problem often is).</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=debugging-101>Debugging 101</h1><h2 id=now-lets-play-the-role-of-the-developer>Now let&rsquo;s play the role of the developer</h2><p>As a developer we must debug the function products:ProductResource.getAllProducts to find the problem.</p><h2 id=debugging-101-the-line-by-line-method>Debugging 101, the Line by Line method</h2><p>Without anything to go on other than &ldquo;BAD FUNCTION&rdquo;, a Developer must then look at code visually line by line to find and fix the problem. To make this worse, <strong>functions call other functions</strong>, and it can get very messy in bad code scenarios.</p><p>We will do the visual inspection mehtod next.</p><ul><li>Using Nano:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano products/src/main/java/com/shabushabu/javashop/products/resources/ProductResource.java</span></span></code></pre></div><ul><li>Search in Nano: <strong>[CTRL]-w</strong></li><li>Enter in: <strong>getAllProducts [Enter]</strong></li><li>You will be taken here:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=nd>@GET</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Response</span> <span class=nf>getAllProducts</span><span class=o>(</span><span class=nd>@DefaultValue</span><span class=o>(</span><span class=s>&#34;California&#34;</span><span class=o>)</span> <span class=nd>@QueryParam</span><span class=o>(</span><span class=s>&#34;location&#34;</span><span class=o>)</span> <span class=n>String</span> <span class=n>location</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// STEP X: All we know right now is somewhere in this function, latency was introduced.
</span></span></span><span class=line><span class=cl><span class=c1></span>  
</span></span><span class=line><span class=cl>      <span class=n>myCoolFunction1</span><span class=o>(</span><span class=n>location</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>myCoolFunction2</span><span class=o>(</span><span class=n>location</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>myCoolFunction10</span><span class=o>(</span><span class=n>location</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>myCoolFunction13</span><span class=o>(</span><span class=n>location</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>myCoolFunction5</span><span class=o>(</span><span class=n>location</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>myCoolFunction6</span><span class=o>(</span><span class=n>location</span><span class=o>);</span></span></span></code></pre></div><p>We can see here in getAllProducts, the first call is to <code>myCoolFunction1()</code>, so as may have guessed our next step is to go look at <code>myCoolFunction1()</code>.</p><ul><li>Search in Nano: <strong>[CTRL]-w</strong></li><li>Enter in: myCoolFunction1 <strong>[Enter]</strong></li><li>Find the next occurrence: <strong>[CTRL]-w [Enter]</strong></li><li>Keep repeating <strong>[CTRL]-w [Enter]</strong> until you get to the actual function definition</li></ul><p>It looks like this:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>myCoolFunction1</span><span class=o>(</span><span class=n>String</span> <span class=n>location</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Generate a FAST sleep of 0 time !
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kt>int</span> <span class=n>sleepy</span> <span class=o>=</span> <span class=n>lookupLocation1</span><span class=o>(</span><span class=n>location</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span><span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=n>sleepy</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span></span></span></code></pre></div><p>Now, <code>myCoolFunction1</code> calls <code>lookupLocation1(location)</code></p><ul><li>Search in Nano: <strong>[CTRL]-w</strong></li><li>Enter in: lookupLocation1 <strong>[Enter]</strong></li></ul><p>I think you get the picture by now, you have no choice but to inspect every line of code and every function called and visually inspect them for problems. This can be a VERY long process and kills our customers Mean Time to Repair. This happens quite often to our customers with our competition beacsue they can&rsquo;t provide all the traces 100% of the time and most can&rsquo;t scale to add more data, via Custom Attributes on top of that!</p><p>Remember, without Full Fidelty, you have to either reproduce errors / latency in another environment or inspect code line by line.</p><p>So they are stuck where we are, quite often.</p><p>OK, enough fun. Let&rsquo;s make this easier for our developer, and show off some Splunk APM Scale!</p><ul><li>Exit your editor:</li><li>Exit nano: <strong>[CTRL]-X</strong></li><li>Optional: If it asks you to save, hit <strong>N</strong></li></ul><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=custom-tags>Custom Tags</h1><h2 id=custom-attribution-custom-tags>Custom Attribution (Custom Tags)</h2><p>To take a deeper look at this issue and make this much easier to debug we will implement Custom Attributes via Opentelemetry Manual Instrumentation.</p><p>To speed up manual instrumentation in Java you can leverage OpenTelemetry Annotations, which automatically create a span around a method without modifying the actual code inside the method. This can be very valuable if you are working with an SRE that may have limited access to source code changes.</p><p>To add even more information to help our developers find the root cause faster, OpenTelemetry Annotations can be used to generate span tags with parameter values for the method in question. This is incredibly important to mean time to Repair, because as a Developer, if I know the parameter values of a function at the time of latency or error, I can debug this without having to reproduce an issue in another environment if I have Full Fidelity Tracing.</p><p>Splunk Full Fidelity APM allows our customers development teams to debug their code as it ran in production, 100% of the time. Add with Custom Attribution, you are providing repeatable Mean Time to Repair reduction&mldr; 100% of the time, only with Full Fidelity tracing.</p><p>To expedite manual instrumentation implementation for this exercise, we have provided a tool which will annotate the entirety of the &ldquo;shop&rdquo; and &ldquo;products&rdquo; services with OpenTelemetry standard annotations for every function call without having to write any code. This &ldquo;annotator&rdquo; tool will also tag every parameter in every function, which adds a span tag with Parameter=Value.</p><ul><li>Run Manual Instrumentation Tool</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./AutomateManualInstrumentation.sh</span></span></code></pre></div><ul><li>Rebuild and Deploy the Application</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./BuildAndDeploy.sh</span></span></code></pre></div><h2 id=visualize-in-splunk-apm>Visualize in Splunk APM</h2><p>Now that we have rebuilt and deployed our application, traffic is being sent once again.</p><p>Go back to the Splunk Observability UI and let&rsquo;s see if these annotations help us narrow down the root cause more quickly.</p><p>Let&rsquo;s try to find our latency root cause again, this time with every function and every parameter spanned and tagged respectively&mldr;. You will see exactly what this means and how it benefits developers in a moment.</p><p><a href=#R-image-d62f5037e2e172f24f97d394582c3ed0 class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/6-custom-tags/../images/6-custom-tags-1-apm-map.png alt=6-custom-tags-1-apm-map class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d62f5037e2e172f24f97d394582c3ed0><img src=../../en/other/dev-mttr-custom-tags/6-custom-tags/../images/6-custom-tags-1-apm-map.png alt=6-custom-tags-1-apm-map class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><ul><li>Click on shop service</li><li>Click Traces ( on the right side )</li><li>Sort by Duration</li><li>Select the longest duration trace ( or one of the obvious much longer ones )</li></ul><p><a href=#R-image-4046da63dd58f53a11e2ea8dfbdd91b5 class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/6-custom-tags/../images/6-custom-tags-2-trace.png alt=6-custom-tags-2-trace class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4046da63dd58f53a11e2ea8dfbdd91b5><img src=../../en/other/dev-mttr-custom-tags/6-custom-tags/../images/6-custom-tags-2-trace.png alt=6-custom-tags-2-trace class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>We can see that the actual function call that has the latency was not <code>ProductResource.getAllProducts</code> but the function call <code>ProductResource.myCoolFunction234234234</code>.</p><p>Since we now have the parameter tagged as part of our span metadata the actual root cause is seemingly related to the &ldquo;location&rdquo; <strong>Colorado</strong>. And it appears the one custom attribute that was tagged for function <code>ProductResource.myCoolFunction234234234</code> was <code>myInt</code> with a value of <strong>999</strong>. With this information a developer can debug very quickly.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>We added additional span information, which we call <strong>Custom Attributes</strong> here at Splunk. In this case our <strong>Custom Attributes</strong> are <strong>Parameter Values at Time of Latency</strong>.</p></div></div><p>In our exmaple the <code>myInt</code> tag was created due our handy Annotator, that did the OpenTelemetry Annotations for us.</p><ul><li>Using nano:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano products/src/main/java/com/shabushabu/javashop/products/resources/ProductResource.java</span></span></code></pre></div><ul><li>Search in Nano: <strong>[CTRL]-w</strong></li><li>Enter in: <strong>999 [Enter]</strong></li></ul><p>We can see here, someone wrote some very bad code in the form of a long Sleep!</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=mi>999</span><span class=o>==</span><span class=n>myInt</span><span class=o>)</span> 
</span></span><span class=line><span class=cl>    <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=n>sleepy</span><span class=o>.</span><span class=na>nextInt</span><span class=o>(</span><span class=mi>5000</span> <span class=o>-</span> <span class=mi>3000</span><span class=o>)</span> <span class=o>+</span> <span class=mi>3000</span><span class=o>);</span></span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=fixing-code>Fixing Code</h1><h2 id=finding-the-problem>Finding the Problem</h2><p>How did we get here? How did the 999 end up in the trace as a Custom Attribute?</p><p>Take a look at the function signature</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>myCoolFunction234234234</span><span class=o>(</span><span class=nd>@SpanAttribute</span><span class=o>(</span><span class=s>&#34;myInt&#34;</span><span class=o>)</span> <span class=kt>int</span> <span class=n>myInt</span><span class=o>)</span></span></span></code></pre></div><p><code>@SpanAttribute("myint")</code> is an OpenTelemetry Annotation that was added by our Java Otel Annotator tool.</p><h2 id=fixing-the-code>Fixing the code</h2><ul><li>Change this:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>myCoolFunction234234234</span><span class=o>(</span><span class=nd>@SpanAttribute</span><span class=o>(</span><span class=s>&#34;myInt&#34;</span><span class=o>)</span> <span class=kt>int</span> <span class=n>myInt</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Generate a FAST sleep of 0 time !
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Random</span> <span class=n>sleepy</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=o>{</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=mi>999</span><span class=o>==</span><span class=n>myInt</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span>
</span></span><span class=line><span class=cl><span class=n>sleepy</span><span class=o>.</span><span class=na>nextInt</span><span class=o>(</span><span class=mi>5000</span> <span class=o>-</span> <span class=mi>3000</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>+</span> <span class=mi>3000</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>){</span></span></span></code></pre></div><ul><li>to this:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>myCoolFunction234234234</span><span class=o>(</span><span class=nd>@SpanAttribute</span><span class=o>(</span><span class=s>&#34;myInt&#34;</span><span class=o>)</span> <span class=kt>int</span> <span class=n>myInt</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Generate a FAST sleep of 0 time !
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Random</span> <span class=n>sleepy</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=o>{</span>
</span></span><span class=line><span class=cl><span class=c1>// if (999==myInt)
</span></span></span><span class=line><span class=cl><span class=c1>// Thread.sleep(
</span></span></span><span class=line><span class=cl><span class=c1>// sleepy.nextInt(5000 - 3000)
</span></span></span><span class=line><span class=cl><span class=c1>// + 3000);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>){</span></span></span></code></pre></div><p>which is basically placing comments (//) before the lines in myCoolFunction234234234 that are causing the slowness:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// if (999==myInt)
</span></span></span><span class=line><span class=cl><span class=c1>// Thread.sleep(
</span></span></span><span class=line><span class=cl><span class=c1>// sleepy.nextInt(5000 - 3000)
</span></span></span><span class=line><span class=cl><span class=c1>// + 3000);
</span></span></span></code></pre></div><ul><li>Save the changes: <strong>[CTRL]-o [Enter]</strong></li><li>Exit: <strong>[CTRL]-x</strong></li></ul><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>Until we rebuild and restart our application this change isn&rsquo;t implemented.</p></div></div><h2 id=find-other-issues>Find Other Issues</h2><p>Let&rsquo;s go see if our manual instrumentation uncovered any other issues we did not see before</p><p>So you may be asking yourself: &ldquo;How does manual instrumentation alone show us &ldquo;more problems&rdquo; than before? Latency is latency, isn&rsquo;t it?&rdquo;</p><p>The answer is with auto-instrumentation you are in most situations NOT covering functions our customers&rsquo; development teams wrote, which is of course the bulk of what developers do. They write functions&mldr;. and of course this is where the bulk of software problems occur.</p><p>You may have noticed a new exception in our trace that was not present with Auto-Instrumentation during our latency fix use-case. Since we skipped over this, let&rsquo;s walk you through it.</p><ul><li>Return to the service map</li><li>Click on shop service</li><li>Click Traces (on the right side)</li><li>Click Errors Only</li></ul><p><a href=#R-image-c6a0b1d8f297d83e64c1779320b20280 class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/7-fixing-code/../images/7-fixing-code-1-traces.png alt=7-fixing-code-1-traces class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c6a0b1d8f297d83e64c1779320b20280><img src=../../en/other/dev-mttr-custom-tags/7-fixing-code/../images/7-fixing-code-1-traces.png alt=7-fixing-code-1-traces class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><ul><li>Click on a trace with an error present</li></ul><p><a href=#R-image-c342d99ac4d4f3dc4a868a926efd6f37 class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/7-fixing-code/../images/7-fixing-code-2-span.png alt=7-fixing-code-2-span class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c342d99ac4d4f3dc4a868a926efd6f37><img src=../../en/other/dev-mttr-custom-tags/7-fixing-code/../images/7-fixing-code-2-span.png alt=7-fixing-code-2-span class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>We can see our exception is <code>InvalidLocaleException</code>.</p><p>The real problem must be related to the new data associated with <strong>Sri Lanka</strong> as the Exception says <strong>&ldquo;Non English Characters found in Instrument Data&rdquo;</strong>.</p><p>This exception had not surfaced in previous traces based on ONLY Auto-Instrumentation because the method where it was thrown was NOT covered with Auto-Instrumentation.</p><p>Once we completed the Manual Instrumentation via the Otel Annotator, this method was instrumented and we can now see we had a buried Exception being thrown.</p><h2 id=fixing-more-code>Fixing more code</h2><p>We already know exactly what file to look in and what method to look at as it is called out in the trace.</p><p><a href=#R-image-4daa2041b0d78722b4835186eb37d44b class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/7-fixing-code/../images/7-fixing-code-3-what-to-fix.png alt=7-fixing-code-3-what-to-fix class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4daa2041b0d78722b4835186eb37d44b><img src=../../en/other/dev-mttr-custom-tags/7-fixing-code/../images/7-fixing-code-3-what-to-fix.png alt=7-fixing-code-3-what-to-fix class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><ul><li>Using nano:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano shop/src/main/java/com/shabushabu/javashop/shop/model/Instrument.java</span></span></code></pre></div><ul><li>Search in Nano: <strong>[CTRL]-w</strong></li><li>Enter in: <strong>buildForLocale [Enter]</strong></li></ul><p>Look just above the <code>buildForLocale</code> function.</p><p>Notice the Annotation <code>@WithSpan</code>? <code>@WithSpan</code> is an <a href=https://opentelemetry.io/docs/instrumentation/java/automatic/annotations/ target=_blank>OpenTelemetry Annotation</a> for Java that automatically generates a span around a the function that follows.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@WithSpan</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=n>Instrument</span> <span class=nf>buildForLocale</span><span class=o>(</span>
</span></span><span class=line><span class=cl>  <span class=nd>@SpanAttribute</span><span class=o>(</span><span class=s>&#34;id&#34;</span><span class=o>)</span> <span class=kt>long</span> <span class=n>id</span><span class=o>,</span> <span class=o>...</span>
</span></span><span class=line><span class=cl>  <span class=nd>@SpanAttribute</span><span class=o>(</span><span class=s>&#34;seller_type&#34;</span><span class=o>)</span> <span class=o>...</span>
</span></span><span class=line><span class=cl>  <span class=k>this</span><span class=o>.</span><span class=na>id</span><span class=o>=</span> <span class=n>id</span><span class=o>;</span></span></span></code></pre></div><p>Now let&rsquo;s fix this code. We are going to simply comment this out for now and see if it fixes our latency issue.</p><ul><li>Change this:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>if</span> <span class=o>(!</span><span class=n>isEnglish</span><span class=o>(</span><span class=n>title</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>throw</span> <span class=k>new</span> <span class=n>InvalidLocaleException</span><span class=o>(</span><span class=s>&#34;Non English Characters found in Instrument Data&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl> <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>   <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Characters OK &#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div><ul><li>to this (comment out if block):</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// if (!isEnglish(title)) {
</span></span></span><span class=line><span class=cl><span class=c1>//   throw new InvalidLocaleException(&#34;Non English Characters found in Instrument Data&#34;);
</span></span></span><span class=line><span class=cl><span class=c1>// } else {
</span></span></span><span class=line><span class=cl><span class=c1>//   System.out.println(&#34;Characters OK &#34;);
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span></code></pre></div><ul><li>Save the changes: <strong>[CTRL]-o [Enter]</strong></li><li>Exit: <strong>[CTRL]-x</strong></li></ul><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=rebuild-and-deploy>Rebuild and Deploy</h1><h2 id=rebuild-and-deploy>Rebuild and Deploy</h2><ul><li>Run</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./BuildAndDeploy.sh</span></span></code></pre></div><ul><li>Wait a few minutes . . .</li><li>Return to the service map</li></ul><p>If you do NOT see RED in your service map, you have completed the Latency Repair for the Colorado Location!</p><p>Now let&rsquo;s check for our exception in the traces.</p><ul><li>Click on shop service</li><li>Click Traces (on the right side)</li><li>Click Errors Only</li></ul><p>If you do not have red in your service map and you do not see Errors in traces, you have successfully completed our Inventory application review for Sri Lanka and Colorado locations.</p><p><strong>Well done!</strong></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=dont-forget-chicago>Don't Forget Chicago</h1><h2 id=dont-forget-chicago>Don&rsquo;t forget Chicago</h2><p>We are nearly done, one more location to go&mldr; Chicago.</p><p>Since we have been having so many issues related to &ldquo;location&rdquo; and we have added that custom attribute via Opentelemetry Manual Instrumentation, lets go to the Splunk Observability UI and look at an APM metric set around that tag that I created for us.</p><p><a href=#R-image-1dd88db118a44cd8e79a697a5ce740bf class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-1-metricset.png alt=9-chicago-1-metricset class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1dd88db118a44cd8e79a697a5ce740bf><img src=../../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-1-metricset.png alt=9-chicago-1-metricset class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><ul><li>Open a browser and navigate to <a href=http://[EC2-Address]:8010 target=_blank>http://[EC2-Address]:8010</a><ul><li>Replace [EC2-Address] with the ip address of your host</li></ul></li><li>Select a few locations and hit the Login button.<ul><li>Make sure to also select the Chicago Location and hit the Login button.</li></ul></li></ul><p><a href=#R-image-9bff7d68c1b778ad2ce150b46723e0e7 class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-2-app.png alt=9-chicago-2-app class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9bff7d68c1b778ad2ce150b46723e0e7><img src=../../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-2-app.png alt=9-chicago-2-app class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Uh oh! We received a 500 error, something is wrong there as well.</p><p><a href=#R-image-5892e31e87f5b30045d32b83947ca6d8 class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-3-map.png alt=9-chicago-3-map class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5892e31e87f5b30045d32b83947ca6d8><img src=../../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-3-map.png alt=9-chicago-3-map class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><ul><li>Return to the Splunk Observability UI and lets look once again at our Service Map</li><li>Select the Instruments Service</li><li>Click the Breakdowns dropdown on the right and select location</li></ul><p><a href=#R-image-09ac82f319c182585348c7d62c4295bb class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-4-map-breakdown.png alt=9-chicago-4-map-breakdown class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-09ac82f319c182585348c7d62c4295bb><img src=../../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-4-map-breakdown.png alt=9-chicago-4-map-breakdown class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>We see there was an un-handled exception thrown in the Instruments service, and some latency from our database that is related to the Chicago location!</p><ul><li>Click on Traces on the right</li><li>Click Errors Only</li><li>Click one of the traces</li></ul><p><a href=#R-image-10f23ba244a4da6828a4f890ecc007a8 class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-5-trace.png alt=9-chicago-5-trace class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-10f23ba244a4da6828a4f890ecc007a8><img src=../../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-5-trace.png alt=9-chicago-5-trace class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>We can see the exception was thrown by Hibernate, however it was thrown in our method instruments: <code>InstrumentRepository.findInstruments</code></p><p><a href=#R-image-9031f3a324cc7f21d438b7b8eca3a296 class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-6-span.png alt=9-chicago-6-span class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9031f3a324cc7f21d438b7b8eca3a296><img src=../../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-6-span.png alt=9-chicago-6-span class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=lets-play-developer-again>Let&rsquo;s play developer again</h2><ul><li>Edit the file <code>instruments: InstrumentRepository.findInstruments</code> using nano:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>nano</span> <span class=n>instruments</span><span class=o>/</span><span class=n>src</span><span class=o>/</span><span class=n>main</span><span class=o>/</span><span class=n>java</span><span class=o>/</span><span class=n>com</span><span class=o>/</span><span class=n>shabushabu</span><span class=o>/</span><span class=n>javashop</span><span class=o>/</span><span class=n>instruments</span><span class=o>/</span><span class=n>repositories</span><span class=o>/</span><span class=n>FindInstrumentRepositoryImpl</span><span class=o>.</span><span class=na>java</span></span></span></code></pre></div><ul><li>Find the method: <code>findInstruments</code><ul><li>You know how to do this now, right?</li></ul></li></ul><p><a href=#R-image-74dbf466765256c8e52a3606999fe26a class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-7-code.png alt=9-chicago-7-code class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-74dbf466765256c8e52a3606999fe26a><img src=../../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-7-code.png alt=9-chicago-7-code class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>We can see the developer accidently added the Instruments database with the Chicago Instruments database!</p><p>Let&rsquo;s change the query and fix this, remove instruments_for_sale from our query.</p><ul><li>Change this:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>Object</span> <span class=nf>findInstruments</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>LOGGER</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;findInstruments Called (All)&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Object</span> <span class=n>obj</span> <span class=o>=</span> <span class=n>entityManager</span><span class=o>.</span><span class=na>createNativeQuery</span><span class=o>(</span> <span class=s>&#34;SELECT * FROM instruments_for_sale, instruments_for_sale_chicago&#34;</span><span class=o>).</span><span class=na>getResultList</span><span class=o>();</span> 
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>obj</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div><ul><li>to this:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>Object</span> <span class=nf>findInstruments</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>LOGGER</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;findInstruments Called (All)&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Object</span> <span class=n>obj</span> <span class=o>=</span> <span class=n>entityManager</span><span class=o>.</span><span class=na>createNativeQuery</span><span class=o>(</span> <span class=s>&#34;SELECT * FROM instruments_for_sale_chicago&#34;</span><span class=o>).</span><span class=na>getResultList</span><span class=o>();</span> 
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>obj</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div><ul><li><p>Save the changes: <strong>[CTRL]-o [Enter]</strong></p></li><li><p>Exit: <strong>[CTRL]-x</strong></p></li><li><p>Build and Deploy Application</p></li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./BuildAndDeploy.sh</span></span></code></pre></div><p>Now let&rsquo;s test the Chicago location once again</p><ul><li>Open a browser and navigate to <a href=http://[EC2-Address]:8010 target=_blank>http://[EC2-Address]:8010</a></li><li>Select the Chicago location and Login</li></ul><p>We now see the 500 error is gone!</p><ul><li>Let&rsquo;s confirm a clean Service Map:</li></ul><p><a href=#R-image-8f8f4bf2e0eedb7d8fef77840637f3b1 class=lightbox-link><img src=../../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-8-map-clean.png alt=9-chicago-8-map-clean class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8f8f4bf2e0eedb7d8fef77840637f3b1><img src=../../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-8-map-clean.png alt=9-chicago-8-map-clean class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>If you see a clean service map, free of errors and Latency you have successfully completed the Java Instrumentation Workshop!</p><p><strong>Congratulations!!!</strong></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=appendix---setting-up-on-mac>Appendix - Setting up on Mac</h1><h2 id=mac-setup>Mac Setup</h2><ul><li>Tested on<ul><li>Macos Ventura 13.2.1</li><li>Mac M1/M2</li></ul></li></ul><p>Intel Macs should be work; however if they are slower you may need to run <code>./BuildAndDeploy</code> multiple times.</p><p>IMPORTANT: Docker must have access to 6-GB RAM.</p><ul><li>Prerequisites<ul><li><a href=https://mac.install.guide/commandlinetools/index.html target=_blank>XCode Command line tools</a></li></ul></li></ul><h3 id=homebrew-install>Homebrew Install</h3><ul><li><a href=https://docs.brew.sh/Installation target=_blank>Homebrew full install details</a></li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir homebrew <span class=o>&amp;&amp;</span> curl -L https://github.com/Homebrew/brew/tarball/master <span class=p>|</span> tar xz --strip <span class=m>1</span> -C homebrew
</span></span><span class=line><span class=cl><span class=nb>eval</span> <span class=s2>&#34;</span><span class=k>$(</span>homebrew/bin/brew shellenv<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>brew update --force --quiet
</span></span><span class=line><span class=cl>chmod -R go-w <span class=s2>&#34;</span><span class=k>$(</span>brew --prefix<span class=k>)</span><span class=s2>/share/zsh&#34;</span></span></span></code></pre></div><h4 id=install-colima>Install Colima</h4><p>Colima - Colima is a docker daemon that does not require Docker Desktop. This is used to avoid any docker license issues with Docker Desktop.</p><ul><li><a href=https://github.com/abiosoft/colima target=_blank>Colima full install details</a></li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>brew uninstall docker docker-compose colima
</span></span><span class=line><span class=cl>brew install docker docker-compose colima 
</span></span><span class=line><span class=cl>colima stop
</span></span><span class=line><span class=cl>colima start --cpu <span class=m>4</span> --memory <span class=m>6</span></span></span></code></pre></div><ul><li>Java Tools Install</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>brew install git
</span></span><span class=line><span class=cl>brew install maven</span></span></code></pre></div><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=splunk-rum>Splunk RUM</h1><p>Splunk RUM is the industry’s only end-to-end, full-fidelity Real User Monitoring solution. It is built to optimize performance and aid in faster troubleshooting, giving you full visibility into end-user experiences.</p><p>Splunk RUM allows you to identify performance problems in your Web and or Mobile applications that impact the customer experience. We support benchmarking and measuring page performance with core web vitals. This includes but is not limited to W3C timings, the ability to identify long-running tasks, along with anything that can impact your page load.</p><p>With Splunk’s end-to-end monitoring capabilities, you can view the latency between all of the services that make up your application, from the service itself through to infrastructure metrics such as database calls and everything in between.
Our full-fidelity end-to-end monitoring solution captures 100% of your span data. We do not sample, we are framework agnostic and Open Telemetry standardized.</p><p>More often than not we find that the frontend and backend application&rsquo;s performance are interdependent. Fully understanding and being able to visualize the link between your backend services and your user experience is increasingly important.
To see the full picture, Splunk RUM provides a seamless correlation between our front-end and back-end microservices. If your users are experiencing less than optimal conditions on your web-based application due to an issue related to your microservice or infrastructure, Splunk will be able to detect this issue and alert you.</p><p>To complete the picture and offer full visibility, Splunk is also able to show in-context logs and events to enable deeper troubleshooting and root-cause analysis.</p><p><a href=#R-image-a2cacbfca22d23aa074e8086c33eb20b class=lightbox-link><img src=../../en/other/rum/images/rum-architecture.png alt="Architecture Overview" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a2cacbfca22d23aa074e8086c33eb20b><img src=../../en/other/rum/images/rum-architecture.png alt="Architecture Overview" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Splunk RUM</h1><article class=default><header class=headline></header><h1 id=1-overview>1. Overview</h1><h2 id=overview-of-the-rum-workshop>Overview of the RUM Workshop</h2><p>The aim of this Splunk Real User Monitoring (RUM) workshop is to let you:</p><ul><li><p>Shop for some fantastic items on the Online Boutique to create traffic, and create a number of RUM User Sessions<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> that you can view in the Splunk Observability Suite.</p></li><li><p>See an overview of the performance of all your application(s) in the Application Summary Dashboard (Both Mobile and Web based)</p></li><li><p>Examine the performance of a specific website or Mobile App with RUM metrics.</p></li><li><p>Investigate issues with your website and backend services.</p></li><li><p>(Optionally) See how to add RUM to your website.</p></li></ul><p>In order to reach this goal, we will use an online boutique to order various products. Whilst shopping on the online boutique you will create what is called a User Session.</p><p>You may encounter some issues with this web site, and you will use Splunk RUM to identify the issues, so they can be resolved by the developers.</p><p>If this a standalone RUM workshop, the workshop host will provide you with a URL for an online boutique store that has RUM enabled.</p><p>If you are running this session as part of the IM/APM workshop you will be able to use your current online boutique store after we enable RUM.</p><p>Each of these Online Boutiques are also being visited by a few synthetic users, this will allow us to generate more live data to be analyzed later.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>A RUM Users session is a &ldquo;recording&rdquo; of a collection of user interactions on an application, basically collecting a website or app’s performance measured straight from the browser or Mobile App of the end user. To do this a small amount of JavaScript is embedded in each page. This script then collects data from each user as he or she explores the page, and transfers that data back for analysis.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=2-example-of-rum-enablement-in-your-website>2. Example of RUM enablement in your Website</h1><ul><li>Check the original HEAD section of your Online-boutique webpage (or use the examples here) in your browser</li><li>Find the Web address of your workshop hosts Online Boutique</li><li>Compare the changes made to the hosts Online-Boutique and compare with the base one.</li></ul><hr><h2 id=1-browse-to-the-online-boutique>1. Browse to the Online Boutique</h2><p>If you have access to an EC2 instance and have previously installed the Online Boutique as part of the APM session, you can view it on port 81 of the EC2 instance&rsquo;s IP address.</p><p>If you have not got access to an EC2 instance with the Online Boutique installed then your workshop instructor will provide you with the Online Boutique URL that does not have RUM installed so that you can complete the next steps.</p><h2 id=2--inspecting-the-html-source>2. Inspecting the HTML source</h2><p>The changes needed for RUM are placed in the <code>&lt;head></code> section of the hosts Web page. Below is the updated <code>&lt;head></code> section with the changes required to enable RUM:</p><p><a href=#R-image-71003db84acac57b1ac5c4ca4b4f24cc class=lightbox-link><img src=../../en/other/rum/2-setup/../images/ViewRUM-HEAD-html.png alt="Online Boutique" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-71003db84acac57b1ac5c4ca4b4f24cc><img src=../../en/other/rum/2-setup/../images/ViewRUM-HEAD-html.png alt="Online Boutique" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>The first three lines (marked in red) have been added to the <code>&lt;head></code> section of the host Web page to enable RUM Tracing, the last three (marked in blue) are optional and used to enable Custom RUM events.</p><ul><li>The first part is to indicate where to download the Splunk Open Telemetry Javascript file from: <code>https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js</code> (this can also be hosted locally if so required).</li><li>The second line defines the location where to send the traces to in the beacon url: <code>{beaconUrl: "https://rum-ingest.eu0.signalfx.com/v1/rum"</code></li><li>The RUM Access Token: <code>rumAuth: "&lt;redacted>"</code>.</li><li>Identification tags <code>app</code> and <code>environment</code> to indentify in the SPLUNK RUM UI e.g. <code>app: "ksnq-store", environment: "ksnq-workshop"}</code></li></ul><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>In this example the app name is <strong>ksnq-store</strong>, this will be different in the Workshop. Check with your host what the app name and environment to use in the RUM session will be and make a note of it!</p></div></div><p>The above two lines are all that is required to enable RUM on your website!</p><p>The (blue) optional section that uses <code>var tracer=Provider.getTracer('appModuleLoader');</code> will add a custom event for every page change allowing you to better track your website conversions and usage.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=3-rum-landing-page>3. RUM Landing Page</h1><ul><li>Visit the RUM landing page and and check the overview of the performance of all your RUM enabled applications with the Application Summary Dashboard (Both Mobile and Web based)</li></ul><hr><h2 id=1-visit-the-rum-landing-page>1. Visit the RUM Landing Page</h2><p>Login into your Splunk IM/APM/RUM Website. From the left side menu bar select <strong>RUM</strong> <a href=#R-image-f67fd0490349886b8d1356c432e9c1c5 class=lightbox-link><img src="../../en/other/rum/3-rum-landing/../images/RUM_ico.png?classes=inline&amp;height=25px" alt=RUM-ico class="figure-image noborder inline lightbox noshadow" style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f67fd0490349886b8d1356c432e9c1c5><img src="../../en/other/rum/3-rum-landing/../images/RUM_ico.png?classes=inline&amp;height=25px" alt=RUM-ico class="lightbox-image noborder inline lightbox noshadow" loading=lazy></a>. This will bring you to your the RUM Landing Page.</p><p>The goal of this page is to give you in a single page, a clear indication of the health, performance and potential errors found in your application(s) and allow you to dive deeper into the information about your User Sessions collected from your web page/App. You will have a pane for each of your active RUM applications. (The view below is the default expanded view)</p><p><a href=#R-image-9cfb610ef3ff2ed68f7de35307420dda class=lightbox-link><img src=../../en/other/rum/3-rum-landing/../images/Applicationsummarydashboard.png alt=RUM-App-sum class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9cfb610ef3ff2ed68f7de35307420dda><img src=../../en/other/rum/3-rum-landing/../images/Applicationsummarydashboard.png alt=RUM-App-sum class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>If you have multiple applications, (which will be the case when every attendee is using their own ec2 instance for the RUM workshop), the pane view may be automatically reduced by collapsing the panes as shown below:</p><p><a href=#R-image-2dae293db5b0465f30acfbc1fe043ef5 class=lightbox-link><img src=../../en/other/rum/3-rum-landing/../images/multiple_apps_collapsed.png alt=RUM-App-sum-collapsed class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2dae293db5b0465f30acfbc1fe043ef5><img src=../../en/other/rum/3-rum-landing/../images/multiple_apps_collapsed.png alt=RUM-App-sum-collapsed class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You can expanded a condensed RUM Application Summary View to the full dashboard by clicking on the small browser <a href=#R-image-2dc2b8dc058ed9b5aea066405206361a class=lightbox-link><img src="../../en/other/rum/3-rum-landing/../images/browser.png?classes=inline&amp;height=25px" alt=RUM-browser class="figure-image noborder inline lightbox noshadow" style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2dc2b8dc058ed9b5aea066405206361a><img src="../../en/other/rum/3-rum-landing/../images/browser.png?classes=inline&amp;height=25px" alt=RUM-browser class="lightbox-image noborder inline lightbox noshadow" loading=lazy></a> or Mobile <a href=#R-image-28a8b5352f684142beac8a523e908f7d class=lightbox-link><img src="../../en/other/rum/3-rum-landing/../images/mobile.png?classes=inline&amp;height=25px" alt=RUM-mobile class="figure-image noborder inline lightbox noshadow" style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-28a8b5352f684142beac8a523e908f7d><img src="../../en/other/rum/3-rum-landing/../images/mobile.png?classes=inline&amp;height=25px" alt=RUM-mobile class="lightbox-image noborder inline lightbox noshadow" loading=lazy></a>icon. (Depending on the type of application: <em>Mobile</em> or <em>Browser</em> based) on the left in front of the applications name, highlighted by the red arrow.</p><p>First find the right application to use for the workshop:</p><p>If you are participating in a stand alone RUM workshop, the workshop leader will tell you the name of the application to use, in the case of a combined workshop, it will follow the naming convention we used for IM and APM and use the ec2 node name as a unique id like <strong>jmcj-store</strong> as shown as the last app in the screenshot above.</p><h2 id=2-configure-the-rum-application-summary-dashboard-header-section>2. Configure the RUM Application Summary Dashboard Header Section</h2><p>RUM Application Summary Dashboard consists of 6 major sections. The first is the selection header, where you can set/filter a number of options:</p><ul><li>A drop down for the <strong>Time Window</strong> you&rsquo;re reviewing (You are looking at the past 15 minutes by default)</li><li>A drop down to select the <strong>Environment</strong><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> you want to look at. This allows you to focus on just the subset of applications belonging to that environment, or Select all to view all available.</li><li>A drop down list with the various <strong>Apps</strong> being monitored. You can use the one provided by the workshop host or select your own. This will focus you on just one application.</li><li>A drop down to select the <strong>Source</strong>, <em>Browser</em> or <em>Mobile</em> applications to view. For the Workshop leave <em>All</em> selected.</li><li>A hamburger menu located at the right of the header allowing you to configure some settings of your Splunk RUM application. (We will visit this in a later section).</li></ul><p><a href=#R-image-ed704cd53fa5763b9243787d66ea83c9 class=lightbox-link><img src=../../en/other/rum/3-rum-landing/../images/RUM_SummaryHeader.png alt=RUM-SummaryHeader class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ed704cd53fa5763b9243787d66ea83c9><img src=../../en/other/rum/3-rum-landing/../images/RUM_SummaryHeader.png alt=RUM-SummaryHeader class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>For the workshop lets do a deeper dive into the Application Summary screen in the next section: <a href=../../en/other/rum/4-browser-summary/index.html>Check Health Browser Application</a></p><hr><p>A common application deployment pattern is to have multiple, distinct application environments that don’t interact directly with each other but that are all being monitored by Splunk APM or RUM: for instance, quality assurance (QA) and production environments, or multiple distinct deployments in different datacenters, regions or cloud providers.
<a href=http://nebezb.com/ target=_blank></a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>A deployment environment is a distinct deployment of your system or application that allows you to set up configurations that don’t overlap with configurations in other deployments of the same application. Separate deployment environments are often used for different stages of the development process, such as development, staging, and production.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=4-check-browser-applications-health-at-a-glance>4. Check Browser Applications health at a glance</h1><ul><li>Get familiar with the UI and options available from this landing page</li><li>Identify Page Views/Errors and Request/Errors and Java Script Errors in a single view</br>Check the Web Vitals metrics and any Detector that has fired for in relation to your Browser Application</li></ul><hr><h2 id=1-application-summary-dashboard-overview>1. Application Summary Dashboard Overview</h2><h3 id=11-header-bar>1.1. Header Bar</h3><p>As seen in the previous section the RUM Application Summary Dashboard consists of 5 major sections.</br>The first section is the selection header, where you can collapse the Pane via the <a href=#R-image-1c589aa5ac5f3ec7cbb867d642450665 class=lightbox-link><img src="../../en/other/rum/4-browser-summary/../images/browser.png?classes=inline&amp;height=25px" alt=RUM-browser class="figure-image noborder inline lightbox noshadow" style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1c589aa5ac5f3ec7cbb867d642450665><img src="../../en/other/rum/4-browser-summary/../images/browser.png?classes=inline&amp;height=25px" alt=RUM-browser class="lightbox-image noborder inline lightbox noshadow" loading=lazy></a> Browser icon or the <strong>></strong> in front of the application name, which is <em>jmcj-store</em> in the example below. It also provides access to the <em>Application Overview</em> page if you click the link with your application name which is <em>jmcj-store</em> in the example below.</p><p>Further, you can also open the <em>Application Overview</em> or <em>App Health Dashboard</em> via the triple dot <a href=#R-image-41db377b0032a10d456f5aa93eb0dc89 class=lightbox-link><img src="../../en/other/rum/4-browser-summary/../images/trippleburger.png?classes=inline&amp;height=25px" alt=trippleburger class="figure-image noborder inline lightbox noshadow" style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-41db377b0032a10d456f5aa93eb0dc89><img src="../../en/other/rum/4-browser-summary/../images/trippleburger.png?classes=inline&amp;height=25px" alt=trippleburger class="lightbox-image noborder inline lightbox noshadow" loading=lazy></a> menu on the right.</p><p><a href=#R-image-f92bc9dd04cc4b32a7b605f664de109f class=lightbox-link><img src=../../en/other/rum/4-browser-summary/../images/summaryHeader.png alt=RUM-SummaryHeader class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f92bc9dd04cc4b32a7b605f664de109f><img src=../../en/other/rum/4-browser-summary/../images/summaryHeader.png alt=RUM-SummaryHeader class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>First use the <em>View Dashboard</em> link to open the Browser App Health Dashboard which should open in a new tab. Then switch back to original RUM tab, and then use the <em>Open Application Overview</em> link, or click on the name of the app to launch the Application Overview dashboard.</p><p>We will looking at the <em>Application Overview</em> and <em>Browser App Health</em> Dashboards in detail in the following sections.</p><h2 id=2-application-overview>2. Application Overview</h2><p>The RUM Application Overview Dashboard is focused on providing you with <em>at a glance</em> overview of the status of your application.</p><h3 id=21-page-views--errors--network-requests--errors>2.1. Page Views / Errors & Network Requests / Errors</h3><p>The first section shows <em>Page Views / Errors</em>, & <em>Network Requests and Errors</em> charts show the quantity and trend of these issues in your application. This could be Javascript errors, or failed network calls to back end services.</p><p><a href=#R-image-696adb69ba46efc1186cb37723114885 class=lightbox-link><img src=../../en/other/rum/4-browser-summary/../images/Rum-chart.png alt=RUM-chart class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-696adb69ba46efc1186cb37723114885><img src=../../en/other/rum/4-browser-summary/../images/Rum-chart.png alt=RUM-chart class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>In the example above you can see that there are no failed network calls in the Network chart, but in the Page View chart you can see that a number of pages do experience some errors. These are often not visible for regular users, but can seriously impact the performance of your web site.</p><p>You can see the count of the Page Views / Network Requests / Errors by hovering over the charts.</p><p><a href=#R-image-edb5740d2900fcd0666db3020492bb06 class=lightbox-link><img src=../../en/other/rum/4-browser-summary/../images/RUM-Chart-Clicked.png alt=RUM-chart-clicked class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-edb5740d2900fcd0666db3020492bb06><img src=../../en/other/rum/4-browser-summary/../images/RUM-Chart-Clicked.png alt=RUM-chart-clicked class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h3 id=22-javascript-errors>2.2. JavaScript Errors</h3><p>With the second section of the RUM Application Summary Dashboard we are showing you an overview of the JavaScript errors occurring in your application, along with a count of each error.</p><p><a href=#R-image-52d4b1ba621460715f6139444c17463f class=lightbox-link><img src=../../en/other/rum/4-browser-summary/../images/RUM-Javascripterrors.png alt=RUM-javascript class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-52d4b1ba621460715f6139444c17463f><img src=../../en/other/rum/4-browser-summary/../images/RUM-Javascripterrors.png alt=RUM-javascript class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>In the example above you can see there are three JavaScript errors, one that appears 29 times in the selected time slot, and the other two each appear 12 times.</p><p>If you click on one of the errors a pop-out opens that will show a summary (below) of the errors over time, along with a Stack Trace of the JavaScript error, giving you an indication of where the problems occurred. (We will see this in more detail in one of the following sections)</p><p><a href=#R-image-c72073e50124ce7e37f7d8c93c12bbf8 class=lightbox-link><img src=../../en/other/rum/4-browser-summary/../images/expandedRUmJAVAscript-error.png alt=RUM-javascript-chart class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c72073e50124ce7e37f7d8c93c12bbf8><img src=../../en/other/rum/4-browser-summary/../images/expandedRUmJAVAscript-error.png alt=RUM-javascript-chart class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h3 id=23-web-vitals>2.3. Web Vitals</h3><p>The third section of the RUM Application Summary Dashboard is showing you the crucial (google) Web Vitals, three metrics, that are used by Google in its ranking system, and give a very good indication of the speed of your site for your end users.</p><p><a href=#R-image-7d740dbeb2e105f349a5b7ddf3170039 class=lightbox-link><img src=../../en/other/rum/4-browser-summary/../images/RUM-QuickWebVitals.png alt=WEB-vitals class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7d740dbeb2e105f349a5b7ddf3170039><img src=../../en/other/rum/4-browser-summary/../images/RUM-QuickWebVitals.png alt=WEB-vitals class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>As you can see our site is well behaved and scores <em>Good</em> for all three Metrics. These metrics can be used to identify the effect changes to your application have, and help you improve the performance of your site.</p><p>If you click on any of the Metrics shown in the Web Vitals pane you will be taken to the corresponding Tag Spotlight Dashboard. e.g. clicking on the <strong>Largest Contentful Paint (LCP)</strong> chartlet, you will be taken to a dashboard similar to the screen shot below, that gives you timeline and table views for how this metric has performed. This should allow you to spot trends and identify where the problem may be more common, such as an OS or browser version, .</p><p><a href=#R-image-def1bad008d93a30af296e73c3a48837 class=lightbox-link><img src=../../en/other/rum/4-browser-summary/../images/RUM-Tag-Spotlight.png alt=WEB-vitals-tag class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-def1bad008d93a30af296e73c3a48837><img src=../../en/other/rum/4-browser-summary/../images/RUM-Tag-Spotlight.png alt=WEB-vitals-tag class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h3 id=24-most-recent-detectors>2.4. Most Recent Detectors</h3><p>The fourth and final section of the RUM Application Summary Dashboard is focused on providing you an overview of any detector that has triggered for your application. We have created a detector for this screen shot but your pane will be empty for now, but we will add some detectors to your site and make sure they are triggered in one of the next sections.</p><p><a href=#R-image-a14e91a6bee20417674e096c41677269 class=lightbox-link><img src=../../en/other/rum/4-browser-summary/../images/rum-detector.png alt=detectors class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a14e91a6bee20417674e096c41677269><img src=../../en/other/rum/4-browser-summary/../images/rum-detector.png alt=detectors class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>In the screen shot you can see we have a critical alert for the <em>RUM Aggregated View Detector</em>, and a Count, how often this alert has triggered in the selected time window. If you happen to have an alert listed, you can click on the name of the Alert (that is shown as a blue link) and you will be taken to the Alert Overview page showing the details of the alert (Note: this will move you away from the current page, Please use the <strong>Back</strong> option of your browser to return to the overview page).</p><p><a href=#R-image-0c1bb1b242787b95fb7377c3176d8e95 class=lightbox-link><img src=../../en/other/rum/4-browser-summary/../images/click-alert.png alt=alert class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0c1bb1b242787b95fb7377c3176d8e95><img src=../../en/other/rum/4-browser-summary/../images/click-alert.png alt=alert class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><hr><p>Please take a few minutes to experiment with the RUM Application Summary Dashboard and the underlying chart and dashboards before going on to the next section.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=5-analyzing-rum-metrics>5. Analyzing RUM Metrics</h1><ul><li>See RUM Metrics and Session information in the RUM UI</li><li>See correlated APM traces in the RUM & APM UI</li></ul><hr><h2 id=1-rum-overview-pages>1. RUM Overview Pages</h2><p>From your RUM Application Summary Dashboard you can see detailed information by opening the Application Overview Page via the tripple dot <a href=#R-image-32b4adddd75c696f92633c57a6540efb class=lightbox-link><img src="../../en/other/rum/5-analyzing-metrics/../images/trippleburger.png?classes=inline&amp;height=25px" alt=trippleburger class="figure-image noborder inline lightbox noshadow" style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-32b4adddd75c696f92633c57a6540efb><img src="../../en/other/rum/5-analyzing-metrics/../images/trippleburger.png?classes=inline&amp;height=25px" alt=trippleburger class="lightbox-image noborder inline lightbox noshadow" loading=lazy></a> menu on the right by selecting <em>Open Application Overview</em> or by clicking the link with your application name which is <em>jmcj-store</em> in the example below.</p><p><a href=#R-image-3d119aea0113c17455a40b81cdc6907e class=lightbox-link><img src=../../en/other/rum/5-analyzing-metrics/../images/summaryHeader.png alt=RUM-SummaryHeader class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-3d119aea0113c17455a40b81cdc6907e><img src=../../en/other/rum/5-analyzing-metrics/../images/summaryHeader.png alt=RUM-SummaryHeader class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>This will take you to the RUM Application Overview Page screen as shown below.</p><p><a href=#R-image-cb53140dc8f4ab036f21562d782f7338 class=lightbox-link><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-1.png alt=RUM-1 class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-cb53140dc8f4ab036f21562d782f7338><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-1.png alt=RUM-1 class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=2-rum-browser-overview>2. RUM Browser Overview</h2><h3 id=21-header>2.1. Header</h3><p>The RUM UI consists of 6 major sections. The first is the selection header, where you can set/filter a number of options:</p><ul><li>A drop down for the time window you&rsquo;re reviewing (You are looking at the past hour in this case)</li><li>A drop down to select the Comparison window (You are comparing current performance on a rolling window - in this case compared to 1 hour ago)</li><li>A drop down with the available Environments to view: (Choose the one provided by the workshop host or <em>All</em> like in the example)</li><li>A drop down list with the Various Web apps (You can use the one provided by the workshop host or use <em>All</em>)</li><li><em><strong>Optionally</strong></em> a drop down to select Browser or Mobile metrics (<em>Might not be available in your workshop</em>)</li></ul><p><a href=#R-image-abd93d1f0a1c1e895bed19415f5b8c6f class=lightbox-link><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-Header.png alt=RUM-Header class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-abd93d1f0a1c1e895bed19415f5b8c6f><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-Header.png alt=RUM-Header class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h3 id=22-overview-pane>2.2. Overview Pane</h3><p>The Overview Panes, down the left hand side of the page, give you a summary of the pages which have increased load times.</p><p>In the example here you can see that the <strong>checkout</strong> and <strong>cart</strong> pages have errors due to the yellow triangles, and you can see that the load time has increased by 2.38 to 5.50 seconds.</p><p><a href=#R-image-bf29adb83a8cd8b967a3919fbdaf8ebd class=lightbox-link><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-Page-Load-Times.png alt=RUM-Top class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bf29adb83a8cd8b967a3919fbdaf8ebd><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-Page-Load-Times.png alt=RUM-Top class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You also see an overview of the number of Front end Error and Backend Errors per minute, and we appear to have three JavaScript errors on our site.</p><p><a href=#R-image-4d83c215af2437a59834cd02e967fc5b class=lightbox-link><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-JS-Errors.png alt=RUM-Top class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4d83c215af2437a59834cd02e967fc5b><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-JS-Errors.png alt=RUM-Top class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>The last two panes show you the <strong>Top Page Views</strong> and the <strong>Top Network Requests</strong>.</p><p><a href=#R-image-4cc0e6e85743518ac93919ac9f0ae7fa class=lightbox-link><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-Page-Views-Network.png alt=RUM-Top class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4cc0e6e85743518ac93919ac9f0ae7fa><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-Page-Views-Network.png alt=RUM-Top class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h3 id=23-key-metrics-pane>2.3. Key Metrics Pane</h3><p>The Key Metrics View is the location where you will find the metrics for the number of
<strong>JavaScript Errors</strong> per second, <strong>Network Errors</strong> per second an the <strong>Backend/Resource Request Duration</strong>.
These Metrics are very useful to guide you to the location of an issue if you are experiencing problems with your site.</p><p><a href=#R-image-0ed8fc0022eea8e6dd9f6586a7486f28 class=lightbox-link><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-Key-Metrics.png alt=RUM-KeyMetrics class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0ed8fc0022eea8e6dd9f6586a7486f28><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-Key-Metrics.png alt=RUM-KeyMetrics class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h3 id=24-web-vitals-pane>2.4. Web Vitals Pane</h3><p>The Web Vitals view is the location where you go if you wish to get insight into the experience you are delivering to your End users based on Web Vitals metrics.
Web Vitals is an initiative by Google to provide unified guidance for quality signals that are essential to delivering a great user experience on the web and focuses on three key parameters:</p><ul><li><strong>Largest Contentful Paint (LCP)</strong>, measures loading performance. To provide a good user experience, LCP should occur within 2.5 seconds of when the page first starts loading.</li><li><strong>First Input Delay (FID)</strong>, measures interactivity. To provide a good user experience, pages should have a FID of 100 milliseconds or less.</li><li><strong>Cumulative Layout Shift (CLS)</strong>, measures visual stability. To provide a good user experience, pages should maintain a CLS of 0.1. or less.</li></ul><p><a href=#R-image-999ab88c2ff47422f151d89d2b7ef92f class=lightbox-link><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-Web-Vitals.png alt=RUM-WebVitals class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-999ab88c2ff47422f151d89d2b7ef92f><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-Web-Vitals.png alt=RUM-WebVitals class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h3 id=25-other-metrics-pane>2.5. Other Metrics Pane</h3><p>The Other Metrics Pane is the location where you find other performance metrics, with a focus on initial load time of your page or tasks that are taking too long to complete.</p><ul><li><strong>Time To First Byte (TTFB)</strong>, measures how long it takes for a client&rsquo;s browser to receive the first byte of the response from the server. The longer it takes for the server to process the request and send a response, the slower your visitors&rsquo; browser is at displaying your page.</li><li><strong>Long Task Duration</strong>, a performance metric that can be used help developers to understand the bad user experience on the website, or can be an indication of a problem.</li><li><strong>Long Task Count</strong>, a metric to indicate how often a long task occurs, again used for exploring user experiences or problem detection.</li></ul><p><a href=#R-image-80d5f5bf7e006697c78c70642e62f6ac class=lightbox-link><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-Other.png alt=RUM-Other class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-80d5f5bf7e006697c78c70642e62f6ac><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-Other.png alt=RUM-Other class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h3 id=26-custom-event-pane>2.6. Custom Event Pane</h3><p>The Custom Event View is the location where you will find the metrics for any event you may have added yourself to the web pages you are monitoring.</p><p>As we have seen in the RUM enabled website, we have added the following two lines:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Provider</span> <span class=o>=</span> <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>provider</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>tracer</span><span class=o>=</span><span class=nx>Provider</span><span class=p>.</span><span class=nx>getTracer</span><span class=p>(</span><span class=s1>&#39;appModuleLoader&#39;</span><span class=p>);</span></span></span></code></pre></div><p>These lines will automatically create custom Events for every new Page, and you can also add these to pieces of custom code that are not part of a framework or an event you created so you can better understand the flow though your application. We support <strong>Custom Event Requests</strong>, <strong>Custom Event Error Rates</strong> and <strong>Custom Event Latency</strong> metrics.</p><p><a href=#R-image-4e7dfc709f3225be00113e7d0423f2b9 class=lightbox-link><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-Custom-Events.png alt=RUM-CustomMetrics class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4e7dfc709f3225be00113e7d0423f2b9><img src=../../en/other/rum/5-analyzing-metrics/../images/RUM-Custom-Events.png alt=RUM-CustomMetrics class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=6-analyzing-rum-tags-in-the-tag-spotlight-view>6. Analyzing RUM Tags in the Tag Spotlight view</h1><ul><li>Look into the Metrics views for the various endpoints and use the Tags sent via the Tag spotlight for deeper analysis</li></ul><hr><h2 id=1-find-an-url-for-the-cart-endpoint>1. Find an url for the Cart endpoint</h2><p>From the RUM Overview page, please select the url for the <strong>Cart</strong> endpoint to dive deeper into the information available for this endpoint.</p><p><a href=#R-image-c3323d5bfca32fb9afcdb2111bcb24f7 class=lightbox-link><img src=../../en/other/rum/6-tag-spotlight/../images/RUM-select-cart.png alt=RUM-Cart2 class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c3323d5bfca32fb9afcdb2111bcb24f7><img src=../../en/other/rum/6-tag-spotlight/../images/RUM-select-cart.png alt=RUM-Cart2 class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Once you have selected and clicked on the blue url, you will find yourself in the <strong>Tag Spotlight</strong> overview</p><p><a href=#R-image-0864e3d26c766c51f4263a017f9c6fa2 class=lightbox-link><img src=../../en/other/rum/6-tag-spotlight/../images/RUM-TAG-Overview.png alt=RUM-Tag class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0864e3d26c766c51f4263a017f9c6fa2><img src=../../en/other/rum/6-tag-spotlight/../images/RUM-TAG-Overview.png alt=RUM-Tag class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Here you will see all of the tags that have been sent to Splunk RUM as part of the RUM traces. The tags displayed will be relevant to the overview that you have selected. These are generic Tags created automatically when the Trace was sent, and additional Tags you have added to the trace as part of the configuration of your website.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Additional Tags</div><div class=box-content><p>We are already sending two additional tags, you have seen them defined in the <em>Beacon url</em> that was added to your website: <code>app: "[nodename]-store", environment: "[nodename]-workshop"</code> in the first section of this workshop! You can add additional tags in a similar way.</p></div></div><p>In our example we have selected the <strong>Document Load Latency</strong> view as shown here:</p><p><a href=#R-image-9ca23f705337482c6eaa3dda7ae04d4c class=lightbox-link><img src=../../en/other/rum/6-tag-spotlight/../images/RUM-Selection.png alt=RUM-Header class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9ca23f705337482c6eaa3dda7ae04d4c><img src=../../en/other/rum/6-tag-spotlight/../images/RUM-Selection.png alt=RUM-Header class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You can select any of the following Tag views, each focused on a specific metric.</p><p><a href=#R-image-f13fc9065448300c61d3da220995b90b class=lightbox-link><img src=../../en/other/rum/6-tag-spotlight/../images/RUM-Tag-views.png alt=RUM-views class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f13fc9065448300c61d3da220995b90b><img src=../../en/other/rum/6-tag-spotlight/../images/RUM-Tag-views.png alt=RUM-views class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><hr><h2 id=2-explore-the-information-in-the-tag-spotlight-view>2. Explore the information in the Tag Spotlight view</h2><p>The Tag spotlight is designed to help you identify problems, either through the chart view,, where you may quickly identify outliers or via the TAGs.</p><p>In the <strong>Document Load Latency</strong> view, if you look at the <strong>Browser</strong>, <strong>Browser Version</strong> & <strong>OS Name</strong> Tag views,you can see the various browser types and versions, as well as for the underlying OS.</p><p>This makes it easy to identify problems related to specific browser or OS versions, as they would be highlighted.</p><p><a href=#R-image-a28930a44adedcd247db17b100fd8529 class=lightbox-link><img src=../../en/other/rum/6-tag-spotlight/../images/RUMBrowserTags.png alt=RUM-Tag2 class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a28930a44adedcd247db17b100fd8529><img src=../../en/other/rum/6-tag-spotlight/../images/RUMBrowserTags.png alt=RUM-Tag2 class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>In the above example you can see that Firefox had the slowest response, various Browser versions ( Chrome) that have different response times and the slow response of the Android devices.</p><p>A further example are the regional Tags that you can use to identify problems related to ISP or locations etc. Here you should be able to find the location you have been using to access the Online Boutique. Drill down by selecting the town or country you are accessing the Online Boutique from by clicking on the name as shown below (City of Amsterdam):</p><p><a href=#R-image-388e0c17095c1bcc61a8291250e3bff8 class=lightbox-link><img src=../../en/other/rum/6-tag-spotlight/../images/RUM-Region.png alt=RUM-click class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-388e0c17095c1bcc61a8291250e3bff8><img src=../../en/other/rum/6-tag-spotlight/../images/RUM-Region.png alt=RUM-click class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>This will select only the traces relevant to the city selected as shown below:</p><p><a href=#R-image-9dc045c20f12e9725dfb328b6c07d869 class=lightbox-link><img src=../../en/other/rum/6-tag-spotlight/../images/RUM-Adam.png alt=RUM-Adam class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9dc045c20f12e9725dfb328b6c07d869><img src=../../en/other/rum/6-tag-spotlight/../images/RUM-Adam.png alt=RUM-Adam class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>By selecting the various Tag you build up a filter, you can see the current selection below</p><p><a href=#R-image-274563c28eacfe08e03046e94b633bbd class=lightbox-link><img src=../../en/other/rum/6-tag-spotlight/../images/RUM-Filter.png alt=RUM-Adam class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-274563c28eacfe08e03046e94b633bbd><img src=../../en/other/rum/6-tag-spotlight/../images/RUM-Filter.png alt=RUM-Adam class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>To clear the filter and see every trace click on <strong>Clear All</strong> at the top right of the page.</p><p>If the overview page is empty or shows <a href=#R-image-7a16a3524ff317744ed634659cefe79c class=lightbox-link><img src="../../en/other/rum/6-tag-spotlight/../images/RUM-NoTime.png?classes=inline&amp;height=25px" alt=RUM-Adam class="figure-image noborder inline lightbox noshadow" style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7a16a3524ff317744ed634659cefe79c><img src="../../en/other/rum/6-tag-spotlight/../images/RUM-NoTime.png?classes=inline&amp;height=25px" alt=RUM-Adam class="lightbox-image noborder inline lightbox noshadow" loading=lazy></a>, no traces have been received in the selected timeslot.
You need to increase the time window at the top left. You can start with the <em>Last 12 hours</em> for example.</p><p>You can then use your mouse to select the time slot you want like show in the view below and activate that time filter by clicking on the little spyglass icon.</p><p><a href=#R-image-0f2727473432f703fbfcb966a7b65f82 class=lightbox-link><img src=../../en/other/rum/6-tag-spotlight/../images/RUM-TimeSelect.png alt=RUM-time class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0f2727473432f703fbfcb966a7b65f82><img src=../../en/other/rum/6-tag-spotlight/../images/RUM-TimeSelect.png alt=RUM-time class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=7-analyzing-rum-sessions>7. Analyzing RUM Sessions</h1><ul><li>Dive into RUM Session information in the RUM UI</li><li>Identify Javascript errors in the Span of an user interaction</li></ul><hr><h2 id=1-again-select-the-cart-url>1. Again select the cart URL</h2><p>After you have focussed the time slot with the time selector, you need to reselect the <em>cart</em> url from <strong>Url Name</strong> view, as shown below:</p><p><a href=#R-image-862d592583e87f5edc67c2ee2f4dabe9 class=lightbox-link><img src=../../en/other/rum/7-rum-sessions/../images/RUM-Cart-All.png alt=RUM-Cart-3 class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-862d592583e87f5edc67c2ee2f4dabe9><img src=../../en/other/rum/7-rum-sessions/../images/RUM-Cart-All.png alt=RUM-Cart-3 class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>In the example above we selected <code>http://34.246.124.162:81/cart</code></p><h2 id=2-drill-down-in-the-sessions>2. Drill down in the Sessions</h2><p>After you have analyzed the information and drilled down via the Tag Spotlight to a subset of the traces, you can view the actual session as it was run by the end-user&rsquo;s browser.</p><p>You do this by clicking on the link <strong>Example Sessions</strong> as shown below:</p><p><a href=#R-image-4f393322912ff01c6eda5b501e503b5b class=lightbox-link><img src=../../en/other/rum/7-rum-sessions/../images/RUM-ExampleSessions.png alt=RUM-Header class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4f393322912ff01c6eda5b501e503b5b><img src=../../en/other/rum/7-rum-sessions/../images/RUM-ExampleSessions.png alt=RUM-Header class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>This will give you a list of sessions that matched both the time filter and the subset selected in the Tag Profile.</p><p>Select one by clicking on the session ID, It is a good idea to select one that has the longest duration (preferably over 700 ms).</p><p><a href=#R-image-54ed66f90429b5ae5514358b5ec35602 class=lightbox-link><img src=../../en/other/rum/7-rum-sessions/../images/RUM-Session-Selected.png alt=RUM-Header class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-54ed66f90429b5ae5514358b5ec35602><img src=../../en/other/rum/7-rum-sessions/../images/RUM-Session-Selected.png alt=RUM-Header class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Once you have selected the session, you will be taken to the session details page. As you are selecting a specific action that is part of the session, you will likely arrive somewhere in the middle of the session, at the moment of the interaction.</p><p>You can see the URL <code>http://34.246.124.162:81/cart</code>, the one you selected earlier, is where we are focusing on in the session stream.</p><p><a href=#R-image-e965c7156d54472a198feee9191c79a4 class=lightbox-link><img src=../../en/other/rum/7-rum-sessions/../images/Session-Tag.png alt=RUM-Session-Tag class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e965c7156d54472a198feee9191c79a4><img src=../../en/other/rum/7-rum-sessions/../images/Session-Tag.png alt=RUM-Session-Tag class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Scroll down a little bit on the page, so you see the end of the operation as shown below.</p><p><a href=#R-image-e5185572b253d8b0aaf48b7e1067e0c4 class=lightbox-link><img src=../../en/other/rum/7-rum-sessions/../images/Session-Tag-2.png alt=RUM-Session-info class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e5185572b253d8b0aaf48b7e1067e0c4><img src=../../en/other/rum/7-rum-sessions/../images/Session-Tag-2.png alt=RUM-Session-info class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You can see that we have received a few Javascript Console errors that may not have been detected or visible to the end users. To examine these in more detail click on the middle one that says: *<strong>Cannot read properties of undefined (reading &lsquo;Prcie&rsquo;)</strong></p><p><a href=#R-image-0325a7bba90986654497c3d464cc9f90 class=lightbox-link><img src=../../en/other/rum/7-rum-sessions/../images/Session-Tag-3.png alt=RUM-Session-info class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0325a7bba90986654497c3d464cc9f90><img src=../../en/other/rum/7-rum-sessions/../images/Session-Tag-3.png alt=RUM-Session-info class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>This will cause the page to expand and show the Span detail for this interaction, It will contain a detailed <em>error.stack</em> you can pass on the developer to solve the issue. You may have noticed when buying in the Online Boutique that the final total always was $0.00.</p><p><a href=#R-image-2d7a56d87eaede2748a845dca69c39fe class=lightbox-link><img src=../../en/other/rum/7-rum-sessions/../images/Session-Tag-4.png alt=RUM-Session-info class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2d7a56d87eaede2748a845dca69c39fe><img src=../../en/other/rum/7-rum-sessions/../images/Session-Tag-4.png alt=RUM-Session-info class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=8-correlate-between-splunk-rum-and-apm-backend-services>8. Correlate between Splunk RUM and APM backend services</h1><ul><li>Continue with the RUM Session information in the RUM UI</li><li>See correlated APM traces and logs in the APM & Log Observer UI</li></ul><hr><h2 id=1-finding-backend-service-issues>1. Finding backend service issues</h2><p>Click on the <a href=#R-image-e4b29d2a002fc464f1da15e7c5727a34 class=lightbox-link><img src="../../en/other/rum/8-apm-correlation/../images/RUM-JS-Error.png?classes=inline&amp;height=25px" alt=RUM-JS class="figure-image noborder inline lightbox noshadow" style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e4b29d2a002fc464f1da15e7c5727a34><img src="../../en/other/rum/8-apm-correlation/../images/RUM-JS-Error.png?classes=inline&amp;height=25px" alt=RUM-JS class="lightbox-image noborder inline lightbox noshadow" loading=lazy></a> to close the Span view.
Now continue to scroll down and find the <strong>POST /cart/checkout</strong> line.</p><p><a href=#R-image-87dc6d8c4f6d1004546ae3e6881da4c7 class=lightbox-link><img src=../../en/other/rum/8-apm-correlation/../images/RUM-APM-Click.png alt=RUM-APM-Click class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-87dc6d8c4f6d1004546ae3e6881da4c7><img src=../../en/other/rum/8-apm-correlation/../images/RUM-APM-Click.png alt=RUM-APM-Click class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Click on the blue <a href=#R-image-525ce0a15700493353676ebcd5dab1a0 class=lightbox-link><img src="../../en/other/rum/8-apm-correlation/../images/RUM-APM.png?classes=inline&amp;height=25px" alt=RUM-APM-BLUE class="figure-image noborder inline lightbox noshadow" style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-525ce0a15700493353676ebcd5dab1a0><img src="../../en/other/rum/8-apm-correlation/../images/RUM-APM.png?classes=inline&amp;height=25px" alt=RUM-APM-BLUE class="lightbox-image noborder inline lightbox noshadow" loading=lazy></a> link, this should pop up a dialog showing information on the backend services that were part of the checkout action taken by the end user.</p><p><a href=#R-image-01b0bd045258bcad6358d61e4e3696bd class=lightbox-link><img src=../../en/other/rum/8-apm-correlation/../images/RUM-Trace.png alt=RUM-APM-Trace class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-01b0bd045258bcad6358d61e4e3696bd><img src=../../en/other/rum/8-apm-correlation/../images/RUM-Trace.png alt=RUM-APM-Trace class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>In this popup, there are multiple sections available, providing you with a quick insight in the behavior of your backend services. For example the Performance Summary section will tell you where the time was spent during the backend call.</p><p><a href=#R-image-608af812efa4f38adfa738eda95f110e class=lightbox-link><img src=../../en/other/rum/8-apm-correlation/../images/RUM-Trace-Performance.png alt=RUM-APM-Trace-perf class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-608af812efa4f38adfa738eda95f110e><img src=../../en/other/rum/8-apm-correlation/../images/RUM-Trace-Performance.png alt=RUM-APM-Trace-perf class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>In the above example you can see that more than 77,9% was spent in external services.</p><p>If you scroll down to the bottom of the dialog, you can see the complete Trace and Services section like shown below:</p><p><a href=#R-image-5de51f2f7cf2ea078d6b1b892ef754ec class=lightbox-link><img src=../../en/other/rum/8-apm-correlation/../images/RUM-Trace-Services.png alt=RUM-APM-Trace-services class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5de51f2f7cf2ea078d6b1b892ef754ec><img src=../../en/other/rum/8-apm-correlation/../images/RUM-Trace-Services.png alt=RUM-APM-Trace-services class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>in the Services map, you can see two services flagged red, the <strong>Checkout</strong> Service and the <strong>Payment</strong> Service in both in dark red. Light red means it received an error and dark red means an error originated from that service.</p><p><a href=#R-image-32d6b94e87f9dcde9e4ff1b96b00a8c2 class=lightbox-link><img src=../../en/other/rum/8-apm-correlation/../images/RUM-Trace-Services-Detail.png alt=RUM-APM-Trace-services-detail class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-32d6b94e87f9dcde9e4ff1b96b00a8c2><img src=../../en/other/rum/8-apm-correlation/../images/RUM-Trace-Services-Detail.png alt=RUM-APM-Trace-services-detail class="lightbox-image noborder lightbox noshadow" loading=lazy></a>
So already it is obvious there is a problem in the back end services.</p><p>Let&rsquo;s investigate!</p><h2 id=2--follow-the-trace-to-the-backend-service>2. Follow the Trace to the Backend service</h2><p>You can now click on the Trace Id link:</p><p><a href=#R-image-e8e024cf9902a7340521f31d905315f4 class=lightbox-link><img src=../../en/other/rum/8-apm-correlation/../images/RUM-Trace-url.png alt=RUM-APM-Trace-link class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e8e024cf9902a7340521f31d905315f4><img src=../../en/other/rum/8-apm-correlation/../images/RUM-Trace-url.png alt=RUM-APM-Trace-link class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>This will bring you to the Waterfall APM view that will show you what occurred in detail in a call to the backend services.
On the right you see the Trace Id: and again the Performance Summary, as we saw before.
In the waterfall, you can identify the various backend services that were part of this call from the frontend.</p><p>As you can see there are red error indicators <a href=#R-image-a3059c573ece9ee0f44b7c8fdd23e5fa class=lightbox-link><img src="../../en/other/rum/8-apm-correlation/../images/APM_Error_Flag.png?classes=inline&amp;height=25px" alt=RUM-APM-error-flag class="figure-image noborder inline lightbox noshadow" style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a3059c573ece9ee0f44b7c8fdd23e5fa><img src="../../en/other/rum/8-apm-correlation/../images/APM_Error_Flag.png?classes=inline&amp;height=25px" alt=RUM-APM-error-flag class="lightbox-image noborder inline lightbox noshadow" loading=lazy></a> before the <strong>Checkout</strong> Service and the <strong>Payment</strong> Service.</p><p><a href=#R-image-910d867b3141cc318cd76e834ca8db6f class=lightbox-link><img src=../../en/other/rum/8-apm-correlation/../images/RUM-APM-Waterfall.png alt=RUM-APM-waterfall class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-910d867b3141cc318cd76e834ca8db6f><img src=../../en/other/rum/8-apm-correlation/../images/RUM-APM-Waterfall.png alt=RUM-APM-waterfall class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Click on the <a href=#R-image-afdef93db1d488787fd0ecb60a874646 class=lightbox-link><img src="../../en/other/rum/8-apm-correlation/../images/APM_Error_Flag.png?classes=inline&amp;height=25px" alt=RUM-APM-error-flag class="figure-image noborder inline lightbox noshadow" style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-afdef93db1d488787fd0ecb60a874646><img src="../../en/other/rum/8-apm-correlation/../images/APM_Error_Flag.png?classes=inline&amp;height=25px" alt=RUM-APM-error-flag class="lightbox-image noborder inline lightbox noshadow" loading=lazy></a> after the <strong>paymentservice: grpc.hipstershop.PaymentService/Charge</strong> line.</p><p><a href=#R-image-ef5ddff496c42283f09de0cbfcc9a79e class=lightbox-link><img src=../../en/other/rum/8-apm-correlation/../images/payment-click.png alt=RUM-payment-click class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ef5ddff496c42283f09de0cbfcc9a79e><img src=../../en/other/rum/8-apm-correlation/../images/payment-click.png alt=RUM-payment-click class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>This will open the span detail page to show you the detailed information about this service call.
You wil see that the call returned a <strong>401</strong> error code or <em>Invalid Request</em>.</p><h2 id=3--use-the-related-content---logs>3. Use the Related Content - Logs</h2><p>As the Splunk Observability cloud suite correlates trace metrics and logs automatically, the system will show you in the related content bar at the bottom of the page, the corresponding logs for this trace.</p><p><a href=#R-image-70304fe444684755f4f48e5b9464de61 class=lightbox-link><img src=../../en/other/rum/8-apm-correlation/../images/log-corelation.png alt=RUM-payment-related-content class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-70304fe444684755f4f48e5b9464de61><img src=../../en/other/rum/8-apm-correlation/../images/log-corelation.png alt=RUM-payment-related-content class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Click on the Log link to see the logs.</p><p>When the logs are shown, notice that the filter at the top of the page contains the logs for the trace.
Next select one of the lines indicating an error for the payment service.
This should open the log message on the right.</p><p>It clearly shows the reason why the payment service fails: we are using an invalid token towards the service:<br>*<strong>Failed payment processing through ButtercupPayments: Invalid API Token (test-20e26e90-356b-432e-a2c6-956fc03f5609)</strong></p><p><a href=#R-image-2f45f2428df59117b74d9e3df1aacad0 class=lightbox-link><img src=../../en/other/rum/8-apm-correlation/../images/RUM-LogObserver.png alt=RUM-logs class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2f45f2428df59117b74d9e3df1aacad0><img src=../../en/other/rum/8-apm-correlation/../images/RUM-LogObserver.png alt=RUM-logs class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=4--conclusion>4. Conclusion</h2><p>In the workshop, you have seen how to add RUM functionality to you website.
We investigate the performance of your Website using RUM Metrics.
Using the Tag profile, you have searched for your own session, and with the session waterfall, you identified two problems:</p><ul><li>A Java script error that caused your price calculation to be zero.</li><li>An issue in the payment backend service that caused payments to fail.</li></ul><p>Using the ability to correlate RUM traces with the Backend APM trace and Logs, you have found the reason for the payment failure.</p><p>This concludes the RUM workshop.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=9-custom-alerts-and-charts-based-on-rum-metrics>9. Custom alerts and charts based on RUM Metrics</h1><ul><li>Use RUM Metrics to set up Alerts to be warned in case of an issue</li><li>Create a Custom Chart based on RUM Metrics</li></ul><hr><h2 id=1--overview>1. Overview</h2><p>The fact that Splunk&rsquo;s RUM is designed as a full fidelity solution, and thus can take 100% of your traces, allows it to detect and alert you to any change to the behavior of your website. It also give you the ability to to give you accurate insight in how your website is behaving by allowing you to creating custom Chart and Dashboards.
This allows you to combine data from your Website, Backend service and underlying Infrastructure. Allowing you to observe the complete stack that makes up your application/solution.</p><p>Creating charts or alerts for RUM Metrics are done in the same way as we do for Infrastructure Metrics. In this section we will create a simple chart, detector and alert.</p><p>If you previously done the Splunk IM Part of the Workshop, you will find this section very familiar. If you have not done the Splunk IM workshop before, it is recommended that you run though the <a href=../../en/imt/dashboards/index.html>Dashboards</a> and <a href=../../en/imt/detectors/index.html>Detectors</a> modules after completing the RUM workshop to get a better understanding of the capabilities.</p><h2 id=2-create-an-alert-on-one-of-the-rum-metrics>2. Create an alert on one of the RUM Metrics</h2><p>From the top left hamburger menu icon click <strong>Alerts</strong> in the menu and then select <strong>Detectors</strong>.</p><h2 id=3-create-a-chart-based-on-rum-metrics>3. Create a Chart based on Rum Metrics</h2><h3 id=31-overview>3.1 Overview</h3><p>Creating charts or alerts for RUM Metrics are done in the same way as we do for Infrastructure Metrics.
In this section we will create a simple chart, detector and alert
If you previously done the Splunk IM Part of the Workshop, you will find this section very familiar.</p><p><a href=#R-image-57c755d02243408723c3906db459f428 class=lightbox-link><img src=../../en/other/rum/9-alerting/../images/RUM-select-cart.png alt=RUM-Cart2 class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-57c755d02243408723c3906db459f428><img src=../../en/other/rum/9-alerting/../images/RUM-select-cart.png alt=RUM-Cart2 class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>u have added to the trace as part of the configuration of your website.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Additional Tags</div><div class=box-content><p>We are already sending two additional tags, you have seen them defined in the <em>Beacon url</em> that was added to your website in the first section of this workshop! You can add additional tag in a similar way.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>app</span><span class=o>:</span> <span class=s2>&#34;[nodename]-store&#34;</span><span class=p>,</span> <span class=nx>environment</span><span class=o>:</span> <span class=s2>&#34;[nodename]-workshop&#34;</span></span></span></code></pre></div></div></div><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=splunk-synthetic-scripting>Splunk Synthetic Scripting</h1><p>Proactively monitor the performance of your web app before problems affect your users. With <strong>Splunk Synthetic Monitoring</strong>, technical and business teams create detailed tests to proactively monitor the speed and reliability of websites, web apps, and resources over time, at any stage in the development cycle.</p><p><strong>Splunk Synthetic Monitoring</strong> offers the most comprehensive and in-depth capabilities for uptime and web performance optimization as part of the only complete observability suite, Splunk Observability Cloud.</p><p>Easily set up monitoring for APIs, service endpoints and end-user-experience. With <strong>Splunk Synthetic Monitoring</strong>, go beyond basic uptime and performance monitoring and focus on proactively finding and fixing issues, optimizing web performance, and ensuring customers get the best user experience.</p><p>With <strong>Splunk Synthetic Monitoring</strong> you can:</p><ul><li>Detect and resolve issues fast across critical user flows, business transactions and API endpoints</li><li>Prevent web performance issues from affecting customers with an intelligence web optimization engine</li><li>And improve performance of all page resources and third-party dependencies</li></ul><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Splunk Synthetic Scripting</h1><article class=default><header class=headline></header><h1 id=1-real-browser-test>1. Real Browser Test</h1><h2 id=introduction>Introduction</h2><p>This workshop walks you through using the <a href=https://developer.chrome.com/docs/devtools/recorder/ target=_blank>Chrome DevTools Recorder</a> to create a synthetic transaction against a Splunk demonstration instance.</p><p>The exported JSON from the Chrome DevTools Recorder will then be used to create a Splunk Synthetic Monitoring Real Browser Test.</p><p>In addition, you will also get to learn other Splunk Synthetic Monitoring checks like <a href=https://docs.splunk.com/Observability/synthetics/api-test/api-test.html target=_blank>API Test</a> and <a href=https://docs.splunk.com/Observability/synthetics/uptime-test/uptime-test.html target=_blank>Uptime Test</a>.</p><h2 id=pre-requisites>Pre-requisites</h2><ul><li>Google Chrome Browser installed</li><li>Access to Splunk Observability Cloud</li></ul><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of 1. Real Browser Test</h1><article class=default><header class=headline></header><h1 id=11-recording-a-test>1.1 Recording a test</h1><h2 id=open-the-starting-url>Open the starting URL</h2><p>Open the starting URL for the workshop in Chrome. Click on the appropriate link below to open the site in a new tab.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>The starting URL for the workshop is different for <strong>EMEA</strong> and <strong>AMER/APAC</strong>. Please use the correct URL for your region.</p><div class=tab-panel data-tab-group=f954f581cdf55e8f8e2ff46e01d6db27><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=emea-workshop-url class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("f954f581cdf55e8f8e2ff46e01d6db27","emea-workshop-url")'>
<span class=tab-nav-text>EMEA Workshop URL</span></button>
<button data-tab-item=amerapac-workshop-url class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("f954f581cdf55e8f8e2ff46e01d6db27","amerapac-workshop-url")'>
<span class=tab-nav-text>AMER/APAC Workshop URL</span></button></div><div class=tab-content-container><div data-tab-item=emea-workshop-url class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p><a href=https://frontend-eu.o11ystore.com:81/ target=_blank>https://frontend-eu.o11ystore.com:81/</a></p></div></div><div data-tab-item=amerapac-workshop-url class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><a href=https://frontend-us.o11ystore.com:81/ target=_blank>https://frontend-us.o11ystore.com/:81/</a></p></div></div></div></div></div></div><h2 id=open-the-chrome-devtools-recorder>Open the Chrome DevTools Recorder</h2><p>Next, open the Developer Tools (in the new tab that was opened above) by pressing <code>Ctrl + Shift + I</code> on Windows or <code>Cmd + Option + I</code> on a Mac, then select <strong>Recorder</strong> from the top-level menu or the <strong>More tools</strong> flyout menu.</p><p><a href=#R-image-104ee7f091f2162a7baa1c64741a445c class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/open-recorder.png alt="Open Recorder" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-104ee7f091f2162a7baa1c64741a445c><img src=../../en/other/synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/open-recorder.png alt="Open Recorder" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>Site elements might change depending on viewport width. Before recording, set your browser window to the correct width for the test you want to create (Desktop, Tablet, or Mobile). Change the DevTools &ldquo;dock side&rdquo; to pop out as a separate window if it helps.</p></div></div><h2 id=create-a-new-recording>Create a new recording</h2><p>With the Recorder panel open in the DevTools window. Click on the
<span class="btn cstyle blue"><button type=button>
Create a new recording</button></span> button to start.</p><p><a href=#R-image-fe4c540a6075493979d878c75560b229 class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/recorder.png alt=Recorder class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fe4c540a6075493979d878c75560b229><img src=../../en/other/synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/recorder.png alt=Recorder class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>For the <strong>Recording Name</strong> use your initials to prefix the name of the recording e.g. <strong><code>&lt;your initials></code> - Online Boutique</strong>. Click on <strong>Start Recording</strong> to start recording your actions.</p><p><a href=#R-image-b8a394019c0d3fc5e42c98de86903400 class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/recording-name.png alt="Recording Name" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b8a394019c0d3fc5e42c98de86903400><img src=../../en/other/synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/recording-name.png alt="Recording Name" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Now that we are recording, complete the following actions on the site:</p><ul><li>Click on <strong>Vintage Camera Lens</strong></li><li>Click on <strong>Add to Cart</strong></li><li>Click on <strong>Place Order</strong></li><li>Click on <strong>End recording</strong> in the Recorder panel.</li></ul><p><a href=#R-image-1cf680f8354d49d86422333631f4d597 class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/end-recording.png alt="End Recording" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1cf680f8354d49d86422333631f4d597><img src=../../en/other/synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/end-recording.png alt="End Recording" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=exporting-the-recording>Exporting the recording</h2><p>Click on the <strong>Export</strong> button:</p><p><a href=#R-image-3fc2f85db3419b41b4172b9b4c84b3db class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/export-button.png alt="Export button" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-3fc2f85db3419b41b4172b9b4c84b3db><img src=../../en/other/synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/export-button.png alt="Export button" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Select <strong>JSON</strong> as the format, then click on <strong>Save</strong></p><p><a href=#R-image-09b83dfef68e0ea2cdb90dd76694029b class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/export-json.png alt="Export JSON" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-09b83dfef68e0ea2cdb90dd76694029b><img src=../../en/other/synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/export-json.png alt="Export JSON" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p><a href=#R-image-1e195c99947b25d7d8ccc9f47318ea0a class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/save-json.png alt="Save JSON" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1e195c99947b25d7d8ccc9f47318ea0a><img src=../../en/other/synthetics-scripting/1-real-browser-test/1-recording-a-test/../../img/save-json.png alt="Save JSON" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p><strong>Congratulations!</strong> You have successfully created a recording using the Chrome DevTools Recorder. Next, we will use this recording to create a Real Browser Test in Splunk Synthetic Monitoring.</p><hr><div class=expand><input type=checkbox id=R-expand-d30f7b1db636647adb453029f45d4d9c aria-controls=R-expandcontent-d30f7b1db636647adb453029f45d4d9c>
<label class=expand-label for=R-expand-d30f7b1db636647adb453029f45d4d9c><i class="fas fa-chevron-down"></i>
<i class="fas fa-chevron-right"></i>
Click here to view the JSON file</label><div id=R-expandcontent-d30f7b1db636647adb453029f45d4d9c class=expand-content><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;RWC - Online Boutique&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;steps&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;setViewport&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;width&#34;</span><span class=p>:</span> <span class=mi>1430</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;height&#34;</span><span class=p>:</span> <span class=mi>1016</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;deviceScaleFactor&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;isMobile&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;hasTouch&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;isLandscape&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;navigate&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://frontend-eu.o11ystore.com:81/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;assertedEvents&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;navigation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://frontend-eu.o11ystore.com:81/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Online Boutique&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;click&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;main&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;selectors&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;div:nth-of-type(2) &gt; div:nth-of-type(2) a &gt; div&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;xpath//html/body/main/div/div/div[2]/div[2]/div/a/div&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;pierce/div:nth-of-type(2) &gt; div:nth-of-type(2) a &gt; div&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetY&#34;</span><span class=p>:</span> <span class=mi>170</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetX&#34;</span><span class=p>:</span> <span class=mi>180</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;assertedEvents&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;navigation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;http://34.242.111.159:81/product/66VCHSJNUP&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;click&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;main&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;selectors&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;aria/ADD TO CART&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;xpath//html/body/main/div[1]/div/div[2]/div/form/div/button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;pierce/button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;text/Add to Cart&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetY&#34;</span><span class=p>:</span> <span class=mf>35.0078125</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetX&#34;</span><span class=p>:</span> <span class=mf>46.4140625</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;assertedEvents&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;navigation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;http://34.242.111.159:81/cart&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;click&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;main&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;selectors&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;aria/PLACE ORDER&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;div &gt; div &gt; div.py-3 button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;xpath//html/body/main/div/div/div[4]/div/form/div[4]/button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;pierce/div &gt; div &gt; div.py-3 button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;text/Place order&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetY&#34;</span><span class=p>:</span> <span class=mf>29.8125</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetX&#34;</span><span class=p>:</span> <span class=mf>66.8203125</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;assertedEvents&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;navigation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;http://34.242.111.159:81/cart/checkout&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=12-create-real-browser-test>1.2 Create Real Browser Test</h1><p>In Splunk Observability Cloud, navigate to <strong>Synthetics</strong> and click on
<span class="btn cstyle blue"><button type=button>
Add new test</button>
</span>.</p><p>From the dropdown select <strong>Browser test</strong>.</p><p><a href=#R-image-a9a8b0569500476154f5cf5f1952b712 class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/2-create-real-browser-test/../../img/add-new-test.png alt="Add new test" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a9a8b0569500476154f5cf5f1952b712><img src=../../en/other/synthetics-scripting/1-real-browser-test/2-create-real-browser-test/../../img/add-new-test.png alt="Add new test" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You will then be presented with the <strong>Browser test content</strong> configuration page.</p><p><a href=#R-image-113e2332765732874e240ebf0b8239de class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/2-create-real-browser-test/../../img/new-test.png alt="New Test" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-113e2332765732874e240ebf0b8239de><img src=../../en/other/synthetics-scripting/1-real-browser-test/2-create-real-browser-test/../../img/new-test.png alt="New Test" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=13-import-json>1.3 Import JSON</h1><p>To begin configuring our test, we need to import the JSON that we exported from the Chrome DevTools Recorder. To enable the
<span class="btn cstyle transparent"><button type=button>
<strong>Import</strong></button></span> button, we must first give our test a name e.g. <strong><code>&lt;your initials></code> - Online Boutique</strong>.</p><p><a href=#R-image-c69d6a6f11153a0680fb18e46e3b3aba class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/3-import-json/../../img/import.png alt=Import class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c69d6a6f11153a0680fb18e46e3b3aba><img src=../../en/other/synthetics-scripting/1-real-browser-test/3-import-json/../../img/import.png alt=Import class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Once the
<span class="btn cstyle transparent"><button type=button>
<strong>Import</strong></button></span> button is enabled, click on it and either drop the JSON file that you exported from the Chrome DevTools Recorder or upload the file.</p><p><a href=#R-image-9887cac469c8874f98625afa2525c69e class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/3-import-json/../../img/import-json.png alt="Import JSON" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9887cac469c8874f98625afa2525c69e><img src=../../en/other/synthetics-scripting/1-real-browser-test/3-import-json/../../img/import-json.png alt="Import JSON" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Once the JSON file has been uploaded, click on
<span class="btn cstyle blue"><button type=button>
Continue to edit steps</button></span></p><p><a href=#R-image-68f15eb5fd07dab9277c82d5ce5c8ced class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/3-import-json/../../img/import-complete.png alt="Import Complete" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-68f15eb5fd07dab9277c82d5ce5c8ced><img src=../../en/other/synthetics-scripting/1-real-browser-test/3-import-json/../../img/import-complete.png alt="Import Complete" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p><a href=#R-image-cacb3a440b0f8f014abffa97b192f2d7 class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/3-import-json/../../img/edit-steps.png alt="Edit Steps" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-cacb3a440b0f8f014abffa97b192f2d7><img src=../../en/other/synthetics-scripting/1-real-browser-test/3-import-json/../../img/edit-steps.png alt="Edit Steps" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Before we make any edits to the test, let&rsquo;s first configure the settings, click on
<span class="btn cstyle blue"><button type=button>
&lt; Return to test</button></span></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=14-settings>1.4 Settings</h1><p>The simple settings allow you to configure the basics of the test:</p><ul><li><strong>Name</strong>: The name of the test (e.g. RWC - Online Boutique).</li><li><strong>Details</strong>:<ul><li><strong>Locations</strong>: The locations where the test will run from.</li><li><strong>Device</strong>: Emulate different devices and connection speeds. Also, the viewport will be adjusted to match the chosen device.</li><li><strong>Frequency</strong>: How often the test will run.</li><li><strong>Round-robin</strong>: If multiple locations are selected, the test will run from one location at a time, rather than all locations at once.</li><li><strong>Active</strong>: Set the test to active or inactive.</li></ul></li></ul><p>![Return to Test]For this workshop, we will configure the locations that we wish to monitor from. Click in the <strong>Locations</strong> field and you will be presented with a list of global locations (over 50 in total).</p><p><a href=#R-image-d157a4498d2d80d19ac887dcec5ab29f class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/4-edit-test-settings/../../img/global-locations.png alt="Global Locations" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d157a4498d2d80d19ac887dcec5ab29f><img src=../../en/other/synthetics-scripting/1-real-browser-test/4-edit-test-settings/../../img/global-locations.png alt="Global Locations" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Select the following locations:</p><ul><li><strong>AWS - N. Virginia</strong></li><li><strong>AWS - London</strong></li><li><strong>AWS - Melbourne</strong></li></ul><p>Once complete, scroll down and click on Click on
<span class="btn cstyle blue"><button type=button>
Submit</button></span> to save the test.</p><p>The test will now be scheduled to run every 5 minutes from the 3 locations that we have selected. This does take a few minutes for the schedule to be created.</p><p>So whilst we wait for the test to be scheduled, click on
<span class="btn cstyle transparent"><button type=button>
Edit test</button></span> so we can go through the Advanced settings.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=15-advanced-settings>1.5 Advanced Settings</h1><p>Click on <strong>Advanced</strong>, these settings are optional and can be used to further configure the test.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>In the case of this workshop, we will <strong>not</strong> be using any of these settings as this is for informational purposes only.</p></div></div><p><a href=#R-image-04573b49da4ed0e401bbe4468e48a36b class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/5-advanced-settings/../../img/advanced-settings.png alt="Advanced Settings" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-04573b49da4ed0e401bbe4468e48a36b><img src=../../en/other/synthetics-scripting/1-real-browser-test/5-advanced-settings/../../img/advanced-settings.png alt="Advanced Settings" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><ul><li><strong>Security</strong>:<ul><li><strong>TLS/SSL validation</strong>: When activated, this feature is used to enforce the validation of expired, invalid hostname, or untrusted issuer on SSL/TLS certificates.</li><li><strong>Authentication</strong>: Add credentials to authenticate with sites that require additional security protocols, for example from within a corporate network. By using <a href=https://docs.splunk.com/Observability/synthetics/test-config/global-variables.html target=_blank>concealed global variables</a> in the Authentication field, you create an additional layer of security for your credentials and simplify the ability to share credentials across checks.</li></ul></li><li><strong>Custom Content</strong>:<ul><li><strong>Custom headers</strong>: Specify custom headers to send with each request. For example, you can add a header in your request to filter out requests from analytics on the back end by sending a specific header in the requests. You can also use custom headers to set cookies.</li><li><strong>Cookies</strong>: Set cookies in the browser before the test starts. For example, to prevent a popup modal from randomly appearing and interfering with your test, you can set cookies. Any cookies that are set will apply to the domain of the starting URL of the check. Splunk Synthetics Monitoring uses the public suffix list to determine the domain.</li><li><strong>Host overrides</strong>: Add host override rules to reroute requests from one host to another. For example, you can create a host override to test an existing production site against page resources loaded from a development site or a specific CDN edge node.</li></ul></li></ul><p>Next, we will edit the test steps to provide more meaningful names for each step.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=16-edit-test-steps>1.6 Edit test steps</h1><p>To edit the steps click on the
<span class="btn cstyle transparent"><button type=button>
+ Edit steps or synthetic transactions</button></span> button. From here, we are going to give meaningful names to each step.</p><p><a href=#R-image-239f006a6a8bfb1be4d58ea96161d537 class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/6-edit-steps/../../img/edit-steps.png alt="Edit steps" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-239f006a6a8bfb1be4d58ea96161d537><img src=../../en/other/synthetics-scripting/1-real-browser-test/6-edit-steps/../../img/edit-steps.png alt="Edit steps" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>For each of the four steps, we are going to give them a meaningful name.</p><ul><li><strong>Step 1</strong> replace the text <strong>Go to URL</strong> with <strong>HomePage - Online Boutique</strong></li><li><strong>Step 2</strong> enter the text <strong>Select Vintage Camera Lens</strong>.</li><li><strong>Step 3</strong> enter <strong>Add to Cart</strong>.</li><li><strong>Step 4</strong> enter <strong>Place Order</strong>.</li></ul><p><a href=#R-image-55f2e1047927f1215f1dcc8db4b72f25 class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/6-edit-steps/../../img/step-names.png alt="Step names" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-55f2e1047927f1215f1dcc8db4b72f25><img src=../../en/other/synthetics-scripting/1-real-browser-test/6-edit-steps/../../img/step-names.png alt="Step names" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Click
<span class="btn cstyle blue"><button type=button>
&lt; Return to test</button></span> to return to the test configuration page and click
<span class="btn cstyle blue"><button type=button>
Save</button></span> to save the test.</p><p>You will be returned to the test dashboard where you will see test results start to appear.</p><p><a href=#R-image-6313d5d9fa8cd64015c9cf02a77713d8 class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/6-edit-steps/../../img/scatterplot.png alt=Scatterplot class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6313d5d9fa8cd64015c9cf02a77713d8><img src=../../en/other/synthetics-scripting/1-real-browser-test/6-edit-steps/../../img/scatterplot.png alt=Scatterplot class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p><strong>Congratulations!</strong> You have successfully created a Real Browser Test in Splunk Synthetic Monitoring. Next, we will look into a test result in more detail.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=17-view-test-results>1.7 View test results</h1><p>In the Scatterplot from the previous step, click on one of the dots to drill into the test run data. Preferably, select the most recent test run (farthest to the right).</p><p><a href=#R-image-7617fac5005ea36fa98a86655f58afcb class=lightbox-link><img src=../../en/other/synthetics-scripting/1-real-browser-test/7-view-test-results/../../img/drilldown.png alt=Drilldown class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7617fac5005ea36fa98a86655f58afcb><img src=../../en/other/synthetics-scripting/1-real-browser-test/7-view-test-results/../../img/drilldown.png alt=Drilldown class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=api-test>API Test</h1><p>The API Test provides a flexible way to check the functionality and performance of API endpoints. The shift toward API-first development has magnified the necessity to monitor the back-end services that provide your core front-end functionality.</p><p>Whether you&rsquo;re interested in testing the multi-step API interactions or you want to gain visibility into the performance of your endpoints, the API Test can help you accomplish your goals.</p><p><a href=#R-image-99ac83696c92c3fbf7d65c399faec15f class=lightbox-link><img src=../../en/other/synthetics-scripting/2-api-test/../img/api-test-result.png alt="API test result" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-99ac83696c92c3fbf7d65c399faec15f><img src=../../en/other/synthetics-scripting/2-api-test/../img/api-test-result.png alt="API test result" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of API Test</h1><article class=default><header class=headline></header><h1 id=global-variables>Global Variables</h1><h2 id=global-variables>Global Variables</h2><p>View the global variable that we&rsquo;ll use to perform our API test. Click on <strong>Global Variables</strong> under the cog. The global variable named <code>env.encoded_auth</code> will be the one that we&rsquo;ll use to build the spotify API transaction.</p><p><a href=#R-image-a46b12daf2e2a5e60fb84b00cde19eca class=lightbox-link><img src=../../en/other/synthetics-scripting/2-api-test/1-global-varilables/../../img/global-variables.png alt=placeholder class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a46b12daf2e2a5e60fb84b00cde19eca><img src=../../en/other/synthetics-scripting/2-api-test/1-global-varilables/../../img/global-variables.png alt=placeholder class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=create-new-api-test>Create new API test</h1><h2 id=create-a-new-api-test>Create a new API test</h2><p>Create a new API test by clicking on the
<span class="btn cstyle blue"><button type=button>
Add new test</button></span> button and select <strong>API test</strong> from the dropdown. Name the test using <strong>your initials</strong> followed by <strong>Spotify API</strong> e.g. <strong>RWC - Spotify API</strong></p><p><a href=#R-image-41b3923cb5eb51368993e7499cec4f90 class=lightbox-link><img src=../../en/other/synthetics-scripting/2-api-test/2-create-new-check/../../img/new-api-check.png alt=placeholder class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-41b3923cb5eb51368993e7499cec4f90><img src=../../en/other/synthetics-scripting/2-api-test/2-create-new-check/../../img/new-api-check.png alt=placeholder class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=authentication-request>Authentication Request</h1><h2 id=add-authentication-request>Add Authentication Request</h2><p>Click on
<span class="btn cstyle transparent"><button type=button>
+ Add requests</button></span> and enter the request step name e.g. <strong>Authenticate with Spotify API</strong>.</p><p><a href=#R-image-8a6c46f4657039fbc84de347fea50b17 class=lightbox-link><img src=../../en/other/synthetics-scripting/2-api-test/3-authentication-request/../../img/add-request.png alt=placeholder class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8a6c46f4657039fbc84de347fea50b17><img src=../../en/other/synthetics-scripting/2-api-test/3-authentication-request/../../img/add-request.png alt=placeholder class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Expand the Request section, from the drop-down change the request method to <strong>POST</strong> and enter the following URL:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>https://accounts.spotify.com/api/token</span></span></code></pre></div><p>In the <strong>Payload body</strong> section enter the following:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>grant_type=client_credentials</span></span></code></pre></div><p>Next, add two request headers with the following key/value pairings:</p><ul><li><strong>CONTENT-TYPE: application/x-www-form-urlencoded</strong></li><li><strong>AUTHORIZATION: Basic {{env.encoded_auth}}</strong></li></ul><p>Expand the <strong>Validation</strong> section and add the following extraction:</p><ul><li><strong>Extract</strong> from <strong>Response body</strong> <strong>JSON</strong> <strong>$.access_token</strong> <strong>as</strong> <strong>access_token</strong>.</li></ul><p>This will parse the JSON payload that is received from the Spotify API, extract the access token and store it as a custom variable.</p><p><a href=#R-image-61cdf44c58a681f384c7964e92810955 class=lightbox-link><img src=../../en/other/synthetics-scripting/2-api-test/3-authentication-request/../../img/add-payload-token.png alt="Add payload token" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-61cdf44c58a681f384c7964e92810955><img src=../../en/other/synthetics-scripting/2-api-test/3-authentication-request/../../img/add-payload-token.png alt="Add payload token" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=search-request>Search Request</h1><h2 id=add-search-request>Add Search Request</h2><p>Click on
<span class="btn cstyle transparent"><button type=button>
+ Add Request</button></span> to add the next step. Name the step <strong>Search for Tracks named &ldquo;Up around the bend&rdquo;</strong>.</p><p>Expand the <strong>Request</strong> section and change the request method to <strong>GET</strong> and enter the following URL:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>https://api.spotify.com/v1/search?q=Up%20around%20the%20bend&amp;type=track&amp;offset=0&amp;limit=5</span></span></code></pre></div><p>Next, add two request headers with the following key/value pairings:</p><ul><li><strong>CONTENT-TYPE: application/json</strong></li><li><strong>AUTHORIZATION: Bearer {{custom.access_token}}</strong></li></ul><p><a href=#R-image-1869c4c59b124111b35bb59bff272534 class=lightbox-link><img src=../../en/other/synthetics-scripting/2-api-test/4-search-request/../../img/add-search-request.png alt="Add search request" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1869c4c59b124111b35bb59bff272534><img src=../../en/other/synthetics-scripting/2-api-test/4-search-request/../../img/add-search-request.png alt="Add search request" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Expand the <strong>Validation</strong> section and add the following extraction:</p><ul><li><strong>Extract</strong> from <strong>Response body</strong> <strong>JSON</strong> <strong>$.tracks.items[0].id</strong> <strong>as</strong> <strong>track.id</strong>.</li></ul><p><a href=#R-image-d1c4e4a20d895cce88fa4c683f771e3f class=lightbox-link><img src=../../en/other/synthetics-scripting/2-api-test/4-search-request/../../img/add-search-payload.png alt="Add search payload" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d1c4e4a20d895cce88fa4c683f771e3f><img src=../../en/other/synthetics-scripting/2-api-test/4-search-request/../../img/add-search-payload.png alt="Add search payload" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Click on
<span class="btn cstyle blue"><button type=button>
< Return to test</button></span> to return to the test configuration page. And then click
<span class="btn cstyle blue"><button type=button>
Save</button></span> to save the API test.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=view-results>View results</h1><h2 id=view-results>View results</h2><p>Wait for a few minutes for the test to provision and run. Once you see the test has run successfully, click on the run to view the test results:</p><p><a href=#R-image-8f32cec5d9b85528f9a5f9feea1e6adc class=lightbox-link><img src=../../en/other/synthetics-scripting/2-api-test/5-view-results/../../img/api-test-result.png alt="API test result" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8f32cec5d9b85528f9a5f9feea1e6adc><img src=../../en/other/synthetics-scripting/2-api-test/5-view-results/../../img/api-test-result.png alt="API test result" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=6-resources>6. Resources</h2><ul><li><p><a href=https://docs.splunk.com/Observability/synthetics/api-test/set-up-api-test.html target=_blank>How to Create an API Test</a></p></li><li><p><a href=https://docs.splunk.com/Observability/synthetics/api-test/api-test.html target=_blank>API Test Overview</a></p></li></ul><footer class=footline></footer></article></section></section><article class=default><header class=headline></header><h1 id=splunk-oncall>Splunk OnCall</h1><h2 id=aim>Aim</h2><p>This module is simply to ensure you have access to the Splunk On-Call UI (formerly known as VictorOps), Splunk Infrastructure Monitoring UI (formerly known as SignalFx) and the EC2 Instance which has been allocated to you.</p><p>Once you have access to each platform, keep them open for the duration of the workshop as you will be switching between them and the workshop instructions.</p><h2 id=1-activate-your-splunk-on-call-login>1. Activate your Splunk On-Call Login</h2><p>You should have received an invitation to Activate your Splunk On-Call account via e-mail, if you have not already done so, click the <em>Activate Account</em> link and follow the prompts.</p><p>If you did not receive an invitation it is probably because you already have a Splunk On-Call login, linked to a different organisation.</p><p>If so login to that Org, then use the organisation dropdown next to your username in the top left to switch to the Observability Workshop Org.</p><p><a href=#R-image-039cd1cff670c77b583ed7a1f98aca49 class=lightbox-link><img src=../../en/other/oncall/images/switch-org.png alt="Switch Org" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-039cd1cff670c77b583ed7a1f98aca49><img src=../../en/other/oncall/images/switch-org.png alt="Switch Org" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>If you do not see the Organisation dropdown menu item next to your name with Observability Workshop EMEA that is OK, it simply means you only have access to a single Org so that menu is not visible to you.</p><p>If you have forgotten your password go to the <a href=https://portal.victorops.com/membership/#/ target=_blank>https://portal.victorops.com/membership/#/</a> page and use the forgotten password link to reset your password.</p><p><a href=#R-image-52d0d531086b8e081d2c3bea2ce68e9d class=lightbox-link><img src=../../en/other/oncall/images/reset-password.png alt="Reset Pwd" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-52d0d531086b8e081d2c3bea2ce68e9d><img src=../../en/other/oncall/images/reset-password.png alt="Reset Pwd" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p></div></div><h2 id=2-activate-your-splunk-infrastructure-monitoring-login>2. Activate your Splunk Infrastructure Monitoring Login</h2><p>You should have received an invitation to join the Splunk Infrastructure Monitoring - Observability Workshop. If you have not already done so click the
<span class="btn cstyle transparent"><button type=button>
JOIN NOW</button></span> button and follow the prompts to set a password and activate your login.</p><h2 id=3-access-your-ec2-instance>3. Access your EC2 Instance</h2><p>Splunk has provided you with a dedicated EC2 Instance which you can use during this workshop for triggering Incidents the same way the instructor did during the introductory demo. This VM has Splunk Infrastructure Monitoring deployed and has an associated Detector configured. The Detector will pass Alerts to Splunk On-Call which will then create Incidents and page the on-call user.</p><p>The welcome e-mail you received providing you all the details for this Workshop contain the instructions for accessing your allocated EC2 Instance.</p><h3 id=ssh-mac-oslinux>SSH (Mac OS/Linux)</h3><p>Most attendees will be able to connect to the workshop by using SSH from their Mac or Linux device.</p><p>To use SSH, open a terminal on your system and type <code>ssh ubuntu@x.x.x.x</code> (replacing x.x.x.x with the IP address found in your welcome e-mail).</p><p><a href=#R-image-f9fb74f396442cbcd5933dd7abfa840b class=lightbox-link><img src=../../en/other/oncall/images/ssh-1.png alt="ssh login" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f9fb74f396442cbcd5933dd7abfa840b><img src=../../en/other/oncall/images/ssh-1.png alt="ssh login" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>When prompted <strong><code>Are you sure you want to continue connecting (yes/no/[fingerprint])?</code></strong> please type <strong><code>yes</code></strong>.</p><p><a href=#R-image-4baf9f82e6b05d555b8202796bc47a8a class=lightbox-link><img src=../../en/other/oncall/images/ssh-2.png alt="ssh password" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4baf9f82e6b05d555b8202796bc47a8a><img src=../../en/other/oncall/images/ssh-2.png alt="ssh password" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Enter the password provided in the welcome e-mail.</p><p>Upon successful login you will be presented with the Splunk logo and the Linux prompt.</p><p><a href=#R-image-b69735c89f76a50c6e5a499862cdb491 class=lightbox-link><img src=../../en/other/oncall/images/ssh-3.png alt="ssh connected" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b69735c89f76a50c6e5a499862cdb491><img src=../../en/other/oncall/images/ssh-3.png alt="ssh connected" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>At this point you are ready to <a href=../../en/other/oncall/getting_started/index.html>continue with the workshop</a> when instructed to do so by the instructor</p><hr><h3 id=putty-windows-users-only>Putty (Windows users only)</h3><p>If you do not have ssh pre-installed or if you are on a Windows system, the best option is to install putty, you can find the downloads <a href=https://www.putty.org/ target=_blank>here</a>.</p><p>!!! important
If you <strong>cannot</strong> install Putty, please go to <a href=../../en/other/oncall/index.html#web-browser-all>Web Browser (All)</a>.</p><p>Open Putty and in the <strong>Host Name (or IP address)</strong> field enter the IP address provided in the welcome e-mail.</p><p>You can optionally save your settings by providing a name and pressing <strong>Save</strong>.</p><p><a href=#R-image-2ab58a8e8ddce5c85bdd29b14ba716b5 class=lightbox-link><img src=../../en/other/oncall/images/putty-settings.png alt=putty-2 class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2ab58a8e8ddce5c85bdd29b14ba716b5><img src=../../en/other/oncall/images/putty-settings.png alt=putty-2 class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>To then login to your instance click on the <strong>Open</strong> button as shown above.</p><p>If this is the first time connecting to your EC2 instance, you will be presented with a security dialogue, please click <strong>Yes</strong>.</p><p><a href=#R-image-b7c605638ba4a3d9c7d8fe5e2a241e85 class=lightbox-link><img src=../../en/other/oncall/images/putty-security.png alt=putty-3 class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b7c605638ba4a3d9c7d8fe5e2a241e85><img src=../../en/other/oncall/images/putty-security.png alt=putty-3 class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Once connected, login in as <strong>ubuntu</strong> using the password provided in the welcome e-mail.</p><p>Once you are connected successfully you should see a screen similar to the one below:</p><p><a href=#R-image-9c71a733acbe356c0092855e21606abd class=lightbox-link><img src=../../en/other/oncall/images/putty-loggedin.png alt=putty-4 class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9c71a733acbe356c0092855e21606abd><img src=../../en/other/oncall/images/putty-loggedin.png alt=putty-4 class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>At this point you are ready to <a href=../../en/other/oncall/getting_started/index.html>continue with the workshop</a> when instructed to do so by the instructor</p><hr><h3 id=web-browser-all>Web Browser (All)</h3><p>If you are blocked from using SSH (Port 22) or unable to install Putty you may be able to connect to the workshop instance by using a web browser.</p><p>!!! note
This assumes that access to port 6501 is not restricted by your company&rsquo;s firewall.</p><p>Open your web browser and type <code>http://x.x.x.x:650</code> (where <code>x.x.x.x</code> is the IP address from the welcome e-mail).</p><p><a href=#R-image-b1bff5c058f493cfc25a25ec663fed71 class=lightbox-link><img src=../../en/other/oncall/images/shellinabox-url.png alt=http-6501 class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b1bff5c058f493cfc25a25ec663fed71><img src=../../en/other/oncall/images/shellinabox-url.png alt=http-6501 class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Once connected, login in as <strong>ubuntu</strong> and the password is the one provided in the welcome e-mail.</p><p><a href=#R-image-ac275a75ee4be4440bc2359cd2243399 class=lightbox-link><img src=../../en/other/oncall/images/shellinabox-connect.png alt=http-connect class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ac275a75ee4be4440bc2359cd2243399><img src=../../en/other/oncall/images/shellinabox-connect.png alt=http-connect class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Once you are connected successfully you should see a screen similar to the one below:</p><p><a href=#R-image-038b8ee99eb87c901afee4617ca70533 class=lightbox-link><img src=../../en/other/oncall/images/shellinabox-login.png alt="web login" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-038b8ee99eb87c901afee4617ca70533><img src=../../en/other/oncall/images/shellinabox-login.png alt="web login" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><hr><h3 id=copy--paste-in-browser>Copy & Paste in browser</h3><p>Unlike when you are using regular SSH, <em>copy and paste</em> does require a few extra steps to complete when using a browser session. This is due to cross browser restrictions.</p><p>When the workshop asks you to copy instructions into your terminal, please do the following:</p><p><em>Copy the instruction as normal, but when ready to paste it in the web terminal, choose <strong>Paste from browser</strong> as show below:</em></p><p><a href=#R-image-054822753e7f495cc9b87c74c22653d3 class=lightbox-link><img src=../../en/other/oncall/images/shellinabox-paste-browser.png alt="web paste 1" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-054822753e7f495cc9b87c74c22653d3><img src=../../en/other/oncall/images/shellinabox-paste-browser.png alt="web paste 1" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>This will open a dialogue box asking for the text to be pasted into the web terminal:</p><p><a href=#R-image-e6f20228098dc5dac845c65e8cc02cde class=lightbox-link><img src=../../en/other/oncall/images/shellinabox-example-1.png alt="web paste 3" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e6f20228098dc5dac845c65e8cc02cde><img src=../../en/other/oncall/images/shellinabox-example-1.png alt="web paste 3" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Paste the text in the text box as show, then press <strong>OK</strong> to complete the copy and paste process.</p><div class="box notices cstyle primary"><div class=box-label></div><div class=box-content><p>Unlike regular SSH connection, the web browser has a 60 second time out, and you will be disconnected, and a <strong>Connect</strong> button will be shown in the center of the web terminal.</p><p>Simply click the <strong>Connect</strong> button and you will be reconnected and will be able to continue.</p></div></div><p>At this point you are ready to <a href=../../en/other/oncall/getting_started/index.html>continue with the workshop</a> when instructed to do so by the instructor</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Splunk OnCall</h1><article class=default><header class=headline></header><h1 id=user-profile>User Profile</h1><h2 id=aim>Aim</h2><p>The aim of this module is for you to configure your personal profile which controls how you will be notified by Splunk On-Call whenever you get paged.</p><h2 id=1-contact-methods>1. Contact Methods</h2><p>Switch to the Splunk On-Call UI and click on your login name in the top right hand corner and chose <strong>Profile</strong> from the drop down. Confirm your contact methods are listed correctly and add any additional phone numbers and e-mail address you wish to use.</p><h2 id=2-mobile-devices>2. Mobile Devices</h2><p>To install the Splunk On-Call app for your smartphone search your phones App Store for Splunk On-Call to find the appropriate version of the app. The publisher should be listed as VictorOps Inc.</p><p><a href=https://apps.apple.com/us/app/victorops/id696974262 target=_blank>Apple Store</a></p><p><a href="https://play.google.com/store/apps/details?id=com.victorops.androidclient&amp;hl=en" target=_blank>Google Play</a></p><p>Configuration help guides are available:</p><ul><li><a href=https://help.victorops.com/knowledge-base/ios-application/ target=_blank>Apple</a></li><li><a href=https://help.victorops.com/knowledge-base/android-devices-victorops/ target=_blank>Android</a></li></ul><p>Install the App and login, then refresh the Profile page and your device should now be listed under the devices section. Click the <strong>Test push notification</strong> button and confirm you receive the test message.</p><h2 id=3-personal-calendar>3. Personal Calendar</h2><p>This link will enable you to sync your on-call schedule with your calendar, however as you do not have any allocated shifts yet this will currently be empty. You can add it to your calendar by copying the link into your preferred application and setting it up as a new subscription.</p><h2 id=4-paging-policies>4. Paging Policies</h2><p>Paging Polices specify how you will be contacted when on-call. The Primary Paging Policy will have defaulted to sending you an SMS assuming you added your phone number when activating your account. We will now configure this policy into a three tier multi-stage policy similar to the image below.</p><p><a href=#R-image-2702b31fa65328905879130cf747ed26 class=lightbox-link><img src=../../en/other/oncall/getting_started/../images/primary-paging-policy.png alt="Paging Policy" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2702b31fa65328905879130cf747ed26><img src=../../en/other/oncall/getting_started/../images/primary-paging-policy.png alt="Paging Policy" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h3 id=41-send-a-push-notification>4.1 Send a push notification</h3><p>Click the edit policy button in the top right corner for the Primary Paging Policy.</p><ul><li>Send a push notification to all my devices</li><li>Execute the next step if I have not responded within 5 minutes</li></ul><p><a href=#R-image-326600481bb78478cedff699c57e69c6 class=lightbox-link><img src=../../en/other/oncall/getting_started/../images/pri-page-step1.png alt="Step 1" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-326600481bb78478cedff699c57e69c6><img src=../../en/other/oncall/getting_started/../images/pri-page-step1.png alt="Step 1" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Click <strong>Add a Step</strong></p><h3 id=42-send-an-e-mail>4.2 Send an e-mail</h3><ul><li>Send an e-mail to [your email address]</li><li>Execute the next step if I have not responded within 5 minutes</li></ul><p><a href=#R-image-03395f7b598612b15eccd2dda9bbcc7d class=lightbox-link><img src=../../en/other/oncall/getting_started/../images/pri-page-step2.png alt="Step 2" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-03395f7b598612b15eccd2dda9bbcc7d><img src=../../en/other/oncall/getting_started/../images/pri-page-step2.png alt="Step 2" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Click <strong>Add a Step</strong></p><h3 id=43-call-your-number>4.3 Call your number</h3><ul><li>Every 5 minutes until we have reached you</li><li>Make a phone call to [your phone number]</li></ul><p>Click
<span class="btn cstyle default" style=--VARIABLE-BOX-color:#00bce4><button type=button>
Save</button></span> to save the policy.</p><p><a href=#R-image-c7978416dbc893e5458ea558ed21bad7 class=lightbox-link><img src=../../en/other/oncall/getting_started/../images/pri-page-step3.png alt="Step 3" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c7978416dbc893e5458ea558ed21bad7><img src=../../en/other/oncall/getting_started/../images/pri-page-step3.png alt="Step 3" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>When you are on-call or in the escalation path of an incident, you will receive notifications in this order following these time delays.</p><p>To cease the paging you must acknowledge the incident. Acknowledgements can occur in one of the following ways:</p><ul><li>Expanding the Push Notification on your device and selecting Acknowledge</li><li>Responding to the SMS with the 5 digit code included</li><li>Pressing 4 during the Phone Call</li><li>Slack Button</li></ul><p>For more information on Notification Types, see <a href=https://help.victorops.com/knowledge-base/notification-types/ target=_blank>here</a>.</p><h2 id=5-custom-paging-policies>5. Custom Paging Policies</h2><p>Custom paging polices enable you to override the primary policy based on the time and day of the week. A good example would be to get the system to immediately phone you whenever you get a page during the evening or weekends as this is more likely to get your attention than a push notification.</p><p>Create a new Custom Policy by clicking <strong>Add a Policy</strong> and configure with the following settings:</p><h3 id=51-custom-evening-policy>5.1 Custom evening policy</h3><p>Policy Name: Evening</p><ul><li>Every 5 minutes until we have reached you<ul><li>Make a phone call to [your phone number]</li><li>Time Period: All 7 Days</li><li>Time zone<ul><li>Between 7pm and 9am</li></ul></li></ul></li></ul><p><a href=#R-image-0952958aa3a152339e638d16963a838f class=lightbox-link><img src=../../en/other/oncall/getting_started/../images/evening.png alt=Evening class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0952958aa3a152339e638d16963a838f><img src=../../en/other/oncall/getting_started/../images/evening.png alt=Evening class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Click
<span class="btn cstyle default" style=--VARIABLE-BOX-color:#00bce4><button type=button>
Save</button></span> to save the policy then add one more.</p><h3 id=52-custom-weekend-policy>5.2 Custom weekend policy</h3><p>Policy Name: Weekend</p><ul><li>Every 5 minutes until we have reached you<ul><li>Make a phone call to [your phone number]</li><li>Time Period: Sat & Sun</li><li>Time zone<ul><li>Between 9am and 7pm</li></ul></li></ul></li></ul><p>Click
<span class="btn cstyle default" style=--VARIABLE-BOX-color:#00bce4><button type=button>
Save</button></span> to save the policy.</p><p><a href=#R-image-87d521ae4d5f153927b79b2b5d923e38 class=lightbox-link><img src=../../en/other/oncall/getting_started/../images/weekends.png alt=Weekends class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-87d521ae4d5f153927b79b2b5d923e38><img src=../../en/other/oncall/getting_started/../images/weekends.png alt=Weekends class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>These custom paging policies will be used during the specified times in place of the Primary Policy. However, admins do have the ability to ignore these custom policies, and we will highlight how this is achieved in a later module.</p><p>The final option here is the setting for Recovery Notifications. These are typically low priority, will default to Push, but can also be email, sms or phone call. Your profile is now fully configured using these example configurations.</p><p>Organizations will have different views on how profiles should be configured and will typically issue guidelines for paging policies and times between escalations etc.</p><p>Please wait for the instructor before proceeding to the Teams module.</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of User Profile</h1><article class=default><header class=headline></header><h1 id=teams>Teams</h1><h2 id=aim>Aim</h2><p>The aim of this module is for you to complete the first step of Team configuration by adding users to your Team.</p><h2 id=1-find-your-team>1. Find your Team</h2><p>Navigate to the <strong>Teams</strong> tab on the main toolbar, you should find you that a Team has been created for you as part of the workshop pre-setup and you would have been informed of your Team Name via e-mail.</p><p>If you have found your pre-configured Team, <strong>skip Step 2.</strong> and proceed to <strong><a href=../../en/other/oncall/getting_started/team/index.html#3-configure-your-team>Step 3. Configure Your Team</a></strong>. However, if you cannot find your allocated Team, you will need to create a new one, so proceed with <strong>Step 2. Create Team</strong></p><h2 id=2-create-team>2. Create Team</h2><p>Only complete this step if you <strong>cannot</strong> find your pre-allocated Team as detailed in your workshop e-mail. Select <strong>Add Team</strong>, then enter your allocated team name, this will typically be in the format of &ldquo;AttendeeID Workshop&rdquo; and then save by clicking the <strong>Add Team</strong> button.</p><h2 id=3-configure-your-team>3. Configure Your Team</h2><p>You now need to add other users to your team. If you are running this workshop using the Splunk provided environment, the following accounts are available for testing. If you are running this lab in your own environment, you will have been provided a list of usernames you can use in place of the table below.</p><p>These users are dummy accounts who will not receive notifications when they are on call.</p><table><thead><tr><th>Name</th><th>Username</th><th>Shift</th></tr></thead><tbody><tr><td>Duane Chow</td><td>duanechow</td><td>Europe</td></tr><tr><td>Steven Gomez</td><td>gomez</td><td>Europe</td></tr><tr><td>Walter White</td><td>heisenberg</td><td>Europe</td></tr><tr><td>Jim Halpert</td><td>jimhalpert</td><td>Asia</td></tr><tr><td>Lydia Rodarte-Quayle</td><td>lydia</td><td>Asia</td></tr><tr><td>Marie Schrader</td><td>marie</td><td>Asia</td></tr><tr><td>Maximo Arciniega</td><td>maximo</td><td>West Coast</td></tr><tr><td>Michael Scott</td><td>michaelscott</td><td>West Coast</td></tr><tr><td>Tuco Salamanca</td><td>tuco</td><td>West Coast</td></tr><tr><td>Jack Welker</td><td>jackwelker</td><td>24/7</td></tr><tr><td>Hank Schrader</td><td>hank</td><td>24/7</td></tr><tr><td>Pam Beesly</td><td>pambeesly</td><td>24/7</td></tr></tbody></table><p>Add the users to your team, using either the above list or the alternate one provided to you. The value in the <strong>Shift</strong> column can be ignored for now, but will be required for a later step.</p><p>Click
<span class="btn cstyle default" style=--VARIABLE-BOX-color:#00bce4><button type=button>
Invite User</button></span> button on the right hand side, then either start typing the usernames (this will filter the list), or copy and paste them into the dialogue box. Once all users are added to the list click the <strong>Add User</strong> button.</p><p><a href=#R-image-71899b9da0ff956466a6628341908fed class=lightbox-link><img src=../../en/other/oncall/getting_started/team/../../images/add-team-members.png alt="Add Team Members" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-71899b9da0ff956466a6628341908fed><img src=../../en/other/oncall/getting_started/team/../../images/add-team-members.png alt="Add Team Members" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>To make a team member a Team Admin, simply click the :fontawesome-regular-edit: icon in the right hand column, pick any user and make them an Admin.</p><p><a href=#R-image-0d24104a42c41a72942e7abab6a496f8 class=lightbox-link><img src=../../en/other/oncall/getting_started/team/../../images/team-admin.png alt="Add Admin" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0d24104a42c41a72942e7abab6a496f8><img src=../../en/other/oncall/getting_started/team/../../images/team-admin.png alt="Add Admin" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><div class="box notices cstyle default" style=--VARIABLE-BOX-color:info><div class=box-label>Tip</div><div class=box-content><p>For large team management you can use the APIs to streamline this process.</p></div></div><p>Continue and also complete the <a href=../../en/other/oncall/getting_started/rotations/index.html>Configure Rotations</a> module.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=configure-rotations>Configure Rotations</h1><h2 id=aim>Aim</h2><p>A rotation is a recurring schedule, that consists of one or more shifts, with members who rotate through a shift.</p><p>The aim of this module is for you to configure two example Rotations, and assign Team Members to the Rotations.</p><hr><p>Navigate to the <strong>Rotations</strong> tab on the <strong>Teams</strong> sub menu, you should have no existing Rotations so we need to create some.</p><p>The 1st Rotation you will create is for a follow the sun support pattern where the members of each shift provide cover during their normal working hours within their time zone.</p><p>The 2nd will be a Rotation used to provide escalation support by more experienced senior members of the team, based on a 24/7, 1 week shift pattern.</p><h2 id=1-follow-the-sun-support---business-hours>1. Follow the Sun Support - Business Hours</h2><p>Click <strong>Add Rotation</strong></p><p><a href=#R-image-65a880df10f7bae028c1fdad07be288f class=lightbox-link><img src=../../en/other/oncall/getting_started/rotations/../../images/add-rotation.png alt="Add Rotation" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-65a880df10f7bae028c1fdad07be288f><img src=../../en/other/oncall/getting_started/rotations/../../images/add-rotation.png alt="Add Rotation" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Enter a name of &ldquo;<em>Follow the Sun Support - Business Hours</em>&rdquo; and Select <strong>Partial day</strong> from the three available shift templates.</p><p><a href=#R-image-6ac720318fa51bde3e7f2ebbd1b91940 class=lightbox-link><img src=../../en/other/oncall/getting_started/rotations/../../images/follow-the-sun.png alt="Follow the Sun" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6ac720318fa51bde3e7f2ebbd1b91940><img src=../../en/other/oncall/getting_started/rotations/../../images/follow-the-sun.png alt="Follow the Sun" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><ul><li>Enter a Shift name of &ldquo;<em>Asia</em>&rdquo;</li><li>Time Zone set to &ldquo;<em>Asia/Tokyo</em>&rdquo;</li><li>Each user is on duty from &ldquo;<em>Monday through Friday from 9.00am to 5.00pm</em>&rdquo;</li><li>Handoff happens every &ldquo;<em>5 days</em>&rdquo;</li><li>The next handoff happens - Select the next Monday using the calendar</li><li>Click <strong>Save Rotation</strong></li></ul><p><a href=#R-image-70503d0f2eb7b208c05f5cfc7a2a23b0 class=lightbox-link><img src=../../en/other/oncall/getting_started/rotations/../../images/asia-shift.png alt="Asia Shift" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-70503d0f2eb7b208c05f5cfc7a2a23b0><img src=../../en/other/oncall/getting_started/rotations/../../images/asia-shift.png alt="Asia Shift" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You will now be prompted to add Members to this shift; add the Asia members who are <strong>Jim Halpert, Lydie Rodarte-Quayle and Marie Schrader</strong>, but only if you&rsquo;re using the Splunk provided environment for this workshop.</p><p>If you&rsquo;re using your own Organisation refer to the specific list provided separately.</p><p><a href=#R-image-83523e2cf77f3fa5b90567b16f82ba3d class=lightbox-link><img src=../../en/other/oncall/getting_started/rotations/../../images/asia-members.png alt="Asia Members" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-83523e2cf77f3fa5b90567b16f82ba3d><img src=../../en/other/oncall/getting_started/rotations/../../images/asia-members.png alt="Asia Members" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Now add an 2nd shift for Europe by again clicking <strong>+Add a shift → Partial Day</strong></p><ul><li>Enter a Shift name of &ldquo;<em>Europe</em>&rdquo;</li><li>Time Zone set to &ldquo;<em>Europe/London</em>&rdquo;</li><li>Each user is on duty from &ldquo;<em>Monday through Friday from 9.00am to 5.00pm</em>&rdquo;</li><li>Handoff happens every &ldquo;<em>5 days</em>&rdquo;</li><li>The next handoff happens - Select the next Monday using the calendar</li><li>Click <strong>Save Shift</strong></li></ul><p><a href=#R-image-dfbbc29186f93389ebe79df890ec86c0 class=lightbox-link><img src=../../en/other/oncall/getting_started/rotations/../../images/europe-shift.png alt="Europe Shift" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-dfbbc29186f93389ebe79df890ec86c0><img src=../../en/other/oncall/getting_started/rotations/../../images/europe-shift.png alt="Europe Shift" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You will again be prompted to add Members to this shift; add the Europe members who are <strong>Duane Chow, Steven Gomez and Walter White</strong>, but only if you&rsquo;re using the Observability Workshop Org for this workshop.</p><p>If you&rsquo;re using your own Organisation refer to the specific list provided separately.</p><p><a href=#R-image-591650089617d501b27b17b4a8669c27 class=lightbox-link><img src=../../en/other/oncall/getting_started/rotations/../../images/europe-members.png alt="Europe Members" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-591650089617d501b27b17b4a8669c27><img src=../../en/other/oncall/getting_started/rotations/../../images/europe-members.png alt="Europe Members" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Now add a 3rd shift for West Coast USA by again clicking <code>+Add a shift</code> - <code>Partial Day</code></p><ul><li>Enter a Shift name of &ldquo;<em>West Coast</em>&rdquo;</li><li>Time Zone set to &ldquo;<em>US/Pacific</em>&rdquo;</li><li>Each user is on duty from &ldquo;<em>Monday through Friday from 9.00am to 5.00pm</em>&rdquo;</li><li>Handoff happens every &ldquo;<em>5 days</em>&rdquo;</li><li>The next handoff happens - Select the next Monday using the calendar</li><li>Click <strong>Save Shift</strong></li></ul><p><a href=#R-image-346799dd2e0faf34af75530f2f9e67f4 class=lightbox-link><img src=../../en/other/oncall/getting_started/rotations/../../images/west-coast-shift.png alt="West Coast Shift" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-346799dd2e0faf34af75530f2f9e67f4><img src=../../en/other/oncall/getting_started/rotations/../../images/west-coast-shift.png alt="West Coast Shift" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You will again be prompted to add Members to this shift; add the West Coast members who are <strong>Maximo Arciniega, Michael Scott and Tuco Salamanca</strong>, but only if you&rsquo;re using the Observability Workshop Org for this workshop.</p><p>If you&rsquo;re using your own Organisation refer to the specific list provided separately.</p><p><a href=#R-image-7337ffeb1766bcc138385a8c764c3742 class=lightbox-link><img src=../../en/other/oncall/getting_started/rotations/../../images/west-coast-members.png alt="West Coast Members" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7337ffeb1766bcc138385a8c764c3742><img src=../../en/other/oncall/getting_started/rotations/../../images/west-coast-members.png alt="West Coast Members" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>The first user added will be the &lsquo;current&rsquo; user for that shift.</p><p>You can re-order the shifts by simply dragging the users up and down, and you can change the current user by clicking <code>Set Current</code> on an alternate user</p><p>You will now have three different Shift patterns, that provide cover 24hr hours, Mon - Fri, but with no cover at weekends.</p><p>We will now add another Rotation for our Senior SRE Escalation cover.</p><hr><h2 id=2-senior-sre-escalation>2. Senior SRE Escalation</h2><ul><li>Click <strong>Add Rotation</strong></li><li>Enter a name of &ldquo;<em>Senior SRE Escalation</em>&rdquo;</li><li>Select <code>24/7</code> from the three available shift templates</li><li>Enter a Shift name of &ldquo;<em>Senior SRE Escalation</em>&rdquo;</li><li>Time Zone set to &ldquo;<em>Asia/Tokyo</em>&rdquo;</li><li>Handoff happens every &ldquo;<em>7 days at 9.00am</em>&rdquo;</li><li>The next handoff happens [select the next Monday from the date picker]</li><li>Click <strong>Save Rotation</strong></li></ul><p><a href=#R-image-bc22b316564e12380db6c58428eea6b6 class=lightbox-link><img src=../../en/other/oncall/getting_started/rotations/../../images/24-7-shift.png alt="24/7 Shift" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bc22b316564e12380db6c58428eea6b6><img src=../../en/other/oncall/getting_started/rotations/../../images/24-7-shift.png alt="24/7 Shift" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You will again be prompted to add Members to this shift; add the 24/7 members who are <strong>Jack Welker, Hank Schrader and Pam Beesly</strong>, but only if you&rsquo;re using the Observability Workshop Org for this workshop.</p><p>If you&rsquo;re using your own Organisation refer to the specific list provided separately.</p><p><a href=#R-image-044460c1b6b92f3a0413f091af72e61e class=lightbox-link><img src=../../en/other/oncall/getting_started/rotations/../../images/24-7-members.png alt="24/7 Members" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-044460c1b6b92f3a0413f091af72e61e><img src=../../en/other/oncall/getting_started/rotations/../../images/24-7-members.png alt="24/7 Members" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><hr><p>Please wait for the instructor before proceeding to the Configuring Escalation Policies module.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=configure-escalation-policies>Configure Escalation Policies</h1><h2 id=aim>Aim</h2><p>Escalation policies determine who is actually on-call for a given team and are the link to utilizing any rotations that have been created.</p><p>The aim of this module is for you to create three different Escalation Policies to demonstrate a number of different features and operating models.</p><p>The instructor will start by explaining the concepts before you proceed with the configuration.</p><hr><p>Navigate to the Escalation Polices tab on the Teams sub menu, you should have no existing Polices so we need to create some.</p><p><a href=#R-image-886488e3a4463c5d6979c929a923a6c1 class=lightbox-link><img src=../../en/other/oncall/getting_started/escalation/../../images/no-escalation.png alt="No Escalation Policies" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-886488e3a4463c5d6979c929a923a6c1><img src=../../en/other/oncall/getting_started/escalation/../../images/no-escalation.png alt="No Escalation Policies" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>We are going to create the following Polices to cover off three typical use cases.</p><p><a href=#R-image-3c4e5fecab6525063a2be3982e93b52b class=lightbox-link><img src=../../en/other/oncall/getting_started/escalation/../../images/escalation-policies.png alt="Escalation Policies" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-3c4e5fecab6525063a2be3982e93b52b><img src=../../en/other/oncall/getting_started/escalation/../../images/escalation-policies.png alt="Escalation Policies" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=1-247-policy>1. 24/7 Policy</h2><p>Click <strong>Add Escalation Policy</strong></p><ul><li>Policy Name: 24/7</li><li>Step 1</li><li>Immediately<ul><li>Notify the on-duty user(s) in rotation → Senior SRE Escalation</li><li>Click <strong>Save</strong></li></ul></li></ul><p><a href=#R-image-13cd17949c20aab732b7442bcf30f469 class=lightbox-link><img src=../../en/other/oncall/getting_started/escalation/../../images/24-7-escalation-policy.png alt="24/7 Escalation Policy " class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-13cd17949c20aab732b7442bcf30f469><img src=../../en/other/oncall/getting_started/escalation/../../images/24-7-escalation-policy.png alt="24/7 Escalation Policy " class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=2-primary-policy>2. Primary Policy</h2><p>Click <strong>Add Escalation Policy</strong></p><ul><li>Policy Name: Primary</li><li>Step 1</li><li>Immediately</li><li>Notify the on-duty user(s) in rotation → Follow the Sun Support - Business Hours</li><li>Click <strong>Add Step</strong></li></ul><p><a href=#R-image-d1f1e2cb8dcb59efab46688660b539c2 class=lightbox-link><img src=../../en/other/oncall/getting_started/escalation/../../images/pri-escalation-policy-step-1.png alt="Pri Escalation Policy Step 1" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d1f1e2cb8dcb59efab46688660b539c2><img src=../../en/other/oncall/getting_started/escalation/../../images/pri-escalation-policy-step-1.png alt="Pri Escalation Policy Step 1" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><ul><li>Step 2</li><li>If still un-acknowledged after 15 minutes</li><li>Notify the next user(s) in the current on-duty shift → Follow the Sun Support - Business Hours</li><li>Click <strong>Add Step</strong></li></ul><p><a href=#R-image-a208fc3bfc4502f0508c18115c1ca171 class=lightbox-link><img src=../../en/other/oncall/getting_started/escalation/../../images/pri-escalation-policy-step-2.png alt="Pri Escalation Policy Step 2" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a208fc3bfc4502f0508c18115c1ca171><img src=../../en/other/oncall/getting_started/escalation/../../images/pri-escalation-policy-step-2.png alt="Pri Escalation Policy Step 2" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><ul><li>Step 3</li><li>If still un-acknowledged after 15 more minutes</li><li>Execute Policy → [Your Team Name] : 24/7</li><li>Click <strong>Save</strong></li></ul><p><a href=#R-image-874322b69144bb6d07a5d28baee7195a class=lightbox-link><img src=../../en/other/oncall/getting_started/escalation/../../images/pri-escalation-policy-step-3.png alt="Pri Escalation Policy Step 3" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-874322b69144bb6d07a5d28baee7195a><img src=../../en/other/oncall/getting_started/escalation/../../images/pri-escalation-policy-step-3.png alt="Pri Escalation Policy Step 3" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=3-waiting-room-policy>3. Waiting Room Policy</h2><p>Click <strong>Add Escalation Policy</strong></p><ul><li>Policy Name: Waiting Room</li><li>Step 1</li><li>If still un-acknowledged after 10 more minutes</li><li>Execute Policy → [Your Team Name] : Primary</li><li>Click <strong>Save</strong></li></ul><p><a href=#R-image-21c110c5d08a822b37b26844d2ffef73 class=lightbox-link><img src=../../en/other/oncall/getting_started/escalation/../../images/wr-escalation-policy.png alt="WR Escalation Policy" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-21c110c5d08a822b37b26844d2ffef73><img src=../../en/other/oncall/getting_started/escalation/../../images/wr-escalation-policy.png alt="WR Escalation Policy" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You should now have the following three escalation polices:</p><p><a href=#R-image-6de82cf572582276567bf1aea9f724a7 class=lightbox-link><img src=../../en/other/oncall/getting_started/escalation/../../images/escalation-policies.png alt="Escalation Policies" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6de82cf572582276567bf1aea9f724a7><img src=../../en/other/oncall/getting_started/escalation/../../images/escalation-policies.png alt="Escalation Policies" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You may have noticed that when we created each policy there was the following warning message:</p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div><div class=box-content><p>There are no routing keys for this policy - it will only receive incidents via manual reroute or when on another escalation policy</p></div></div><p>This is because there are no Routing Keys linked to these Escalation Polices, so now that we have these polices configured we can create the Routing Keys and link them to our Polices..</p><hr><p>Continue and also complete the <a href=../../en/other/oncall/getting_started/routing/index.html>Creating Routing Keys</a> module.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=creating-routing-keys>Creating Routing Keys</h1><h2 id=aim>Aim</h2><p>Routing Keys map the incoming alert messages from your monitoring system to an Escalation Policy which in turn sends the notifications to the appropriate team.</p><p>Note that routing keys are case insensitive and should only be composed of letters, numbers, hyphens, and underscores.</p><p>The aim of this module is for you to create some routing keys and then link them to your Escalation Policies you have created in the previous exercise.</p><hr><h2 id=1-instance-id>1. Instance ID</h2><p>Each participant requires a unique Routing Key so we use the Hostname of the EC2 Instance you were allocated. We are only doing this to ensure your Routing Key is unique and we know all Hostnames are unique. In a production deployment the Routing Key would typically reflect the name of a System or Service being monitored, or a Team such as 1st Line Support etc.</p><p>Your welcome e-mail informed you of the details of your EC2 Instance that has been provided for you to use during this workshop and you should have logged into this as part of the 1st exercise.</p><p>The e-mail also contained the Hostname of the Instance, but you can also obtain it from the Instance directly. To get your Hostname from within the shell session connected to your Instance run the following command:</p><div class=tab-panel data-tab-group=f39eeae6cc0b34342ba26577d4e5ff07><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=export-hostname class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("f39eeae6cc0b34342ba26577d4e5ff07","export-hostname")'>
<span class=tab-nav-text>Export Hostname</span></button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("f39eeae6cc0b34342ba26577d4e5ff07","example-output")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=export-hostname class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=si>${</span><span class=nv>HOSTNAME</span><span class=si>}</span></span></span></code></pre></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>zevn</span></span></code></pre></div></div></div></div></div><p>It is very important that when creating the Routing Keys you use the 4 letter hostname allocated to you as a Detector has been configured within Splunk Infrastructure Monitoring using this hostname, so any deviation will cause future exercises to fail.</p><h2 id=2-create-routing-keys>2 Create Routing Keys</h2><p>Navigate to <strong>Settings</strong> on the main menu bar, you should now be at the <strong>Routing Keys</strong> page.</p><p>You are going to create the following two Routing Keys using the naming conventions listed in the following table, but replacing {==HOSTNAME==} with the value from above and replace <strong><code>TEAM_NAME</code></strong> with the team you were allocated or created earlier.</p><table><thead><tr><th>Routing Key</th><th>Escalation Policies</th></tr></thead><tbody><tr><td><strong><code>HOSTNAME</code></strong>_PRI</td><td><strong><code>TEAM_NAME</code></strong> : Primary</td></tr><tr><td><strong><code>HOSTNAME</code></strong>_WR</td><td><strong><code>TEAM_NAME</code></strong> : Waiting Room</td></tr></tbody></table><p>There will probably already be a number of Routing Keys configured, but to add a new one simply scroll to the bottom of the page and then click <strong>Add Key</strong></p><p>In the left hand box, enter the name for the key as per the table above. In the <strong>Routing Key</strong> column, select your Teams <strong>Primary</strong> policy from the drop down in the <strong>Escalation Polices</strong> column. You can start typing your Team Name to filter the results.</p><p><a href=#R-image-4d4043250cef467c4d79e9e3f8152cd0 class=lightbox-link><img src=../../en/other/oncall/getting_started/routing/../../images/routing-key-add.png alt="Add Routing Key" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4d4043250cef467c4d79e9e3f8152cd0><img src=../../en/other/oncall/getting_started/routing/../../images/routing-key-add.png alt="Add Routing Key" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>If there are a large number of participants on the workshop, resulting in an unusually large number of Escalation Policies sometimes the search filter does not list all the Policies under your Team Name. If this happens instead of using the search feature, simply scroll down to your team name, all the policies will then be listed.</p></div></div><p>Repeat the above steps for both Keys, <strong><code>xxxx_PRI</code></strong> and <strong><code>xxxx_WR</code></strong>, mapping them to your Teams Primary and Waiting Room policies.</p><p>You should now have two Routing Keys configured, similar to the following:</p><p><a href=#R-image-8345b3eabb48946ac22aeb44fe2d5874 class=lightbox-link><img src=../../en/other/oncall/getting_started/routing/../../images/routing-keys.png alt="Routing Keys" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8345b3eabb48946ac22aeb44fe2d5874><img src=../../en/other/oncall/getting_started/routing/../../images/routing-keys.png alt="Routing Keys" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Tip</div><div class=box-content><p>You can assign a Routing Key to multiple Escalation Policies if required by simply selecting more from the list</p></div></div><p>If you now navigate back to <strong>Teams → [Your Team Name] → Escalation Policies</strong> and look at the settings for your <strong>Primary</strong> and <strong>Waiting Room</strong> polices you will see that these now have <strong>Routes</strong> assigned to them.</p><p><a href=#R-image-544c2a69c60aa3bc96279523ea823b39 class=lightbox-link><img src=../../en/other/oncall/getting_started/routing/../../images/routing-keys-assigned.png alt="Routing Keys Assigned" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-544c2a69c60aa3bc96279523ea823b39><img src=../../en/other/oncall/getting_started/routing/../../images/routing-keys-assigned.png alt="Routing Keys Assigned" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>The <strong>24/7</strong> policy does not have a Route assigned as this will only be triggered via an <strong>Execute Policy</strong> escalation from the <strong>Primary</strong> policy.</p><hr><p>Please wait for the instructor before proceeding to the Incident Lifecycle/Overview module.</p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=incident-lifecycle>Incident Lifecycle</h1><h2 id=aim>Aim</h2><p>The aim of this module is for you to get more familiar with the Timeline Tab and the filtering features.</p><h2 id=1-timeline>1. Timeline</h2><p>The aim of Splunk On-Call is to make being on call more bearable, and it does this by getting the critical data, to the right people, at the right time.</p><p>The key to making it work for you is to centralize all your alerting sources, sending them all to the Splunk On-Call platform, then you have a single pane of glass in which to manage all of your alerting.</p><p>Login to the Splunk On-Call UI and select the <strong>Timeline</strong> tab on the main menu bar, you should have a screen similar to the following image:</p><p><a href=#R-image-9b609c29ffd01fff8d7b550d0bd8ba2c class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/../images/m7-vo-ui.png alt="Splunk On-Call UI" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9b609c29ffd01fff8d7b550d0bd8ba2c><img src=../../en/other/oncall/incident_lifecycle/../images/m7-vo-ui.png alt="Splunk On-Call UI" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=2-people>2. People</h2><p>On the left we have the <strong>People</strong> section with the <strong>Teams</strong> and <strong>Users</strong> sub tabs. On the <strong>Teams</strong> tab, click on <strong>All Teams</strong> then expand <em><strong>[Your Team name]</strong></em>.</p><p>Users with the Splunk On-Call Logo against their name are currently on call. Here you can see who is on call within a particular Team, or across all Teams via <strong>Users → On-Call</strong>.</p><p>If you click into one of the currently on call users, you can see their status. It shows which Rotation they are on call for, when their current Shift ends and their next Shift starts (times are displayed in your time zone), what contact methods they have and which Teams they belong to (dummy users such as Hank do not have Contact Methods configured).</p><p><a href=#R-image-7411c620061fc5c83e148526f575905e class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/../images/m7-user-detail.png alt="User Detail" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7411c620061fc5c83e148526f575905e><img src=../../en/other/oncall/incident_lifecycle/../images/m7-user-detail.png alt="User Detail" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=3-timeline>3. Timeline</h2><p>In the centre <strong>Timeline</strong> section you get a realtime view of what is happening within your environment with the newest messages at the top. Here you can quickly post update messages to make your colleagues aware of important developments etc.</p><p>You can filter the view using the buttons on the top toolbar showing only update messages, GitHub integrations, or apply more advanced filters.</p><p>Lets change the Filters settings to streamline your view. Click the <strong>Filters</strong> button then within the <strong>Routing Keys</strong> tab change the <strong>Show</strong> setting from <strong>all routing keys</strong> to <strong>selected routing keys</strong>. Change the <strong>My Keys</strong> value to <strong>all</strong> and the <strong>Other Keys</strong> value to <strong>selected</strong> and deselect all keys under the Other Keys section.</p><p>Click anywhere outside of the dialogue box to close it.</p><p><a href=#R-image-375a10d354a6fa8dada10e00d5f44224 class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/../images/m7-timeline-filters.png alt="Timeline Filters" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-375a10d354a6fa8dada10e00d5f44224><img src=../../en/other/oncall/incident_lifecycle/../images/m7-timeline-filters.png alt="Timeline Filters" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You will probably now have a much simpler view as you will not currently have Incidents created using your Routing Keys, so you are left with the other types of messages that the Timeline can display.</p><p>Click on <strong>Filters</strong> again, but this time switch to the <strong>Message Types</strong> tab. Here you control the types of messages that are displayed.</p><p>For example, deselect <strong>On-call Changes</strong> and <strong>Escalations</strong>, this will reduce the amount of messages displayed.</p><p><a href=#R-image-f7e1b8cf7b3acd60a25ff6bad99b99c5 class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/../images/m7-timeline-filters-message-types.png alt="Timeline Filters Message Types" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f7e1b8cf7b3acd60a25ff6bad99b99c5><img src=../../en/other/oncall/incident_lifecycle/../images/m7-timeline-filters-message-types.png alt="Timeline Filters Message Types" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=4-incidents>4. Incidents</h2><p>On the right we have the <strong>Incidents</strong> section. Here we get a list of all the incidents within the platform, or we can view a more specific list such as incidents you are specifically assigned to, or for any of the Teams you are a member of.</p><p>Select the <strong>Team Incidents</strong> tab you should find that the <strong>Triggered</strong>, <strong>Acknowledged</strong> & <strong>Resolved</strong> tabs are currently all empty as you have had no incidents logged.</p><p>Let&rsquo;s change that by generating your first incident!</p><p>Continue with the <a href=../../en/other/oncall/incident_lifecycle/create_incidents/index.html>Create Incidents</a> module.</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Incident Lifecycle</h1><article class=default><header class=headline></header><h1 id=create-incidents>Create Incidents</h1><h2 id=aim>Aim</h2><p>The aim of this module is for you to place yourself &lsquo;On-Call&rsquo; then generate an Incident using the supplied EC2 Instance so you can then work through the lifecycle of an Incident.</p><hr><h2 id=1-on-call>1. On-Call</h2><p>Before generating any incidents you should assign yourself to the current Shift within your <strong>Follow the Sun Support - Business Hours</strong> Rotation and also place yourself <strong>On-Call</strong>.</p><ul><li>Click on the <strong>Schedule</strong> link within your <strong>Team</strong> in the <strong>People</strong> section on the left, or navigate to <strong>Teams → [Your Team] → Rotations</strong></li><li>Expand the <strong>Follow the Sun Support - Business Hours</strong> Rotation</li><li>Click on the <strong>Manage members</strong> icon (the figures) for the current active shift depending on your time zone
<a href=#R-image-c18daa56d84923de6505afb9056c4f2b class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/create_incidents/../../images/manage-members.png alt="Manage Members" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c18daa56d84923de6505afb9056c4f2b><img src=../../en/other/oncall/incident_lifecycle/create_incidents/../../images/manage-members.png alt="Manage Members" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></li><li>Use the <strong>Select a user to add&mldr;</strong> dropdown to add yourself to the shift</li><li>Then click on <strong>Set Current</strong> next to your name to make yourself the current <strong>on-call</strong> user within the shift</li><li>You should now get a <strong>Push Notification</strong> to your phone informing you that <strong>You Are Now On-Call</strong>
<a href=#R-image-38cd5b8b74ab76be4f4d035c4759a8d3 class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/create_incidents/../../images/on-duty.png alt="On Duty" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-38cd5b8b74ab76be4f4d035c4759a8d3><img src=../../en/other/oncall/incident_lifecycle/create_incidents/../../images/on-duty.png alt="On Duty" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></li></ul><h2 id=2-trigger-alert>2. Trigger Alert</h2><p>Switch back to your shell session connected to your EC2 Instance; all of the following commands will be executed from your Instance.</p><p>Force the CPU to spike to 100% by running the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>openssl speed -multi $(grep -ci processor /proc/cpuinfo)</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Forked child 0
</span></span><span class=line><span class=cl>+DT:md4:3:16
</span></span><span class=line><span class=cl>+R:19357020:md4:3.000000
</span></span><span class=line><span class=cl>+DT:md4:3:64
</span></span><span class=line><span class=cl>+R:14706608:md4:3.010000
</span></span><span class=line><span class=cl>+DT:md4:3:256
</span></span><span class=line><span class=cl>+R:8262960:md4:3.000000
</span></span><span class=line><span class=cl>+DT:md4:3:1024</span></span></code></pre></div><p>This will result in an Alert being generated by Splunk Infrastructure Monitoring which in turn will generate an Incident within Splunk On-Call within a maximum of 10 seconds. This is the default polling time for the OpenTelemetry Collector installed on your instance (note it can be reduced to 1 second).</p><hr><p>Continue with the <a href=../../en/other/oncall/incident_lifecycle/manage_incidents/index.html>Manage Incidents</a> module.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=manage-incidents>Manage Incidents</h1><h2 id=1-acknowledge>1. Acknowledge</h2><p>Use your Splunk On-Call App on your phone to acknowledge the Incident by clicking on the <strong>push notification</strong> &mldr;</p><p><a href=#R-image-be2df5b85dbe6f201c7bc122d8c46baf class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/mobile-notification.png alt="Push Notification" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-be2df5b85dbe6f201c7bc122d8c46baf><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/mobile-notification.png alt="Push Notification" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>&mldr;to open the alert in the Splunk On-Call mobile app, then clicking on either the <strong>single tick</strong> in the top right hand corner, or the <strong>Acknowledge</strong> link to acknowledge the incident and stop the escalation process.</p><p>The :fontawesome-solid-check: will then transform into a :fontawesome-solid-check::fontawesome-solid-check:, and the status will change from <strong>TRIGGERED</strong> to <strong>ACKNOWLEDGED</strong>.</p><table><thead><tr><th>Triggered Incident</th><th>Acknowledge Incident</th></tr></thead><tbody><tr><td><a href=#R-image-659a322a177a8fd08789f00fe2bad8e2 class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/phone-annotations.png alt="Acknowledge Alert" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-659a322a177a8fd08789f00fe2bad8e2><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/phone-annotations.png alt="Acknowledge Alert" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></td><td><a href=#R-image-951f32dd8c9bd2fb6e661752d39a2c0a class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/phone-alert-acknowledged.png alt="Alert Acknowledged" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-951f32dd8c9bd2fb6e661752d39a2c0a><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/phone-alert-acknowledged.png alt="Alert Acknowledged" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></td></tr></tbody></table><h2 id=2-details-and-annotations>2. Details and Annotations</h2><p>Still on your phone, select the Alert Details tab. Then on the Web UI, navigate back to <strong>Timeline</strong>, select <strong>Team Incidents</strong> on the right, then select <strong>Acknowledged</strong> and click into the new <strong>Incident</strong>, this will open up the War Room Dashboard view of the Incident.</p><p>You should now have the <strong>Details</strong> tab displayed on both your Phone and the Web UI. Notice how they both show the exact same information.</p><p>Now select the <strong>Annotations</strong> tab on both the Phone and the Web UI, you should have a <strong>Graph</strong> displayed in the UI which is generated by Splunk Infrastructure Monitoring.</p><p><a href=#R-image-c605b80243eaae451723c8e5df73551e class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/ui-annotations.png alt="UI Annotations" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c605b80243eaae451723c8e5df73551e><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/ui-annotations.png alt="UI Annotations" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>On your phone you should get the same image displayed (sometimes it&rsquo;s a simple hyperlink depending on the image size)</p><p><a href=#R-image-5913005907ef03442fab4092fe620a31 class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/phone-annotations.png alt="Phone Link" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5913005907ef03442fab4092fe620a31><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/phone-annotations.png alt="Phone Link" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Splunk On-Call is a &lsquo;Mobile First&rsquo; platform meaning the phone app is full functionality and you can manage an incident directly from your phone.</p><p>For the remainder of this module we will focus on the Web UI however please spend some time later exploring the phone app features.</p><h2 id=3-link-to-alerting-system>3. Link to Alerting System</h2><p>Sticking with the Web UI, click the <strong>2. Alert Details in SignalFx</strong> link.</p><p><a href=#R-image-5e919dd680502e8b7c2123822a362407 class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/alert-details-in-sfx.png alt="Alert Details" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5e919dd680502e8b7c2123822a362407><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/alert-details-in-sfx.png alt="Alert Details" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>This will open a new browser tab and take you directly to the Alert within Splunk Infrastructure Monitoring where you could then progress your troubleshooting using the powerful tools built into its UI.</p><p><a href=#R-image-56fd233ea6e16a00ce9097cac7c7018f class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/sfx-alert-details.png alt="SFX Alert Details" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-56fd233ea6e16a00ce9097cac7c7018f><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/sfx-alert-details.png alt="SFX Alert Details" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>However, we are focussing on Splunk On-Call so close this tab and return to the Splunk On-Call UI.</p><h2 id=4-similar-incidents>4. Similar Incidents</h2><p>What if Splunk On-Call could identify previous incidents within the system which may give you a clue to the best way to tackle this incident.</p><p>The <strong>Similar Incidents</strong> tab does exactly that, surfacing previous incidents allowing you to look at them and see what actions were taken to resolve them, actions which could be easily repeated for this incident.</p><p><a href=#R-image-b1e290f7e7b7d4f7b76aa059b1339a03 class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/similar-incidents.png alt="Similar Incidents" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b1e290f7e7b7d4f7b76aa059b1339a03><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/similar-incidents.png alt="Similar Incidents" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=5-timeline>5 Timeline</h2><p>On right we have a Time Line view where you can add messages and see the history of previous alerts and interactions.</p><p><a href=#R-image-25e89e804f83cc5575c07f04b1b4fb04 class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/war-room-dashboard.png alt="Incident View" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-25e89e804f83cc5575c07f04b1b4fb04><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/war-room-dashboard.png alt="Incident View" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=6-add-responders>6 Add Responders</h2><p>On the far left you have the option of allocating additional resources to this incident by clicking on the <strong>Add Responders</strong> link.</p><p><a href=#R-image-d2fd946c15385d12093eb87d1193e8a5 class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/add-responders.png alt=add-responders class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d2fd946c15385d12093eb87d1193e8a5><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/add-responders.png alt=add-responders class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>This allows you build a virtual team specific to this incident by adding other Teams or individual Users, and also share details of a <strong>Conference Bridge</strong> where you can all get together and collaborate.</p><p><a href=#R-image-cf4000805695ac8abf1a5517b62de9fd class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/conference-bridge.png alt="Conference Bridge" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-cf4000805695ac8abf1a5517b62de9fd><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/conference-bridge.png alt="Conference Bridge" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Once the system has built up some incident data history, it will use Machine Learning to suggest Teams and Users who have historically worked on similar incidents, as they may be best placed to help resolve this incident quickly.</p><p>You can select different Teams and/or Users and also choose from a pre-configured conference bridge, or populate the details of a new bridge from your preferred provider.</p><p>We do not need to add any Responders in this exercise so close the <strong>Add Responders</strong> dialogue by clicking <strong>Cancel</strong>.</p><h2 id=7-reroute>7 Reroute</h2><p>If it&rsquo;s decided that maybe the incident could be better dealt with by a different Team, the call can be <strong>Rerouted</strong> by clicking the <strong>Reroute</strong> Button at the top of the left hand panel.</p><p><a href=#R-image-f7b58bf3d024e1a6b50aae5d3e6da930 class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/reroute1.png alt=Reroute class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f7b58bf3d024e1a6b50aae5d3e6da930><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/reroute1.png alt=Reroute class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>In a similar method to that used in the Add Responders dialogue, you can select Teams or Users to Reroute the Incident to.</p><p><a href=#R-image-19bbfe62874b01f7d79b88361a8398b8 class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/reroute2.png alt="Reroute Incident" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-19bbfe62874b01f7d79b88361a8398b8><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/reroute2.png alt="Reroute Incident" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>We do not need to actually Reroute in this exercise so close the <strong>Reroute Incident</strong> dialogue by clicking <strong>Cancel</strong>.</p><h2 id=8-snooze>8 Snooze</h2><p>You can also <strong>snooze</strong> this incident by clicking on the <strong>alarm clock</strong> Button at the top of the left hand panel.</p><p><a href=#R-image-0100189bbd2ae9bc6f351256e1c51f3a class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/snooze1.png alt=Snnoze class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0100189bbd2ae9bc6f351256e1c51f3a><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/snooze1.png alt=Snnoze class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You can enter an amount of time upto 24 hours to snooze the incident. This action will be tracked in the Timeline, and when the time expires the paging will restart.</p><p>This is useful for low priority incidents, enabling you to put them on a back burner for a few hours, but it ensures they do not get forgotten thanks to the paging process starting again.</p><p><a href=#R-image-468f62bf2fdd570f8312cf6af954754e class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/snooze2.png alt="Snooze Incident" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-468f62bf2fdd570f8312cf6af954754e><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/snooze2.png alt="Snooze Incident" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>We do not need to actually Snooze in this exercise so close the <strong>Snooze Incident</strong> dialogue by clicking <strong>Cancel</strong>.</p><h2 id=9-action-tracking>9 Action Tracking</h2><p>Now lets fix this issue and update the Incident with what we did. Add a new message at the top of the right hand panel such as <strong>Discovered rogue process, terminated it</strong>.</p><p><a href=#R-image-fee9c67c2b4bb34e110ef2fea08fa941 class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/time-line-update-message.png alt="Add Message" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fee9c67c2b4bb34e110ef2fea08fa941><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/time-line-update-message.png alt="Add Message" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>All the actions related to the Incident will be recorded here, and can then be summarized is a <strong>Post Incident Review Report</strong> available from the <strong>Reports</strong> tab</p><h2 id=10-resolution>10 Resolution</h2><p>Now kill off the process we started in the VM to max out the CPU by switching back the Shell session for the VM and pressing <strong>ctrl+c</strong></p><p>Within no more than 10 seconds SignalFx should detect the new CPU value, clear the alert state in SignalFx, then automatically update the Incident in VictorOps marking it as <strong>Resolved</strong>.</p><p><a href=#R-image-be62ec1a42d87b2685c696d8e7ca2f99 class=lightbox-link><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/m7-resolved.png alt=Resolved class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-be62ec1a42d87b2685c696d8e7ca2f99><img src=../../en/other/oncall/incident_lifecycle/manage_incidents/../../images/m7-resolved.png alt=Resolved class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>As we have two way integration between Splunk Infrastructure Monitoring and Splunk On-Call we could have also marked the incident as Resolved in Splunk On-Call, and this would have resulted in the alert in Splunk Infrastructure Monitoring being resolved as well.</p><hr><p>That completes this introduction to Splunk On-Call!</p><footer class=footline></footer></article></section></section><article class=default><header class=headline></header><h1 id=making-your-observability-cloud-native-with-opentelemetry>Making Your Observability Cloud Native With OpenTelemetry</h1><h2 id=abstract>Abstract</h2><p>Organizations getting started with OpenTelemetry may begin by sending data directly to an observability backend. While this works well for initial testing, using the OpenTelemetry collector as part of your observability architecture provides numerous benefits and is recommended for any production deployment.</p><p>In this workshop, we will be focusing on using the OpenTelemetry collector and starting with the fundamentals of configuring the receivers, processors, and exporters ready to use with Splunk Observability Cloud. The journey will take attendees from novices to being able to start adding custom components to help solve for their business observability needs for their distributed platform.</p><h3 id=ninja-sections>Ninja Sections</h3><p>Throughout the workshop there will be expandable <span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja</strong> Sections</span></span>, these will be more hands on and go into further technical detail that you can explore within the workshop or in your own time.</p><p>Please note that the content in these sections may go out of date due to the frequent development being made to the OpenTelemetry project. Links will be provided in the event details are out of sync, please let us know if you spot something that needs updating.</p><hr><div class=expand><input type=checkbox id=R-expand-6853e8951ed094050f7bf87777501cd3 aria-controls=R-expandcontent-6853e8951ed094050f7bf87777501cd3>
<label class=expand-label for=R-expand-6853e8951ed094050f7bf87777501cd3><i class="fas fa-chevron-down"></i>
<i class="fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Test Me!</span></span></label><div id=R-expandcontent-6853e8951ed094050f7bf87777501cd3 class=expand-content><p><strong>By completing this workshop you will officially be an OpenTelemetry Collector Ninja!</strong></p></div></div><hr><h2 id=target-audience>Target Audience</h2><p>This interactive workshop is for developers and system administrators who are interested in learning more about architecture and deployment of the OpenTelemetry Collector.</p><h2 id=prerequisites>Prerequisites</h2><ul><li>Attendees should have a basic understanding of data collection</li><li>Command line and vim/vi experience.</li><li>A instance/host/VM running Ubuntu 20.04 LTS or 22.04 LTS.<ul><li>Minimum requirements are an AWS/EC2 t2.micro (1 CPU, 1GB RAM, 8GB Storage)</li></ul></li></ul><h2 id=learning-objectives>Learning Objectives</h2><p>By the end of this talk, attendees will be able to:</p><ul><li>Understand the components of OpenTelemetry</li><li>Use receivers, processors, and exporters to collect and analyze data</li><li>Identify the benefits of using OpenTelemetry</li><li>Build a custom component to solve their business needs</li></ul><h2 id=opentelemetry-architecture>OpenTelemetry Architecture</h2><pre class="mermaid align-center">
%%{
  init:{
    &#34;theme&#34;:&#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    subgraph Collector
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Making Your Observability Cloud Native With OpenTelemetry</h1><article class=default><header class=headline></header><h1 id=installing-opentelemetry-collector-contrib>Installing OpenTelemetry Collector Contrib</h1><h2 id=download-the-opentelemetry-collector-contrib-distribution>Download the OpenTelemetry Collector Contrib distribution</h2><p>The first step in installing the Open Telemetry Collector is downloading it. For our lab we will use the <code>wget</code> command to download the <code>.deb</code> package from the OpenTelemetry Github repository.</p><p>Obtain the <code>.deb</code> package for your platform from the <a href=https://github.com/open-telemetry/opentelemetry-collector-releases/releases target=_blank>OpenTelemetry Collector Contrib releases page</a></p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget https://github.com/open-telemetry/opentelemetry-collector-releases/releases/download/v0.80.0/otelcol-contrib_0.80.0_linux_amd64.deb</span></span></code></pre></div><h2 id=install-the-opentelemetry-collector-contrib-distribution>Install the OpenTelemetry Collector Contrib distribution</h2><p>Install the <code>.deb</code> package using <code>dpkg</code>. Take a look at the <strong>dpkg Output</strong> tab below to see what the example output of a successful install will look like:</p><div class=tab-panel data-tab-group=54cda1fdc0f0d896b9ef2912c0cb3469><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=install class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("54cda1fdc0f0d896b9ef2912c0cb3469","install")'>
<span class=tab-nav-text>Install</span></button>
<button data-tab-item=dpkg-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("54cda1fdc0f0d896b9ef2912c0cb3469","dpkg-output")'>
<span class=tab-nav-text>dpkg Output</span></button></div><div class=tab-content-container><div data-tab-item=install class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo dpkg -i otelcol-contrib_0.80.0_linux_amd64.deb</span></span></code></pre></div></div></div><div data-tab-item=dpkg-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Selecting previously unselected package otelcol-contrib.
</span></span><span class=line><span class=cl>(Reading database ... 64218 files and directories currently installed.)
</span></span><span class=line><span class=cl>Preparing to unpack otelcol-contrib_0.75.0_linux_amd64.deb ...
</span></span><span class=line><span class=cl>Unpacking otelcol-contrib (0.75.0) ...
</span></span><span class=line><span class=cl>Setting up otelcol-contrib (0.75.0) ...
</span></span><span class=line><span class=cl>Created symlink /etc/systemd/system/multi-user.target.wants/otelcol-contrib.service → /lib/systemd/system/otelcol-contrib.service.</span></span></code></pre></div></div></div></div></div><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Installing OpenTelemetry Collector Contrib</h1><article class=default><header class=headline></header><h1 id=installing-opentelemetry-collector-contrib>Installing OpenTelemetry Collector Contrib</h1><h2 id=confirm-the-collector-is-running>Confirm the Collector is running</h2><p>The collector should now be running. We will verify this as root using <code>systemctl</code> command. To exit the status just press <code>q</code>.</p><div class=tab-panel data-tab-group=b41f84eec053158c74730848693a935b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("b41f84eec053158c74730848693a935b","command")'>
<span class=tab-nav-text>Command</span></button>
<button data-tab-item=status-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("b41f84eec053158c74730848693a935b","status-output")'>
<span class=tab-nav-text>Status Output</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl status otelcol-contrib</span></span></code></pre></div></div></div><div data-tab-item=status-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>● otelcol-contrib.service - OpenTelemetry Collector Contrib
</span></span><span class=line><span class=cl>     Loaded: loaded (/lib/systemd/system/otelcol-contrib.service; enabled; vendor preset: enabled)
</span></span><span class=line><span class=cl>     Active: active (running) since Tue 2023-05-16 08:23:23 UTC; 25s ago
</span></span><span class=line><span class=cl>   Main PID: 1415 (otelcol-contrib)
</span></span><span class=line><span class=cl>      Tasks: 5 (limit: 1141)
</span></span><span class=line><span class=cl>     Memory: 22.2M
</span></span><span class=line><span class=cl>        CPU: 125ms
</span></span><span class=line><span class=cl>     CGroup: /system.slice/otelcol-contrib.service
</span></span><span class=line><span class=cl>             └─1415 /usr/bin/otelcol-contrib --config=/etc/otelcol-contrib/config.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]: NumberDataPoints #0
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]: Data point attributes:
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]:      -&gt; exporter: Str(logging)
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]:      -&gt; service_instance_id: Str(df8a57f4-abdc-46b9-a847-acd62db1001f)
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]:      -&gt; service_name: Str(otelcol-contrib)
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]:      -&gt; service_version: Str(0.75.0)
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]: StartTimestamp: 2023-05-16 08:23:39.006 +0000 UTC
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]: Timestamp: 2023-05-16 08:23:39.006 +0000 UTC
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]: Value: 0.000000
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]:         {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;metrics&#34;, &#34;name&#34;: &#34;logging&#34;}</span></span></code></pre></div></div></div></div></div><p>As will be running the rest of the workshop using the <code>otelcol-contrib</code> standalone binary, we will stop the service and then disable it from starting on boot:</p><div class=tab-panel data-tab-group=9c30046b7e15a7c23696e43bb37e86d5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("9c30046b7e15a7c23696e43bb37e86d5","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl stop otelcol-contrib</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=de75c8280001634f3bcb55813c3b2ef1><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("de75c8280001634f3bcb55813c3b2ef1","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl disable otelcol-contrib</span></span></code></pre></div></div></div></div></div><hr><div class=expand><input type=checkbox id=R-expand-a5a0e4d654b0e18161967a0c13472148 aria-controls=R-expandcontent-a5a0e4d654b0e18161967a0c13472148>
<label class=expand-label for=R-expand-a5a0e4d654b0e18161967a0c13472148><i class="fas fa-chevron-down"></i>
<i class="fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Build your own collector using Open Telemetry Collector Builder (ocb)</span></span></label><div id=R-expandcontent-a5a0e4d654b0e18161967a0c13472148 class=expand-content><p>For this part we will require the following installed on your system:</p><ul><li><p>Golang (latest version)</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /tmp
</span></span><span class=line><span class=cl>wget https://golang.org/dl/go1.20.linux-amd64.tar.gz
</span></span><span class=line><span class=cl>sudo tar -C /usr/local -xzf go1.20.linux-amd64.tar.gz</span></span></code></pre></div><p>Edit <code>.profile</code> and add the following environment variables:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>GOROOT</span><span class=o>=</span>/usr/local/go
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>GOPATH</span><span class=o>=</span><span class=nv>$HOME</span>/go
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=nv>$GOPATH</span>/bin:<span class=nv>$GOROOT</span>/bin:<span class=nv>$PATH</span></span></span></code></pre></div><p>Renew your shell session:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>source</span> ~/.profile</span></span></code></pre></div><p>Check Go version:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go version</span></span></code></pre></div></li><li><p>ocb installed</p><ul><li><p>Download the ocb binary from the <a href=https://github.com/open-telemetry/opentelemetry-collector/releases/tag/cmd%2Fbuilder%2Fv0.80.0 target=_blank>project releases</a>
and run the following commands:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mv ocb_0.80.0_darwin_arm64 /usr/bin/ocb
</span></span><span class=line><span class=cl>chmod <span class=m>755</span> /usr/bin/ocb</span></span></code></pre></div><p>An alternative approach would be to use the golang tool chain to build the binary locally by doing:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go install go.opentelemetry.io/collector/cmd/builder@v0.80.0
</span></span><span class=line><span class=cl>mv <span class=k>$(</span>go env GOPATH<span class=k>)</span>/bin/builder /usr/bin/ocb</span></span></code></pre></div></li></ul></li><li><p>(Optional) Docker</p></li></ul><h2 id=why-build-your-own-collector>Why build your own collector?</h2><p>The default distribution of the collector (core and contrib) either contain too much or too little in what they have to offer.</p><p>It is also not advised to run the contrib collector in your production environments due to the amount of components installed which more than likely are not needed by your deployment.</p><h2 id=benefits-of-building-your-own-collector>Benefits of building your own collector?</h2><p>When creating your own collector binaries, (commonly referred to as distribution), means you build what you need.</p><p>The benefits of this are:</p><ol><li>Smaller sized binaries</li><li>Can use existing go scanners for vulnerabilities</li><li>Include internal components that can tie in with your organisation</li></ol><h2 id=considerations-for-building-your-own-collector>Considerations for building your own collector?</h2><p>Now, this would not be a 🥷 Ninja zone if it didn&rsquo;t come with some draw backs:</p><ol><li>Go experience is recommended if not required</li><li><strong>No</strong> Splunk support</li><li>Responsibility of distribution and lifecycle management</li></ol><p>It is important to note that project is working towards stability but it does not mean changes made will not break your workflow. The team at Splunk provide increased support and a higher level of stability so they can provide a curated experience helping you with your deployment needs.</p><h2 id=the-ninja-zone>The Ninja Zone</h2><p>Once you have all the required tools installed to get started, you will need to create a new file named <code>otelcol-builder.yaml</code> and we will follow this directory structure:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>└── otelcol-builder.yaml</span></span></code></pre></div><p>Once we have the file created, we need to add a list of components for it to install with some additional metadata.</p><p>For this example, we are going to create a builder manifest that will install only the components we need for the introduction config:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dist</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>otelcol-ninja</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>A custom build of the Open Telemetry Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>output_path</span><span class=p>:</span><span class=w> </span><span class=l>./dist</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/extension/ballastextension v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/extension/zpagesextension  v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/extension/httpforwarder v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/extension/healthcheckextension v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/loggingexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/otlpexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/exporter/splunkhecexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/exporter/signalfxexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/exporter/sapmexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/processor/batchprocessor v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/processor/memorylimiterprocessor v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/receiver/otlpreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/hostmetricsreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/jaegerreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/prometheusreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/zipkinreceiver v0.80.0</span></span></span></code></pre></div><p>Once the yaml file has been updated for the <em>ocb</em>, then run the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ocb --config<span class=o>=</span>otelcol-builder.yaml</span></span></code></pre></div><p>Which leave you with the following directory structure:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>├── dist
</span></span><span class=line><span class=cl>│   ├── components.go
</span></span><span class=line><span class=cl>│   ├── components_test.go
</span></span><span class=line><span class=cl>│   ├── go.mod
</span></span><span class=line><span class=cl>│   ├── go.sum
</span></span><span class=line><span class=cl>│   ├── main.go
</span></span><span class=line><span class=cl>│   ├── main_others.go
</span></span><span class=line><span class=cl>│   ├── main_windows.go
</span></span><span class=line><span class=cl>│   └── otelcol-ninja
</span></span><span class=line><span class=cl>└── otelcol-builder.yaml</span></span></code></pre></div><h3 id=references>References</h3><ol><li><a href=https://opentelemetry.io/docs/collector/custom-collector/ target=_blank>https://opentelemetry.io/docs/collector/custom-collector/</a></li></ol></div></div><hr><h2 id=default-configuration>Default configuration</h2><p>OpenTelemetry is configured through YAML files. These files have default configurations that we can modify to meet our needs. Let&rsquo;s look at the default configuration that is supplied:</p><div class=tab-panel data-tab-group=a996478b1fefd2d30632b1d8c276da6d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("a996478b1fefd2d30632b1d8c276da6d","command")'>
<span class=tab-nav-text>Command</span></button>
<button data-tab-item=configyaml class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("a996478b1fefd2d30632b1d8c276da6d","configyaml")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /etc/otelcol-contrib/config.yaml</span></span></code></pre></div></div></div><div data-tab-item=configyaml class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div><p>Congratulations! You have successfully downloaded and installed the OpenTelemetry Collector. You are well on your way to becoming an OTel Ninja. But first lets walk through configuration files and different distributions of the OpenTelemetry Collector.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>Splunk does provide its own, fully supported, distribution of the OpenTelemetry Collector. This distribution is available to install from the <a href=https://github.com/signalfx/splunk-otel-collector target=_blank>Splunk GitHub Repository</a> or via a wizard in Splunk Observability Cloud that will build out a simple installation script to copy and paste. This distribution includes a number of additional features and enhancements that are not available in the OpenTelemetry Collector Contrib distribution.</p><ul><li>The Splunk Distribution of the OpenTelemetry Collector is production tested; it is in use by the majority of customers in their production environments.</li><li>Customers that use our distribution can receive direct help from official Splunk support within SLA&rsquo;s.</li><li>Customers can use or migrate to the Splunk Distribution of the OpenTelemetry Collector without worrying about future breaking changes to its core configuration experience for metrics and traces collection (OpenTelemetry logs collection configuration is in beta). There may be breaking changes to the Collector&rsquo;s own metrics.</li></ul></div></div><p>We will now walk through each section of the configuration file and modify it to send host metrics to Splunk Observability Cloud.</p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-extensions>OpenTelemetry Collector Extensions</h1><p>Now that we have the OpenTelemetry Collector installed, let&rsquo;s take a look at extensions for the OpenTelemetry Collector. Extensions are optional and available primarily for tasks that do not involve processing telemetry data. Examples of extensions include health monitoring, service discovery, and data forwarding.</p><pre class="mermaid align-center">
%%{
  init:{
    &#34;theme&#34;: &#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    style E fill:#e20082,stroke:#333,stroke-width:4px,color:#fff
    subgraph Collector
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of OpenTelemetry Collector Extensions</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-extensions>OpenTelemetry Collector Extensions</h1><h2 id=health-check>Health Check</h2><p>Extensions are configured in the same <code>config.yaml</code> file that we referenced in the installation step. Let&rsquo;s edit the <code>config.yaml</code> file and configure the extensions. Note that the <strong>pprof</strong> and <strong>zpages</strong> extensions are already configured in the default <code>config.yaml</code> file. For the purpose of this workshop, we will only be updating the <strong>health_check</strong> extension to expose the port on all network interfaces on which we can access the health of the collector.</p><div class=tab-panel data-tab-group=8395b5e229676d71bf925c9768c27490><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("8395b5e229676d71bf925c9768c27490","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/otelcol-contrib/config.yaml</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=84a5875dbe6d6165b8a0e70b0af8634e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=extensions-configuration class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("84a5875dbe6d6165b8a0e70b0af8634e","extensions-configuration")'>
<span class=tab-nav-text>Extensions Configuration</span></button></div><div class=tab-content-container><div data-tab-item=extensions-configuration class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span></span></span></code></pre></div></div></div></div></div><p>Start the collector:</p><div class=tab-panel data-tab-group=94130f5496a574cbd81d0216238d97a1><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("94130f5496a574cbd81d0216238d97a1","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>otelcol-contrib --config<span class=o>=</span>file:/etc/otelcol-contrib/config.yaml</span></span></code></pre></div></div></div></div></div><p>This extension enables a HTTP URL that can be probed to check the status of the OpenTelemetry Collector. This extension can be used as a liveness and/or readiness probe on Kubernetes. To learn more about the <code>curl</code> command, check out the <a href=https://curl.se/docs/manpage.html target=_blank>curl man page</a>.</p><p>Open a new terminal session and SSH into your instance to run the following command:</p><div class=tab-panel data-tab-group=0f37561aa74e2a88526d36c9e52b7147><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=curl-command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("0f37561aa74e2a88526d36c9e52b7147","curl-command")'>
<span class=tab-nav-text>curl Command</span></button>
<button data-tab-item=curl-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("0f37561aa74e2a88526d36c9e52b7147","curl-output")'>
<span class=tab-nav-text>curl Output</span></button></div><div class=tab-content-container><div data-tab-item=curl-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:13133</span></span></code></pre></div></div></div><div data-tab-item=curl-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>{&#34;status&#34;:&#34;Server available&#34;,&#34;upSince&#34;:&#34;2023-04-27T10:11:22.153295874+01:00&#34;,&#34;uptime&#34;:&#34;16m24.684476004s&#34;}</span></span></code></pre></div></div></div></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-extensions>OpenTelemetry Collector Extensions</h1><h2 id=performance-profiler>Performance Profiler</h2><p><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/extension/pprofextension/README.md target=_blank><strong>Performance Profiler</strong></a> extension enables the golang net/http/pprof endpoint. This is typically used by developers to collect performance profiles and investigate issues with the service. <strong>We will not be covering this in this workshop</strong>.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-extensions>OpenTelemetry Collector Extensions</h1><h2 id=zpages>zPages</h2><p><a href=https://github.com/open-telemetry/opentelemetry-collector/blob/main/extension/zpagesextension/README.md target=_blank><strong>zPages</strong></a> are an in-process alternative to external exporters. When included, they collect and aggregate tracing and metrics information in the background; this data is served on web pages when requested. zPages are an extremely useful diagnostic feature to ensure the collector is running as expected.</p><div class=tab-panel data-tab-group=3f9b12ecc900dcdde350637f63a1e01f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=servicez class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("3f9b12ecc900dcdde350637f63a1e01f","servicez")'>
<span class=tab-nav-text>ServiceZ</span></button>
<button data-tab-item=pipelinez class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("3f9b12ecc900dcdde350637f63a1e01f","pipelinez")'>
<span class=tab-nav-text>PipelineZ</span></button>
<button data-tab-item=extensionz class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("3f9b12ecc900dcdde350637f63a1e01f","extensionz")'>
<span class=tab-nav-text>ExtensionZ</span></button></div><div class=tab-content-container><div data-tab-item=servicez class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p><strong>ServiceZ</strong> gives an overview of the collector services and quick access to the pipelinez, extensionz, and featurez zPages. The page also provides build and runtime information.</p><p>Example URL: <a href=http://localhost:55679/debug/servicez target=_blank>http://localhost:55679/debug/servicez</a> (change <code>localhost</code> to reflect your own environment).</p><p><a href=#R-image-0b698f813cd88564786ae86e323fefdf class=lightbox-link><img src=../../en/other/opentelemetry-collector/2-extensions/3-zpages/../../images/servicez.png alt=ServiceZ class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0b698f813cd88564786ae86e323fefdf><img src=../../en/other/opentelemetry-collector/2-extensions/3-zpages/../../images/servicez.png alt=ServiceZ class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p></div></div><div data-tab-item=pipelinez class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><strong>PipelineZ</strong> provides insights on the running pipelines running in the collector. You can find information on type, if data is mutated, and you can also see information on the receivers, processors and exporters that are used for each pipeline.</p><p>Example URL: <a href=http://localhost:55679/debug/pipelinez target=_blank>http://localhost:55679/debug/pipelinez</a> (change <code>localhost</code> to reflect your own environment).</p><p><a href=#R-image-b4db7c4519a818ef861619d7be4eae75 class=lightbox-link><img src=../../en/other/opentelemetry-collector/2-extensions/3-zpages/../../images/pipelinez.png alt=PipelineZ class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b4db7c4519a818ef861619d7be4eae75><img src=../../en/other/opentelemetry-collector/2-extensions/3-zpages/../../images/pipelinez.png alt=PipelineZ class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p></div></div><div data-tab-item=extensionz class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><strong>ExtensionZ</strong> shows the extensions that are active in the collector.</p><p>Example URL: <a href=http://localhost:55679/debug/extensionz target=_blank>http://localhost:55679/debug/extensionz</a> (change <code>localhost</code> to reflect your own environment).</p><p><a href=#R-image-d80a1d93303dbc6961d235645044be75 class=lightbox-link><img src=../../en/other/opentelemetry-collector/2-extensions/3-zpages/../../images/extensionz.png alt=ExtensionZ class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d80a1d93303dbc6961d235645044be75><img src=../../en/other/opentelemetry-collector/2-extensions/3-zpages/../../images/extensionz.png alt=ExtensionZ class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p></div></div></div></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>If you are not following along, you can use your browser to access a test environment emitting zPages information at:</p><ul><li><strong>ServiceZ:</strong> <a href=http://63.33.64.193:55679/debug/servicez target=_blank>http://63.33.64.193:55679/debug/servicez</a></li><li><strong>PipelineZ:</strong> <a href=http://63.33.64.193:55679/debug/pipelinez target=_blank>http://63.33.64.193:55679/debug/pipelinez</a></li><li><strong>ExtensionZ:</strong> <a href=http://63.33.64.193:55679/debug/extensionz target=_blank>http://63.33.64.193:55679/debug/extensionz</a></li></ul></div></div><hr><div class=expand><input type=checkbox id=R-expand-ff64fa230857daa24956b1517cc1be6d aria-controls=R-expandcontent-ff64fa230857daa24956b1517cc1be6d>
<label class=expand-label for=R-expand-ff64fa230857daa24956b1517cc1be6d><i class="fas fa-chevron-down"></i>
<i class="fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Improve data durability with storage extension</span></span></label><div id=R-expandcontent-ff64fa230857daa24956b1517cc1be6d class=expand-content><p>For this, we will need to validate that our distribution has the <code>file_storage</code> extension installed. This can be done by running the command <code>otelcol-contrib components</code> which should show results like:</p><div class=tab-panel data-tab-group=74b7eef2e49f0e64f62d4e0c22fda679><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=truncated-output class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("74b7eef2e49f0e64f62d4e0c22fda679","truncated-output")'>
<span class=tab-nav-text>Truncated Output</span></button>
<button data-tab-item=full-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("74b7eef2e49f0e64f62d4e0c22fda679","full-output")'>
<span class=tab-nav-text>Full Output</span></button></div><div class=tab-content-container><div data-tab-item=truncated-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># ... truncated for clarity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>file_storage</span></span></span></code></pre></div></div></div><div data-tab-item=full-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>buildinfo</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>otelcol-contrib</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>OpenTelemetry Collector Contrib</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>prometheus_simple</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>influxdb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>purefa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>purefb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>receiver_creator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mongodbatlas</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>vcenter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>snmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>expvar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jmx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>skywalking</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>udplog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>carbon</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>kafkametrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>memcached</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>prometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>windowseventlog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsecscontainermetrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>iis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>nsxt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>aerospike</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>httpcheck</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8sobjects</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mongodb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>hostmetrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>signalfx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>statsd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsxray</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>cloudfoundry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>collectd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>couchdb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>kubeletstats</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jaeger</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>journald</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>riak</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>splunk_hec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>active_directory_ds</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awscloudwatch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sqlquery</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>windowsperfcounters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>flinkmetrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlecloudpubsub</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>podman_stats</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>wavefront</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8s_events</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>postgresql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sapm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sqlserver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>solace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tcplog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awscontainerinsightreceiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsfirehose</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bigip</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>filelog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlecloudspanner</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>cloudflare</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>docker_stats</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8s_cluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>pulsar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>zipkin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>opencensus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>azureeventhub</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>datadog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>fluentforward</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlpjsonfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>syslog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>cumulativetodelta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>groupbyattrs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>groupbytrace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8sattributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>experimental_metricsgeneration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>metricstransform</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>routing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>datadog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>deltatorate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>spanmetrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>span</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>redaction</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>servicegraph</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>transform</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>filter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>probabilistic_sampler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tail_sampling</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>carbon</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>datadog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>f5cloud</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mezmo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>skywalking</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsxray</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>dynatrace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>loki</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>prometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>logging</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>azuredataexplorer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>azuremonitor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>instana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jaeger</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>loadbalancing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sentry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>splunk_hec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tanzuobservability</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>zipkin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>alibabacloud_logservice</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>clickhouse</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlecloud</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>prometheusremotewrite</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awscloudwatchlogs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlecloudpubsub</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jaeger_thrift</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>logzio</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sapm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sumologic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlemanagedprometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>opencensus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awskinesis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>coralogix</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>influxdb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>logicmonitor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>signalfx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tencentcloud_logservice</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsemf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>pulsar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>zpages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bearertokenauth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>oidc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>host_observer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sigv4auth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>file_storage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>memory_ballast</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>health_check</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>oauth2client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsproxy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>http_forwarder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jaegerremotesampling</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8s_observer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>pprof</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>asapclient</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>basicauth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>headers_setter</span></span></span></code></pre></div></div></div></div></div><p>This extension provides exporters the ability to queue data to disk in the event that exporter is unable to send data to the configured endpoint.</p><p>In order to configure the extension, you will need to update your config to include the information below. First, be sure to create a /tmp/otel-data directory and give it read/write permissions:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file_storage</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/otel-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>compaction</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/otel-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>on_start</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>on_rebound</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>rebound_needed_threshold_mib</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>rebound_trigger_threshold_mib</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># ... truncated for clarity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages, file_storage]</span></span></span></code></pre></div><h2 id=why-queue-data-to-disk>Why queue data to disk?</h2><p>This allows the collector to weather network interruptions (and even collector restarts) to ensure data is sent to the upstream provider.</p><h2 id=considerations-for-queuing-data-to-disk>Considerations for queuing data to disk?</h2><p>There is a potential that this could impact data throughput performance due to disk performance.</p><h3 id=references>References</h3><ol><li><a href=https://community.splunk.com/t5/Community-Blog/Data-Persistence-in-the-OpenTelemetry-Collector/ba-p/624583 target=_blank>https://community.splunk.com/t5/Community-Blog/Data-Persistence-in-the-OpenTelemetry-Collector/ba-p/624583</a></li><li><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/extension/storage/filestorage target=_blank>https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/extension/storage/filestorage</a></li></ol></div></div><hr><h2 id=configuration-check-in>Configuration Check-in</h2><p>Now that we&rsquo;ve covered extensions, let&rsquo;s check our configuration changes.</p><hr><div class=expand><input type=checkbox id=R-expand-26dbfd540c1eaaec3f94ba90aee28de8 aria-controls=R-expandcontent-26dbfd540c1eaaec3f94ba90aee28de8>
<label class=expand-label for=R-expand-26dbfd540c1eaaec3f94ba90aee28de8><i class="fas fa-chevron-down"></i>
<i class="fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>Review your configuration</span></span></label><div id=R-expandcontent-26dbfd540c1eaaec3f94ba90aee28de8 class=expand-content><div class=tab-panel data-tab-group=4fb634d65b1a02caa0a7d031952bf7dd><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configyaml class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("4fb634d65b1a02caa0a7d031952bf7dd","configyaml")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div data-tab-item=configyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=hl><span class=lnt> 3
</span></span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></div><hr><p>Now that we have reviewed extensions, let&rsquo;s dive into the data pipeline portion of the workshop. A pipeline defines a path the data follows in the Collector starting from reception, moving to further processing or modification, and finally exiting the Collector via exporters.</p><p>The data pipeline in the OpenTelemetry Collector is made up of receivers, processors, and exporters. We will first start with receivers.</p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-receivers>OpenTelemetry Collector Receivers</h1><p>Welcome to the receiver portion of the workshop! This is the starting point of the data pipeline of the OpenTelemetry Collector. Let&rsquo;s dive in.</p><p>A receiver, which can be push or pull based, is how data gets into the Collector. Receivers may support one or more data sources. Generally, a receiver accepts data in a specified format, translates it into the internal format and passes it to processors and exporters defined in the applicable pipelines.</p><pre class="mermaid align-center">
%%{
  init:{
    &#34;theme&#34;:&#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    style M fill:#e20082,stroke:#333,stroke-width:4px,color:#fff
    subgraph Collector
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of OpenTelemetry Collector Receivers</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-receivers>OpenTelemetry Collector Receivers</h1><h2 id=host-metrics-receiver>Host Metrics Receiver</h2><p><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/receiver/hostmetricsreceiver/README.md target=_blank><strong>The Host Metrics Receiver</strong></a> generates metrics about the host system scraped from various sources. This is intended to be used when the collector is deployed as an agent which is what we will be doing in this workshop.</p><p>Let&rsquo;s update the <code>/etc/otel-contrib/config.yaml</code> file and configure the <strong>hostmetrics</strong> receiver. Insert the following YAML under the <strong>receivers</strong> section, taking care to indent by two spaces.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/otelcol-contrib/config.yaml</span></span></code></pre></div><div class=tab-panel data-tab-group=a8ee1f2ad6e93d204c47afb0c3448e3b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=host-metrics-receiver-configuration class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("a8ee1f2ad6e93d204c47afb0c3448e3b","host-metrics-receiver-configuration")'>
<span class=tab-nav-text>Host Metrics Receiver Configuration</span></button></div><div class=tab-content-container><div data-tab-item=host-metrics-receiver-configuration class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># process:</span></span></span></code></pre></div></div></div></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-receivers>OpenTelemetry Collector Receivers</h1><h2 id=prometheus-receiver>Prometheus Receiver</h2><p>You will also notice another receiver called <strong>prometheus</strong>. <a href=https://prometheus.io/docs/introduction/overview/ target=_blank>Prometheus</a> is an open-source toolkit used by the OpenTelemetry Collector. This receiver is used to scrape metrics from the OpenTelemetry Collector itself. These metrics can then be used to monitor the health of the collector.</p><p>Let&rsquo;s modify the <strong>prometheus</strong> receiver to clearly show that it is for collecting metrics from the collector itself. By changing the name of the receiver from <strong>prometheus</strong> to <strong>prometheus/internal</strong>, it is now much clearer as to what that receiever is doing. Update the configuration file to look like this:</p><div class=tab-panel data-tab-group=42ff3d7948ae41454710443cc5549141><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=prometheus-receiver-configuration class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("42ff3d7948ae41454710443cc5549141","prometheus-receiver-configuration")'>
<span class=tab-nav-text>Prometheus Receiver Configuration</span></button></div><div class=tab-content-container><div data-tab-item=prometheus-receiver-configuration class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class="line hl"><span class=cl><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span></span></span></code></pre></div></div></div></div></div><h2 id=example-dashboard---prometheus-metrics>Example Dashboard - Prometheus metrics</h2><p>The following screenshot shows an example dashboard of spme of the metrics the Prometheus internal receiver collects from the OpenTelemetry Collector. Here, we can see accepted and sent spans, metrics and log records.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>The following screenshot is an out-of-the-box (OOTB) dashboard from Splunk Observability Cloud that allows you to easily monitor your Splunk OpenTelemetry Collector install base.</p></div></div><p><a href=#R-image-f7aa4a1fa76bf0be10dd1d3f5d2f8070 class=lightbox-link><img src=../../en/other/opentelemetry-collector/3-receivers/2-prometheus/../../images/otel-charts.png alt=otel-charts class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f7aa4a1fa76bf0be10dd1d3f5d2f8070><img src=../../en/other/opentelemetry-collector/3-receivers/2-prometheus/../../images/otel-charts.png alt=otel-charts class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-receivers>OpenTelemetry Collector Receivers</h1><h2 id=other-receivers>Other Receivers</h2><p>You will notice in the default configuration there are other receivers: <strong>otlp</strong>, <strong>opencensus</strong>, <strong>jaeger</strong> and <strong>zipkin</strong>. These are used to receive telemetry data from other sources. We will not be covering these receivers in this workshop and they can be left as they are.</p><hr><div class=expand><input type=checkbox id=R-expand-67b3ba196aad3a443b6bae66e82d99b8 aria-controls=R-expandcontent-67b3ba196aad3a443b6bae66e82d99b8>
<label class=expand-label for=R-expand-67b3ba196aad3a443b6bae66e82d99b8><i class="fas fa-chevron-down"></i>
<i class="fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Create receivers dynamically</span></span></label><div id=R-expandcontent-67b3ba196aad3a443b6bae66e82d99b8 class=expand-content><p>To help observe short lived tasks like docker containers, kubernetes pods, or ssh sessions, we can use the <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/receivercreator target=_blank>receiver creator</a> with <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/extension/observer target=_blank>observer extensions</a> to create a new receiver as these services start up.</p><h2 id=what-do-we-need>What do we need?</h2><p>In order to start using the receiver creator and its associated observer extensions, they will need to be part of your collector build manifest.</p><p>See <a href=../../en/other/opentelemetry-collector/1-installation/index.html>installation</a> for the details.</p><h2 id=things-to-consider>Things to consider?</h2><p>Some short lived tasks may require additional configuration such as <em>username</em>, and <em>password</em>.
These values can be referenced via <a href=https://opentelemetry.io/docs/collector/configuration/#configuration-environment-variables target=_blank>environment variables</a>,
or use a scheme expand syntax such as <code>${file:./path/to/database/password}</code>.
Please adhere to your organisation&rsquo;s secret practices when taking this route.</p><h2 id=the-ninja-zone>The Ninja Zone</h2><p>There are only two things needed for this ninja zone:</p><ol><li>Make sure you have added receiver creater and observer extensions to the builder manifest.</li><li>Create the config that can be used to match against discovered endpoints.</li></ol><p>To create the templated configurations, you can do the following:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receiver_creator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>watch_observers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>host_observer]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>redis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=l>type == &#34;port&#34; &amp;&amp; port == 6379</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=l>${env:HOST_REDIS_PASSWORD}</span></span></span></code></pre></div><p>For more examples, refer to these <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/receivercreator#examples target=_blank>receiver creator&rsquo;s examples</a>.</p></div></div><hr><h2 id=configuration-check-in>Configuration Check-in</h2><p>We&rsquo;ve now covered receivers, so let&rsquo;s now check our configuration changes.</p><hr><div class=expand><input type=checkbox id=R-expand-7d08e87fc9344123b437a944b4bc1bb7 aria-controls=R-expandcontent-7d08e87fc9344123b437a944b4bc1bb7>
<label class=expand-label for=R-expand-7d08e87fc9344123b437a944b4bc1bb7><i class="fas fa-chevron-down"></i>
<i class="fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>Review your configuration</span></span></label><div id=R-expandcontent-7d08e87fc9344123b437a944b4bc1bb7 class=expand-content><div class=tab-panel data-tab-group=f4c58b36704f99f6b531a78691831c9f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configyaml class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("f4c58b36704f99f6b531a78691831c9f","configyaml")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div data-tab-item=configyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=hl><span class=lnt>10
</span></span><span class=hl><span class=lnt>11
</span></span><span class=hl><span class=lnt>12
</span></span><span class=hl><span class=lnt>13
</span></span><span class=hl><span class=lnt>14
</span></span><span class=hl><span class=lnt>15
</span></span><span class=hl><span class=lnt>16
</span></span><span class=hl><span class=lnt>17
</span></span><span class=hl><span class=lnt>18
</span></span><span class=hl><span class=lnt>19
</span></span><span class=hl><span class=lnt>20
</span></span><span class=hl><span class=lnt>21
</span></span><span class=hl><span class=lnt>22
</span></span><span class=hl><span class=lnt>23
</span></span><span class=hl><span class=lnt>24
</span></span><span class=hl><span class=lnt>25
</span></span><span class=hl><span class=lnt>26
</span></span><span class=hl><span class=lnt>27
</span></span><span class=hl><span class=lnt>28
</span></span><span class=hl><span class=lnt>29
</span></span><span class=hl><span class=lnt>30
</span></span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=hl><span class=lnt>39
</span></span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># process:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></div><hr><p>Now that we have reviewed how data gets into the OpenTelemetry Collector through receivers, let&rsquo;s now take a look at how the Collector processes the received data.</p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div><div class=box-content><p>As the <code>/etc/otelcol-contrib/config.yaml</code> is not complete, please <strong>do not</strong> attempt to restart the collector at this point.</p></div></div><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-processors>OpenTelemetry Collector Processors</h1><p><a href=https://github.com/open-telemetry/opentelemetry-collector/blob/main/processor/README.md target=_blank><strong>Processors</strong></a> are run on data between being received and being exported. Processors are optional though some are recommended. There are <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor target=_blank>a large number of processors</a> included in the OpenTelemetry contrib Collector.</p><pre class="mermaid align-center">
%%{
  init:{
    &#34;theme&#34;:&#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    style Processors fill:#e20082,stroke:#333,stroke-width:4px,color:#fff
    subgraph Collector
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of OpenTelemetry Collector Processors</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-processors>OpenTelemetry Collector Processors</h1><h2 id=batch-processor>Batch Processor</h2><p>By default, only the <strong>batch</strong> processor is enabled. This processor is used to batch up data before it is exported. This is useful for reducing the number of network calls made to exporters. For this workshop we will accept the defaults:</p><ul><li><code>send_batch_size</code> (default = 8192): Number of spans, metric data points, or log records after which a batch will be sent regardless of the timeout. send_batch_size acts as a trigger and does not affect the size of the batch. If you need to enforce batch size limits sent to the next component in the pipeline see send_batch_max_size.</li><li><code>timeout</code> (default = 200ms): Time duration after which a batch will be sent regardless of size. If set to zero, send_batch_size is ignored as data will be sent immediately, subject to only send_batch_max_size.</li><li><code>send_batch_max_size</code> (default = 0): The upper limit of the batch size. 0 means no upper limit of the batch size. This property ensures that larger batches are split into smaller units. It must be greater than or equal to send_batch_size.</li></ul><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-processors>OpenTelemetry Collector Processors</h1><h2 id=resource-detection-processor>Resource Detection Processor</h2><p>The <strong>resourcedetection</strong> processor can be used to detect resource information from the host and append or override the resource value in telemetry data with this information.</p><p>By default, the hostname is set to the FQDN if possible, otherwise the hostname provided by the OS is used as a fallback. This logic can be changed from using using the <code>hostname_sources</code> configuration option. To avoid getting the FQDN and use the hostname provided by the OS, we will set the <code>hostname_sources</code> to <code>os</code>.</p><div class=tab-panel data-tab-group=e0d8c81071fcea574ac0d6c1bbde7046><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=system-resource-detection-processor-configuration class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("e0d8c81071fcea574ac0d6c1bbde7046","system-resource-detection-processor-configuration")'>
<span class=tab-nav-text>System Resource Detection Processor Configuration</span></button></div><div class=tab-content-container><div data-tab-item=system-resource-detection-processor-configuration class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span></span></span></code></pre></div></div></div></div></div><p>If the workshop instance is running on an AWS/EC2 instance we can gather the following tags from the EC2 metadata API (this is not available on other platforms).</p><ul><li><code>cloud.provider ("aws")</code></li><li><code>cloud.platform ("aws_ec2")</code></li><li><code>cloud.account.id</code></li><li><code>cloud.region</code></li><li><code>cloud.availability_zone</code></li><li><code>host.id</code></li><li><code>host.image.id</code></li><li><code>host.name</code></li><li><code>host.type</code></li></ul><p>We will create another processor to append these tags to our metrics.</p><div class=tab-panel data-tab-group=3a9b1d7a7b2f15a1ffa8e90e7261be1a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=ec2-resource-detection-processor-configuration class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("3a9b1d7a7b2f15a1ffa8e90e7261be1a","ec2-resource-detection-processor-configuration")'>
<span class=tab-nav-text>EC2 Resource Detection Processor Configuration</span></button></div><div class=tab-content-container><div data-tab-item=ec2-resource-detection-processor-configuration class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span></span></span></code></pre></div></div></div></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-processors>OpenTelemetry Collector Processors</h1><h2 id=attributes-processor>Attributes Processor</h2><p>The attributes processor modifies attributes of a span, log, or metric. This processor also supports the ability to filter and match input data to determine if they should be included or excluded for specified actions.</p><p>It takes a list of actions which are performed in order specified in the config. The supported actions are:</p><ul><li><code>insert</code>: Inserts a new attribute in input data where the key does not already exist.</li><li><code>update</code>: Updates an attribute in input data where the key does exist.</li><li><code>upsert</code>: Performs insert or update. Inserts a new attribute in input data where the key does not already exist and updates an attribute in input data where the key does exist.</li><li><code>delete</code>: Deletes an attribute from the input data.</li><li><code>hash</code>: Hashes (SHA1) an existing attribute value.</li><li><code>extract</code>: Extracts values using a regular expression rule from the input key to target keys specified in the rule. If a target key already exists, it will be overridden.</li></ul><p>We are going to create an attributes processor to <code>insert</code> a new attribute to all our host metrics called <code>participant.name</code> with a value of your own name e.g. <code>marge_simpson</code>.</p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div><div class=box-content><p>Ensure you replace <code>INSERT_YOUR_NAME_HERE</code> with your own name and also ensure you <strong>do not</strong> use spaces in your name.</p></div></div><p>Later on in the workshop we will use this attribute to filter our metrics in Splunk Observability Cloud.</p><div class=tab-panel data-tab-group=350345aa8e7b7f830956d57fd01ae862><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=attributes-processor-configuration class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("350345aa8e7b7f830956d57fd01ae862","attributes-processor-configuration")'>
<span class=tab-nav-text>Attributes Processor Configuration</span></button></div><div class=tab-content-container><div data-tab-item=attributes-processor-configuration class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>attributes/conf</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>participant.name</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;INSERT_YOUR_NAME_HERE&#34;</span></span></span></code></pre></div></div></div></div></div><hr><div class=expand><input type=checkbox id=R-expand-d2aed9bec0e2e6e9f44122fc27e8d867 aria-controls=R-expandcontent-d2aed9bec0e2e6e9f44122fc27e8d867>
<label class=expand-label for=R-expand-d2aed9bec0e2e6e9f44122fc27e8d867><i class="fas fa-chevron-down"></i>
<i class="fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Using connectors to gain internal insights</span></span></label><div id=R-expandcontent-d2aed9bec0e2e6e9f44122fc27e8d867 class=expand-content><p>One of the most recent additions to the collector was the notion of a <a href=https://opentelemetry.io/docs/collector/configuration/#connectors target=_blank>connector</a>, which allows you to join output of one pipeline to input of another pipeline.</p><p>An example of how this is beneficial is that some services emit metrics based on the amount of datapoints being exported, number of logs containing an error status,
or the amount of data being sent from one deployment environment. The count connector helps address this for you out of the box.</p><h2 id=why-a-connector-instead-of-a-processor>Why a connector instead of a processor?</h2><p>A processor is limited in what additional data it can produce considering it has to pass on the data it has processed making it hard to expose additional information. Connectors do not have to emit the data they received which means they provide an opportunity to create those insights we are after.</p><p>For example, a connector could be made to count the number of logs, metrics, and traces that do not have the deployment environment attribute.</p><p>A very simple example with the output of being able to break down data usage by deployment environment.</p><h2 id=considerations-with-connectors>Considerations with connectors</h2><p>A connector only accepts data exported from one pipeline and receiver by another pipeline, this means you may have to consider how you construct your collector config to take advantage of it.</p><h2 id=references>References</h2><ol><li><a href=https://opentelemetry.io/docs/collector/configuration/#connectors target=_blank>https://opentelemetry.io/docs/collector/configuration/#connectors</a></li><li><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/countconnector target=_blank>https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/countconnector</a></li></ol></div></div><hr><h2 id=configuration-check-in>Configuration Check-in</h2><p>That&rsquo;s processors covered, let&rsquo;s check our configuration changes.</p><hr><div class=expand><input type=checkbox id=R-expand-b899b91619e897c3e213a6eef7501609 aria-controls=R-expandcontent-b899b91619e897c3e213a6eef7501609>
<label class=expand-label for=R-expand-b899b91619e897c3e213a6eef7501609><i class="fas fa-chevron-down"></i>
<i class="fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>Review your configuration</span></span></label><div id=R-expandcontent-b899b91619e897c3e213a6eef7501609 class=expand-content><div class=tab-panel data-tab-group=8c41afb26acd179fef7bf84d36820118><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configyaml class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("8c41afb26acd179fef7bf84d36820118","configyaml")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div data-tab-item=configyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=hl><span class=lnt>58
</span></span><span class=hl><span class=lnt>59
</span></span><span class=hl><span class=lnt>60
</span></span><span class=hl><span class=lnt>61
</span></span><span class=hl><span class=lnt>62
</span></span><span class=hl><span class=lnt>63
</span></span><span class=hl><span class=lnt>64
</span></span><span class=hl><span class=lnt>65
</span></span><span class=hl><span class=lnt>66
</span></span><span class=hl><span class=lnt>67
</span></span><span class=hl><span class=lnt>68
</span></span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># process:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>attributes/conf</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>participant.name</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;INSERT_YOUR_NAME_HERE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></div><hr><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-exporters>OpenTelemetry Collector Exporters</h1><p>An exporter, which can be push or pull based, is how you send data to one or more backends/destinations. Exporters may support one or more data sources.</p><p>For this workshop, we will be using the <a href=https://opentelemetry.io/docs/specs/otel/protocol/exporter/ target=_blank><strong>otlphttp</strong></a> exporter. The OpenTelemetry Protocol (OTLP) is a vendor-neutral, standardised protocol for transmitting telemetry data. The OTLP exporter sends data to a server that implements the OTLP protocol. The OTLP exporter supports both <a href=https://grpc.io/ target=_blank><strong>gRPC</strong></a> and <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview target=_blank><strong>HTTP</strong></a>/<a href=https://www.json.org/json-en.html target=_blank><strong>JSON</strong></a> protocols.</p><pre class="mermaid align-center">
%%{
  init:{
    &#34;theme&#34;:&#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    style Exporters fill:#e20082,stroke:#333,stroke-width:4px,color:#fff
    subgraph Collector
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of OpenTelemetry Collector Exporters</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-exporters>OpenTelemetry Collector Exporters</h1><h2 id=otlp-http-exporter>OTLP HTTP Exporter</h2><p>In order to send metrics over HTTP to Splunk Observability Cloud, we will need to configure the <strong>otlphttp</strong> exporter.</p><p>Let&rsquo;s edit our <code>/etc/otelcol-contrib/config.yaml</code> file and configure the <strong>otlphttp</strong> exporter. Insert the following YAML under the <strong>exporters</strong> section, taking care to indent by two spaces e.g.</p><p>We will also change the verbosity of the logging exporter to prevent the disk filling up. The default of <code>detailed</code> is very noisy.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=l>otlphttp/splunk:</span></span></span></code></pre></div><p>Next we need to define the <code>metrics_endpoint</code> and configure the target URL.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>If you are an attendee to a Splunk hosted workshop, the instance your are using has already been configured with a Realm environment variable. We will reference that environment variable in our configuration file. Otherwise, you will need to create a new environment variable and set the Realm e.g.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>REALM</span><span class=o>=</span><span class=s2>&#34;us1&#34;</span></span></span></code></pre></div></div></div><p>The URL to use is <code>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</code>. (Splunk has Realms in key geographical locations around the world for data residency).</p><p>The <strong>otlphttp</strong> exporter can also be configured to send traces and logs by defining a target URL for <code>traces_endpoint</code> and <code>logs_endpoint</code> respectively. Configuring these is outside the scope of this workshop.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp/splunk</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>metrics_endpoint</span><span class=p>:</span><span class=w> </span><span class=l>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</span></span></span></code></pre></div><p>By default, <code>gzip</code> compression is enabled for all endpoints. This can be disabled by setting <code>compression: none</code> in the exporter configuration. We will leave compression enabled for this workshop and accept the default as this is the most efficient way to send data.</p><p>In order to send metrics to Splunk Observability Cloud, we need to use an Access Token. This can be done by creating a new token in the Splunk Observability Cloud UI. For more information on how to create a token, see <a href=https://docs.splunk.com/Observability/admin/authentication-tokens/org-tokens.html target=_blank>Create a token</a>. The token needs to be of type <strong>INGEST</strong>.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>If you are an attendee to a Splunk hosted workshop, the instance your are using has already been configured with an Access Token (which has been set as an environment variable). We will reference that environment variable in our configuration file. Otherwise, you will need to create a new token and set it as an environment variable e.g.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>ACCESS_TOKEN</span><span class=o>=</span>&lt;replace-with-your-token&gt;</span></span></code></pre></div></div></div><p>The token is defined in the configuration file by inserting <code>X-SF-TOKEN: ${env:ACCESS_TOKEN}</code> under a <code>headers:</code> section:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp/splunk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics_endpoint</span><span class=p>:</span><span class=w> </span><span class=l>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>X-SF-TOKEN</span><span class=p>:</span><span class=w> </span><span class=l>${env:ACCESS_TOKEN}</span></span></span></code></pre></div><h2 id=configuration-check-in>Configuration Check-in</h2><p>Now that we&rsquo;ve covered exporters, let&rsquo;s check our configuration changes:</p><hr><div class=expand><input type=checkbox id=R-expand-3882870a85c7a9e529eaf310c2d08d62 aria-controls=R-expandcontent-3882870a85c7a9e529eaf310c2d08d62>
<label class=expand-label for=R-expand-3882870a85c7a9e529eaf310c2d08d62><i class="fas fa-chevron-down"></i>
<i class="fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>Review your configuration</span></span></label><div id=R-expandcontent-3882870a85c7a9e529eaf310c2d08d62 class=expand-content><div class=tab-panel data-tab-group=75b4dcb104e49433b80b453953c1d534><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configyaml class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("75b4dcb104e49433b80b453953c1d534","configyaml")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div data-tab-item=configyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=hl><span class=lnt>72
</span></span><span class=hl><span class=lnt>73
</span></span><span class=hl><span class=lnt>74
</span></span><span class=hl><span class=lnt>75
</span></span><span class=hl><span class=lnt>76
</span></span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># process:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>attributes/conf</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>participant.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;INSERT_YOUR_NAME_HERE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>otlphttp/splunk</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>metrics_endpoint</span><span class=p>:</span><span class=w> </span><span class=l>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>X-SF-TOKEN</span><span class=p>:</span><span class=w> </span><span class=l>${env:ACCESS_TOKEN}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></div><hr><p>Of course, you can easily configure the <code>metrics_endpoint</code> to point to any other solution that supports the <strong>OTLP</strong> protocol.</p><p>Next, we need to enable the receivers, processors and exporters we have just configured in the service section of the <code>config.yaml</code>.</p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><p>The <strong>Service</strong> section is used to configure what components are enabled in the Collector based on the configuration found in the receivers, processors, exporters, and extensions sections.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>If a component is configured, but not defined within the <strong>Service</strong> section then it is <strong>not</strong> enabled.</p></div></div><p>The service section consists of three sub-sections:</p><ul><li>extensions</li><li>pipelines</li><li>telemetry</li></ul><p>In the default configuration, the extension section has been configured to enable <code>health_check</code>, <code>pprof</code> and <code>zpages</code>, which we configured in the Extensions module earlier.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></div><p>So lets configure our Metric Pipeline!</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of OpenTelemetry Collector Service</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><h2 id=hostmetrics-receiver>Hostmetrics Receiver</h2><p>If you recall from the Receivers portion of the workshop, we defined the <a href=../../en/other/opentelemetry-collector/3-receivers/index.html#host-metrics-receiver>Host Metrics Receiver</a> to generate metrics about the host system, which are scraped from various sources. To enable the receiver, we must include the <code>hostmetrics</code> receiver in the metrics pipeline.</p><p>In the <code>metrics</code> pipeline, add <code>hostmetrics</code> to the metrics <code>receivers</code> section.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span></span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><h2 id=prometheus-internal-receiver>Prometheus Internal Receiver</h2><p>Earlier in the workshop, we also renamed the <code>prometheus</code> receiver to reflect that is was collecting metrics internal to the collector, renaming it to <code>prometheus/internal</code>.</p><p>We now need to enable the <code>prometheus/internal</code> receiver under the metrics pipeline. Update the <code>receivers</code> section to include <code>prometheus/internal</code> under the <code>metrics</code> pipeline:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span></span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><h2 id=resource-detection-processor>Resource Detection Processor</h2><p>We also added <code>resourcedetection/system</code> and <code>resourcedetection/ec2</code> processors so that the collector can capture the instance hostname and AWS/EC2 metadata. We now need to enable these two processors under the metrics pipeline.</p><p>Update the <code>processors</code> section to include <code>resourcedetection/system</code> and <code>resourcedetection/ec2</code> under the <code>metrics</code> pipeline:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch, resourcedetection/system, resourcedetection/ec2]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span></span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><h2 id=attributes-processor>Attributes Processor</h2><p>Also in the Processors section of this workshop, we added the <code>attributes/conf</code> processor so that the collector will inset a new attribute called <code>participant.name</code> to all the metrics. We now need to enable this under the metrics pipeline.</p><p>Update the <code>processors</code> section to include <code>attributes/conf</code> under the <code>metrics</code> pipeline:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch, resourcedetection/system, resourcedetection/ec2, attributes/conf]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span></span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><h2 id=otlp-http-exporter>OTLP HTTP Exporter</h2><p>In the Exporters section of the workshop, we configured the <code>otlphttp</code> exporter to send metrics to Splunk Observability Cloud. We now need to enable this under the metrics pipeline.</p><p>Update the <code>exporters</code> section to include <code>otlphttp/splunk</code> under the <code>metrics</code> pipeline:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch, resourcedetection/system, resourcedetection/ec2, attributes/conf]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging, otlphttp/splunk]</span></span></span></code></pre></div><hr><div class=expand><input type=checkbox id=R-expand-ce20c204cffae3eca6623a72c0cce17f aria-controls=R-expandcontent-ce20c204cffae3eca6623a72c0cce17f>
<label class=expand-label for=R-expand-ce20c204cffae3eca6623a72c0cce17f><i class="fas fa-chevron-down"></i>
<i class="fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Observing the collector internals</span></span></label><div id=R-expandcontent-ce20c204cffae3eca6623a72c0cce17f class=expand-content><p>The collector captures internal signals about its behavior this also include additional signals from running components.
The reason for this is that components that make decisions about the flow of data need a way to surface that information
as metrics or traces.</p><h2 id=why-monitor-the-collector>Why monitor the collector?</h2><p>This is somewhat of a chicken and egg problem of, &ldquo;Who is watching the the watcher?&rdquo;, but it is important that we can surface this information. Another interesting part of the collector&rsquo;s history is that it existed before the Go metrics&rsquo; SDK was considered stable so the collector exposes a prometheus endpoint to provide this functionality for the time being.</p><h2 id=considerations>Considerations</h2><p>Monitoring the internal usage of each running collector in your organisation can contribute a significant amount of new Metric Time Series (MTS). The Splunk distribution has curated these metrics for you and would be able to to help forcast the expected increases.</p><h2 id=the-ninja-zone>The Ninja Zone</h2><p>To expose the internal observability of the collector, there are some additional settings that can be adjusted:</p><div class=tab-panel data-tab-group=d0d8339bcc930ac099f08fd0896005f2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=telemetry-schema class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("d0d8339bcc930ac099f08fd0896005f2","telemetry-schema")'>
<span class=tab-nav-text>telemetry schema</span></button>
<button data-tab-item=example-configyml class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("d0d8339bcc930ac099f08fd0896005f2","example-configyml")'>
<span class=tab-nav-text>example-config.yml</span></button></div><div class=tab-content-container><div data-tab-item=telemetry-schema class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>telemetry</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>&lt;info|warn|error&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>development</span><span class=p>:</span><span class=w> </span><span class=l>&lt;true|false&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>encoding</span><span class=p>:</span><span class=w> </span><span class=l>&lt;console|json&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disable_caller</span><span class=p>:</span><span class=w> </span><span class=l>&lt;true|false&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disable_stacktrace</span><span class=p>:</span><span class=w> </span><span class=l>&lt;true|false&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>output_paths</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>&lt;stdout|stderr&gt;, paths...]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>error_output_paths</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>&lt;stdout|stderr&gt;, paths...]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>initial_fields</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>&lt;none|basic|normal|detailed&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Address binds the promethues endpoint to scrape</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class=l>&lt;hostname:port&gt;</span></span></span></code></pre></div></div></div><div data-tab-item=example-configyml class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>telemetry</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>info</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>encoding</span><span class=p>:</span><span class=w> </span><span class=l>json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disable_stacktrace</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>initial_fields</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>instance.name</span><span class=p>:</span><span class=w> </span><span class=l>${env:INSTANCE}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class=l>localhost:8888 </span></span></span></code></pre></div></div></div></div></div><h2 id=references>References</h2><ol><li><a href=https://opentelemetry.io/docs/collector/configuration/#service target=_blank>https://opentelemetry.io/docs/collector/configuration/#service</a></li></ol></div></div><hr><h2 id=final-configuration>Final configuration</h2><hr><div class=expand><input type=checkbox id=R-expand-0de4b4fbe8d9559407eb8b496ff83627 aria-controls=R-expandcontent-0de4b4fbe8d9559407eb8b496ff83627>
<label class=expand-label for=R-expand-0de4b4fbe8d9559407eb8b496ff83627><i class="fas fa-chevron-down"></i>
<i class="fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>Review your final configuration</span></span></label><div id=R-expandcontent-0de4b4fbe8d9559407eb8b496ff83627 class=expand-content><div class=tab-panel data-tab-group=02e5ead21f03340eaa9f2b967a600064><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configyaml class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("02e5ead21f03340eaa9f2b967a600064","configyaml")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div data-tab-item=configyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># process:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>attributes/conf</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>participant.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;INSERT_YOUR_NAME_HERE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp/splunk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics_endpoint</span><span class=p>:</span><span class=w> </span><span class=l>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>X-SF-TOKEN</span><span class=p>:</span><span class=w> </span><span class=l>${env:ACCESS_TOKEN}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch, resourcedetection/system, resourcedetection/ec2, attributes/conf] </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging, otlphttp/splunk]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></div><hr><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Tip</div><div class=box-content><p>It is recommended that you validate your configuration file before restarting the collector. You can do this by using the built-in <code>validate</code> command:</p><div class=tab-panel data-tab-group=0b3a6f3ae18c370da2204c3a06f66c3b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("0b3a6f3ae18c370da2204c3a06f66c3b","command")'>
<span class=tab-nav-text>Command</span></button>
<button data-tab-item=example-error-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("0b3a6f3ae18c370da2204c3a06f66c3b","example-error-output")'>
<span class=tab-nav-text>Example error output</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>otelcol-contrib validate --config<span class=o>=</span>file:/etc/otelcol-contrib/config.yaml</span></span></code></pre></div></div></div><div data-tab-item=example-error-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Error: failed to get config: cannot unmarshal the configuration: 1 error(s) decoding:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>* error decoding &#39;processors&#39;: error reading configuration for &#34;attributes/conf&#34;: 1 error(s) decoding:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>* &#39;actions[0]&#39; has invalid keys: actions
</span></span><span class=line><span class=cl>2023/06/29 09:41:28 collector server run finished with error: failed to get config: cannot unmarshal the configuration: 1 error(s) decoding:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>* error decoding &#39;processors&#39;: error reading configuration for &#34;attributes/conf&#34;: 1 error(s) decoding:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>* &#39;actions[0]&#39; has invalid keys: actions</span></span></code></pre></div></div></div></div></div></div></div><p>Now that we have a working configuration, let&rsquo;s start the collector and then check to see what <a href=../../en/other/opentelemetry-collector/2-extensions/index.html#zpages>zPages</a> is reporting.</p><div class=tab-panel data-tab-group=6ff2446a9bc84ecabdf9c34caec001f4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("6ff2446a9bc84ecabdf9c34caec001f4","command")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div data-tab-item=command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>otelcol-contrib --config<span class=o>=</span>file:/etc/otelcol-contrib/config.yaml</span></span></code></pre></div></div></div></div></div><p><a href=#R-image-9b68c29d0f8a39b174ddb877e5601566 class=lightbox-link><img src=../../en/other/opentelemetry-collector/6-service/5-otlphttp/../../images/pipelinez-full-config.png alt=pipelinez-full-config class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9b68c29d0f8a39b174ddb877e5601566><img src=../../en/other/opentelemetry-collector/6-service/5-otlphttp/../../images/pipelinez-full-config.png alt=pipelinez-full-config class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=data-visualisations>Data Visualisations</h1><h2 id=splunk-observability-cloud>Splunk Observability Cloud</h2><p>Now that we have configured the OpenTelemetry Collector to send metrics to Splunk Observability Cloud, let&rsquo;s take a look at the data in Splunk Observability Cloud. If you have not received an invite to Splunk Observability Cloud, your instructor will provide you with login credentials.</p><p>Before that, lets make things a little more interesting and run a stress test on the instance. This in turn will light up the dashboards.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install stress
</span></span><span class=line><span class=cl><span class=k>while</span> true<span class=p>;</span> <span class=k>do</span> stress -c <span class=m>2</span> -t 40<span class=p>;</span> stress -d <span class=m>5</span> -t 40<span class=p>;</span> stress -m <span class=m>20</span> -t 40<span class=p>;</span> <span class=k>done</span></span></span></code></pre></div><p>Once you are logged into Splunk Observability Cloud, using the left-hand navigation, navigate to <strong>Dashboards</strong>:</p><p><a href=#R-image-842981c0da5e952ef038f6da3bfafeef class=lightbox-link><img src=../../en/other/opentelemetry-collector/7-visualisation/../images/menu-dashboards.png alt=menu-dashboards class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-842981c0da5e952ef038f6da3bfafeef><img src=../../en/other/opentelemetry-collector/7-visualisation/../images/menu-dashboards.png alt=menu-dashboards class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>In the search box, search for <strong>OTel Contrib</strong>:</p><p><a href=#R-image-d0fdd724a26dc3b5a8832c0ede0e2523 class=lightbox-link><img src=../../en/other/opentelemetry-collector/7-visualisation/../images/search-dashboards.png alt=search-dashboards class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d0fdd724a26dc3b5a8832c0ede0e2523><img src=../../en/other/opentelemetry-collector/7-visualisation/../images/search-dashboards.png alt=search-dashboards class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>If the dashboard does not exist, then your instructor will be able to quickly add it. If you are not attending a Splunk hosted version of this workshop then the Dashboard Group to import can be found at the bottom of this page.</p></div></div><p>Click on the <strong>OTel Contrib Dashboard</strong> dashboard to open it:</p><p><a href=#R-image-ddb16585a8f7900233d288a408052f1e class=lightbox-link><img src=../../en/other/opentelemetry-collector/7-visualisation/../images/otel-dashboard.png alt=otel-dashboard class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ddb16585a8f7900233d288a408052f1e><img src=../../en/other/opentelemetry-collector/7-visualisation/../images/otel-dashboard.png alt=otel-dashboard class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>In the <strong>Filter</strong> box, at the top of the dashboard, type in <strong>participant</strong> and select <strong>participant.name</strong>:</p><p><a href=#R-image-cb80dc18661e4ce05983ac136f47efc8 class=lightbox-link><img src=../../en/other/opentelemetry-collector/7-visualisation/../images/search-filter.png alt=search-filter class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-cb80dc18661e4ce05983ac136f47efc8><img src=../../en/other/opentelemetry-collector/7-visualisation/../images/search-filter.png alt=search-filter class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You can either start typing in your name you configured for <code>participant.name</code> in the <code>config.yaml</code> or you can select your name from the list:</p><p><a href=#R-image-fd78eca1b7449d7a0a0f4877831fd8fc class=lightbox-link><img src=../../en/other/opentelemetry-collector/7-visualisation/../images/select-participant-name.png alt=select-conf-attendee-name class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fd78eca1b7449d7a0a0f4877831fd8fc><img src=../../en/other/opentelemetry-collector/7-visualisation/../images/select-participant-name.png alt=select-conf-attendee-name class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>You can now see the host metrics for the host upon which you configured the OpenTelemetry Collector.</p><div class="box attachments cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Download Dashboard JSON for importing</div><ul class="box-content attachments-files"><li><a href=../../en/other/opentelemetry-collector/7-visualisation/index.files/dashboard_OTel-Contrib-Dashboard.json>dashboard_OTel-Contrib-Dashboard.json</a> (40 KB)</li></ul></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-development>OpenTelemetry Collector Development</h1><h2 id=developing-a-custom-component>Developing a custom component</h2><p>Building a component for the Open Telemetry Collector requires three key parts:</p><ol><li>The Configuration - <em>What values are exposed to the user to configure</em></li><li>The Factory - <em>Make the component using the provided values</em></li><li>The Business Logic - <em>What the component needs to do</em></li></ol><p>For this, we will use the example of building a component that works with Jenkins so that we can track important DevOps metrics of our project(s).</p><p>The metrics we are looking to measure are:</p><ol><li>Lead time for changes - <em>&ldquo;How long it takes for a commit to get into production&rdquo;</em></li><li>Change failure rate - <em>&ldquo;The percentage of deployments causing a failure in production&rdquo;</em></li><li>Deployment frequency - <em>&ldquo;How often a [team] successfully releases to production&rdquo;</em></li><li>Mean time to recover - <em>&ldquo;How long does it take for a [team] to recover from a failure in production&rdquo;</em></li></ol><p>These indicators were identified Google&rsquo;s DevOps Research and Assesment (DORA)[^1] team to help
show performance of a software development team. The reason for choosing <em>Jenkins CI</em> is that we remain in the same Open Source Software ecosystem which we can serve as the example for the vendor managed CI tools to adopt in future.</p><h2 id=instrument-vs-component>Instrument Vs Component</h2><p>There is something to consider when improving level of Observability within your organisation
since there are some trade offs that get made.</p><table><thead><tr><th></th><th>Pros</th><th>Cons</th></tr></thead><tbody><tr><td><strong>(Auto) Instrumented</strong></td><td>Does not require an external API to be monitored in order to observe the system.</td><td>Changing instrumentation requires changes to the project.</td></tr><tr><td></td><td>Gives system owners/developers to make changes in their observability.</td><td>Requires additional runtime dependancies.</td></tr><tr><td></td><td>Understands system context and can corrolate captured data with <em>Exemplars</em>.</td><td>Can impact performance of the system.</td></tr><tr><td><strong>Component</strong></td><td>- Changes to data names or semantics can be rolled out independently of the system&rsquo;s release cycle.</td><td>Breaking API changes require a coordinated release between system and collector.</td></tr><tr><td></td><td>Updating/extending data collected is a seemless user facing change.</td><td>Captured data semantics can unexpectedly break that does not align with a new system release.</td></tr><tr><td></td><td>Does not require the supporting teams to have a deep understanding of observability practice.</td><td>Strictly external / exposed information can be surfaced from the system.</td></tr></tbody></table><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of OpenTelemetry Collector Development</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-development>OpenTelemetry Collector Development</h1><h2 id=project-setup-hahahugoshortcode183s0hbhb>Project Setup <span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja</strong></span></span></h2><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>The time to finish this section of the workshop can vary depending on experience.</p><p>A complete solution can be found <a href=https://github.com/splunk/collector-workshop-example target=_blank>here</a> incase you&rsquo;re stuck or want to follow
along with the instructor.</p></div></div><p>To get started developing a the new <em>Jenkins CI</em> receiver, we first need to set up a Golang project.
The steps to create your new Golang project is:</p><ol><li>Create a new directoy named <code>${HOME}/go/src/jenkinscireceiver</code> and change into it<ol><li>The actual directory name or location is not strict, you can choose your own development directory to make it in.</li></ol></li><li>Initialise the golang module by going <code>go mod init splunk.conf/workshop/example/jenkinscireceiver</code><ol><li>This will create a file named <code>go.mod</code> which is used to track our direct and indirect dependencies</li><li>Eventually there will be a <code>go.sum</code> which is the checksum values of the depedancies being imported.</li></ol></li></ol><div class=expand><input type=checkbox id=R-expand-c34aff30ccf969d3c169c173fe1e3be1 aria-controls=R-expandcontent-c34aff30ccf969d3c169c173fe1e3be1>
<label class=expand-label for=R-expand-c34aff30ccf969d3c169c173fe1e3be1><i class="fas fa-chevron-down"></i>
<i class="fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>Review your go.mod</span></span></label><div id=R-expandcontent-c34aff30ccf969d3c169c173fe1e3be1 class=expand-content><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>module splunk.conf/workshop/example/jenkinscireceiver
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>go 1.20</span></span></code></pre></div></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-development>OpenTelemetry Collector Development</h1><h2 id=building-the-configuration>Building The Configuration</h2><p>The configuration portion of the component is how the user is able to have their inputs over the component,
so the values that is used for the configuration need to be:</p><ol><li>Intuitive for users to understand what that field controls</li><li>Be explicit in what is required and what is optional</li><li>Reuse common names and fields</li><li>Keep the options simple</li></ol><div class=tab-panel data-tab-group=327f23048bdf8e2656d64f687f4d0e99><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=bad-config class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("327f23048bdf8e2656d64f687f4d0e99","bad-config")'>
<span class=tab-nav-text>bad config</span></button>
<button data-tab-item=good-config class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("327f23048bdf8e2656d64f687f4d0e99","good-config")'>
<span class=tab-nav-text>good config</span></button></div><div class=tab-content-container><div data-tab-item=bad-config class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jenkins_server_addr</span><span class=p>:</span><span class=w> </span><span class=l>hostname</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jenkins_server_api_port</span><span class=p>:</span><span class=w> </span><span class=m>8089</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>10m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>filter_builds_by</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-awesome-build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class=l>amber</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>track</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>example.metric.1</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>example.metric.2</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>example.metric.3</span><span class=p>:</span><span class=w> </span><span class=kc>no</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>example.metric.4</span><span class=p>:</span><span class=w> </span><span class=kc>no</span></span></span></code></pre></div></div></div><div data-tab-item=good-config class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Required Values</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=l>http://my-jenkins-server:8089</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>auth</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>authenticator</span><span class=p>:</span><span class=w> </span><span class=l>basicauth/jenkins</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Optional Values</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example.metric.1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example.metric.2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example.metric.3</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example.metric.4</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span></span></span></code></pre></div></div></div></div></div><p>The bad configuration highlights how doing the opposite of the recommendations of configuration practices impacts the usability
of the component. It doesn&rsquo;t make it clear what field values should be, it includes features that can be pushed to existing processors,
and the field naming is not consistent with other components that exist in the collector.</p><p>The good configuration keeps the required values simple, reuses field names from other components, and ensures the component focuses on
just the interaction between Jenkins and the collector.</p><p>The code tab shows how much is required to be added by us and what is already provided for us by shared libraries within the collector.
These will be explained in more detail once we get to the business logic. The configuration should start off small and will change
once the business logic has started to include additional features that is needed.</p><h2 id=write-the-code>Write the code</h2><p>In order to implement the code needed for the configuration, we are going to create a new file named <code>config.go</code> with the following content:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/config/confighttp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver/scraperhelper&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;splunk.conf/workshop/example/jenkinscireceiver/internal/metadata&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Config</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// HTTPClientSettings contains all the values
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// that are commonly shared across all HTTP interactions
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// performed by the collector.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>confighttp</span><span class=p>.</span><span class=nx>HTTPClientSettings</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ScraperControllerSettings will allow us to schedule 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// how often to check for updates to builds.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>scraperhelper</span><span class=p>.</span><span class=nx>ScraperControllerSettings</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl>    <span class=c1>// MetricsBuilderConfig contains all the metrics
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// that can be configured.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>metadata</span><span class=p>.</span><span class=nx>MetricsBuilderConfig</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-development>OpenTelemetry Collector Development</h1><h2 id=component-review>Component Review</h2><p>To recap the type of component we will need to in order to capture metrics from Jenkins:</p><div class=tab-panel data-tab-group=30471809003784ed4216ef720d48cb54><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=extension class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("30471809003784ed4216ef720d48cb54","extension")'>
<span class=tab-nav-text>Extension</span></button>
<button data-tab-item=receiver class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("30471809003784ed4216ef720d48cb54","receiver")'>
<span class=tab-nav-text>Receiver</span></button>
<button data-tab-item=processor class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("30471809003784ed4216ef720d48cb54","processor")'>
<span class=tab-nav-text>Processor</span></button>
<button data-tab-item=exporter class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("30471809003784ed4216ef720d48cb54","exporter")'>
<span class=tab-nav-text>Exporter</span></button>
<button data-tab-item=ninja-connectors class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("30471809003784ed4216ef720d48cb54","ninja-connectors")'>
<span class=tab-nav-text><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Connectors</span></span></span></button></div><div class=tab-content-container><div data-tab-item=extension class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p>The business use case an extension helps solves for are:</p><ol><li>Having shared functionality that requires runtime configuration</li><li>Indirectly helps with observing the runtime of the collector</li></ol><p>See <a href=../../en/other/opentelemetry-collector/2-extensions/index.html>Extensions Overview</a> for more details.</p></div></div><div data-tab-item=receiver class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>The business use case a receiver solves for:</p><ul><li>Fetching data from a remote source</li><li>Receiving data from remote source(s)</li></ul><p>This are commonly referred to <em>pull</em> vs <em>push</em> based data collection, and you read more about the details in the <a href=../../en/other/opentelemetry-collector/3-receivers/index.html>Receiver Overview</a>.</p></div></div><div data-tab-item=processor class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>The business use case a processor solves for is:</p><ul><li>Adding or removing data, fields, or values</li><li>Observing and making decisions on the data</li><li>Buffering, queueing, and reordering</li></ul><p>The thing to keep in mind that the data type flowing through a processor needs to use the forward
the same data type to its downstream components.
Read through <a href=../../en/other/opentelemetry-collector/4-processors/index.html>Processor Overview</a> for the details.</p></div></div><div data-tab-item=exporter class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>The business use case an exporter solves for:</p><ul><li>Send the data to a tool, service, or storage</li></ul><p>The OpenTelemetry collector does not want to be &ldquo;backend&rdquo;, an all in one observability suite, but rather
keep to the principles that founded OpenTelemetry to begin with; A vendor agnostic Observability for all.
To help revisit the details, please read through <a href=../../en/other/opentelemetry-collector/5-exporters/index.html>Exporter Overview</a>.</p></div></div><div data-tab-item=ninja-connectors class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>This is a component type that was missed in the workshop since it is a relatively new addition to the collector,
but the best way to think about a connector is that it is like a processor that allows to be used across different
telemetry types, and pipelines. Meaning that a connector can accept data as logs, and output metrics, or accept
metrics from one pipeline and provide metrics on the data it has observed.</p><p>The business case that a connector solves for:</p><ul><li>Converting from different telemetry types<ul><li>logs to metrics</li><li>traces to metrics</li><li>metrics to logs</li></ul></li><li>Observing incoming data and producing its own data<ul><li>Accepting metrics and generating analytical metrics of the data.</li></ul></li></ul><p>There was a brief overview within the <strong>Ninja</strong> section as part of the <a href=../../en/other/opentelemetry-collector/4-processors/index.html>Processor Overview</a>,
and be sure what the project for updates for new connector components.</p></div></div></div></div><p>From the component overviews, it is clear that developing a pull based receiver for Jenkins.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-development>OpenTelemetry Collector Development</h1><h3 id=designing-the-metrics>Designing The Metrics</h3><p>To help define and export the metrics captured by our receiver, we will be using, <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/cmd/mdatagen target=_blank>mdatagen</a>, a tool developed for the collector that turns yaml defined metrics into code.</p><div class=tab-panel data-tab-group=e76877c49dc2ee250010f58c730669e6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=metadatayaml class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("e76877c49dc2ee250010f58c730669e6","metadatayaml")'>
<span class=tab-nav-text>metadata.yaml</span></button>
<button data-tab-item=gengo class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("e76877c49dc2ee250010f58c730669e6","gengo")'>
<span class=tab-nav-text>gen.go</span></button></div><div class=tab-content-container><div data-tab-item=metadatayaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Type defines the name to reference the component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># in the configuration file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>jenkins</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Status defines the component type and the stability level</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>status</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>class</span><span class=p>:</span><span class=w> </span><span class=l>receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stability</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>development</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>metrics]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Attributes are the expected fields reported</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># with the exported values.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job.name</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>The name of the associated Jenkins job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job.status</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>Shows if the job had passed, or failed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enum</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>failed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>success</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>unknown</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Metrics defines all the pontentially exported values from this receiver. </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jenkins.jobs.count</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>Provides a count of the total number of configured jobs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{Count}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>gauge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value_type</span><span class=p>:</span><span class=w> </span><span class=l>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jenkins.job.duration</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>Show the duration of the job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;s&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>gauge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value_type</span><span class=p>:</span><span class=w> </span><span class=l>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>job.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>job.status</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jenkins.job.commit_delta</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>The calculation difference of the time job was finished minus commit timestamp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;s&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>gauge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value_type</span><span class=p>:</span><span class=w> </span><span class=l>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>job.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>job.status</span></span></span></code></pre></div></div></div><div data-tab-item=gengo class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// To generate the additional code needed to capture metrics, 
</span></span></span><span class=line><span class=cl><span class=c1>// the following command to be run from the shell:
</span></span></span><span class=line><span class=cl><span class=c1>//  go generate -x ./...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>//go:generate go run github.com/open-telemetry/opentelemetry-collector-contrib/cmd/mdatagen@v0.80.0 metadata.yaml
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// There is no code defined within this file.
</span></span></span></code></pre></div></div></div></div></div><p>Create these files within the project folder before continuing onto the next section.</p><h2 id=building-the-factory>Building The Factory</h2><p>The Factory is a software design pattern that effectively allows for an object, in this case a <code>jenkinscireceiver</code>, to be created
dynamically with the provided configuration. To use a more real world example, it would be going to a phone store, asking for a phone
that matches your exact description, and then provides it to you.</p><p>Run the following command <code>go generate -x ./...</code> , it will create a new folder, <code>jenkinscireceiver/internal/metadata</code>,
that contains all code required to export the defined metrics. The required code is:</p><div class=tab-panel data-tab-group=20962f1b478aba74179c05ab67b7e792><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=factorygo class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("20962f1b478aba74179c05ab67b7e792","factorygo")'>
<span class=tab-nav-text>factory.go</span></button>
<button data-tab-item=configgo class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("20962f1b478aba74179c05ab67b7e792","configgo")'>
<span class=tab-nav-text>config.go</span></button>
<button data-tab-item=scrapergo class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("20962f1b478aba74179c05ab67b7e792","scrapergo")'>
<span class=tab-nav-text>scraper.go</span></button>
<button data-tab-item=build-configyaml class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("20962f1b478aba74179c05ab67b7e792","build-configyaml")'>
<span class=tab-nav-text>build-config.yaml</span></button>
<button data-tab-item=project-layout class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("20962f1b478aba74179c05ab67b7e792","project-layout")'>
<span class=tab-nav-text>project layout</span></button></div><div class=tab-content-container><div data-tab-item=factorygo class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;errors&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/component&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/config/confighttp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver/scraperhelper&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;splunk.conf/workshop/example/jenkinscireceiver/internal/metadata&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewFactory</span><span class=p>()</span> <span class=nx>receiver</span><span class=p>.</span><span class=nx>Factory</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>receiver</span><span class=p>.</span><span class=nf>NewFactory</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>metadata</span><span class=p>.</span><span class=nx>Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>newDefaultConfig</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>receiver</span><span class=p>.</span><span class=nf>WithMetrics</span><span class=p>(</span><span class=nx>newMetricsReceiver</span><span class=p>,</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>MetricsStability</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>newMetricsReceiver</span><span class=p>(</span><span class=nx>_</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>set</span> <span class=nx>receiver</span><span class=p>.</span><span class=nx>CreateSettings</span><span class=p>,</span> <span class=nx>cfg</span> <span class=nx>component</span><span class=p>.</span><span class=nx>Config</span><span class=p>,</span> <span class=nx>consumer</span> <span class=nx>consumer</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>)</span> <span class=p>(</span><span class=nx>receiver</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Convert the configuration into the expected type
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>conf</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>cfg</span><span class=p>.(</span><span class=o>*</span><span class=nx>Config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>!</span><span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;can not convert config&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>sc</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>newScraper</span><span class=p>(</span><span class=nx>conf</span><span class=p>,</span> <span class=nx>set</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>NewScraperControllerReceiver</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&amp;</span><span class=nx>conf</span><span class=p>.</span><span class=nx>ScraperControllerSettings</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>set</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>consumer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>AddScraper</span><span class=p>(</span><span class=nx>sc</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div data-tab-item=configgo class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/config/confighttp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver/scraperhelper&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;splunk.conf/workshop/example/jenkinscireceiver/internal/metadata&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Config</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// HTTPClientSettings contains all the values
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// that are commonly shared across all HTTP interactions
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// performed by the collector.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>confighttp</span><span class=p>.</span><span class=nx>HTTPClientSettings</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ScraperControllerSettings will allow us to schedule 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// how often to check for updates to builds.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>scraperhelper</span><span class=p>.</span><span class=nx>ScraperControllerSettings</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl>    <span class=c1>// MetricsBuilderConfig contains all the metrics
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// that can be configured.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>metadata</span><span class=p>.</span><span class=nx>MetricsBuilderConfig</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>newDefaultConfig</span><span class=p>()</span> <span class=nx>component</span><span class=p>.</span><span class=nx>Config</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>Config</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ScraperControllerSettings</span><span class=p>:</span> <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>NewDefaultScraperControllerSettings</span><span class=p>(</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>Type</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>HTTPClientSettings</span><span class=p>:</span>        <span class=nx>confighttp</span><span class=p>.</span><span class=nf>NewDefaultHTTPClientSettings</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=nx>MetricsBuilderConfig</span><span class=p>:</span>      <span class=nx>metadata</span><span class=p>.</span><span class=nf>DefaultMetricsBuilderConfig</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div data-tab-item=scrapergo class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>scraper</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>newScraper</span><span class=p>(</span><span class=nx>cfg</span> <span class=o>*</span><span class=nx>Config</span><span class=p>,</span> <span class=nx>set</span> <span class=nx>receiver</span><span class=p>.</span><span class=nx>CreateSettings</span><span class=p>)</span> <span class=p>(</span><span class=nx>scraperhelper</span><span class=p>.</span><span class=nx>Scraper</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Create a our scraper with our values 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>s</span> <span class=o>:=</span> <span class=nx>scraper</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// To be filled in later
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>NewScraper</span><span class=p>(</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>Type</span><span class=p>,</span> <span class=nx>s</span><span class=p>.</span><span class=nx>scrape</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>scraper</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// To be filled in
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nx>pmetrics</span><span class=p>.</span><span class=nf>NewMetrics</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div data-tab-item=build-configyaml class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>dist</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>otelcol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Conf workshop collector&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>output_path</span><span class=p>:</span><span class=w> </span><span class=l>./dist</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>v0.0.0-experimental</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/extension/basicauthextension v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/extension/healthcheckextension v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/receiver/otlpreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/jaegerreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/prometheusreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>splunk.conf/workshop/example/jenkinscireceiver v0.0.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./jenkinscireceiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/processor/batchprocessor v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/loggingexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/otlpexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/otlphttpexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># This replace is a go directive that allows for redefine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># where to fetch the code to use since the default would be from a remote project.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>replaces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>splunk.conf/workshop/example/jenkinscireceiver =&gt; ./jenkinscireceiver</span></span></span></code></pre></div></div></div><div data-tab-item=project-layout class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>├── build-config.yaml
</span></span><span class=line><span class=cl>└── jenkinscireceiver
</span></span><span class=line><span class=cl>    ├── go.mod
</span></span><span class=line><span class=cl>    ├── config.go
</span></span><span class=line><span class=cl>    ├── factory.go
</span></span><span class=line><span class=cl>    ├── scraper.go
</span></span><span class=line><span class=cl>    └── internal
</span></span><span class=line><span class=cl>      └── metadata</span></span></code></pre></div></div></div></div></div><p>Once you have written these file into the project with the expected contents then run, <code>go mod tidy</code>, which will fetch all the remote depedancies and update <code>go.mod</code> and generate the <code>go.sum</code> files.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-development>OpenTelemetry Collector Development</h1><h2 id=building-the-business-logic>Building The Business Logic</h2><p>At this point, we have a custom component that currently does nothing so we need to add in the required
logic to capture this data from Jenkins.</p><p>From this point, the steps that we need to take are:</p><ol><li>Create a client that connect to Jenkins</li><li>Capture all the configured jobs</li><li>Report the status of the last build for the configured job</li><li>Calculate the time difference between commit timestamp and job completion.</li></ol><p>The changes will be made to <code>scraper.go</code>.</p><div class=tab-panel data-tab-group=d7181071dc4ae306bd4d62fcb557941e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=add-jenkins-client class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("d7181071dc4ae306bd4d62fcb557941e","add-jenkins-client")'>
<span class=tab-nav-text><ol><li>Add Jenkins client</li></ol></span></button>
<button data-tab-item=capture-all-configured-jobs class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("d7181071dc4ae306bd4d62fcb557941e","capture-all-configured-jobs")'>
<span class=tab-nav-text><ol start=2><li>Capture all configured jobs</li></ol></span></button>
<button data-tab-item=report-the-status-of-each-job class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("d7181071dc4ae306bd4d62fcb557941e","report-the-status-of-each-job")'>
<span class=tab-nav-text><ol start=3><li>Report the status of each job</li></ol></span></button>
<button data-tab-item=report-the-delta class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("d7181071dc4ae306bd4d62fcb557941e","report-the-delta")'>
<span class=tab-nav-text><ol start=4><li>Report the delta</li></ol></span></button></div><div class=tab-content-container><div data-tab-item=add-jenkins-client class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p>To be able to connect to the Jenkins server, we will be using the package,
<a href=https://pkg.go.dev/github.com/yosida95/golang-jenkins target=_blank>&ldquo;github.com/yosida95/golang-jenkins&rdquo;</a>,
which provides the functionality required to read data from the jenkins server.</p><p>Then we are going to utilise some of the helper functions from the,
<a href=https://pkg.go.dev/go.opentelemetry.io/collector/receiver/scraperhelper target=_blank>&ldquo;go.opentelemetry.io/collector/receiver/scraperhelper&rdquo;</a> ,
library to create a start function so that we can connect to the Jenkins server once component has finished starting.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>jenkins</span> <span class=s>&#34;github.com/yosida95/golang-jenkins&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/component&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/pdata/pmetric&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver/scraperhelper&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;splunk.conf/workshop/example/jenkinscireceiver/internal/metadata&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>scraper</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>mb</span>     <span class=o>*</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>Metricsbuilder</span>
</span></span><span class=line><span class=cl>    <span class=nx>client</span> <span class=o>*</span><span class=nx>jenkins</span><span class=p>.</span><span class=nx>Jenkins</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>newScraper</span><span class=p>(</span><span class=nx>cfg</span> <span class=o>*</span><span class=nx>Config</span><span class=p>,</span> <span class=nx>set</span> <span class=nx>receiver</span><span class=p>.</span><span class=nx>CreateSettings</span><span class=p>)</span> <span class=p>(</span><span class=nx>scraperhelper</span><span class=p>.</span><span class=nx>Scraper</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>s</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>scraper</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>mb</span> <span class=p>:</span> <span class=nx>metadata</span><span class=p>.</span><span class=nf>NewMetricsBuilder</span><span class=p>(</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>MetricsBuilderConfig</span><span class=p>,</span> <span class=nx>set</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>NewScraper</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>metadata</span><span class=p>.</span><span class=nx>Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>s</span><span class=p>.</span><span class=nx>scrape</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>scarperhelper</span><span class=p>.</span><span class=nf>WithStart</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>h</span> <span class=nx>component</span><span class=p>.</span><span class=nx>Host</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>cfg</span><span class=p>.</span><span class=nf>ToClient</span><span class=p>(</span><span class=nx>h</span><span class=p>,</span> <span class=nx>set</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=c1>// The collector provides a means of injecting authentication
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// on our behalf, so this will ignore the libraries approach
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// and use the configured http client with authentication.
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>s</span><span class=p>.</span><span class=nx>client</span> <span class=p>=</span> <span class=nx>jenkins</span><span class=p>.</span><span class=nf>NewJenkins</span><span class=p>(</span><span class=kc>nil</span><span class=p>,</span> <span class=nx>cfg</span><span class=p>.</span><span class=nx>Endpoint</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nx>s</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>SetHTTPClient</span><span class=p>(</span><span class=nx>client</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>scraper</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// To be filled in
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nx>pmetric</span><span class=p>.</span><span class=nf>NewMetrics</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>This finishes all the setup code that is required in order to initialise a Jenkins receiver.</p></div></div><div data-tab-item=capture-all-configured-jobs class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>From this point on, we will be focuses on the <code>scrape</code> method that has been waiting to be filled in.
This method will be run on each interval that is configured within the configuration (by default, every minute).</p><p>The reason we want to capture the number of jobs configured so we can see the growth of our Jenkins server,
and measure of many projects have onboarded. To do this we will call the jenkins client to list all jobs,
and if it reports an error, return that with no metrics, otherwise, emit the data from the metric builder.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>scrape</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>jobs</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>GetJobs</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Recording the timestamp to ensure
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// all captured data points within this scrape have the same value. 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>now</span> <span class=o>:=</span> <span class=nx>pcommon</span><span class=p>.</span><span class=nf>NewTimestampFromTime</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Casting to an int64 to match the expected type
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobsCountDataPoint</span><span class=p>(</span><span class=nx>now</span><span class=p>,</span> <span class=nb>int64</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>jobs</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// To be filled in
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>Emit</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div data-tab-item=report-the-status-of-each-job class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>In the last step, we were able to capture all jobs ands report the number of jobs
there was. Within this step, we are going to examine each job and use the report values
to capture metrics.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>scrape</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>jobs</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>GetJobs</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Recording the timestamp to ensure
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// all captured data points within this scrape have the same value. 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>now</span> <span class=o>:=</span> <span class=nx>pcommon</span><span class=p>.</span><span class=nf>NewTimestampFromTime</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Casting to an int64 to match the expected type
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobsCountDataPoint</span><span class=p>(</span><span class=nx>now</span><span class=p>,</span> <span class=nb>int64</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>jobs</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>job</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>jobs</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Ensure we have valid results to start off with
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>build</span>  <span class=p>=</span> <span class=nx>job</span><span class=p>.</span><span class=nx>LastCompletedBuild</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusUnknown</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// This will check the result of the job, however,
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// since the only defined attributes are 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// `success`, `failure`, and `unknown`. 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// it is assume that anything did not finish 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// with a success or failure to be an unknown status.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=nx>build</span><span class=p>.</span><span class=nx>Result</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s>&#34;aborted&#34;</span><span class=p>,</span> <span class=s>&#34;not_built&#34;</span><span class=p>,</span> <span class=s>&#34;unstable&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusUnknown</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s>&#34;success&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusSuccess</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s>&#34;failure&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusFailed</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobDurationDataPoint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>now</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nb>int64</span><span class=p>(</span><span class=nx>job</span><span class=p>.</span><span class=nx>LastCompletedBuild</span><span class=p>.</span><span class=nx>Duration</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nx>job</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>Emit</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div data-tab-item=report-the-delta class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>The final step is to calculate how long it took from
commit to job completion to help infer our DORA metrics.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>scrape</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>jobs</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>GetJobs</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Recording the timestamp to ensure
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// all captured data points within this scrape have the same value. 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>now</span> <span class=o>:=</span> <span class=nx>pcommon</span><span class=p>.</span><span class=nf>NewTimestampFromTime</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Casting to an int64 to match the expected type
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobsCountDataPoint</span><span class=p>(</span><span class=nx>now</span><span class=p>,</span> <span class=nb>int64</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>jobs</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>job</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>jobs</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Ensure we have valid results to start off with
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>build</span>  <span class=p>=</span> <span class=nx>job</span><span class=p>.</span><span class=nx>LastCompletedBuild</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusUnknown</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Previous step here
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=c1>// Ensure that the `ChangeSet` has values
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// set so there is a valid value for us to reference
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>build</span><span class=p>.</span><span class=nx>ChangeSet</span><span class=p>.</span><span class=nx>Items</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Making the assumption that the first changeset
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// item is the most recent change.
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>change</span> <span class=o>:=</span> <span class=nx>build</span><span class=p>.</span><span class=nx>ChangeSet</span><span class=p>.</span><span class=nx>Items</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Record the difference from the build time
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// compared against the change timestamp.
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobCommitDeltaDataPoint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>now</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nb>int64</span><span class=p>(</span><span class=nx>build</span><span class=p>.</span><span class=nx>Timestamp</span><span class=o>-</span><span class=nx>change</span><span class=p>.</span><span class=nx>Timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nx>job</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>Emit</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Once all of these steps have been completed, you now have built a custom Jenkins CI receiver!</p><h2 id=whats-next>Whats next?</h2><p>There are more than likely features that would be desired from component that you can think of, like:</p><ul><li>Can I include the branch name that the job used?</li><li>Can I include the project name for the job?</li><li>How I calculate the collective job durations for project?</li><li>How do I validate the changes work?</li></ul><p>Please take this time to play around, break it, change things around, or even try to capture logs from the builds.</p><footer class=footline></footer></article></section></section></section></div></main></div><script src=../../js/clipboard.min.js?1701863659 defer></script>
<script src=../../js/perfect-scrollbar.min.js?1701863659 defer></script>
<script src=../../js/d3/d3-color.min.js?1701863659 defer></script>
<script src=../../js/d3/d3-dispatch.min.js?1701863659 defer></script>
<script src=../../js/d3/d3-drag.min.js?1701863659 defer></script>
<script src=../../js/d3/d3-ease.min.js?1701863659 defer></script>
<script src=../../js/d3/d3-interpolate.min.js?1701863659 defer></script>
<script src=../../js/d3/d3-selection.min.js?1701863659 defer></script>
<script src=../../js/d3/d3-timer.min.js?1701863659 defer></script>
<script src=../../js/d3/d3-transition.min.js?1701863659 defer></script>
<script src=../../js/d3/d3-zoom.min.js?1701863659 defer></script>
<script src=../../js/js-yaml.min.js?1701863659 defer></script>
<script src=../../js/mermaid.min.js?1701863659 defer></script>
<script>window.themeUseMermaid=JSON.parse("{}")</script><script src=../../js/theme.js?1701863659 defer></script></body></html>