<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.125.5"><meta name=generator content="Relearn 6.4.0+tip"><meta name=description content="The Splunk OpenTelemetry Collector is the core component of instrumenting infrastructure and applications. Its role is to collect and send:
Infrastructure metrics (disk, CPU, memory, etc) Application Performance Monitoring (APM) traces Profiling data Host and application logs Remove any existing OpenTelemetry Collectors If you have completed the Splunk IM workshop, please ensure you have deleted the collector running in Kubernetes before continuing. This can be done by running the following command:"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Installing the OpenTelemetry Collector :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="The Splunk OpenTelemetry Collector is the core component of instrumenting infrastructure and applications. Its role is to collect and send:
Infrastructure metrics (disk, CPU, memory, etc) Application Performance Monitoring (APM) traces Profiling data Host and application logs Remove any existing OpenTelemetry Collectors If you have completed the Splunk IM workshop, please ensure you have deleted the collector running in Kubernetes before continuing. This can be done by running the following command:"><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.69/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/1-otel-collector/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Installing the OpenTelemetry Collector :: Splunk Observability Cloud Workshops"><meta property="og:description" content="The Splunk OpenTelemetry Collector is the core component of instrumenting infrastructure and applications. Its role is to collect and send:
Infrastructure metrics (disk, CPU, memory, etc) Application Performance Monitoring (APM) traces Profiling data Host and application logs Remove any existing OpenTelemetry Collectors If you have completed the Splunk IM workshop, please ensure you have deleted the collector running in Kubernetes before continuing. This can be done by running the following command:"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="Ninja Workshops"><meta property="article:modified_time" content="2024-09-19T16:47:03+01:00"><meta itemprop=name content="Installing the OpenTelemetry Collector :: Splunk Observability Cloud Workshops"><meta itemprop=description content="The Splunk OpenTelemetry Collector is the core component of instrumenting infrastructure and applications. Its role is to collect and send:
Infrastructure metrics (disk, CPU, memory, etc) Application Performance Monitoring (APM) traces Profiling data Host and application logs Remove any existing OpenTelemetry Collectors If you have completed the Splunk IM workshop, please ensure you have deleted the collector running in Kubernetes before continuing. This can be done by running the following command:"><meta itemprop=dateModified content="2024-09-19T16:47:03+01:00"><meta itemprop=wordCount content="433"><title>Installing the OpenTelemetry Collector :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.69/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/1-otel-collector/index.html rel=canonical type=text/html title="Installing the OpenTelemetry Collector :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.69/images/favicon.ico?1728314635 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.69/css/fontawesome-all.min.css?1728314635 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.69/css/fontawesome-all.min.css?1728314635 rel=stylesheet></noscript><link href=/observability-workshop/v5.69/css/nucleus.css?1728314635 rel=stylesheet><link href=/observability-workshop/v5.69/css/auto-complete.css?1728314635 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.69/css/auto-complete.css?1728314635 rel=stylesheet></noscript><link href=/observability-workshop/v5.69/css/perfect-scrollbar.min.css?1728314635 rel=stylesheet><link href=/observability-workshop/v5.69/css/fonts.css?1728314635 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.69/css/fonts.css?1728314635 rel=stylesheet></noscript><link href=/observability-workshop/v5.69/css/theme.css?1728314635 rel=stylesheet><link href=/observability-workshop/v5.69/css/theme-splunk-light.css?1728314635 rel=stylesheet id=R-variant-style><link href=/observability-workshop/v5.69/css/chroma-relearn-light.css?1728314635 rel=stylesheet id=R-variant-chroma-style><link href=/observability-workshop/v5.69/css/variant.css?1728314635 rel=stylesheet><link href=/observability-workshop/v5.69/css/print.css?1728314635 rel=stylesheet media=print><link href=/observability-workshop/v5.69/css/format-print.css?1728314635 rel=stylesheet><script src=/observability-workshop/v5.69/js/variant.js?1728314635></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../../../..",window.relearn.relBaseUri="../../../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.69",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.index_js_url="/observability-workshop/v5.69/en/index.search.js?1728314635",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA"})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/observability-workshop/v5.69/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/1-otel-collector/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.69/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.69/en/ninja-workshops/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.69/en/ninja-workshops/1-automatic-discovery/index.html><span itemprop=name>Automatic Discovery Workshops</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.69/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/index.html><span itemprop=name>PetClinic Monolith Workshop</span></a><meta itemprop=position content="4">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>1. OpenTelemetry Collector</span><meta itemprop=position content="5"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.69/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/index.html title="PetClinic Monolith Workshop (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.69/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/2-building-petclinic/index.html title="Building the Spring PetClinic Application (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=installing-the-opentelemetry-collector>Installing the OpenTelemetry Collector</h1><p>The Splunk OpenTelemetry Collector is the core component of instrumenting infrastructure and applications. Its role is to collect and send:</p><ul><li>Infrastructure metrics (disk, CPU, memory, etc)</li><li>Application Performance Monitoring (APM) traces</li><li>Profiling data</li><li>Host and application logs</li></ul><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Remove any existing OpenTelemetry Collectors</div><div class=box-content><p>If you have completed the Splunk IM workshop, please ensure you have deleted the collector running in Kubernetes before continuing. This can be done by running the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></div></div><p>To ensure your instance is configured correctly, we need to confirm that the required environment variables for this workshop are set correctly. In your terminal run the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>. ~/workshop/scripts/check_env.sh</span></span></code></pre></div><p>In the output check that all of the following environment variables are present and have values set. If any are missing, please contact your instructor:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>ACCESS_TOKEN
</span></span><span class=line><span class=cl>REALM
</span></span><span class=line><span class=cl>RUM_TOKEN
</span></span><span class=line><span class=cl>HEC_TOKEN
</span></span><span class=line><span class=cl>HEC_URL
</span></span><span class=line><span class=cl>INSTANCE</span></span></code></pre></div><p>We can then go ahead and install the Collector. Some additional parameters are passed to the install script, they are:</p><ul><li><code>--with-instrumentation</code> - This will install the agent from the Splunk distribution of OpenTelemetry Java, which is then loaded automatically when the PetClinic Java application starts up. No configuration is required!</li><li><code>--deployment-environment</code> - Sets the resource attribute <code>deployment.environment</code> to the value passed. This is used to filter views in the UI.</li><li><code>--enable-profiler</code> - Enables the profiler for the Java application. This will generate CPU profiles for the application.</li><li><code>--enable-profiler-memory</code> - Enables the profiler for the Java application. This will generate memory profiles for the application.</li><li><code>--enable-metrics</code> - Enables the exporting of Micrometer metrics</li><li><code>--hec-token</code> - Sets the HEC token for the collector to use</li><li><code>--hec-url</code> - Sets the HEC URL for the collector to use</li></ul><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo sh /tmp/splunk-otel-collector.sh --realm <span class=nv>$REALM</span> -- <span class=nv>$ACCESS_TOKEN</span> --mode agent --without-fluentd --with-instrumentation --deployment-environment <span class=nv>$INSTANCE</span>-petclinic --enable-profiler --enable-profiler-memory --enable-metrics --hec-token <span class=nv>$HEC_TOKEN</span> --hec-url <span class=nv>$HEC_URL</span></span></span></code></pre></div><p>Next, we will patch the collector to expose the hostname of the instance and not the AWS instance ID. This will make it easier to filter data in the UI:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo sed -i <span class=s1>&#39;s/gcp, ecs, ec2, azure, system/system, gcp, ecs, ec2, azure/g&#39;</span> /etc/otel/collector/agent_config.yaml</span></span></code></pre></div><p>Once the <code>agent_config.yaml</code> has been patched, you will need to restart the collector:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector</span></span></code></pre></div><p>Once the installation is completed, you can navigate to the <strong>Hosts with agent installed</strong> dashboard to see the data from your host, <strong>Dashboards → Hosts with agent installed</strong>.</p><p>Use the dashboard filter and select <code>host.name</code> and type or select the hostname of your workshop instance (you can get this from the command prompt in your terminal session). Once you see data flowing for your host, we are then ready to get started with the APM component.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></div></main></div><script src=/observability-workshop/v5.69/js/clipboard.min.js?1728314635 defer></script><script src=/observability-workshop/v5.69/js/perfect-scrollbar.min.js?1728314635 defer></script><script src=/observability-workshop/v5.69/js/theme.js?1728314635 defer></script></body></html>