<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.125.5"><meta name=generator content="Relearn 6.0.0+tip"><meta name=description content="The business teams want to add the service version, the customer profile that is defined by a color and the name of the analyzed file.
Switch to the provided milestone 12microservices-k8s-autoi with the instructions from “Getting Started”.
Implement the requested changes to the public-api microservice.
The Kubernetes manifests are located in the k8s folder. Add the service version by configuring the OpenTelemetry resource attributes.
The customer profile and the file name vary by request."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Using OpenTelementry in Instrumentation :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="The business teams want to add the service version, the customer profile that is defined by a color and the name of the analyzed file.
Switch to the provided milestone 12microservices-k8s-autoi with the instructions from “Getting Started”.
Implement the requested changes to the public-api microservice.
The Kubernetes manifests are located in the k8s folder. Add the service version by configuring the OpenTelemetry resource attributes.
The customer profile and the file name vary by request."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.61/en/other/bootcamp/docs/apm/api/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Using OpenTelementry in Instrumentation :: Splunk Observability Cloud Workshops"><meta property="og:description" content="The business teams want to add the service version, the customer profile that is defined by a color and the name of the analyzed file.
Switch to the provided milestone 12microservices-k8s-autoi with the instructions from “Getting Started”.
Implement the requested changes to the public-api microservice.
The Kubernetes manifests are located in the k8s folder. Add the service version by configuring the OpenTelemetry resource attributes.
The customer profile and the file name vary by request."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="Ninja Workshops"><meta property="article:modified_time" content="2024-02-26T11:39:11+00:00"><meta itemprop=name content="Using OpenTelementry in Instrumentation :: Splunk Observability Cloud Workshops"><meta itemprop=description content="The business teams want to add the service version, the customer profile that is defined by a color and the name of the analyzed file.
Switch to the provided milestone 12microservices-k8s-autoi with the instructions from “Getting Started”.
Implement the requested changes to the public-api microservice.
The Kubernetes manifests are located in the k8s folder. Add the service version by configuring the OpenTelemetry resource attributes.
The customer profile and the file name vary by request."><meta itemprop=dateModified content="2024-02-26T11:39:11+00:00"><meta itemprop=wordCount content="241"><title>Using OpenTelementry in Instrumentation :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.61/en/other/bootcamp/docs/apm/api/index.html rel=canonical type=text/html title="Using OpenTelementry in Instrumentation :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.61/images/favicon.ico?1718371329 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.61/css/fontawesome-all.min.css?1718371343 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.61/css/fontawesome-all.min.css?1718371343 rel=stylesheet></noscript><link href=/observability-workshop/v5.61/css/nucleus.css?1718371343 rel=stylesheet><link href=/observability-workshop/v5.61/css/auto-complete.css?1718371343 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.61/css/auto-complete.css?1718371343 rel=stylesheet></noscript><link href=/observability-workshop/v5.61/css/perfect-scrollbar.min.css?1718371343 rel=stylesheet><link href=/observability-workshop/v5.61/css/fonts.css?1718371343 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.61/css/fonts.css?1718371343 rel=stylesheet></noscript><link href=/observability-workshop/v5.61/css/theme.css?1718371343 rel=stylesheet><link href=/observability-workshop/v5.61/css/theme-splunk-light.css?1718371343 rel=stylesheet id=R-variant-style><link href=/observability-workshop/v5.61/css/chroma-relearn-light.css?1718371343 rel=stylesheet id=R-variant-chroma-style><link href=/observability-workshop/v5.61/css/variant.css?1718371343 rel=stylesheet><link href=/observability-workshop/v5.61/css/print.css?1718371343 rel=stylesheet media=print><link href=/observability-workshop/v5.61/css/format-print.css?1718371343 rel=stylesheet><script src=/observability-workshop/v5.61/js/variant.js?1718371343></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../../../../..",window.relearn.relBaseUri="../../../../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.61",window.index_js_url="/observability-workshop/v5.61/en/index.search.js",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA"})</script></script><style>:root{--MAIN-WIDTH-MAX:1000rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/observability-workshop/v5.61/en/other/bootcamp/docs/apm/api/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.61/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.61/en/other/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Observability Bootcamp</span><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.61/en/other/bootcamp/docs/index.html><span itemprop=name>Bootcamp Labs</span></a><meta itemprop=position content="4">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.61/en/other/bootcamp/docs/apm/index.html><span itemprop=name>Microserverices APM</span></a><meta itemprop=position content="5">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Using OpenTelementry in Instrumentation</span><meta itemprop=position content="6"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.61/en/resources/otel_tagging/index.html title="Naming Conventions for Tagging with OpenTelemetry and Splunk (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class=topbar-control><i class="fa-fw fas fa-chevron-right"></i></span></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=using-opentelementry-in-instrumentation>Using OpenTelementry in Instrumentation</h1><p>The business teams want to add the service version, the customer profile that is defined by a color and the name of the analyzed file.</p><p>Switch to the provided milestone <code>12microservices-k8s-autoi</code> with the instructions from &ldquo;Getting Started&rdquo;.</p><p>Implement the requested changes to the <code>public-api</code> microservice.</p><p>The Kubernetes manifests are located in the <code>k8s</code> folder. Add the service version by <a href=https://github.com/signalfx/splunk-otel-python/blob/main/docs/advanced-config.md#trace-configuration rel=external target=_blank>configuring the OpenTelemetry resource attributes</a>.</p><p>The customer profile and the file name vary by request. Create attributes and assign them to the current span with the <a href=https://opentelemetry-python.readthedocs.io/en/stable/faq-and-cookbook.html rel=external target=_blank>OpenTelemetry Python API</a>.</p><p>You can use a random function to generate the customer profile (e.g. red, blue, green) with this snippet:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>color</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> <span class=s1>&#39;blue&#39;</span><span class=p>,</span> <span class=s1>&#39;green&#39;</span><span class=p>])</span></span></span></code></pre></div><p>Note 1: Do not use a temporary variable to retrieve the current span. Use the <code>trace</code> directly.</p><p>Note 2: Make sure to import modules.</p><p>Rebuild the container images for the private registry:</p><div class=tab-panel data-tab-group=725d40d83ee99f4bd248846157aab8a3><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=shell-command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("725d40d83ee99f4bd248846157aab8a3","shell-command")'>
<span class=tab-nav-text>Shell Command</span></button></div><div class=tab-content-container><div data-tab-item=shell-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p>docker-compose build</p></div></div></div></div><p>Push the images to the private registry:</p><div class=tab-panel data-tab-group=f8a147f33b70c154794ce18116d90ba7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=shell-command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f8a147f33b70c154794ce18116d90ba7","shell-command")'>
<span class=tab-nav-text>Shell Command</span></button></div><div class=tab-content-container><div data-tab-item=shell-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p>docker-compose push</p></div></div></div></div><p>Delete the <code>public-api</code> deployment:</p><div class=tab-panel data-tab-group=3e26344c8f5a9a8f4e623ed7791ceaf5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=shell-command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("3e26344c8f5a9a8f4e623ed7791ceaf5","shell-command")'>
<span class=tab-nav-text>Shell Command</span></button></div><div class=tab-content-container><div data-tab-item=shell-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p>kubectl delete deploy public-api</p></div></div></div></div><p>Redeploy to the cluster with</p><div class=tab-panel data-tab-group=10f53a2e40179e76be9c80f9c04f0cc5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=shell-command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("10f53a2e40179e76be9c80f9c04f0cc5","shell-command")'>
<span class=tab-nav-text>Shell Command</span></button></div><div class=tab-content-container><div data-tab-item=shell-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p>kubectl apply -f k8s</p></div></div></div></div><p>Test the service with</p><div class=tab-panel data-tab-group=329c39713728dffde8c126762257d71d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=shell-command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("329c39713728dffde8c126762257d71d","shell-command")'>
<span class=tab-nav-text>Shell Command</span></button></div><div class=tab-content-container><div data-tab-item=shell-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>ENDPOINT</span><span class=o>=</span><span class=k>$(</span>kubectl get service/public-api -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.spec.clusterIP}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>curl http://<span class=nv>$ENDPOINT</span>:8000/api -F <span class=nv>text</span><span class=o>=</span>@hamlet.txt</span></span></code></pre></div></div></div></div></div><p>Verify in Splunk APM that traces contain the desired information: TODO screenshot</p><p>[Create a new indexed span tag][index-span-tag] so that the business team can breakdown performance per customer profile.</p><p>The milestone for this task is <code>13custom-instr</code>. It adds the described custom instrumentation.</p><p><a href=https://docs.splunk.com/Observability/apm/span-tags/index-span-tags.html#index-a-new-span-tag rel=external target=_blank>index-span-tag</a></p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>rcastley</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Feb 26, 2024</span></span></footer></article></div></main></div><script src=/observability-workshop/v5.61/js/clipboard.min.js?1718371343 defer></script><script src=/observability-workshop/v5.61/js/perfect-scrollbar.min.js?1718371343 defer></script><script src=/observability-workshop/v5.61/js/theme.js?1718371343 defer></script></body></html>