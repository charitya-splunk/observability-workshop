<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.125.5"><meta name=generator content="Relearn 6.0.0+tip"><meta name=description content="Gateway First we will deploy the OTel Gateway. The workshop instructor will deploy the gateway, but we will walk through the steps here if you wish to try this yourself on a second instance.
The steps:
Click the Data Management icon in the toolbar Click the + Add integration button Click Deploy the Splunk OpenTelemetry Collector button Click Next Select Linux Change mode to Data forwarding (gateway) Set the environment to prod Choose the access token for this workshop Click Next Copy the installer script and run it in the provided linux environment."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Deploy Gateway :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="Gateway First we will deploy the OTel Gateway. The workshop instructor will deploy the gateway, but we will walk through the steps here if you wish to try this yourself on a second instance.
The steps:
Click the Data Management icon in the toolbar Click the + Add integration button Click Deploy the Splunk OpenTelemetry Collector button Click Next Select Linux Change mode to Data forwarding (gateway) Set the environment to prod Choose the access token for this workshop Click Next Copy the installer script and run it in the provided linux environment."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.61/en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Deploy Gateway :: Splunk Observability Cloud Workshops"><meta property="og:description" content="Gateway First we will deploy the OTel Gateway. The workshop instructor will deploy the gateway, but we will walk through the steps here if you wish to try this yourself on a second instance.
The steps:
Click the Data Management icon in the toolbar Click the + Add integration button Click Deploy the Splunk OpenTelemetry Collector button Click Next Select Linux Change mode to Data forwarding (gateway) Set the environment to prod Choose the access token for this workshop Click Next Copy the installer script and run it in the provided linux environment."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="Scenarios"><meta property="article:modified_time" content="2024-04-10T10:08:06-04:00"><meta itemprop=name content="Deploy Gateway :: Splunk Observability Cloud Workshops"><meta itemprop=description content="Gateway First we will deploy the OTel Gateway. The workshop instructor will deploy the gateway, but we will walk through the steps here if you wish to try this yourself on a second instance.
The steps:
Click the Data Management icon in the toolbar Click the + Add integration button Click Deploy the Splunk OpenTelemetry Collector button Click Next Select Linux Change mode to Data forwarding (gateway) Set the environment to prod Choose the access token for this workshop Click Next Copy the installer script and run it in the provided linux environment."><meta itemprop=dateModified content="2024-04-10T10:08:06-04:00"><meta itemprop=wordCount content="567"><title>Deploy Gateway :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.61/en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/index.html rel=canonical type=text/html title="Deploy Gateway :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.61/images/favicon.ico?1718371329 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.61/css/fontawesome-all.min.css?1718371345 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.61/css/fontawesome-all.min.css?1718371345 rel=stylesheet></noscript><link href=/observability-workshop/v5.61/css/nucleus.css?1718371345 rel=stylesheet><link href=/observability-workshop/v5.61/css/auto-complete.css?1718371345 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.61/css/auto-complete.css?1718371345 rel=stylesheet></noscript><link href=/observability-workshop/v5.61/css/perfect-scrollbar.min.css?1718371345 rel=stylesheet><link href=/observability-workshop/v5.61/css/fonts.css?1718371345 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.61/css/fonts.css?1718371345 rel=stylesheet></noscript><link href=/observability-workshop/v5.61/css/theme.css?1718371345 rel=stylesheet><link href=/observability-workshop/v5.61/css/theme-splunk-light.css?1718371345 rel=stylesheet id=R-variant-style><link href=/observability-workshop/v5.61/css/chroma-relearn-light.css?1718371345 rel=stylesheet id=R-variant-chroma-style><link href=/observability-workshop/v5.61/css/variant.css?1718371345 rel=stylesheet><link href=/observability-workshop/v5.61/css/print.css?1718371345 rel=stylesheet media=print><link href=/observability-workshop/v5.61/css/format-print.css?1718371345 rel=stylesheet><script src=/observability-workshop/v5.61/js/variant.js?1718371345></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../../../..",window.relearn.relBaseUri="../../../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.61",window.index_js_url="/observability-workshop/v5.61/en/index.search.js",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA"})</script></script><style>:root{--MAIN-WIDTH-MAX:1000rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/observability-workshop/v5.61/en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.61/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.61/en/scenarios/index.html><span itemprop=name>Scenarios</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.61/en/scenarios/self_service_observability/index.html><span itemprop=name>Self-Service Observability</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.61/en/scenarios/self_service_observability/2-collect_with_standards/index.html><span itemprop=name>2 Collect Data with Standards</span></a><meta itemprop=position content="4">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>2.1 Deploy Gateway</span><meta itemprop=position content="5"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.61/en/scenarios/self_service_observability/2-collect_with_standards/index.html title="Collect Data with Standards (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.61/en/scenarios/self_service_observability/2-collect_with_standards/2-deploy_collector_agent/index.html title="Deploy Collector (Agent) (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=deploy-gateway>Deploy Gateway</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<h2 id=gateway>Gateway</h2><p>First we will deploy the <strong>OTel Gateway</strong>. The workshop instructor will deploy the gateway, but we will walk through the steps here if you wish to try this yourself on a second instance.</p><p>The steps:</p><ul><li>Click the <strong>Data Management</strong> icon in the toolbar</li><li>Click the <strong>+ Add integration</strong> button</li><li>Click <strong>Deploy the Splunk OpenTelemetry Collector</strong> button</li><li>Click <strong>Next</strong></li><li>Select <strong>Linux</strong></li><li>Change mode to <strong>Data forwarding (gateway)</strong></li><li>Set the environment to <strong>prod</strong></li><li>Choose the access token for this workshop</li><li>Click <strong>Next</strong></li><li>Copy the installer script and run it in the provided linux environment.</li></ul><p>Once our gateway is started we will notice&mldr; <strong>Nothing</strong>. The gateway, by default, doesn&rsquo;t send any data. It can be configured to send data, but it doesn&rsquo;t by default.</p><p>We can review the config file with:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo cat /etc/otel/collector/splunk-otel-collector.conf</span></span></code></pre></div><p>And see that the config being used is <code>gateway_config.yaml</code>.</p><div class="box notices cstyle primary"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Tip</div><div class=box-content><p>Diagrams created with <a href=https://www.otelbin.io rel=external target=_blank>OTelBin.io</a>. Click on them to see them in detail.</p></div></div><table><thead><tr><th>Diagram</th><th>What it Tells Us</th></tr></thead><tbody><tr><td><a href=#R-image-9453f1793a6283159f17555d7620adbd class=lightbox-link><img alt="metrics Config" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.61/en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/../images/metrics.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9453f1793a6283159f17555d7620adbd><img alt="metrics Config" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.61/en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/../images/metrics.png></a></td><td><strong>Metrics</strong>:<br>The gateway will receive metrics over <strong>otlp</strong> or <strong>signalfx</strong> protocols, and then send these metrics to <strong>Splunk Observability Cloud</strong> with the <strong>signalfx</strong> protocol.<br><br>There is also a pipeline for <strong>prometheus metrics</strong> to be sent to Splunk. That pipeline is labeled <strong>internal</strong> and is meant to be for the collector. (In other words if we want to receive prometheus directly we should add it to the main pipeline.)</td></tr><tr><td><a href=#R-image-60767aaf1e52f40f82c895682424398d class=lightbox-link><img alt="traces Config" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.61/en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/../images/traces.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-60767aaf1e52f40f82c895682424398d><img alt="traces Config" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.61/en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/../images/traces.png></a></td><td><strong>Traces</strong>:<br>The gateway will receive traces over <strong>jaeger</strong>, <strong>otlp</strong>, <strong>sapm</strong>, or <strong>zipkin</strong> and then send these traces to <strong>Splunk Observability Cloud</strong> with the <strong>sapm</strong> protocol.</td></tr><tr><td><a href=#R-image-f46c7e15cdd5bfd72d8f45806aefbc9f class=lightbox-link><img alt="logs Config" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.61/en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/../images/logs.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f46c7e15cdd5bfd72d8f45806aefbc9f><img alt="logs Config" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.61/en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/../images/logs.png></a></td><td><strong>Logs</strong>:<br>The gateway will receive logs over <strong>otlp</strong> and then send these logs to 2 places: <strong>Splunk Enterprise (Cloud)</strong> (for logs) and <strong>Splunk Observability Cloud</strong> (for profiling data).<br><br>There is also a pipeline labeled <strong>signalfx</strong> that is sending <strong>signalfx</strong> to <strong>Splunk Observability Cloud</strong>; these are events that can be used to add events to charts, as well as the process list.</td></tr></tbody></table><p>We&rsquo;re not going to see any host metrics, and we aren&rsquo;t send any other data through the gateway yet. But we do have the <strong>internal</strong> metrics being sent in.</p><p>You can find it by creating a new chart and adding a metric:</p><ul><li>Click the <strong>+</strong> in the top-right</li><li>Click <strong>Chart</strong></li><li>For the signal of Plot A, type <code>otelcol_process_uptime</code></li><li>Add a filter with the + to the right, and type: <code>host.id:&lt;name of instance></code></li></ul><p>You should get a chart like the following:
<a href=#R-image-e95cdcd80097dae76ab25eb6c7f34872 class=lightbox-link><img alt="Chart of gateway" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.61/en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/../images/gateway_metric_chart.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e95cdcd80097dae76ab25eb6c7f34872><img alt="Chart of gateway" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.61/en/scenarios/self_service_observability/2-collect_with_standards/1-deploy_gateway/../images/gateway_metric_chart.png></a></p><p>You can look at the <strong>Metric Finder</strong> to find other internal metrics to explore.</p><h2 id=add-metadata>Add Metadata</h2><p>Before we deploy a collector (agent) let&rsquo;s add some metada onto metrics and traces with the gateway. That&rsquo;s how we will know data is passing through it.</p><p>The <a href=https://docs.splunk.com/observability/en/gdi/opentelemetry/components/attributes-processor.html rel=external target=_blank>attributes processor</a> let&rsquo;s us add some metadata.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/otel/collector/agent_config.yaml</span></span></code></pre></div><p>Here&rsquo;s what we want to add to the processors section:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>attributes/gateway_config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>oac</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span></span></span></code></pre></div><p>And then to the pipelines (adding <code>attributes/gateway_config</code> to each):</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>jaeger, otlp, smartagent/signalfx-forwarder, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>attributes/gateway_config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#- resource/add_environment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>sapm, signalfx]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Use instead when sending to gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#exporters: [otlp, signalfx]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, signalfx, smartagent/signalfx-forwarder]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>memory_limiter, batch, resourcedetection, attributes/gateway_config]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>signalfx]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Use instead when sending to gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#exporters: [otlp]</span></span></span></code></pre></div><p>And finally we need to restart the gateway:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector.service</span></span></code></pre></div><p>We can make sure it is still running fine by checking the status:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl status splunk-otel-collector.service </span></span></code></pre></div><h2 id=next>Next</h2><p>Next, let&rsquo;s deploy a collector and then configure it to this gateway.</p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>Bill Grant</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Apr 10, 2024</span></span></footer></article></div></main></div><script src=/observability-workshop/v5.61/js/clipboard.min.js?1718371345 defer></script><script src=/observability-workshop/v5.61/js/perfect-scrollbar.min.js?1718371345 defer></script><script src=/observability-workshop/v5.61/js/theme.js?1718371345 defer></script></body></html>