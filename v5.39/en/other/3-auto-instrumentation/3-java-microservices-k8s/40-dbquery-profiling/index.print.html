<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta name=generator content="Relearn 5.23.2+tip"><meta name=description content="Splunk Observability Workshops"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Database Query Performance & Always-on Profiling :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="1. Introduction As we have seen in the previous chapter, you will be able to trace your inteactions between the service using APM, however you will get two mor features that can help you find
2. AlwaysOn Profiling and Metrics When we installed the collector we configured it to enable AlwaysOn Profiling and Metrics. This means that the collector will automatically generate CPU and Memory profiles for the application and send them to Splunk Observability Cloud."><meta property="og:title" content="Database Query Performance & Always-on Profiling :: Splunk Observability Cloud Workshops"><meta property="og:description" content="1. Introduction As we have seen in the previous chapter, you will be able to trace your inteactions between the service using APM, however you will get two mor features that can help you find
2. AlwaysOn Profiling and Metrics When we installed the collector we configured it to enable AlwaysOn Profiling and Metrics. This means that the collector will automatically generate CPU and Memory profiles for the application and send them to Splunk Observability Cloud."><meta property="og:type" content="article"><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.39/en/other/3-auto-instrumentation/3-java-microservices-k8s/40-dbquery-profiling/index.html"><meta property="article:section" content="Workshop using the Java microservices Pet Clinic demo (Kubernetes based). :: Splunk Observability Cloud Workshops"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><title>Database Query Performance & Always-on Profiling :: Splunk Observability Cloud Workshops</title><link href=https://splunk.github.io/observability-workshop/v5.39/en/other/3-auto-instrumentation/3-java-microservices-k8s/40-dbquery-profiling/index.html rel=canonical type=text/html title="Database Query Performance & Always-on Profiling :: Splunk Observability Cloud Workshops"><link href=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/40-dbquery-profiling/index.xml rel=alternate type=application/rss+xml title="Database Query Performance & Always-on Profiling :: Splunk Observability Cloud Workshops"><link href=../../../../../images/favicon.ico?1707220482 rel=icon type=image/x-icon sizes=any><link href=../../../../../css/fontawesome-all.min.css?1707220489 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../../css/fontawesome-all.min.css?1707220489 rel=stylesheet></noscript><link href=../../../../../css/nucleus.css?1707220489 rel=stylesheet><link href=../../../../../css/auto-complete.css?1707220489 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../../css/auto-complete.css?1707220489 rel=stylesheet></noscript><link href=../../../../../css/perfect-scrollbar.min.css?1707220489 rel=stylesheet><link href=../../../../../css/fonts.css?1707220489 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../../css/fonts.css?1707220489 rel=stylesheet></noscript><link href=../../../../../css/theme.css?1707220489 rel=stylesheet><link href=../../../../../css/theme-splunk-light.css?1707220489 rel=stylesheet id=R-variant-style><link href=../../../../../css/variant.css?1707220489 rel=stylesheet><link href=../../../../../css/print.css?1707220489 rel=stylesheet media=print><link href=../../../../../css/format-print.css?1707220489 rel=stylesheet><link href=../../../../../css/ie.css?1707220489 rel=stylesheet><script src=../../../../../js/url.js?1707220489></script>
<script src=../../../../../js/variant.js?1707220489></script>
<script>window.index_js_url="../../../../../en/index.search.js";var root_url="../../../../../",baseUri=root_url.replace(/\/$/,"");window.relearn=window.relearn||{},window.relearn.baseUriFull="https://splunk.github.io/observability-workshop/v5.39/",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script>
<script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script>
<script>SplunkRum.init({beaconUrl:"https://rum-ingest.eu0.signalfx.com/v1/rum",rumAuth:"EDIbCJR4LlxWdXMLjkYX1g",app:"observability-workshop",version:"1",environment:"observability-workshop-env"}),SplunkSessionRecorder.init({beaconUrl:"https://rum-ingest.eu0.signalfx.com/v1/rumreplay",rumAuth:"EDIbCJR4LlxWdXMLjkYX1g"})</script><style>@media screen and (min-width:1000px){#R-body .flex-block-wrapper{margin-left:auto;margin-right:auto;max-width:1400px;width:100%}}:root{--MENU-WIDTH-L:22.5rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/40-dbquery-profiling/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)">
<i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../../en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../../en/other/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../../en/other/3-auto-instrumentation/index.html><span itemprop=name>Auto-Instrumentation Workshops</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/index.html><span itemprop=name>Workshop using the Java microservices Pet Clinic demo (Kubernetes based).</span></a><meta itemprop=position content="4">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Database Query Performance & Always-on Profiling</span><meta itemprop=position content="5"></li></ol><div class="topbar-area topbar-area-end" data-area=end></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=database-query-performance--always-on-profiling>Database Query Performance & Always-on Profiling</h1><h2 id=1-introduction>1. Introduction</h2><p>As we have seen in the previous chapter, you will be able to trace your inteactions between the service using APM, however you will get two mor features that can help you find</p><h2 id=2-alwayson-profiling-and-metrics>2. AlwaysOn Profiling and Metrics</h2><p>When we installed the collector we configured it to enable <strong>AlwaysOn Profiling</strong> and <strong>Metrics</strong>. This means that the collector will automatically generate CPU and Memory profiles for the application and send them to Splunk Observability Cloud.</p><p>When you start the PetClinic application you will see the collector automatically detect the application and instrument it for traces and profiling.</p><div class=tab-panel data-tab-group=695b5433d42ac10a2955917b3bd2dd1c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("695b5433d42ac10a2955917b3bd2dd1c","example-output")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Picked up JAVA_TOOL_OPTIONS: -javaagent:/usr/lib/splunk-instrumentation/splunk-otel-javaagent.jar -Dsplunk.profiler.enabled=true -Dsplunk.profiler.memory.enabled=true
</span></span><span class=line><span class=cl>OpenJDK 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:04:661 +0100] [main] INFO io.opentelemetry.javaagent.tooling.VersionLogger - opentelemetry-javaagent - version: splunk-1.25.0-otel-1.27.0
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:05:294 +0100] [main] INFO com.splunk.javaagent.shaded.io.micrometer.core.instrument.push.PushMeterRegistry - publishing metrics for SignalFxMeterRegistry every 30s
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:043 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:044 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - Profiler configuration:
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:047 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                  splunk.profiler.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:048 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                splunk.profiler.directory : /tmp
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:049 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -       splunk.profiler.recording.duration : 20s
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:050 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -               splunk.profiler.keep-files : false
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:051 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -            splunk.profiler.logs-endpoint : null
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:053 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -              otel.exporter.otlp.endpoint : null
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:054 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -           splunk.profiler.memory.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:055 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -             splunk.profiler.tlab.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:056 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -        splunk.profiler.memory.event.rate : 150/s
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:057 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.call.stack.interval : PT10S
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:058 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -  splunk.profiler.include.internal.stacks : false
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:059 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.tracing.stacks.only : false
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:059 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:060 +0100] [main] INFO com.splunk.opentelemetry.profiler.JfrActivator - Profiler is active.</span></span></code></pre></div></div></div></div></div><h2 id=3-review-profiling-data-collection>3. Review Profiling Data Collection</h2><p>You can now visit the Splunk APM UI and examine the application components, traces, profiling, DB Query performance and metrics. From the left-hand menu <strong>APM</strong> → <strong>Explore</strong>, click the environment dropdown and select your environment e.g. <code>&lt;INSTANCE>-petclinic</code> (where<code>&lt;INSTANCE></code> is replaced with the value you noted down earlier).</p><p><a href=#R-image-9ccd01015aa391c3af589309549db948 class=lightbox-link><img src=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/40-dbquery-profiling/../images/apm-environment.png alt="APM Environment" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9ccd01015aa391c3af589309549db948><img src=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/40-dbquery-profiling/../images/apm-environment.png alt="APM Environment" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>Once your validation is complete you can stop the application by pressing <code>Ctrl-c</code>.</p><footer class=footline></footer></article></div></main></div><script src=../../../../../js/clipboard.min.js?1707220489 defer></script>
<script src=../../../../../js/perfect-scrollbar.min.js?1707220489 defer></script>
<script src=../../../../../js/theme.js?1707220489 defer></script></body></html>