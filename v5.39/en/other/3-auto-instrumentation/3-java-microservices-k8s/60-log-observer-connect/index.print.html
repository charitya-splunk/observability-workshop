<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta name=generator content="Relearn 5.23.2+tip"><meta name=description content="Splunk Observability Workshops"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Log Observer :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="1. Introduction Until this point, we have not touched or changed our code, yet we did receive Trace & Profiling/DB Query performance information. If we want to get more out of our Java application, we can introduce a small change to our application log setup.
This change will configure the Spring PetClinic application to use an Otel Based format to write logs, This will allow the (Auto)-instrumentation to add Otel relevant information into the logs."><meta property="og:title" content="Log Observer :: Splunk Observability Cloud Workshops"><meta property="og:description" content="1. Introduction Until this point, we have not touched or changed our code, yet we did receive Trace & Profiling/DB Query performance information. If we want to get more out of our Java application, we can introduce a small change to our application log setup.
This change will configure the Spring PetClinic application to use an Otel Based format to write logs, This will allow the (Auto)-instrumentation to add Otel relevant information into the logs."><meta property="og:type" content="article"><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.39/en/other/3-auto-instrumentation/3-java-microservices-k8s/60-log-observer-connect/index.html"><meta property="article:section" content="Workshop using the Java microservices Pet Clinic demo (Kubernetes based). :: Splunk Observability Cloud Workshops"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><title>Log Observer :: Splunk Observability Cloud Workshops</title><link href=https://splunk.github.io/observability-workshop/v5.39/en/other/3-auto-instrumentation/3-java-microservices-k8s/60-log-observer-connect/index.html rel=canonical type=text/html title="Log Observer :: Splunk Observability Cloud Workshops"><link href=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/60-log-observer-connect/index.xml rel=alternate type=application/rss+xml title="Log Observer :: Splunk Observability Cloud Workshops"><link href=../../../../../images/favicon.ico?1707220482 rel=icon type=image/x-icon sizes=any><link href=../../../../../css/fontawesome-all.min.css?1707220489 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../../css/fontawesome-all.min.css?1707220489 rel=stylesheet></noscript><link href=../../../../../css/nucleus.css?1707220489 rel=stylesheet><link href=../../../../../css/auto-complete.css?1707220489 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../../css/auto-complete.css?1707220489 rel=stylesheet></noscript><link href=../../../../../css/perfect-scrollbar.min.css?1707220489 rel=stylesheet><link href=../../../../../css/fonts.css?1707220489 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../../css/fonts.css?1707220489 rel=stylesheet></noscript><link href=../../../../../css/theme.css?1707220489 rel=stylesheet><link href=../../../../../css/theme-splunk-light.css?1707220489 rel=stylesheet id=R-variant-style><link href=../../../../../css/variant.css?1707220489 rel=stylesheet><link href=../../../../../css/print.css?1707220489 rel=stylesheet media=print><link href=../../../../../css/format-print.css?1707220489 rel=stylesheet><link href=../../../../../css/ie.css?1707220489 rel=stylesheet><script src=../../../../../js/url.js?1707220489></script>
<script src=../../../../../js/variant.js?1707220489></script>
<script>window.index_js_url="../../../../../en/index.search.js";var root_url="../../../../../",baseUri=root_url.replace(/\/$/,"");window.relearn=window.relearn||{},window.relearn.baseUriFull="https://splunk.github.io/observability-workshop/v5.39/",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script>
<script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script>
<script>SplunkRum.init({beaconUrl:"https://rum-ingest.eu0.signalfx.com/v1/rum",rumAuth:"EDIbCJR4LlxWdXMLjkYX1g",app:"observability-workshop",version:"1",environment:"observability-workshop-env"}),SplunkSessionRecorder.init({beaconUrl:"https://rum-ingest.eu0.signalfx.com/v1/rumreplay",rumAuth:"EDIbCJR4LlxWdXMLjkYX1g"})</script><style>@media screen and (min-width:1000px){#R-body .flex-block-wrapper{margin-left:auto;margin-right:auto;max-width:1400px;width:100%}}:root{--MENU-WIDTH-L:22.5rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/60-log-observer-connect/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)">
<i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../../en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../../en/other/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../../en/other/3-auto-instrumentation/index.html><span itemprop=name>Auto-Instrumentation Workshops</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/index.html><span itemprop=name>Workshop using the Java microservices Pet Clinic demo (Kubernetes based).</span></a><meta itemprop=position content="4">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Log Observer</span><meta itemprop=position content="5"></li></ol><div class="topbar-area topbar-area-end" data-area=end></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=log-observer>Log Observer</h1><h2 id=1-introduction>1. Introduction</h2><p>Until this point, we have not touched or changed our code, yet we did receive Trace & Profiling/DB Query performance information.
If we want to get more out of our Java application, we can introduce a small change to our application log setup.</p><p>This change will configure the Spring PetClinic application to use an Otel Based format to write logs, This will allow the (Auto)-instrumentation to add Otel relevant information into the logs.</p><p>The Splunk Log Observer component is used to view the logs and with this information can automatically relate logs information with APM Services and Traces. This feature called <strong>Related Content</strong> will also work with Infra structure.</p><h2 id=2-update-logback-config-for-the-services>2. Update Logback config for the services</h2><p>The Spring PetClinic application can be configured to use several different Java logging libraries. In this scenario, the application is using <code>logback</code>. To make sure we get the otel information in the logs we need to update a file named <code>logback.xml</code> with the log structure, and add an Otel dependency to the <code>pom.xml</code> of each of the services in the petclinic microservices folders.</p><p>First lets set the Log Structure/Format:</p><p>Spring boot will allow you to set a global template, but for ease of use, we will replace the existing content of the <code>logback-spring.xml</code> files of each service with the following XML content using a prepared script:
Note the following entries that will be added:</p><ul><li>trace_id</li><li>span_id</li><li>trace_flags</li><li>service.name</li><li>deployment.environment</li></ul><p>These fields allows the <strong>Splunk Observability Cloud Suite</strong> to display <strong>Related Content</strong>:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;include</span> <span class=na>resource=</span><span class=s>&#34;org/springframework/boot/logging/logback/base.xml&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Required for Loglevel management into the Spring Petclinic Admin Server--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;jmxConfigurator/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;appender</span> <span class=na>name=</span><span class=s>&#34;CONSOLE&#34;</span> <span class=na>class=</span><span class=s>&#34;ch.qos.logback.core.ConsoleAppender&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;encoder&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;pattern&gt;</span>
</span></span><span class=line><span class=cl>            %d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg trace_id=%X{trace_id} span_id=%X{span_id} trace_flags=%X{trace_flags} %n service.name=%property{otel.resource.service.name}, deployment.environment=%property{otel.resource.deployment.environment}: %m%n
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/pattern&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/encoder&gt;</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/appender&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Just wrap your logging appender, for example ConsoleAppender, with OpenTelemetryAppender --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;appender</span> <span class=na>name=</span><span class=s>&#34;OTEL&#34;</span> <span class=na>class=</span><span class=s>&#34;io.opentelemetry.instrumentation.logback.mdc.v1_0.OpenTelemetryAppender&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;appender-ref</span> <span class=na>ref=</span><span class=s>&#34;CONSOLE&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/appender&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>     <span class=c>&lt;!-- Use the wrapped &#34;OTEL&#34; appender instead of the original &#34;CONSOLE&#34; one --&gt;</span>
</span></span><span class=line><span class=cl>     <span class=nt>&lt;root</span> <span class=na>level=</span><span class=s>&#34;INFO&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>       <span class=nt>&lt;appender-ref</span> <span class=na>ref=</span><span class=s>&#34;OTEL&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>     <span class=nt>&lt;/root&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span></span></span></code></pre></div><p>So lets run the script that will update our log structure with the format above:</p><div class=tab-panel data-tab-group=59ae965fed24bd9ee3bfcb1e17beedd0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=update-logback-files class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("59ae965fed24bd9ee3bfcb1e17beedd0","update-logback-files")'>
<span class=tab-nav-text>Update Logback files</span></button>
<button data-tab-item=replace-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("59ae965fed24bd9ee3bfcb1e17beedd0","replace-output")'>
<span class=tab-nav-text>Replace Output</span></button></div><div class=tab-content-container><div data-tab-item=update-logback-files class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>. ~/workshop/petclinic/scripts/update_logback.sh</span></span></code></pre></div></div></div><div data-tab-item=replace-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Overwritten /home/ubuntu/spring-petclinic-microservices/spring-petclinic-admin-server/src/main/resources/logback-spring.xml with new XML content.
</span></span><span class=line><span class=cl>Overwritten /home/ubuntu/spring-petclinic-microservices/spring-petclinic-api-gateway/src/main/resources/logback-spring.xml with new XML content.
</span></span><span class=line><span class=cl>Overwritten /home/ubuntu/spring-petclinic-microservices/spring-petclinic-config-server/src/main/resources/logback-spring.xml with new XML content.
</span></span><span class=line><span class=cl>Overwritten /home/ubuntu/spring-petclinic-microservices/spring-petclinic-customers-service/src/main/resources/logback-spring.xml with new XML content.
</span></span><span class=line><span class=cl>Overwritten /home/ubuntu/spring-petclinic-microservices/spring-petclinic-discovery-server/src/main/resources/logback-spring.xml with new XML content.
</span></span><span class=line><span class=cl>Overwritten /home/ubuntu/spring-petclinic-microservices/spring-petclinic-vets-service/src/main/resources/logback-spring.xml with new XML content.
</span></span><span class=line><span class=cl>Overwritten /home/ubuntu/spring-petclinic-microservices/spring-petclinic-visits-service/src/main/resources/logback-spring.xml with new XML content.
</span></span><span class=line><span class=cl>Script execution completed.</span></span></code></pre></div></div></div></div></div><p>We can verify if the replacement has been successful by examining the spring-logback.xml file from one of the services</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /home/ubuntu/spring-petclinic-microservices/spring-petclinic-customers-service/src/main/resources/logback-spring.xml</span></span></code></pre></div><h2 id=3-reconfigure-and-build-the-services-locally>3. Reconfigure and build the services locally</h2><p>Before we can build the new services with the updated log format we need to add the dependency to the <code>Pom.xml</code>:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>. ~/workshop/petclinic/scripts/add_otel.sh</span></span></code></pre></div><p>The Services are now ready to be build, so run the script that will use the <code>maven</code> command to compile/build/package the PetClinic microservices (Note the -P buildDocker, this will build the new containers):<div class=tab-panel data-tab-group=9cc0301c87d86f023b8c5d8de2df565e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=running-maven class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("9cc0301c87d86f023b8c5d8de2df565e","running-maven")'>
<span class=tab-nav-text>Running maven</span></button>
<button data-tab-item=maven-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("9cc0301c87d86f023b8c5d8de2df565e","maven-output")'>
<span class=tab-nav-text>Maven Output</span></button></div><div class=tab-content-container><div data-tab-item=running-maven class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw clean install -D skipTests -P buildDocker</span></span></code></pre></div></div></div><div data-tab-item=maven-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Successfully tagged quay.io/phagen/spring-petclinic-api-gateway:latest
</span></span><span class=line><span class=cl>[INFO] Built quay.io/phagen/spring-petclinic-api-gateway
</span></span><span class=line><span class=cl>[INFO] ------------------------------------------------------------------------
</span></span><span class=line><span class=cl>[INFO] Reactor Summary:
</span></span><span class=line><span class=cl>[INFO] 
</span></span><span class=line><span class=cl>[INFO] spring-petclinic-microservices 0.0.1 ............... SUCCESS [  0.770 s]
</span></span><span class=line><span class=cl>[INFO] spring-petclinic-admin-server ...................... SUCCESS [01:03 min]
</span></span><span class=line><span class=cl>[INFO] spring-petclinic-customers-service ................. SUCCESS [ 29.031 s]
</span></span><span class=line><span class=cl>[INFO] spring-petclinic-vets-service ...................... SUCCESS [ 22.145 s]
</span></span><span class=line><span class=cl>[INFO] spring-petclinic-visits-service .................... SUCCESS [ 20.451 s]
</span></span><span class=line><span class=cl>[INFO] spring-petclinic-config-server ..................... SUCCESS [ 12.260 s]
</span></span><span class=line><span class=cl>[INFO] spring-petclinic-discovery-server .................. SUCCESS [ 14.174 s]
</span></span><span class=line><span class=cl>[INFO] spring-petclinic-api-gateway 0.0.1 ................. SUCCESS [ 29.832 s]
</span></span><span class=line><span class=cl>[INFO] ------------------------------------------------------------------------
</span></span><span class=line><span class=cl>[INFO] BUILD SUCCESS
</span></span><span class=line><span class=cl>[INFO] ------------------------------------------------------------------------
</span></span><span class=line><span class=cl>[INFO] Total time: 03:14 min
</span></span><span class=line><span class=cl>[INFO] Finished at: 2024-01-02T12:43:20Z
</span></span><span class=line><span class=cl>[INFO] ------------------------------------------------------------------------</span></span></code></pre></div></div></div></div></div></p><p>Given that Kubernetes needs to pull these freshly build images from somewhere, we are going to store them in the repository we set up earlier. To do this, run the script that will push the newly build containers into our local repository:</p><div class=tab-panel data-tab-group=2014cb1dd1d3b38ecbd82b814fe4c018><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=pushing-containers class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("2014cb1dd1d3b38ecbd82b814fe4c018","pushing-containers")'>
<span class=tab-nav-text>pushing Containers</span></button>
<button data-tab-item=docker-push-output-partial class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("2014cb1dd1d3b38ecbd82b814fe4c018","docker-push-output-partial")'>
<span class=tab-nav-text>Docker Push Output (partial)</span></button></div><div class=tab-content-container><div data-tab-item=pushing-containers class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>. ~/workshop/petclinic/scripts/push_docker.sh </span></span></code></pre></div></div></div><div data-tab-item=docker-push-output-partial class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>The push refers to repository [localhost:5000/spring-petclinic-vets-service]
</span></span><span class=line><span class=cl>0391386bcb2a: Preparing 
</span></span><span class=line><span class=cl>bbb67f51a186: Preparing 
</span></span><span class=line><span class=cl>105351d0ada3: Preparing 
</span></span><span class=line><span class=cl>49cfeae6cb9f: Preparing 
</span></span><span class=line><span class=cl>b4da5101fcde: Preparing 
</span></span><span class=line><span class=cl>49cfeae6cb9f: Pushed 
</span></span><span class=line><span class=cl>e742c14be110: Mounted from spring-petclinic-visits-service 
</span></span><span class=line><span class=cl>540aa741fede: Mounted from spring-petclinic-visits-service 
</span></span><span class=line><span class=cl>a1dfe59d4939: Mounted from spring-petclinic-visits-service 
</span></span><span class=line><span class=cl>1e99e92c46bf: Mounted from spring-petclinic-visits-service 
</span></span><span class=line><span class=cl>f5aa38537736: Mounted from spring-petclinic-visits-service 
</span></span><span class=line><span class=cl>d2210512edb4: Mounted from spring-petclinic-visits-service 
</span></span><span class=line><span class=cl>8e87ff28f1b5: Mounted from spring-petclinic-visits-service 
</span></span><span class=line><span class=cl>local: digest: sha256:42337b2a4ff7d0ac9b7c2cf3c70aa20b7b52d092f1e05d351e031dd7fad956fc size: 3040
</span></span><span class=line><span class=cl>The push refers to repository [localhost:5000/spring-petclinic-customers-service]
</span></span><span class=line><span class=cl>15d54d9adca8: Preparing 
</span></span><span class=line><span class=cl>886f6def5b35: Preparing 
</span></span><span class=line><span class=cl>1575ae90e858: Preparing 
</span></span><span class=line><span class=cl>ccc884d92d18: Preparing 
</span></span><span class=line><span class=cl>b4da5101fcde: Preparing 
</span></span><span class=line><span class=cl>ccc884d92d18: Pushed 
</span></span><span class=line><span class=cl>e742c14be110: Mounted from spring-petclinic-vets-service 
</span></span><span class=line><span class=cl>540aa741fede: Mounted from spring-petclinic-vets-service 
</span></span><span class=line><span class=cl>a1dfe59d4939: Mounted from spring-petclinic-vets-service 
</span></span><span class=line><span class=cl>1e99e92c46bf: Mounted from spring-petclinic-vets-service 
</span></span><span class=line><span class=cl>f5aa38537736: Mounted from spring-petclinic-vets-service 
</span></span><span class=line><span class=cl>d2210512edb4: Mounted from spring-petclinic-vets-service 
</span></span><span class=line><span class=cl>8e87ff28f1b5: Mounted from spring-petclinic-vets-service 
</span></span><span class=line><span class=cl>local: digest: sha256:3601c6e7f58224001946058fb0400483fbb8f1b0ea8a6dbaf403c62b4c1908be size: 3042</span></span></code></pre></div></div></div></div></div><p>The containers should now be stored in the local repository, lets confirm by checking the catalog,</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> curl -X GET http://localhost:5000/v2/_catalog </span></span></code></pre></div><p>The result should be :</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>{&#34;repositories&#34;:[&#34;spring-petclinic-admin-server&#34;,&#34;spring-petclinic-api-gateway&#34;,&#34;spring-petclinic-config-server&#34;,&#34;spring-petclinic-customers-service&#34;,&#34;spring-petclinic-discovery-server&#34;,&#34;spring-petclinic-vets-service&#34;,&#34;spring-petclinic-visits-service&#34;]}</span></span></code></pre></div><h2 id=5-deploy-new-services-to-kubernetes>5. Deploy new services to kubernetes</h2><p>To see the changes in effect, we need to redeploy the services, First let change the location of the images from the external repo to the local one by running the following script:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>. ~/workshop/petclinic/scripts/set_local.sh</span></span></code></pre></div><p>The result is a new file on disk called <strong>petclinic-local.yaml</strong>
Let switch to the local version by applying the local version of the deployment yaml.
First delete the old deplyment with</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl delete -f ~/workshop/petclinic/petclinic-local.yaml</span></span></code></pre></div><p>followed by</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f ~/workshop/petclinic/petclinic-local.yaml</span></span></code></pre></div><p>This will cause the containers to be replaced with the local version, you can verify this by checking the containers:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe pods api-gateway <span class=p>|</span>grep Image:</span></span></code></pre></div><p>The resulting output should say ( again if you see double, its the old container being terminated, give it a few seconds):</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>  Image:         ghcr.io/signalfx/splunk-otel-java/splunk-otel-java:v1.30.0
</span></span><span class=line><span class=cl>  Image:         localhost:5000/spring-petclinic-api-gateway:local</span></span></code></pre></div><h2 id=6-view-logs>6. View Logs</h2><p>First give the service time to get back into sync and lets tail the load generator log again<div class=tab-panel data-tab-group=9f3a73dee17c4bd636f79b1dac7e16bb><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=tail-log class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("9f3a73dee17c4bd636f79b1dac7e16bb","tail-log")'>
<span class=tab-nav-text>Tail Log</span></button>
<button data-tab-item=tail-log-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("9f3a73dee17c4bd636f79b1dac7e16bb","tail-log-output")'>
<span class=tab-nav-text>Tail Log Output</span></button></div><div class=tab-content-container><div data-tab-item=tail-log class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>. ~/workshop/petclinic/scripts/tail_logs.sh</span></span></code></pre></div></div></div><div data-tab-item=tail-log-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>{&#34;severity&#34;:&#34;info&#34;,&#34;msg&#34;:&#34;Welcome Text = &#34;Welcome to Petclinic&#34;}
</span></span><span class=line><span class=cl>{&#34;severity&#34;:&#34;info&#34;,&#34;msg&#34;:&#34;@ALL&#34;
</span></span><span class=line><span class=cl>{&#34;severity&#34;:&#34;info&#34;,&#34;msg&#34;:&#34;@owner details page&#34;}
</span></span><span class=line><span class=cl>{&#34;severity&#34;:&#34;info&#34;,&#34;msg&#34;:&#34;@pet details page&#34;}
</span></span><span class=line><span class=cl>{&#34;severity&#34;:&#34;info&#34;,&#34;msg&#34;:&#34;@add pet page&#34;}
</span></span><span class=line><span class=cl>{&#34;severity&#34;:&#34;info&#34;,&#34;msg&#34;:&#34;@veterinarians page&#34;}
</span></span><span class=line><span class=cl>{&#34;severity&#34;:&#34;info&#34;,&#34;msg&#34;:&#34;cookies was&#34;}</span></span></code></pre></div></div></div></div></div></p><p>From the left-hand menu click on <strong>Log Observer</strong> and ensure <strong>Index</strong> is set to <strong>splunk4rookies-workshop</strong>.</p><p>Next, click <strong>Add Filter</strong> search for the field <code>service_name</code> select the value <code>&lt;INSTANCE>-petclinic-service</code> and click <code>=</code> (include). You should now see only the log messages from your PetClinic application.</p><p><a href=#R-image-b6c250e57bbdfaedf876f4de4dcba82f class=lightbox-link><img src=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/60-log-observer-connect/../images/log-observer.png alt="Log Observer" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b6c250e57bbdfaedf876f4de4dcba82f><img src=../../../../../en/other/3-auto-instrumentation/3-java-microservices-k8s/60-log-observer-connect/../images/log-observer.png alt="Log Observer" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><h2 id=7-summary>7. Summary</h2><p>This is the end of the workshop and we have certainly covered a lot of ground. At this point, you should have metrics, traces (APM & RUM), logs, database query performance and code profiling being reported into Splunk Observability Cloud.</p><p><strong>Congratulations!</strong></p><p>docker system prune -a &ndash;volumes</p><p>81 . ~/workshop/petclinic/scripts/add_otel.sh
82 . ~/workshop/petclinic/scripts/update_logback.sh
83 ./mvnw clean install -DskipTests -P buildDocker
84 . ~/workshop/petclinic/scripts/push_docker.sh
85 . ~/workshop/petclinic/scripts/set_local.sh
86 kubectl apply -f ~/workshop/petclinic/petclinic-local.yaml
87 k9s
88 kubectl delete -f ~/workshop/petclinic/petclinic-local.yaml
89 kubectl apply -f ~/workshop/petclinic/petclinic-local.yaml
90 k9s
91 kubectl delete -f ~/workshop/petclinic/petclinic-local.yaml
92 kubectl apply -f ~/workshop/petclinic/petclinic-local.yaml
93 k9s
94 kubectl get deployments -l app.kubernetes.io/part-of=spring-petclinic -o name | xargs -I % kubectl patch % -p &ldquo;{"spec": {"template":{"metadata":{"annotations":{"instrumentation.opentelemetry.io/inject-java":"true"}}}}}&rdquo;</p><footer class=footline></footer></article></div></main></div><script src=../../../../../js/clipboard.min.js?1707220489 defer></script>
<script src=../../../../../js/perfect-scrollbar.min.js?1707220489 defer></script>
<script src=../../../../../js/theme.js?1707220489 defer></script></body></html>