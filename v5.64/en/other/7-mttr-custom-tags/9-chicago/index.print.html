<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.125.5"><meta name=generator content="Relearn 6.0.0+tip"><meta name=description content="Don’t forget Chicago We are nearly done, one more location to go… Chicago.
Since we have been having so many issues related to “location” and we have added that custom attribute via Opentelemetry Manual Instrumentation, lets go to the Splunk Observability UI and look at an APM metric set around that tag that I created for us.
Open a browser and navigate to http://[EC2-Address]:8010 Replace [EC2-Address] with the ip address of your host Select a few locations and hit the Login button."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Don't Forget Chicago :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="Don’t forget Chicago We are nearly done, one more location to go… Chicago.
Since we have been having so many issues related to “location” and we have added that custom attribute via Opentelemetry Manual Instrumentation, lets go to the Splunk Observability UI and look at an APM metric set around that tag that I created for us.
Open a browser and navigate to http://[EC2-Address]:8010 Replace [EC2-Address] with the ip address of your host Select a few locations and hit the Login button."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Don't Forget Chicago :: Splunk Observability Cloud Workshops"><meta property="og:description" content="Don’t forget Chicago We are nearly done, one more location to go… Chicago.
Since we have been having so many issues related to “location” and we have added that custom attribute via Opentelemetry Manual Instrumentation, lets go to the Splunk Observability UI and look at an APM metric set around that tag that I created for us.
Open a browser and navigate to http://[EC2-Address]:8010 Replace [EC2-Address] with the ip address of your host Select a few locations and hit the Login button."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="Ninja Workshops"><meta property="article:modified_time" content="2023-12-21T14:15:53+00:00"><meta itemprop=name content="Don't Forget Chicago :: Splunk Observability Cloud Workshops"><meta itemprop=description content="Don’t forget Chicago We are nearly done, one more location to go… Chicago.
Since we have been having so many issues related to “location” and we have added that custom attribute via Opentelemetry Manual Instrumentation, lets go to the Splunk Observability UI and look at an APM metric set around that tag that I created for us.
Open a browser and navigate to http://[EC2-Address]:8010 Replace [EC2-Address] with the ip address of your host Select a few locations and hit the Login button."><meta itemprop=dateModified content="2023-12-21T14:15:53+00:00"><meta itemprop=wordCount content="354"><title>Don't Forget Chicago :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/index.html rel=canonical type=text/html title="Don't Forget Chicago :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.64/images/favicon.ico?1721291801 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.64/css/fontawesome-all.min.css?1721291801 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.64/css/fontawesome-all.min.css?1721291801 rel=stylesheet></noscript><link href=/observability-workshop/v5.64/css/nucleus.css?1721291801 rel=stylesheet><link href=/observability-workshop/v5.64/css/auto-complete.css?1721291801 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.64/css/auto-complete.css?1721291801 rel=stylesheet></noscript><link href=/observability-workshop/v5.64/css/perfect-scrollbar.min.css?1721291801 rel=stylesheet><link href=/observability-workshop/v5.64/css/fonts.css?1721291801 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.64/css/fonts.css?1721291801 rel=stylesheet></noscript><link href=/observability-workshop/v5.64/css/theme.css?1721291801 rel=stylesheet><link href=/observability-workshop/v5.64/css/theme-splunk-light.css?1721291801 rel=stylesheet id=R-variant-style><link href=/observability-workshop/v5.64/css/chroma-relearn-light.css?1721291801 rel=stylesheet id=R-variant-chroma-style><link href=/observability-workshop/v5.64/css/variant.css?1721291801 rel=stylesheet><link href=/observability-workshop/v5.64/css/print.css?1721291801 rel=stylesheet media=print><link href=/observability-workshop/v5.64/css/format-print.css?1721291801 rel=stylesheet><script src=/observability-workshop/v5.64/js/variant.js?1721291801></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../../..",window.relearn.relBaseUri="../../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.64",window.index_js_url="/observability-workshop/v5.64/en/index.search.js?1721291801",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA"})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.64/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.64/en/other/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/index.html><span itemprop=name>Improving MTTR w/ Custom Tags</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>9. Don't Forget Chicago</span><meta itemprop=position content="4"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/8-rebuild-and-deploy/index.html title="Rebuild and Deploy (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/appendix-a-setup-mac/index.html title="Appendix - Setting up on Mac (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=dont-forget-chicago>Don't Forget Chicago</h1><h2 id=dont-forget-chicago>Don&rsquo;t forget Chicago</h2><p>We are nearly done, one more location to go&mldr; Chicago.</p><p>Since we have been having so many issues related to &ldquo;location&rdquo; and we have added that custom attribute via Opentelemetry Manual Instrumentation, lets go to the Splunk Observability UI and look at an APM metric set around that tag that I created for us.</p><p><a href=#R-image-09c00ad974055d8e270bc01e2e200873 class=lightbox-link><img alt=9-chicago-1-metricset class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/../images/9-chicago-1-metricset.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-09c00ad974055d8e270bc01e2e200873><img alt=9-chicago-1-metricset class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/../images/9-chicago-1-metricset.png></a></p><ul><li>Open a browser and navigate to <a href=http://[EC2-Address]:8010 rel=external target=_blank>http://[EC2-Address]:8010</a><ul><li>Replace [EC2-Address] with the ip address of your host</li></ul></li><li>Select a few locations and hit the Login button.<ul><li>Make sure to also select the Chicago Location and hit the Login button.</li></ul></li></ul><p><a href=#R-image-e4465abcb2cfd181981663924b7b74f4 class=lightbox-link><img alt=9-chicago-2-app class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/../images/9-chicago-2-app.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e4465abcb2cfd181981663924b7b74f4><img alt=9-chicago-2-app class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/../images/9-chicago-2-app.png></a></p><p>Uh oh! We received a 500 error, something is wrong there as well.</p><p><a href=#R-image-0504c7f34a89071da41ad5702e980e0e class=lightbox-link><img alt=9-chicago-3-map class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/../images/9-chicago-3-map.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0504c7f34a89071da41ad5702e980e0e><img alt=9-chicago-3-map class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/../images/9-chicago-3-map.png></a></p><ul><li>Return to the Splunk Observability UI and lets look once again at our Service Map</li><li>Select the Instruments Service</li><li>Click the Breakdowns dropdown on the right and select location</li></ul><p><a href=#R-image-1cdd3c5d747403e0f446d9f6f9a9404a class=lightbox-link><img alt=9-chicago-4-map-breakdown class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/../images/9-chicago-4-map-breakdown.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1cdd3c5d747403e0f446d9f6f9a9404a><img alt=9-chicago-4-map-breakdown class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/../images/9-chicago-4-map-breakdown.png></a></p><p>We see there was an un-handled exception thrown in the Instruments service, and some latency from our database that is related to the Chicago location!</p><ul><li>Click on Traces on the right</li><li>Click Errors Only</li><li>Click one of the traces</li></ul><p><a href=#R-image-665aef3df0561faa70ba0b218f8e9597 class=lightbox-link><img alt=9-chicago-5-trace class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/../images/9-chicago-5-trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-665aef3df0561faa70ba0b218f8e9597><img alt=9-chicago-5-trace class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/../images/9-chicago-5-trace.png></a></p><p>We can see the exception was thrown by Hibernate, however it was thrown in our method instruments: <code>InstrumentRepository.findInstruments</code></p><p><a href=#R-image-55a8b98a4dd8ef8dd700af6f0f0c9fe1 class=lightbox-link><img alt=9-chicago-6-span class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/../images/9-chicago-6-span.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-55a8b98a4dd8ef8dd700af6f0f0c9fe1><img alt=9-chicago-6-span class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/../images/9-chicago-6-span.png></a></p><h2 id=lets-play-developer-again>Let&rsquo;s play developer again</h2><ul><li>Edit the file <code>instruments: InstrumentRepository.findInstruments</code> using nano:</li></ul><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>nano</span><span class=w> </span><span class=n>instruments</span><span class=o>/</span><span class=n>src</span><span class=o>/</span><span class=n>main</span><span class=o>/</span><span class=n>java</span><span class=o>/</span><span class=n>com</span><span class=o>/</span><span class=n>shabushabu</span><span class=o>/</span><span class=n>javashop</span><span class=o>/</span><span class=n>instruments</span><span class=o>/</span><span class=n>repositories</span><span class=o>/</span><span class=n>FindInstrumentRepositoryImpl</span><span class=p>.</span><span class=na>java</span></span></span></code></pre></div><ul><li>Find the method: <code>findInstruments</code><ul><li>You know how to do this now, right?</li></ul></li></ul><p><a href=#R-image-b9bb1ff09466b481c8209239ee60f6ca class=lightbox-link><img alt=9-chicago-7-code class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/../images/9-chicago-7-code.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b9bb1ff09466b481c8209239ee60f6ca><img alt=9-chicago-7-code class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/../images/9-chicago-7-code.png></a></p><p>We can see the developer accidently added the Instruments database with the Chicago Instruments database!</p><p>Let&rsquo;s change the query and fix this, remove instruments_for_sale from our query.</p><ul><li>Change this:</li></ul><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>findInstruments</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>LOGGER</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;findInstruments Called (All)&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>Object</span><span class=w> </span><span class=n>obj</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entityManager</span><span class=p>.</span><span class=na>createNativeQuery</span><span class=p>(</span><span class=w> </span><span class=s>&#34;SELECT * FROM instruments_for_sale, instruments_for_sale_chicago&#34;</span><span class=p>).</span><span class=na>getResultList</span><span class=p>();</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>obj</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div><ul><li>to this:</li></ul><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>findInstruments</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>LOGGER</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;findInstruments Called (All)&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>Object</span><span class=w> </span><span class=n>obj</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entityManager</span><span class=p>.</span><span class=na>createNativeQuery</span><span class=p>(</span><span class=w> </span><span class=s>&#34;SELECT * FROM instruments_for_sale_chicago&#34;</span><span class=p>).</span><span class=na>getResultList</span><span class=p>();</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>obj</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div><ul><li><p>Save the changes: <strong>[CTRL]-o [Enter]</strong></p></li><li><p>Exit: <strong>[CTRL]-x</strong></p></li><li><p>Build and Deploy Application</p></li></ul><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./BuildAndDeploy.sh</span></span></code></pre></div><p>Now let&rsquo;s test the Chicago location once again</p><ul><li>Open a browser and navigate to <a href=http://[EC2-Address]:8010 rel=external target=_blank>http://[EC2-Address]:8010</a></li><li>Select the Chicago location and Login</li></ul><p>We now see the 500 error is gone!</p><ul><li>Let&rsquo;s confirm a clean Service Map:</li></ul><p><a href=#R-image-0aa3e308a0082271d87a7112e6051fc2 class=lightbox-link><img alt=9-chicago-8-map-clean class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/../images/9-chicago-8-map-clean.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0aa3e308a0082271d87a7112e6051fc2><img alt=9-chicago-8-map-clean class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.64/en/other/7-mttr-custom-tags/9-chicago/../images/9-chicago-8-map-clean.png></a></p><p>If you see a clean service map, free of errors and Latency you have successfully completed the Java Instrumentation Workshop!</p><p><strong>Congratulations!!!</strong></p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>Robert Castley</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Dec 21, 2023</span></span></footer></article></div></main></div><script src=/observability-workshop/v5.64/js/clipboard.min.js?1721291801 defer></script><script src=/observability-workshop/v5.64/js/perfect-scrollbar.min.js?1721291801 defer></script><script src=/observability-workshop/v5.64/js/theme.js?1721291801 defer></script></body></html>